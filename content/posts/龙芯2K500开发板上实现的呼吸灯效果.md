---
title: "é¾™èŠ¯2K500å¼€å‘æ¿ä¸Šå®ç°çš„å‘¼å¸ç¯æ•ˆæœ"
date: 2023-02-19T10:23:19+08:00
draft: false
description: åœ¨é¾™èŠ¯2K500å¼€å‘æ¿ä¸Šå®ç°çš„å‘¼å¸ç¯æ•ˆæœ
tags: ["linux", "é¾™èŠ¯"]
keywords: ["linux", "é¾™èŠ¯"]
categories: ["ç¼–ç¨‹", "æŠ€æœ¯"]
---

## å‰è¨€

æœ¬æ¥è¿™ç¯‡æ–‡ç« åº”è¯¥åœ¨ä¸Šå‘¨å°±å†™å®Œçš„ï¼Œä¸è¿‡çªç„¶è¢«å®‰æ’å‡ºå·®ï¼Œä¸€ç›´å¿™åˆ°äº†ç°åœ¨ï¼Œç»ˆäºå¯ä»¥é™ä¸‹å¿ƒæ¥åšäº›å…¶å®ƒäº‹æƒ…ã€‚

ä¹‹å‰å’Œé¾™èŠ¯3A5000ä¸»æœºä¸€èµ·é€è¿‡æ¥çš„è¿˜æœ‰ä¸€å—é¾™èŠ¯2K500çš„è¿·ä½ å¼€å‘æ¿ï¼Œæ•´ä¸ªæ¿å­ä¸åˆ°å·´æŒå¤§å°ã€‚ä¹‹å‰åªæ˜¯ç®€å•åšäº†ä¸Šç”µå¯åŠ¨ï¼Œè¿™æ¬¡æ‹¿åˆ°äº†æ¯”è¾ƒå®Œæ•´çš„å¼€å‘èµ„æ–™ï¼Œå¯ä»¥å°è¯•ä¸ºå¼€å‘æ¿ç¼–å†™ä¸€äº›ç¨‹åºäº†ã€‚

ç”±äºæš‚æ—¶æ²¡æœ‰å±å¹•ï¼Œåªèƒ½å…ˆè¯•ç€åšä¸€äº›å…¶å®ƒçš„äº‹æƒ…ï¼Œå¦‚é€šä¿¡å’ŒIOæ§åˆ¶ï¼Œå…¶ä¸­æœ€ç®€å•ï¼Œæœ€åŸºç¡€çš„å°±æ˜¯LEDç¯çš„æ§åˆ¶ã€‚ç„¶åæˆ‘å°±å‘ç°ï¼Œè¿™ä¸ªæ¿å­å±…ç„¶æœ‰ä¸€é¢—å¯ä»¥è°ƒèŠ‚äº®åº¦çš„LEDç¯ï¼æ²¡é”™ï¼Œä¹‹å‰åšçš„LEDæ§åˆ¶éƒ½åªèƒ½è¿›è¡Œå¼€å…³æ“ä½œï¼Œè€Œå¯ä»¥è°ƒèŠ‚äº®åº¦ï¼Œæ„å‘³ç€å¯ä»¥åšå‡ºæ›´å¤šçš„æ˜¾ç¤ºæ•ˆæœï¼Œè¿™æ¬¡æˆ‘å°±åšäº†ä¸€ä¸ªå‘¼å¸ç¯çš„æ•ˆæœã€‚

ç„¶åï¼Œæˆ‘ä¹Ÿç®€å•äº†è§£äº†ä¸€ä¸‹è¿™ç§äº®åº¦è°ƒèŠ‚çš„åŸç†ï¼Œå®é™…ä¸Šå°±æ˜¯é€šè¿‡è°ƒèŠ‚PWMè¾“å‡ºçš„å ç©ºæ¯”ï¼Œæ”¹å˜ä¸€ä¸ªå‘¨æœŸå†…è¾“å‡ºçš„é«˜ä½ç”µå¹³æ‰€å çš„æ¯”ä¾‹ï¼Œå®ç°æ§åˆ¶LEDç¯äº®åº¦çš„æ•ˆæœã€‚ç”±äºå¼•è„šè¾“å‡ºçš„ç”µå‹æ˜¯å›ºå®šçš„ï¼Œæ‰€ä»¥ä¸èƒ½é€šè¿‡æ”¹å˜ç”µå¹³æ¥æ§åˆ¶äº®åº¦ï¼Œè€Œæ”¹å˜é«˜ä½ç”µå¹³çš„å ç©ºæ¯”åˆ™æ˜¯å¦ä¸€ç§æ€è·¯ï¼ŒåµŒå…¥å¼è®¾å¤‡çš„å±å¹•èƒŒå…‰äº®åº¦è°ƒèŠ‚ä¹Ÿæ˜¯åŸºäºåŒæ ·çš„åŸç†ã€‚

## å¼€å‘æ¿ä¸Šç”µå¯åŠ¨ã€è¿æ¥ä¸²å£ç»ˆç«¯

ç”±äºæš‚æ—¶æ²¡æœ‰å±å¹•ï¼Œæƒ³è¦å’Œå¼€å‘æ¿è¿›è¡Œäº¤äº’å°±åªèƒ½é€šè¿‡ç»ˆç«¯çš„æ–¹å¼ï¼Œé€šå¸¸å¼€å‘æ¿éƒ½ä¼šæœ‰è°ƒè¯•ä¸²å£ï¼Œæˆ‘ä»¬å…ˆé€šè¿‡ä¸²å£ç»ˆç«¯ç™»å½•è®¾å¤‡ï¼Œé…ç½®å¥½ç½‘å£IPåœ°å€åï¼Œå†é€šè¿‡ç½‘ç»œè¿æ¥ç™»å½•è®¾å¤‡ã€‚

ä¸²å£çš„è¿æ¥æ–¹å¼å¦‚ä¸‹å›¾ï¼š

![](https://cdn.jsdelivr.net/gh/kira-96/Picture@main/blog/images/Snipaste_2023-02-25_11-59-37.png)

å°†ç»¿ã€ç™½ã€é»‘ä¸‰è‰²çº¿ä»¥å›¾ä¸­æ–¹å¼æ¥å¥½ï¼ˆçº¢çº¿ä¸ç”¨æ¥ï¼‰ï¼ŒUSBç«¯æ’å…¥åˆ°ç”µè„‘ï¼Œåº”è¯¥ä¸éœ€è¦è£…é©±åŠ¨ï¼Œç”µè„‘å¯ä»¥ç›´æ¥è¯†åˆ«å‡ºä¸²å£è®¾å¤‡ã€‚

æ‰“å¼€ä¸²å£ç»ˆç«¯å·¥å…·ï¼Œæ¯”å¦‚Windows MobaXtermï¼Œlinux minicomç­‰ï¼Œæˆ‘æ¯”è¾ƒå–œæ¬¢ç”¨puttyã€‚

é…ç½®å¥½ç«¯å£ï¼Œè®¾ç½®  
æ³¢ç‰¹ç‡ï¼š115200  
æ•°æ®ä½ï¼š8ä½  
åœæ­¢ä½ï¼š1ä½  
æ ¡éªŒï¼šæ—   
ç¡¬ä»¶æµæ§ï¼šæ— 

ç„¶åç»™å¼€å‘æ¿æ¥é€šç”µæºï¼Œå°±å¯ä»¥çœ‹åˆ°è°ƒè¯•è¾“å‡ºä¿¡æ¯äº†ã€‚

æŸ¥çœ‹ç³»ç»Ÿä¿¡æ¯ï¼Œå¯ä»¥çœ‹åˆ°è¿è¡Œçš„æ˜¯å®‰è£…äº†[`PREEMPT_RT`](https://mirrors.tuna.tsinghua.edu.cn/kernel/projects/rt/)è¡¥ä¸çš„å®æ—¶æ“ä½œç³»ç»Ÿã€‚

``` sh
[root@LS-GD ~]# uname -a
Linux LS-GD 5.10.0.lsgd-g434b00a6badf #1 PREEMPT Wed Sep 14 12:57:58 CST 2022 loongarch64 GNU/Linux
[root@LS-GD ~]# 
```

## é…ç½®äº¤å‰ç¼–è¯‘ç¯å¢ƒ

2K500å¼€å‘æ¿æ˜¯loongarch64æ¶æ„çš„åµŒå…¥å¼æ¿å¡ã€‚ä¸‹è½½å¥½å¯¹åº”çš„äº¤å‰ç¼–è¯‘å·¥å…·é“¾åï¼Œè§£å‹åˆ°ç³»ç»Ÿ`/opt/`ç›®å½•ä¸‹ã€‚æŒ‰æ‰‹å†Œæ¥å°±å¥½~

``` sh
$ sudo tar -xf toolchain-loongarch64-linux-gnu-gcc8-host-x86_64-2022-07-18.tar.xz -C /opt/
```

ç„¶åæˆ‘ä»¬éœ€è¦å°†äº¤å‰ç¼–è¯‘å™¨æ·»åŠ åˆ°ç³»ç»Ÿè·¯å¾„ï¼Œæ–¹ä¾¿æˆ‘ä»¬æ¥ä¸‹æ¥ä½¿ç”¨ã€‚

è¿™é‡Œæˆ‘ç›´æ¥å°†é…ç½®å†™æˆè„šæœ¬ï¼Œæ–¹ä¾¿ä¸‹æ¬¡ä½¿ç”¨ã€‚

``` sh
$ cd /opt/toolchain-loongarch64-linux-gnu-gcc8-host-x86_64-2022-07-18
# åˆ›å»ºè„šæœ¬
$ sudo touch environment-setup-loongarch64-linux-gnu
# æ·»åŠ å¯æ‰§è¡Œæƒé™
$ sudo chmod +x environment-setup-loongarch64-linux-gnu
# ä¿®æ”¹è„šæœ¬å†…å®¹
$ sudo vi environment-setup-loongarch64-linux-gnu
# å†…å®¹å¦‚ä¸‹~
```

``` sh
# environment-setup-loongarch64-linux-gnu
CC_PREFIX=/opt/toolchain-loongarch64-linux-gnu-gcc8-host-x86_64-2022-07-18
export PATH=$CC_PREFIX/bin:$PATH
export LD_LIBRARY_PATH=$CC_PREFIX/lib:$LD_LIBRARY_PATH
export LD_LIBRARY_PATH=$CC_PREFIX/loongarch64-linux-gnu/lib64:$LD_LIBRARY_PATH

export ARCH=loongarch
export CROSS_COMPILE=loongarch64-linux-gnu-
```

æ¥ä¸‹æ¥æµ‹è¯•ä¸€ä¸‹äº¤å‰ç¼–è¯‘ç¯å¢ƒ

``` sh
$ cd ~
$ . /opt/toolchain-loongarch64-linux-gnu-gcc8-host-x86_64-2022-07-18/environment-setup-loongarch64-linux-gnu
$ loongarch64-linux-gnu-gcc -v
Using built-in specs.
COLLECT_GCC=loongarch64-linux-gnu-gcc
COLLECT_LTO_WRAPPER=/opt/toolchain-loongarch64-linux-gnu-gcc8-host-x86_64-2022-07-18/bin/../libexec/gcc/loongarch64-linux-gnu/8.3.0/lto-wrapper
Target: loongarch64-linux-gnu
Configured with: /dev/shm/build_loongarch64_gcc8-host-x86_64_2022-07-18/src/gcc/configure --build=x86_64-redhat-linux --host=x86_64-redhat-linux --target=loongarch64-linux-gnu --program-prefix=loongarch64-linux-gnu- --prefix=/dev/shm/build_loongarch64_gcc8-host-x86_64_2022-07-18/cross --libdir=/dev/shm/build_loongarch64_gcc8-host-x86_64_2022-07-18/cross/lib --with-gxx-include-dir=/dev/shm/build_loongarch64_gcc8-host-x86_64_2022-07-18/cross/sysroot/usr/include/c++ --with-sysroot=/dev/shm/build_loongarch64_gcc8-host-x86_64_2022-07-18/cross/sysroot --with-native-system-header-dir=/usr/include --with-arch=loongarch64 --with-abi=lp64 --with-multilib-list=lp64d,lp64s --with-pkgversion='LoongArch\ GNU\ toolchain\ vec.32-rc2' --disable-linker-build-id --with-newlib --without-headers --disable-shared --enable-threads=posix --enable-tls --enable-languages=c,c++,fortran --enable-__cxa_atexit --enable-libquadmath-support --disable-gcov --disable-libcc1 --enable-initfini-array --disable-nls --disable-bootstrap --with-glibc-version=2.28
Thread model: posix
gcc version 8.3.0 (LoongArch GNU toolchain vec.32-rc2)
```

å¯ä»¥çœ‹åˆ°loongarchäº¤å‰ç¼–è¯‘å™¨çš„ç‰ˆæœ¬ä¿¡æ¯ï¼Œé…ç½®äº¤å‰ç¼–è¯‘ç¯å¢ƒå®Œæˆã€‚

## ç¼–å†™ç¨‹åº

æ§åˆ¶LEDç¯çš„äº®åº¦ï¼ŒLinuxç³»ç»Ÿå·²ç»æœ‰é©±åŠ¨å®ç°äº†ï¼Œæˆ‘ä»¬è¦åšçš„æ“ä½œå°±æ˜¯å‘ç›¸åº”çš„æ–‡ä»¶ä¸­å†™å…¥æ•°å€¼å³å¯ï¼Œå‰©ä¸‹çš„éƒ½æ˜¯ç³»ç»Ÿçš„äº‹æƒ…ã€‚

å¯¹äºä¸€èˆ¬çš„LEDç¯ï¼Œåªæœ‰å¼€å…³ä¸¤ä¸ªé€‰é¡¹ï¼Œå†™å…¥`0`ä¸ºå…³é—­ï¼Œå†™å…¥é0å€¼æ‰“å¼€ã€‚

è€Œå¯¹äºPWMæ§åˆ¶çš„LEDç¯ï¼Œéœ€è¦å†™å…¥å…·ä½“æ•°å€¼æ¥æ§åˆ¶ç¯çš„äº®åº¦ï¼ŒåŒæ ·ï¼Œ`0`ä¸ºå…³é—­ï¼Œå†™å…¥æ•°å€¼è¶Šå¤§LEDç¯å°±è¶Šäº®ï¼Œå½“ç„¶ï¼Œè¿™æ˜¯æœ‰ä¸Šé™çš„ã€‚è¿™é‡Œç»è¿‡æµ‹è¯•ï¼Œå†™å…¥`255`åï¼ŒLEDç¯è¾¾åˆ°æœ€äº®ã€‚

è€Œè¿™æ¬¡å†™çš„*å‘¼å¸ç¯*ç¨‹åºï¼Œåˆ™æ˜¯é€æ¸æ”¹å˜LEDç¯çš„äº®åº¦ï¼Œå®ç°LEDç¯ç¼“æ…¢é—ªçƒçš„æ•ˆæœã€‚  
è¿™é‡Œæˆ‘å°†äº®åº¦åˆ†ä¸º10ä¸ªçº§åˆ«ï¼Œä»`0`åˆ°`255`ï¼ˆ2^8 - 1ï¼‰ï¼Œæ¯100msæ”¹å˜ä¸€ä¸‹LEDç¯çš„äº®åº¦ï¼Œä¸€ä¸ªå‘¨æœŸåˆšå¥½ä¸º2ç§’ï¼ˆä»ç­åˆ°æœ€äº®ï¼Œç„¶åä»æœ€äº®åˆ°ç­ï¼‰ã€‚

è‡³äºä¸ºä»€ä¹ˆæ˜¯åˆ†ä¸ºè¿™10ä¸ªçº§åˆ«ï¼Œè€Œä¸æ˜¯ä»0~255å˜åŒ–ï¼Œå¤§å®¶å¯ä»¥è‡ªå·±è¯•è¯•ï¼Œçœ‹ä¸€ä¸‹æ•ˆæœã€‚

ä»¥ä¸‹æ˜¯å®Œæ•´ç¨‹åºï¼š

``` c
/**
 * file: led-pwm.c
 */

#include <fcntl.h>
#include <stdio.h>
#include <stdlib.h>
#include <unistd.h>

/**
 * @brief å‘¼å¸ç¯æ•ˆæœ
 * @param fd è®¾å¤‡æ–‡ä»¶
 */
void breath(int fd);

int main(int argc, char *argv[])
{
    if (argc < 2)
    {
        printf("Please input LED device.\n");
        return -1;
    }

    int fd;
    char file[64];
    sprintf(file, "%s/brightness", argv[1]);

    /* æ‰“å¼€è®¾å¤‡æ–‡ä»¶ */
    fd = open(file, O_WRONLY);
    if (fd < 0)
    {
        printf("Error open file: %s\n", file);
        return fd;
    }

    breath(fd);
    /* å…³é—­è®¾å¤‡æ–‡ä»¶ */
    close(fd);
    return 0;
}

void breath(int fd)
{
    const int values[10] = {0, 1, 2, 4, 8, 16, 32, 64, 128, 255};
    char buf[5];

    while (1)
    {
        /* ä»æš—åˆ°äº® */
        for (int i = 0; i < 10; i++)
        {
            sprintf(buf, "%d", values[i]);
            write(fd, buf, sizeof(buf));
            usleep(100000);  // ä¼‘çœ 100ms
        }
        /* ä»äº®åˆ°æš— */
        for (int i = 9; i >= 0; i--)
        {
            sprintf(buf, "%d", values[i]);
            write(fd, buf, sizeof(buf));
            usleep(100000);  // ä¼‘çœ 100ms
        }
    }
}
```

ç„¶åç¼–è¯‘ï¼Œå¾—åˆ°åœ¨å¼€å‘æ¿ä¸Šè¿è¡Œå¯æ‰§è¡Œç¨‹åºã€‚

``` sh
$ loongarch64-linux-gnu-gcc led-pwm.c -o led-pwm
```

## ä¸‹è½½ç¨‹åºåˆ°å¼€å‘æ¿

è¿è¡Œå‰çš„æœ€åä¸€æ­¥ï¼Œéœ€è¦å°†ç¼–è¯‘å¥½å¯æ‰§è¡Œç¨‹åºå¤åˆ¶åˆ°å¼€å‘æ¿ä¸Šï¼Œæˆ‘é€šå¸¸æ˜¯ä½¿ç”¨`scp`å‘½ä»¤å°†æ–‡ä»¶å¤åˆ¶åˆ°å¼€å‘æ¿ã€‚

éœ€è¦å…ˆåœ¨ä¸²å£ç»ˆç«¯é€šè¿‡`ifconfig`è®¾ç½®å¼€å‘æ¿çš„ç½‘å£IPï¼Œç¬¬ä¸€æ¬¡ä½¿ç”¨`scp`å‰ï¼Œéœ€è¦å…ˆç”¨`ssh`ç™»å½•åˆ°å¼€å‘æ¿ã€‚

> ç³»ç»Ÿé»˜è®¤è´¦æˆ·ä¸º`root`ï¼Œé»˜è®¤å¯†ç ä¸º`123`

ç”±äºä¹‹å‰ä¸çŸ¥é“é»˜è®¤å¯†ç æ˜¯ä»€ä¹ˆï¼Œæ‰€ä»¥å…ˆç”¨`passwd`å‘½ä»¤æ”¹äº†å¯†ç ğŸ˜…ã€‚

``` sh
# ä¾‹ï¼šå°†å¯æ‰§è¡Œç¨‹åºå¤åˆ¶åˆ°å¼€å‘æ¿
$ scp ./led-pwm root@192.168.0.10:~/
# ä½¿ç”¨ ssh ç™»å½•å¼€å‘æ¿
$ ssh root@192.168.0.10
# ä¸ºç¨‹åºæ·»åŠ å¯æ‰§è¡Œæƒé™ï¼ˆåœ¨å¼€å‘æ¿æ“ä½œï¼‰
~ $ chmod +x ./led-pwm
# è¿è¡Œç¨‹åº
~ $ ./led-pwm /sys/class/leds/led1-pwm
```

## å®é™…è¿è¡Œæ•ˆæœ

ç”±äºå¼€å‘æ¿çš„LED2é»˜è®¤æ˜¯å¿ƒè·³æ¨¡å¼[`heartbeat`]ï¼Œæ‰€ä»¥ä¼šä¸€ç›´ä¸€é—ªä¸€é—ªçš„ï¼Œåœ¨è¿è¡Œå‘¼å¸ç¯ç¨‹åºå‰ï¼Œå¯ä»¥å…ˆæŠŠLED2æ”¹ä¸º[`none`]æ¨¡å¼ã€‚

``` sh
~ $ echo none > /sys/class/leds/led2/trigger
```

æ‰§è¡Œç¼–å†™çš„å‘¼å¸ç¯ç¨‹åº

``` sh
~ $ ./led-pwm /sys/class/leds/led1-pwm
```

å®é™…è¿è¡Œæ•ˆæœå¦‚ä¸‹ï¼š

{{< bilibili BV1hY411r7bx >}}
