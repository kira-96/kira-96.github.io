<!doctype html><html lang=zh dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Qt Remote Objects 简单使用 | ✨kiraの博客</title><meta name=keywords content="Qt"><meta name=description content="学习使用 Qt Remote Objects"><meta name=author content><link rel=canonical href=https://kira-96.github.io/posts/qt-remote-objects/><link crossorigin=anonymous href=/assets/css/stylesheet.815f49216b75997834400fbcaec870253547212931c1c398d7d108d9395a8c5b.css integrity="sha256-gV9JIWt1mXg0QA+8rshwJTVHISkxwcOY19EI2TlajFs=" rel="preload stylesheet" as=style><link rel=icon href=https://cdn.jsdelivr.net/gh/kira-96/kira-96.github.io@gh-pages/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://cdn.jsdelivr.net/gh/kira-96/kira-96.github.io@gh-pages/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://cdn.jsdelivr.net/gh/kira-96/kira-96.github.io@gh-pages/favicon-32x32.png><link rel=apple-touch-icon href=https://cdn.jsdelivr.net/gh/kira-96/kira-96.github.io@gh-pages/icons/apple-icon-180x180.png><link rel=mask-icon href=https://cdn.jsdelivr.net/gh/kira-96/kira-96.github.io@gh-pages/icons/apple-icon-76x76.png><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=zh href=https://kira-96.github.io/posts/qt-remote-objects/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><link rel=manifest href=https://cdn.jsdelivr.net/gh/kira-96/kira-96.github.io@gh-pages/manifest.json><link rel=stylesheet href=https://cdn.bootcdn.net/ajax/libs/lxgw-wenkai-screen-webfont/1.7.0/style.min.css><script src=https://fastly.jsdelivr.net/npm/live2d-widgets@0/autoload.js></script><script type=text/javascript src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><meta property="og:url" content="https://kira-96.github.io/posts/qt-remote-objects/"><meta property="og:site_name" content="✨kiraの博客"><meta property="og:title" content="Qt Remote Objects 简单使用"><meta property="og:description" content="学习使用 Qt Remote Objects"><meta property="og:locale" content="zh"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2025-04-17T16:15:28+08:00"><meta property="article:modified_time" content="2025-04-18T11:12:36+08:00"><meta property="article:tag" content="Qt"><meta name=twitter:card content="summary"><meta name=twitter:title content="Qt Remote Objects 简单使用"><meta name=twitter:description content="学习使用 Qt Remote Objects"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://kira-96.github.io/posts/"},{"@type":"ListItem","position":2,"name":"Qt Remote Objects 简单使用","item":"https://kira-96.github.io/posts/qt-remote-objects/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Qt Remote Objects 简单使用","name":"Qt Remote Objects 简单使用","description":"学习使用 Qt Remote Objects","keywords":["Qt"],"articleBody":"介绍 Qt Remote Objects 是Qt推出的进程间通信（IPC）模块，用于实现进程间或远程网络间通信，简化分布式系统的开发。通过抽象底层通信细节，让开发者能够像操作本地对象一样调用远程对象的属性和方法。\n关键组成\n源对象（Source）\n在服务端定义实际对象，对外暴露数据和方法。例如，一个控制设备的类可能包含状态属性和控制指令方法。 副本对象（Replica）\n客户端通过副本对象（Replica）与源对象（Source）交互。Replica 会将客户端的操作转发给服务端，并同步更新属性变化。 通信节点（Node）\n服务端通过 QRemoteObjectHost 发布对象，客户端通过 QRemoteObjectNode 连接服务端并获取副本对象（Replica）。 关键特性\n透明通信：客户端调用远程方法如同本地调用。 自动同步：源对象的属性变化会自动同步到所有客户端副本。 多协议支持：支持本地进程通信（local://）、TCP 网络通信（tcp://）等。 动态发现：可选注册中心（Registry）实现服务自动发现。 典型场景\n多进程协作：例如 GUI 应用与后台服务分离。 分布式应用：主控程序与多个子进程共享配置数据。 跨设备控制：如通过 PC 控制嵌入式设备。 微服务架构：将功能模块拆分为独立进程，通过 QtRO 通信。 QtRO与RPC框架的功能比较\n通信模式 Qt Remote Objects RPC(Remote Procedure Call) 多客户端 ✅ ✅ 单向调用 ✅（Slots） ✅ 发布-订阅 ✅（Signals） ❌ 双向流式 ❌ ✅ 状态同步 ✅ ❌ 补充说明\nReplica 编译器（repc）基于 API 定义文件（“rep”文件）生成 QObject 头文件。当 repc 处理这些文件时，repc 会生成 Source 头文件和 Replica 头文件。\nQt Remote Objects 支持静态和动态副本两种方式，两种方式的客户端代码编写方式有所不同。\n虽然 Qt Remote Objects 支持通过网络共享任何 QObject 对象，但使用 repc 定义对象有几个优点：\n虽然动态副本（DynamicReplicas）很有用，但使用起来更麻烦。在对象初始化之前，是不知道API的，并且使用 API 时需要通过元对象（QMetaObject）的方法进行字符串查找。 在编译时知道接口可以更容易发现编译时与运行时的问题。 rep 格式支持默认值，如果您无法确保在实例化副本对象（Replica）时源对象（Source）可用，则可以使用默认值。 简单示例 静态方式 定义接口 QtRO 静态方式需要先定义副本对象接口文件（.rep），文件语法可以参考Qt Remote Objects Compiler。\n这里我编写了一个简单的设备控制接口文件：\ndevicecontroller.rep ▼ 1 2 3 4 5 6 7 8 class DeviceController { ENUM Status { Ok, Error }; // 状态枚举 PROP(Status status = Ok READONLY); // 状态属性，只读 SLOT(void controlDevice(QString command)); // 槽函数 SLOT(void uploadFile(QString fileName, QByteArray fileData)); // 槽函数 SIGNAL(fileReceived(QString fileName)); // 信号 }; 接下来需要把接口文件添加到项目中，项目分为服务端和客户端。\nmyproject.pro ▼ 1 2 3 4 5 6 7 8 9 10 11 12 13 # qmake中的写法 # 添加 Qt Remote Objects 支持 QT += remoteobjects # 服务端项目（生成源对象） REPC_SOURCE += devicecontroller.rep # 客户端项目（生成副本对象） REPC_REPLICA += devicecontroller.rep # 同时生成源对象和副本对象的头文件 REPC_MERGED = devicecontroller.rep CMakeLists.txt ▼ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 # cmake中的写法 set(CMAKE_INCLUDE_CURRENT_DIR ON) # 添加 Qt Remote Objects 支持 find_package(Qt6 REQUIRED COMPONENTS Core RemoteObjects) # 服务端项目（生成源对象） qt_add_repc_sources(${PROJECT_NAME} devicecontroller.rep ) # 客户端项目（生成副本对象） qt_add_repc_replicas(${PROJECT_NAME} devicecontroller.rep ) # 同时生成源对象和副本对象的头文件 qt_add_repc_merged(${PROJECT_NAME} devicecontroller.rep ) 添加完成后，构建一下项目，可以看到生成了源对象头文件rep_devicecontroller_source.h和副本对象头文件rep_devicecontroller_replica.h。\nrep_devicecontroller_source.h ▼ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 #ifndef REP_DEVICECONTROLLER_SOURCE_H #define REP_DEVICECONTROLLER_SOURCE_H // This is an autogenerated file. // Do not edit this file, any changes made will be lost the next time it is generated. #include #include #include #include #include #include #include using namespace Qt::Literals::StringLiterals; class DeviceControllerSource : public QObject { Q_OBJECT Q_CLASSINFO(QCLASSINFO_REMOTEOBJECT_TYPE, \"DeviceController\") Q_CLASSINFO(QCLASSINFO_REMOTEOBJECT_SIGNATURE, \"3947cd1a592cb801ecdf88688ceb676821764dc3\") Q_PROPERTY(Status status READ status NOTIFY statusChanged) public: enum Status { Ok = 0, Error = 1, }; Q_ENUM(Status) public: explicit DeviceControllerSource(QObject *parent = nullptr) : QObject(parent) { qRegisterMetaType\u003cStatus\u003e(); } public: ~DeviceControllerSource() override = default; virtual Status status() const = 0; Q_SIGNALS: void statusChanged(DeviceControllerSource::Status status); void fileReceived(QString fileName); public Q_SLOTS: virtual void controlDevice(QString command) = 0; virtual void uploadFile(QString fileName, QByteArray fileData) = 0; private: friend class QT_PREPEND_NAMESPACE(QRemoteObjectNode); }; class DeviceControllerSimpleSource : public DeviceControllerSource { Q_OBJECT public: explicit DeviceControllerSimpleSource(QObject *parent = nullptr) : DeviceControllerSource(parent) , m_status(Ok) {} public: ~DeviceControllerSimpleSource() override = default; Status status() const override { return m_status; } protected: virtual void setStatus(Status status) { if (status != m_status) { m_status = status; Q_EMIT statusChanged(m_status); } } private: Status m_status; }; ... #endif // REP_DEVICECONTROLLER_SOURCE_H 服务端 接下来编写服务端代码：\nmydeviceservice.h ▼ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 #ifndef MYDEVICESERVICE_H #define MYDEVICESERVICE_H #include \"rep_devicecontroller_source.h\" class MyDeviceService : public DeviceControllerSimpleSource { Q_OBJECT public: explicit MyDeviceService(QObject *parent = Q_NULLPTR); ~MyDeviceService(); public Q_SLOTS: virtual void controlDevice(QString command) Q_DECL_OVERRIDE; virtual void uploadFile(QString fileName, QByteArray fileData) Q_DECL_OVERRIDE; }; #endif // MYDEVICESERVICE_H mydeviceservice.cpp ▼ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 #include \"mydeviceservice.h\" #include MyDeviceService::MyDeviceService(QObject *parent) : DeviceControllerSimpleSource{parent} { qDebug() \u003c\u003c __PRETTY_FUNCTION__; } MyDeviceService::~MyDeviceService() { qDebug() \u003c\u003c __PRETTY_FUNCTION__; } void MyDeviceService::controlDevice(QString command) { qDebug() \u003c\u003c __PRETTY_FUNCTION__ \u003c\u003c command; setStatus(Error); } void MyDeviceService::uploadFile(QString fileName, QByteArray fileData) { qDebug() \u003c\u003c __PRETTY_FUNCTION__; qDebug() \u003c\u003c \"Receiving file:\" \u003c\u003c fileName \u003c\u003c \"\\nContent: \\n\" \u003c\u003c QString::fromUtf8(fileData); setStatus(Ok); Q_EMIT fileReceived(fileName); } 启动服务端：\nmain.cpp ▼ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 #include #include \"mydeviceservice.h\" int main(int argc, char *argv[]) { QCoreApplication a(argc, argv); QRemoteObjectHost host; // 进程间通信（IPC） // host.setHostUrl(QUrl(\"local:devicecontroller\")); // 远程过程调用（RPC） host.setHostUrl(QUrl(\"tcp://0.0.0.0:2333\")); MyDeviceService service; /** * 第一个参数是源对象指针 * 第二个参数是源对象名字，客户端可根据名字获取源对象， * 使用动态副本的方式时，必须填写源对象名字。 */ host.enableRemoting(\u0026service, \"mydeviceservice\"); return a.exec(); } 客户端 客户端代码：\nmydevicecontroller.h ▼ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 #ifndef MYDEVICECONTROLLER_H #define MYDEVICECONTROLLER_H #include #include QT_BEGIN_NAMESPACE class QRemoteObjectNode; QT_END_NAMESPACE class MyDeviceController : public QObject { Q_OBJECT public: explicit MyDeviceController(QObject *parent = Q_NULLPTR); Q_INVOKABLE void test(const QUrl \u0026url); private: QPointer\u003cQRemoteObjectNode\u003e node; // QPointer replica; }; #endif // MYDEVICECONTROLLER_H mydevicecontroller.h ▼ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 #include \"mydevicecontroller.h\" #include \"rep_devicecontroller_replica.h\" MyDeviceController::MyDeviceController(QObject *parent) : QObject{parent} , node{new QRemoteObjectNode(this)} {} void MyDeviceController::test(const QUrl \u0026url) { node-\u003econnectToNode(url); qDebug() \u003c\u003c \"connected to:\" \u003c\u003c url; auto *replica = node-\u003eacquire\u003cDeviceControllerReplica\u003e(\"mydeviceservice\"); connect(replica, \u0026DeviceControllerReplica::statusChanged, this, [\u0026](DeviceControllerReplica::Status s) { qDebug() \u003c\u003c \"Device status changed to:\" \u003c\u003c s; }); connect(replica, \u0026DeviceControllerReplica::fileReceived, this, [\u0026](QString fileName) { qDebug() \u003c\u003c \"File sent. file -\" \u003c\u003c fileName; }); connect(replica, \u0026DeviceControllerReplica::stateChanged, this, [this](QRemoteObjectReplica::State state, QRemoteObjectReplica::State oldState) { qDebug() \u003c\u003c \"replica state changed:\" \u003c\u003c oldState \u003c\u003c \"→\" \u003c\u003c state; // 副本对象状态可用时才能调用接口 if (state == QRemoteObjectReplica::Valid) { DeviceControllerReplica *replica = qobject_cast\u003cDeviceControllerReplica*\u003e(sender()); Q_ASSERT(replica); replica-\u003econtrolDevice(\"echo\"); replica-\u003euploadFile(\"test.txt\", QString(\"你好！世界。\").toUtf8()); } }); } 客户端调用：\nmain.cpp ▼ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 #include #include #include \"mydevicecontroller.h\" int main(int argc, char *argv[]) { QCoreApplication a(argc, argv); MyDeviceController client; // 进程间通信（IPC） // client.test(QUrl(\"local:devicecontroller\")); // 远程过程调用（RPC） client.test(QUrl(\"tcp://192.168.1.3:2333\")); return a.exec(); } 动态副本 动态副本的客户端代码有所不同。\nmydevicecontroller.h ▼ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 #ifndef MYDEVICECONTROLLER_H #define MYDEVICECONTROLLER_H #include #include QT_BEGIN_NAMESPACE class QRemoteObjectNode; QT_END_NAMESPACE class MyDeviceController : public QObject { Q_OBJECT public: explicit MyDeviceController(QObject *parent = Q_NULLPTR); Q_INVOKABLE void test(const QUrl \u0026url); Q_SLOT void onStatusChanged(int); Q_SLOT void onFileReceived(const QString\u0026); private: QPointer\u003cQRemoteObjectNode\u003e node; }; #endif // MYDEVICECONTROLLER_H mydevicecontroller.cpp ▼ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 #include \"mydevicecontroller.h\" #include \"rep_devicecontroller_replica.h\" MyDeviceController::MyDeviceController(QObject *parent) : QObject{parent} , node{new QRemoteObjectNode(this)} {} void MyDeviceController::test(const QUrl \u0026url) { node-\u003econnectToNode(url); qDebug() \u003c\u003c \"connected to:\" \u003c\u003c url; auto *replica = node-\u003eacquireDynamic(\"mydeviceservice\"); connect(replica, \u0026QRemoteObjectDynamicReplica::stateChanged, this, [this](QRemoteObjectReplica::State state, QRemoteObjectReplica::State oldState) { qDebug() \u003c\u003c \"replica state changed:\" \u003c\u003c oldState \u003c\u003c \"→\" \u003c\u003c state; if (state == QRemoteObjectReplica::Valid) { QRemoteObjectDynamicReplica *replica = qobject_cast\u003cQRemoteObjectDynamicReplica*\u003e(sender()); Q_ASSERT(replica); /** 由于使用动态副本方式，在副本初始化完成前，无法预先知道API， * 只有在副本对象状态可用时，才能进行信号-槽连接。 * 并且无法使用自定义类型参数，如之前定义的枚举。 */ // connect(replica, SIGNAL(statusChanged(int)), this, SLOT(onStatusChanged(int))); connect(replica, SIGNAL(fileReceived(QString)), this, SLOT(onFileReceived(QString))); /** 调用接口需要使用元对象的`invokeMethod`方法 */ QMetaObject::invokeMethod(replica, \"controlDevice\", Q_ARG(QString, \"echo\")); QMetaObject::invokeMethod(replica, \"uploadFile\", Q_ARG(QString, \"test.txt\"), Q_ARG(QByteArray, QString(\"你好！世界。\").toUtf8())); } }); } void MyDeviceController::onStatusChanged(int s) { qDebug() \u003c\u003c \"Device status changed to:\" \u003c\u003c s; } void MyDeviceController::onFileReceived(const QString \u0026fileName) { qDebug() \u003c\u003c \"File sent. file -\" \u003c\u003c fileName; } 注意事项 Qt Remote Objects 使用内部协议在进程和/或设备之间传递数据。所有部分都需要使用相同的协议版本：如果版本不匹配，连接节点将输出警告，主机节点将不发送任何数据。\n目前发布的版本：\n协议版本 Qt版本 \u003c1.2 在 QtRO 的技术预览阶段使用。 1.2 5.12.0 1.3 5.12.4 2.0 6.2.0 See Qt Remote Objects Protocol Versioning.\n参考\nQt Remote Objects远程调用模块的基本使用 Qt Remote Objects 学习笔记（Qt 远端可调用对象框架) Qt Remote Object（QtRO）动态Replica实现进程间通信 ","wordCount":"1233","inLanguage":"zh","datePublished":"2025-04-17T16:15:28+08:00","dateModified":"2025-04-18T11:12:36+08:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://kira-96.github.io/posts/qt-remote-objects/"},"publisher":{"@type":"Organization","name":"✨kiraの博客","logo":{"@type":"ImageObject","url":"https://cdn.jsdelivr.net/gh/kira-96/kira-96.github.io@gh-pages/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://kira-96.github.io/ accesskey=h title="✨kiraの博客 (Alt + H)">✨kiraの博客</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)" aria-label="Toggle theme">
<svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg>
<svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://kira-96.github.io/ title=🏠主页><span>🏠主页</span></a></li><li><a href=https://kira-96.github.io/notes/ title=📓笔记><span>📓笔记</span></a></li><li><a href=https://kira-96.github.io/search/ title=🔍️搜索><span>🔍️搜索</span></a></li><li><a href=https://kira-96.github.io/archives/ title=🗃️存档><span>🗃️存档</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://kira-96.github.io/>主页</a>&nbsp;»&nbsp;<a href=https://kira-96.github.io/posts/>Posts</a></div><h1 class="post-title entry-hint-parent">Qt Remote Objects 简单使用</h1><div class=post-description>学习使用 Qt Remote Objects</div><div class=post-meta><span title='2025-04-17 16:15:28 +0800 +0800'>四月 17, 2025</span>&nbsp;·&nbsp;6 分钟&nbsp;·&nbsp;1233 字&nbsp;|&nbsp;<a href=https://github.com/kira-96/kira-96.github.io/tree/main/content/posts/ rel="noopener noreferrer edit" target=_blank>✏️编辑</a></div></header><aside id=toc-container class="toc-container wide"><div class=toc><details open><summary accesskey=c title="(Alt + C)"><span class=details>目录</span></summary><div class=inner><ul><li><a href=#%e4%bb%8b%e7%bb%8d aria-label=介绍>介绍</a></li><li><a href=#%e7%ae%80%e5%8d%95%e7%a4%ba%e4%be%8b aria-label=简单示例>简单示例</a><ul><li><a href=#%e9%9d%99%e6%80%81%e6%96%b9%e5%bc%8f aria-label=静态方式>静态方式</a><ul><li><a href=#%e5%ae%9a%e4%b9%89%e6%8e%a5%e5%8f%a3 aria-label=定义接口>定义接口</a></li><li><a href=#%e6%9c%8d%e5%8a%a1%e7%ab%af aria-label=服务端>服务端</a></li><li><a href=#%e5%ae%a2%e6%88%b7%e7%ab%af aria-label=客户端>客户端</a></li></ul></li><li><a href=#%e5%8a%a8%e6%80%81%e5%89%af%e6%9c%ac aria-label=动态副本>动态副本</a></li></ul></li><li><a href=#%e6%b3%a8%e6%84%8f%e4%ba%8b%e9%a1%b9 aria-label=注意事项>注意事项</a></li></ul></div></details></div></aside><script>let activeElement,elements;window.addEventListener("DOMContentLoaded",function(){checkTocPosition(),elements=document.querySelectorAll("h1[id],h2[id],h3[id],h4[id],h5[id],h6[id]"),activeElement=elements[0];const t=encodeURI(activeElement.getAttribute("id")).toLowerCase();document.querySelector(`.inner ul li a[href="#${t}"]`).classList.add("active")},!1),window.addEventListener("resize",function(){checkTocPosition()},!1),window.addEventListener("scroll",()=>{activeElement=Array.from(elements).find(e=>{if(getOffsetTop(e)-window.pageYOffset>0&&getOffsetTop(e)-window.pageYOffset<window.innerHeight/2)return e})||activeElement,elements.forEach(e=>{const t=encodeURI(e.getAttribute("id")).toLowerCase();e===activeElement?document.querySelector(`.inner ul li a[href="#${t}"]`).classList.add("active"):document.querySelector(`.inner ul li a[href="#${t}"]`).classList.remove("active")})},!1);const main=parseInt(getComputedStyle(document.body).getPropertyValue("--article-width"),10),toc=parseInt(getComputedStyle(document.body).getPropertyValue("--toc-width"),10),gap=parseInt(getComputedStyle(document.body).getPropertyValue("--gap"),10);function checkTocPosition(){const e=document.body.scrollWidth;e-main-toc*2-gap*4>0?document.getElementById("toc-container").classList.add("wide"):document.getElementById("toc-container").classList.remove("wide")}function getOffsetTop(e){if(!e.getClientRects().length)return 0;let t=e.getBoundingClientRect(),n=e.ownerDocument.defaultView;return t.top+n.pageYOffset}</script><div class=post-content><h2 id=介绍>介绍<a hidden class=anchor aria-hidden=true href=#介绍>#</a></h2><p><code>Qt Remote Objects</code> 是Qt推出的进程间通信（IPC）模块，用于实现进程间或远程网络间通信，简化分布式系统的开发。通过抽象底层通信细节，让开发者能够像操作本地对象一样调用远程对象的属性和方法。</p><p><strong>关键组成</strong></p><ol><li>源对象（Source）<br>在服务端定义实际对象，对外暴露数据和方法。例如，一个控制设备的类可能包含状态属性和控制指令方法。</li><li>副本对象（Replica）<br>客户端通过副本对象（Replica）与源对象（Source）交互。<code>Replica</code> 会将客户端的操作转发给服务端，并同步更新属性变化。</li><li>通信节点（Node）<br>服务端通过 <code>QRemoteObjectHost</code> 发布对象，客户端通过 <code>QRemoteObjectNode</code> 连接服务端并获取副本对象（Replica）。</li></ol><p><strong>关键特性</strong></p><ul><li>透明通信：客户端调用远程方法如同本地调用。</li><li>自动同步：源对象的属性变化会自动同步到所有客户端副本。</li><li>多协议支持：支持本地进程通信（<code>local://</code>）、TCP 网络通信（<code>tcp://</code>）等。</li><li>动态发现：可选注册中心（Registry）实现服务自动发现。</li></ul><p><strong>典型场景</strong></p><ul><li>多进程协作：例如 GUI 应用与后台服务分离。</li><li>分布式应用：主控程序与多个子进程共享配置数据。</li><li>跨设备控制：如通过 PC 控制嵌入式设备。</li><li>微服务架构：将功能模块拆分为独立进程，通过 QtRO 通信。</li></ul><p><strong>QtRO与RPC框架的功能比较</strong></p><table><thead><tr><th>通信模式</th><th>Qt Remote Objects</th><th>RPC(Remote Procedure Call)</th></tr></thead><tbody><tr><td>多客户端</td><td>✅</td><td>✅</td></tr><tr><td>单向调用</td><td>✅（Slots）</td><td>✅</td></tr><tr><td>发布-订阅</td><td>✅（Signals）</td><td>❌</td></tr><tr><td>双向流式</td><td>❌</td><td>✅</td></tr><tr><td>状态同步</td><td>✅</td><td>❌</td></tr></tbody></table><p><strong>补充说明</strong></p><p>Replica 编译器（repc）基于 API 定义文件（“rep”文件）生成 QObject 头文件。当 repc 处理这些文件时，repc 会生成 <code>Source</code> 头文件和 <code>Replica</code> 头文件。<br>Qt Remote Objects 支持<strong>静态</strong>和<strong>动态副本</strong>两种方式，两种方式的客户端代码编写方式有所不同。</p><p>虽然 Qt Remote Objects 支持通过网络共享任何 QObject 对象，但使用 repc 定义对象有几个优点：</p><ul><li>虽然动态副本（DynamicReplicas）很有用，但使用起来更麻烦。在对象初始化之前，是不知道API的，并且使用 API 时需要通过元对象（QMetaObject）的方法进行字符串查找。</li><li>在编译时知道接口可以更容易发现编译时与运行时的问题。</li><li>rep 格式支持默认值，如果您无法确保在实例化副本对象（Replica）时源对象（Source）可用，则可以使用默认值。</li></ul><h2 id=简单示例>简单示例<a hidden class=anchor aria-hidden=true href=#简单示例>#</a></h2><h3 id=静态方式>静态方式<a hidden class=anchor aria-hidden=true href=#静态方式>#</a></h3><h4 id=定义接口>定义接口<a hidden class=anchor aria-hidden=true href=#定义接口>#</a></h4><p>QtRO 静态方式需要先定义副本对象接口文件（.rep），文件语法可以参考<a href=https://doc.qt.io/qt-6/qtremoteobjects-repc.html>Qt Remote Objects Compiler</a>。</p><p>这里我编写了一个简单的设备控制接口文件：</p><div class=mac-codeblock><div class=mac-titlebar><div class=mac-left-group><span class=mac-close></span>
<span class=mac-minimize></span>
<span class=mac-expand></span></div><div class=mac-title title=devicecontroller.rep>devicecontroller.rep</div><div class=mac-right-group><button class=fold-button>&#9660;</button></div></div><div class=mac-content><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=k>class</span> <span class=nc>DeviceController</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>ENUM</span> <span class=n>Status</span> <span class=p>{</span> <span class=n>Ok</span><span class=p>,</span> <span class=n>Error</span> <span class=p>};</span>  <span class=c1>// 状态枚举
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=n>PROP</span><span class=p>(</span><span class=n>Status</span> <span class=n>status</span> <span class=o>=</span> <span class=n>Ok</span> <span class=n>READONLY</span><span class=p>);</span>  <span class=c1>// 状态属性，只读
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=n>SLOT</span><span class=p>(</span><span class=kt>void</span> <span class=n>controlDevice</span><span class=p>(</span><span class=n>QString</span> <span class=n>command</span><span class=p>));</span>  <span class=c1>// 槽函数
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=n>SLOT</span><span class=p>(</span><span class=kt>void</span> <span class=n>uploadFile</span><span class=p>(</span><span class=n>QString</span> <span class=n>fileName</span><span class=p>,</span> <span class=n>QByteArray</span> <span class=n>fileData</span><span class=p>));</span>  <span class=c1>// 槽函数
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=n>SIGNAL</span><span class=p>(</span><span class=n>fileReceived</span><span class=p>(</span><span class=n>QString</span> <span class=n>fileName</span><span class=p>));</span>  <span class=c1>// 信号
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>};</span></span></span></code></pre></td></tr></table></div></div></div></div><p>接下来需要把接口文件添加到项目中，项目分为服务端和客户端。</p><div class=mac-codeblock><div class=mac-titlebar><div class=mac-left-group><span class=mac-close></span>
<span class=mac-minimize></span>
<span class=mac-expand></span></div><div class=mac-title title=myproject.pro>myproject.pro</div><div class=mac-right-group><button class=fold-button>&#9660;</button></div></div><div class=mac-content><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-make data-lang=make><span class=line><span class=cl><span class=c># qmake中的写法
</span></span></span><span class=line><span class=cl><span class=c></span>
</span></span><span class=line><span class=cl><span class=c># 添加 Qt Remote Objects 支持
</span></span></span><span class=line><span class=cl><span class=c></span><span class=nv>QT</span> <span class=o>+=</span> remoteobjects
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c># 服务端项目（生成源对象）
</span></span></span><span class=line><span class=cl><span class=c></span><span class=nv>REPC_SOURCE</span> <span class=o>+=</span> devicecontroller.rep
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c># 客户端项目（生成副本对象）
</span></span></span><span class=line><span class=cl><span class=c></span><span class=nv>REPC_REPLICA</span> <span class=o>+=</span> devicecontroller.rep
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c># 同时生成源对象和副本对象的头文件
</span></span></span><span class=line><span class=cl><span class=c></span><span class=nv>REPC_MERGED</span> <span class=o>=</span> devicecontroller.rep
</span></span></code></pre></td></tr></table></div></div></div></div><div class=mac-codeblock><div class=mac-titlebar><div class=mac-left-group><span class=mac-close></span>
<span class=mac-minimize></span>
<span class=mac-expand></span></div><div class=mac-title title=CMakeLists.txt>CMakeLists.txt</div><div class=mac-right-group><button class=fold-button>&#9660;</button></div></div><div class=mac-content><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cmake data-lang=cmake><span class=line><span class=cl><span class=c># cmake中的写法
</span></span></span><span class=line><span class=cl><span class=c></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=nb>set</span><span class=p>(</span><span class=s>CMAKE_INCLUDE_CURRENT_DIR</span> <span class=s>ON</span><span class=p>)</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=c># 添加 Qt Remote Objects 支持
</span></span></span><span class=line><span class=cl><span class=c></span><span class=nb>find_package</span><span class=p>(</span><span class=s>Qt6</span> <span class=s>REQUIRED</span> <span class=s>COMPONENTS</span> <span class=s>Core</span> <span class=s>RemoteObjects</span><span class=p>)</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=c># 服务端项目（生成源对象）
</span></span></span><span class=line><span class=cl><span class=c></span><span class=nb>qt_add_repc_sources</span><span class=p>(</span><span class=o>${</span><span class=nv>PROJECT_NAME</span><span class=o>}</span>
</span></span><span class=line><span class=cl>    <span class=s>devicecontroller.rep</span>
</span></span><span class=line><span class=cl><span class=p>)</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=c># 客户端项目（生成副本对象）
</span></span></span><span class=line><span class=cl><span class=c></span><span class=nb>qt_add_repc_replicas</span><span class=p>(</span><span class=o>${</span><span class=nv>PROJECT_NAME</span><span class=o>}</span>
</span></span><span class=line><span class=cl>    <span class=s>devicecontroller.rep</span>
</span></span><span class=line><span class=cl><span class=p>)</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=c># 同时生成源对象和副本对象的头文件
</span></span></span><span class=line><span class=cl><span class=c></span><span class=nb>qt_add_repc_merged</span><span class=p>(</span><span class=o>${</span><span class=nv>PROJECT_NAME</span><span class=o>}</span>
</span></span><span class=line><span class=cl>    <span class=s>devicecontroller.rep</span>
</span></span><span class=line><span class=cl><span class=p>)</span></span></span></code></pre></td></tr></table></div></div></div></div><p>添加完成后，构建一下项目，可以看到生成了源对象头文件<em>rep_devicecontroller_source.h</em>和副本对象头文件<em>rep_devicecontroller_replica.h</em>。</p><div class=mac-codeblock><div class=mac-titlebar><div class=mac-left-group><span class=mac-close></span>
<span class=mac-minimize></span>
<span class=mac-expand></span></div><div class=mac-title title=rep_devicecontroller_source.h>rep_devicecontroller_source.h</div><div class=mac-right-group><button class=fold-button>&#9660;</button></div></div><div class=mac-content><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span><span class=lnt>59
</span><span class=lnt>60
</span><span class=lnt>61
</span><span class=lnt>62
</span><span class=lnt>63
</span><span class=lnt>64
</span><span class=lnt>65
</span><span class=lnt>66
</span><span class=lnt>67
</span><span class=lnt>68
</span><span class=lnt>69
</span><span class=lnt>70
</span><span class=lnt>71
</span><span class=lnt>72
</span><span class=lnt>73
</span><span class=lnt>74
</span><span class=lnt>75
</span><span class=lnt>76
</span><span class=lnt>77
</span><span class=lnt>78
</span><span class=lnt>79
</span><span class=lnt>80
</span><span class=lnt>81
</span><span class=lnt>82
</span><span class=lnt>83
</span><span class=lnt>84
</span><span class=lnt>85
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=cp>#ifndef REP_DEVICECONTROLLER_SOURCE_H
</span></span></span><span class=line><span class=cl><span class=cp>#define REP_DEVICECONTROLLER_SOURCE_H
</span></span></span><span class=line><span class=cl><span class=cp></span>
</span></span><span class=line><span class=cl><span class=c1>// This is an autogenerated file.
</span></span></span><span class=line><span class=cl><span class=c1>// Do not edit this file, any changes made will be lost the next time it is generated.
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;QtCore/qobject.h&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;QtCore/qdatastream.h&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;QtCore/qvariant.h&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;QtCore/qmap.h&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;QtCore/qmetatype.h&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp></span>
</span></span><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;QtRemoteObjects/qremoteobjectnode.h&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;QtRemoteObjects/qremoteobjectsource.h&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp></span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>using</span> <span class=k>namespace</span> <span class=n>Qt</span><span class=o>::</span><span class=n>Literals</span><span class=o>::</span><span class=n>StringLiterals</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>DeviceControllerSource</span> <span class=o>:</span> <span class=k>public</span> <span class=n>QObject</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>Q_OBJECT</span>
</span></span><span class=line><span class=cl>    <span class=nf>Q_CLASSINFO</span><span class=p>(</span><span class=n>QCLASSINFO_REMOTEOBJECT_TYPE</span><span class=p>,</span> <span class=s>&#34;DeviceController&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>Q_CLASSINFO</span><span class=p>(</span><span class=n>QCLASSINFO_REMOTEOBJECT_SIGNATURE</span><span class=p>,</span> <span class=s>&#34;3947cd1a592cb801ecdf88688ceb676821764dc3&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>Q_PROPERTY</span><span class=p>(</span><span class=n>Status</span> <span class=n>status</span> <span class=n>READ</span> <span class=n>status</span> <span class=n>NOTIFY</span> <span class=n>statusChanged</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>public</span><span class=o>:</span>
</span></span><span class=line><span class=cl>    <span class=k>enum</span> <span class=nc>Status</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>Ok</span> <span class=o>=</span> <span class=mi>0</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>Error</span> <span class=o>=</span> <span class=mi>1</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=p>};</span>
</span></span><span class=line><span class=cl>    <span class=n>Q_ENUM</span><span class=p>(</span><span class=n>Status</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>public</span><span class=o>:</span>
</span></span><span class=line><span class=cl>    <span class=k>explicit</span> <span class=n>DeviceControllerSource</span><span class=p>(</span><span class=n>QObject</span> <span class=o>*</span><span class=n>parent</span> <span class=o>=</span> <span class=k>nullptr</span><span class=p>)</span> <span class=o>:</span> <span class=n>QObject</span><span class=p>(</span><span class=n>parent</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>qRegisterMetaType</span><span class=o>&lt;</span><span class=n>Status</span><span class=o>&gt;</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>public</span><span class=o>:</span>
</span></span><span class=line><span class=cl>    <span class=o>~</span><span class=n>DeviceControllerSource</span><span class=p>()</span> <span class=k>override</span> <span class=o>=</span> <span class=k>default</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>virtual</span> <span class=n>Status</span> <span class=nf>status</span><span class=p>()</span> <span class=k>const</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nl>Q_SIGNALS</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=kt>void</span> <span class=n>statusChanged</span><span class=p>(</span><span class=n>DeviceControllerSource</span><span class=o>::</span><span class=n>Status</span> <span class=n>status</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=kt>void</span> <span class=nf>fileReceived</span><span class=p>(</span><span class=n>QString</span> <span class=n>fileName</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>public</span> <span class=nl>Q_SLOTS</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=k>virtual</span> <span class=kt>void</span> <span class=n>controlDevice</span><span class=p>(</span><span class=n>QString</span> <span class=n>command</span><span class=p>)</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>virtual</span> <span class=kt>void</span> <span class=nf>uploadFile</span><span class=p>(</span><span class=n>QString</span> <span class=n>fileName</span><span class=p>,</span> <span class=n>QByteArray</span> <span class=n>fileData</span><span class=p>)</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>private</span><span class=o>:</span>
</span></span><span class=line><span class=cl>    <span class=k>friend</span> <span class=k>class</span> <span class=nc>QT_PREPEND_NAMESPACE</span><span class=p>(</span><span class=n>QRemoteObjectNode</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>DeviceControllerSimpleSource</span> <span class=o>:</span> <span class=k>public</span> <span class=n>DeviceControllerSource</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>Q_OBJECT</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>public</span><span class=o>:</span>
</span></span><span class=line><span class=cl>    <span class=k>explicit</span> <span class=n>DeviceControllerSimpleSource</span><span class=p>(</span><span class=n>QObject</span> <span class=o>*</span><span class=n>parent</span> <span class=o>=</span> <span class=k>nullptr</span><span class=p>)</span> <span class=o>:</span> <span class=n>DeviceControllerSource</span><span class=p>(</span><span class=n>parent</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>,</span> <span class=n>m_status</span><span class=p>(</span><span class=n>Ok</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>public</span><span class=o>:</span>
</span></span><span class=line><span class=cl>    <span class=o>~</span><span class=n>DeviceControllerSimpleSource</span><span class=p>()</span> <span class=k>override</span> <span class=o>=</span> <span class=k>default</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>Status</span> <span class=nf>status</span><span class=p>()</span> <span class=k>const</span> <span class=k>override</span> <span class=p>{</span> <span class=k>return</span> <span class=n>m_status</span><span class=p>;</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>protected</span><span class=o>:</span>
</span></span><span class=line><span class=cl>    <span class=k>virtual</span> <span class=kt>void</span> <span class=n>setStatus</span><span class=p>(</span><span class=n>Status</span> <span class=n>status</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>(</span><span class=n>status</span> <span class=o>!=</span> <span class=n>m_status</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=n>m_status</span> <span class=o>=</span> <span class=n>status</span><span class=p>;</span>
</span></span><span class=line><span class=cl>            <span class=n>Q_EMIT</span> <span class=nf>statusChanged</span><span class=p>(</span><span class=n>m_status</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>private</span><span class=o>:</span>
</span></span><span class=line><span class=cl>    <span class=n>Status</span> <span class=n>m_status</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>...</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=cp>#endif </span><span class=c1>// REP_DEVICECONTROLLER_SOURCE_H
</span></span></span></code></pre></td></tr></table></div></div></div></div><h4 id=服务端>服务端<a hidden class=anchor aria-hidden=true href=#服务端>#</a></h4><p>接下来编写服务端代码：</p><div class=mac-codeblock><div class=mac-titlebar><div class=mac-left-group><span class=mac-close></span>
<span class=mac-minimize></span>
<span class=mac-expand></span></div><div class=mac-title title=mydeviceservice.h>mydeviceservice.h</div><div class=mac-right-group><button class=fold-button>&#9660;</button></div></div><div class=mac-content><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=cp>#ifndef MYDEVICESERVICE_H
</span></span></span><span class=line><span class=cl><span class=cp>#define MYDEVICESERVICE_H
</span></span></span><span class=line><span class=cl><span class=cp></span>
</span></span><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&#34;rep_devicecontroller_source.h&#34;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp></span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>MyDeviceService</span> <span class=o>:</span> <span class=k>public</span> <span class=n>DeviceControllerSimpleSource</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>Q_OBJECT</span>
</span></span><span class=line><span class=cl><span class=k>public</span><span class=o>:</span>
</span></span><span class=line><span class=cl>    <span class=k>explicit</span> <span class=n>MyDeviceService</span><span class=p>(</span><span class=n>QObject</span> <span class=o>*</span><span class=n>parent</span> <span class=o>=</span> <span class=n>Q_NULLPTR</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=o>~</span><span class=n>MyDeviceService</span><span class=p>();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>public</span> <span class=nl>Q_SLOTS</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=k>virtual</span> <span class=kt>void</span> <span class=n>controlDevice</span><span class=p>(</span><span class=n>QString</span> <span class=n>command</span><span class=p>)</span> <span class=n>Q_DECL_OVERRIDE</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>virtual</span> <span class=kt>void</span> <span class=nf>uploadFile</span><span class=p>(</span><span class=n>QString</span> <span class=n>fileName</span><span class=p>,</span> <span class=n>QByteArray</span> <span class=n>fileData</span><span class=p>)</span> <span class=n>Q_DECL_OVERRIDE</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=cp>#endif </span><span class=c1>// MYDEVICESERVICE_H
</span></span></span></code></pre></td></tr></table></div></div></div></div><div class=mac-codeblock><div class=mac-titlebar><div class=mac-left-group><span class=mac-close></span>
<span class=mac-minimize></span>
<span class=mac-expand></span></div><div class=mac-title title=mydeviceservice.cpp>mydeviceservice.cpp</div><div class=mac-right-group><button class=fold-button>&#9660;</button></div></div><div class=mac-content><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&#34;mydeviceservice.h&#34;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;QDebug&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp></span>
</span></span><span class=line><span class=cl><span class=n>MyDeviceService</span><span class=o>::</span><span class=n>MyDeviceService</span><span class=p>(</span><span class=n>QObject</span> <span class=o>*</span><span class=n>parent</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=o>:</span> <span class=n>DeviceControllerSimpleSource</span><span class=p>{</span><span class=n>parent</span><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>qDebug</span><span class=p>()</span> <span class=o>&lt;&lt;</span> <span class=n>__PRETTY_FUNCTION__</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>MyDeviceService</span><span class=o>::~</span><span class=n>MyDeviceService</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>qDebug</span><span class=p>()</span> <span class=o>&lt;&lt;</span> <span class=n>__PRETTY_FUNCTION__</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kt>void</span> <span class=n>MyDeviceService</span><span class=o>::</span><span class=n>controlDevice</span><span class=p>(</span><span class=n>QString</span> <span class=n>command</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>qDebug</span><span class=p>()</span> <span class=o>&lt;&lt;</span> <span class=n>__PRETTY_FUNCTION__</span> <span class=o>&lt;&lt;</span> <span class=n>command</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=n>setStatus</span><span class=p>(</span><span class=n>Error</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kt>void</span> <span class=n>MyDeviceService</span><span class=o>::</span><span class=n>uploadFile</span><span class=p>(</span><span class=n>QString</span> <span class=n>fileName</span><span class=p>,</span> <span class=n>QByteArray</span> <span class=n>fileData</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>qDebug</span><span class=p>()</span> <span class=o>&lt;&lt;</span> <span class=n>__PRETTY_FUNCTION__</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=n>qDebug</span><span class=p>()</span> <span class=o>&lt;&lt;</span> <span class=s>&#34;Receiving file:&#34;</span> <span class=o>&lt;&lt;</span> <span class=n>fileName</span>
</span></span><span class=line><span class=cl>             <span class=o>&lt;&lt;</span> <span class=s>&#34;</span><span class=se>\n</span><span class=s>Content: </span><span class=se>\n</span><span class=s>&#34;</span> <span class=o>&lt;&lt;</span> <span class=n>QString</span><span class=o>::</span><span class=n>fromUtf8</span><span class=p>(</span><span class=n>fileData</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=n>setStatus</span><span class=p>(</span><span class=n>Ok</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=n>Q_EMIT</span> <span class=nf>fileReceived</span><span class=p>(</span><span class=n>fileName</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></td></tr></table></div></div></div></div><p>启动服务端：</p><div class=mac-codeblock><div class=mac-titlebar><div class=mac-left-group><span class=mac-close></span>
<span class=mac-minimize></span>
<span class=mac-expand></span></div><div class=mac-title title=main.cpp>main.cpp</div><div class=mac-right-group><button class=fold-button>&#9660;</button></div></div><div class=mac-content><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;QCoreApplication&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&#34;mydeviceservice.h&#34;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp></span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>(</span><span class=kt>int</span> <span class=n>argc</span><span class=p>,</span> <span class=kt>char</span> <span class=o>*</span><span class=n>argv</span><span class=p>[])</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>QCoreApplication</span> <span class=n>a</span><span class=p>(</span><span class=n>argc</span><span class=p>,</span> <span class=n>argv</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>QRemoteObjectHost</span> <span class=n>host</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=c1>// 进程间通信（IPC）
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=c1>// host.setHostUrl(QUrl(&#34;local:devicecontroller&#34;));
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=c1>// 远程过程调用（RPC）
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=n>host</span><span class=p>.</span><span class=n>setHostUrl</span><span class=p>(</span><span class=n>QUrl</span><span class=p>(</span><span class=s>&#34;tcp://0.0.0.0:2333&#34;</span><span class=p>));</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>MyDeviceService</span> <span class=n>service</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm>     * 第一个参数是源对象指针
</span></span></span><span class=line><span class=cl><span class=cm>     * 第二个参数是源对象名字，客户端可根据名字获取源对象，
</span></span></span><span class=line><span class=cl><span class=cm>     * 使用动态副本的方式时，必须填写源对象名字。
</span></span></span><span class=line><span class=cl><span class=cm>     */</span>
</span></span><span class=line><span class=cl>    <span class=n>host</span><span class=p>.</span><span class=n>enableRemoting</span><span class=p>(</span><span class=o>&amp;</span><span class=n>service</span><span class=p>,</span> <span class=s>&#34;mydeviceservice&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>a</span><span class=p>.</span><span class=n>exec</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></td></tr></table></div></div></div></div><h4 id=客户端>客户端<a hidden class=anchor aria-hidden=true href=#客户端>#</a></h4><p>客户端代码：</p><div class=mac-codeblock><div class=mac-titlebar><div class=mac-left-group><span class=mac-close></span>
<span class=mac-minimize></span>
<span class=mac-expand></span></div><div class=mac-title title=mydevicecontroller.h>mydevicecontroller.h</div><div class=mac-right-group><button class=fold-button>&#9660;</button></div></div><div class=mac-content><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=cp>#ifndef MYDEVICECONTROLLER_H
</span></span></span><span class=line><span class=cl><span class=cp>#define MYDEVICECONTROLLER_H
</span></span></span><span class=line><span class=cl><span class=cp></span>
</span></span><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;QObject&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;QPointer&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp></span>
</span></span><span class=line><span class=cl><span class=n>QT_BEGIN_NAMESPACE</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>QRemoteObjectNode</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=n>QT_END_NAMESPACE</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>MyDeviceController</span> <span class=o>:</span> <span class=k>public</span> <span class=n>QObject</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>Q_OBJECT</span>
</span></span><span class=line><span class=cl><span class=k>public</span><span class=o>:</span>
</span></span><span class=line><span class=cl>    <span class=k>explicit</span> <span class=n>MyDeviceController</span><span class=p>(</span><span class=n>QObject</span> <span class=o>*</span><span class=n>parent</span> <span class=o>=</span> <span class=n>Q_NULLPTR</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>Q_INVOKABLE</span> <span class=kt>void</span> <span class=nf>test</span><span class=p>(</span><span class=k>const</span> <span class=n>QUrl</span> <span class=o>&amp;</span><span class=n>url</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>private</span><span class=o>:</span>
</span></span><span class=line><span class=cl>    <span class=n>QPointer</span><span class=o>&lt;</span><span class=n>QRemoteObjectNode</span><span class=o>&gt;</span> <span class=n>node</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=c1>// QPointer&lt;DeviceControllerReplica&gt; replica;
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=cp>#endif </span><span class=c1>// MYDEVICECONTROLLER_H
</span></span></span></code></pre></td></tr></table></div></div></div></div><div class=mac-codeblock><div class=mac-titlebar><div class=mac-left-group><span class=mac-close></span>
<span class=mac-minimize></span>
<span class=mac-expand></span></div><div class=mac-title title=mydevicecontroller.h>mydevicecontroller.h</div><div class=mac-right-group><button class=fold-button>&#9660;</button></div></div><div class=mac-content><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=hl><span class=lnt>24
</span></span><span class=hl><span class=lnt>25
</span></span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&#34;mydevicecontroller.h&#34;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&#34;rep_devicecontroller_replica.h&#34;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp></span>
</span></span><span class=line><span class=cl><span class=n>MyDeviceController</span><span class=o>::</span><span class=n>MyDeviceController</span><span class=p>(</span><span class=n>QObject</span> <span class=o>*</span><span class=n>parent</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=o>:</span> <span class=n>QObject</span><span class=p>{</span><span class=n>parent</span><span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>,</span> <span class=n>node</span><span class=p>{</span><span class=k>new</span> <span class=nf>QRemoteObjectNode</span><span class=p>(</span><span class=k>this</span><span class=p>)}</span>
</span></span><span class=line><span class=cl><span class=p>{}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kt>void</span> <span class=n>MyDeviceController</span><span class=o>::</span><span class=n>test</span><span class=p>(</span><span class=k>const</span> <span class=n>QUrl</span> <span class=o>&amp;</span><span class=n>url</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>node</span><span class=o>-&gt;</span><span class=n>connectToNode</span><span class=p>(</span><span class=n>url</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=n>qDebug</span><span class=p>()</span> <span class=o>&lt;&lt;</span> <span class=s>&#34;connected to:&#34;</span> <span class=o>&lt;&lt;</span> <span class=n>url</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>auto</span> <span class=o>*</span><span class=n>replica</span> <span class=o>=</span> <span class=n>node</span><span class=o>-&gt;</span><span class=n>acquire</span><span class=o>&lt;</span><span class=n>DeviceControllerReplica</span><span class=o>&gt;</span><span class=p>(</span><span class=s>&#34;mydeviceservice&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=n>connect</span><span class=p>(</span><span class=n>replica</span><span class=p>,</span> <span class=o>&amp;</span><span class=n>DeviceControllerReplica</span><span class=o>::</span><span class=n>statusChanged</span><span class=p>,</span> <span class=k>this</span><span class=p>,</span> <span class=p>[</span><span class=o>&amp;</span><span class=p>](</span><span class=n>DeviceControllerReplica</span><span class=o>::</span><span class=n>Status</span> <span class=n>s</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>qDebug</span><span class=p>()</span> <span class=o>&lt;&lt;</span> <span class=s>&#34;Device status changed to:&#34;</span> <span class=o>&lt;&lt;</span> <span class=n>s</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>});</span>
</span></span><span class=line><span class=cl>    <span class=n>connect</span><span class=p>(</span><span class=n>replica</span><span class=p>,</span> <span class=o>&amp;</span><span class=n>DeviceControllerReplica</span><span class=o>::</span><span class=n>fileReceived</span><span class=p>,</span> <span class=k>this</span><span class=p>,</span> <span class=p>[</span><span class=o>&amp;</span><span class=p>](</span><span class=n>QString</span> <span class=n>fileName</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>qDebug</span><span class=p>()</span> <span class=o>&lt;&lt;</span> <span class=s>&#34;File sent. file -&#34;</span> <span class=o>&lt;&lt;</span> <span class=n>fileName</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>});</span>
</span></span><span class=line><span class=cl>    <span class=n>connect</span><span class=p>(</span><span class=n>replica</span><span class=p>,</span> <span class=o>&amp;</span><span class=n>DeviceControllerReplica</span><span class=o>::</span><span class=n>stateChanged</span><span class=p>,</span> <span class=k>this</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=p>[</span><span class=k>this</span><span class=p>](</span><span class=n>QRemoteObjectReplica</span><span class=o>::</span><span class=n>State</span> <span class=n>state</span><span class=p>,</span> <span class=n>QRemoteObjectReplica</span><span class=o>::</span><span class=n>State</span> <span class=n>oldState</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>qDebug</span><span class=p>()</span> <span class=o>&lt;&lt;</span> <span class=s>&#34;replica state changed:&#34;</span> <span class=o>&lt;&lt;</span> <span class=n>oldState</span> <span class=o>&lt;&lt;</span> <span class=s>&#34;→&#34;</span> <span class=o>&lt;&lt;</span> <span class=n>state</span><span class=p>;</span>
</span></span><span class="line hl"><span class=cl>        <span class=c1>// 副本对象状态可用时才能调用接口
</span></span></span><span class="line hl"><span class=cl><span class=c1></span>        <span class=k>if</span> <span class=p>(</span><span class=n>state</span> <span class=o>==</span> <span class=n>QRemoteObjectReplica</span><span class=o>::</span><span class=n>Valid</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=n>DeviceControllerReplica</span> <span class=o>*</span><span class=n>replica</span> <span class=o>=</span> <span class=n>qobject_cast</span><span class=o>&lt;</span><span class=n>DeviceControllerReplica</span><span class=o>*&gt;</span><span class=p>(</span><span class=n>sender</span><span class=p>());</span>
</span></span><span class=line><span class=cl>            <span class=n>Q_ASSERT</span><span class=p>(</span><span class=n>replica</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=n>replica</span><span class=o>-&gt;</span><span class=n>controlDevice</span><span class=p>(</span><span class=s>&#34;echo&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>            <span class=n>replica</span><span class=o>-&gt;</span><span class=n>uploadFile</span><span class=p>(</span><span class=s>&#34;test.txt&#34;</span><span class=p>,</span> <span class=n>QString</span><span class=p>(</span><span class=s>&#34;你好！世界。&#34;</span><span class=p>).</span><span class=n>toUtf8</span><span class=p>());</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>});</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></td></tr></table></div></div></div></div><p>客户端调用：</p><div class=mac-codeblock><div class=mac-titlebar><div class=mac-left-group><span class=mac-close></span>
<span class=mac-minimize></span>
<span class=mac-expand></span></div><div class=mac-title title=main.cpp>main.cpp</div><div class=mac-right-group><button class=fold-button>&#9660;</button></div></div><div class=mac-content><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;QCoreApplication&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;QUrl&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&#34;mydevicecontroller.h&#34;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp></span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>(</span><span class=kt>int</span> <span class=n>argc</span><span class=p>,</span> <span class=kt>char</span> <span class=o>*</span><span class=n>argv</span><span class=p>[])</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>QCoreApplication</span> <span class=n>a</span><span class=p>(</span><span class=n>argc</span><span class=p>,</span> <span class=n>argv</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>MyDeviceController</span> <span class=n>client</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=c1>// 进程间通信（IPC）
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=c1>// client.test(QUrl(&#34;local:devicecontroller&#34;));
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=c1>// 远程过程调用（RPC）
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=n>client</span><span class=p>.</span><span class=n>test</span><span class=p>(</span><span class=n>QUrl</span><span class=p>(</span><span class=s>&#34;tcp://192.168.1.3:2333&#34;</span><span class=p>));</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>a</span><span class=p>.</span><span class=n>exec</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></td></tr></table></div></div></div></div><h3 id=动态副本>动态副本<a hidden class=anchor aria-hidden=true href=#动态副本>#</a></h3><p>动态副本的客户端代码有所不同。</p><div class=mac-codeblock><div class=mac-titlebar><div class=mac-left-group><span class=mac-close></span>
<span class=mac-minimize></span>
<span class=mac-expand></span></div><div class=mac-title title=mydevicecontroller.h>mydevicecontroller.h</div><div class=mac-right-group><button class=fold-button>&#9660;</button></div></div><div class=mac-content><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=hl><span class=lnt>19
</span></span><span class=hl><span class=lnt>20
</span></span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=cp>#ifndef MYDEVICECONTROLLER_H
</span></span></span><span class=line><span class=cl><span class=cp>#define MYDEVICECONTROLLER_H
</span></span></span><span class=line><span class=cl><span class=cp></span>
</span></span><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;QObject&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;QPointer&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp></span>
</span></span><span class=line><span class=cl><span class=n>QT_BEGIN_NAMESPACE</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>QRemoteObjectNode</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=n>QT_END_NAMESPACE</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>MyDeviceController</span> <span class=o>:</span> <span class=k>public</span> <span class=n>QObject</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>Q_OBJECT</span>
</span></span><span class=line><span class=cl><span class=k>public</span><span class=o>:</span>
</span></span><span class=line><span class=cl>    <span class=k>explicit</span> <span class=n>MyDeviceController</span><span class=p>(</span><span class=n>QObject</span> <span class=o>*</span><span class=n>parent</span> <span class=o>=</span> <span class=n>Q_NULLPTR</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>Q_INVOKABLE</span> <span class=kt>void</span> <span class=nf>test</span><span class=p>(</span><span class=k>const</span> <span class=n>QUrl</span> <span class=o>&amp;</span><span class=n>url</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class="line hl"><span class=cl>    <span class=n>Q_SLOT</span> <span class=kt>void</span> <span class=nf>onStatusChanged</span><span class=p>(</span><span class=kt>int</span><span class=p>);</span>
</span></span><span class="line hl"><span class=cl>    <span class=n>Q_SLOT</span> <span class=kt>void</span> <span class=nf>onFileReceived</span><span class=p>(</span><span class=k>const</span> <span class=n>QString</span><span class=o>&amp;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>private</span><span class=o>:</span>
</span></span><span class=line><span class=cl>    <span class=n>QPointer</span><span class=o>&lt;</span><span class=n>QRemoteObjectNode</span><span class=o>&gt;</span> <span class=n>node</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=cp>#endif </span><span class=c1>// MYDEVICECONTROLLER_H
</span></span></span></code></pre></td></tr></table></div></div></div></div><div class=mac-codeblock><div class=mac-titlebar><div class=mac-left-group><span class=mac-close></span>
<span class=mac-minimize></span>
<span class=mac-expand></span></div><div class=mac-title title=mydevicecontroller.cpp>mydevicecontroller.cpp</div><div class=mac-right-group><button class=fold-button>&#9660;</button></div></div><div class=mac-content><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=hl><span class=lnt>14
</span></span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=hl><span class=lnt>26
</span></span><span class=hl><span class=lnt>27
</span></span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=hl><span class=lnt>31
</span></span><span class=hl><span class=lnt>32
</span></span><span class=hl><span class=lnt>33
</span></span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&#34;mydevicecontroller.h&#34;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&#34;rep_devicecontroller_replica.h&#34;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp></span>
</span></span><span class=line><span class=cl><span class=n>MyDeviceController</span><span class=o>::</span><span class=n>MyDeviceController</span><span class=p>(</span><span class=n>QObject</span> <span class=o>*</span><span class=n>parent</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=o>:</span> <span class=n>QObject</span><span class=p>{</span><span class=n>parent</span><span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>,</span> <span class=n>node</span><span class=p>{</span><span class=k>new</span> <span class=nf>QRemoteObjectNode</span><span class=p>(</span><span class=k>this</span><span class=p>)}</span>
</span></span><span class=line><span class=cl><span class=p>{}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kt>void</span> <span class=n>MyDeviceController</span><span class=o>::</span><span class=n>test</span><span class=p>(</span><span class=k>const</span> <span class=n>QUrl</span> <span class=o>&amp;</span><span class=n>url</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>node</span><span class=o>-&gt;</span><span class=n>connectToNode</span><span class=p>(</span><span class=n>url</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=n>qDebug</span><span class=p>()</span> <span class=o>&lt;&lt;</span> <span class=s>&#34;connected to:&#34;</span> <span class=o>&lt;&lt;</span> <span class=n>url</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    
</span></span><span class="line hl"><span class=cl>    <span class=k>auto</span> <span class=o>*</span><span class=n>replica</span> <span class=o>=</span> <span class=n>node</span><span class=o>-&gt;</span><span class=n>acquireDynamic</span><span class=p>(</span><span class=s>&#34;mydeviceservice&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=n>connect</span><span class=p>(</span><span class=n>replica</span><span class=p>,</span> <span class=o>&amp;</span><span class=n>QRemoteObjectDynamicReplica</span><span class=o>::</span><span class=n>stateChanged</span><span class=p>,</span> <span class=k>this</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=p>[</span><span class=k>this</span><span class=p>](</span><span class=n>QRemoteObjectReplica</span><span class=o>::</span><span class=n>State</span> <span class=n>state</span><span class=p>,</span> <span class=n>QRemoteObjectReplica</span><span class=o>::</span><span class=n>State</span> <span class=n>oldState</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=n>qDebug</span><span class=p>()</span> <span class=o>&lt;&lt;</span> <span class=s>&#34;replica state changed:&#34;</span> <span class=o>&lt;&lt;</span> <span class=n>oldState</span> <span class=o>&lt;&lt;</span> <span class=s>&#34;→&#34;</span> <span class=o>&lt;&lt;</span> <span class=n>state</span><span class=p>;</span>
</span></span><span class=line><span class=cl>                <span class=k>if</span> <span class=p>(</span><span class=n>state</span> <span class=o>==</span> <span class=n>QRemoteObjectReplica</span><span class=o>::</span><span class=n>Valid</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                    <span class=n>QRemoteObjectDynamicReplica</span> <span class=o>*</span><span class=n>replica</span> <span class=o>=</span> <span class=n>qobject_cast</span><span class=o>&lt;</span><span class=n>QRemoteObjectDynamicReplica</span><span class=o>*&gt;</span><span class=p>(</span><span class=n>sender</span><span class=p>());</span>
</span></span><span class=line><span class=cl>                    <span class=n>Q_ASSERT</span><span class=p>(</span><span class=n>replica</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>                    <span class=cm>/** 由于使用动态副本方式，在副本初始化完成前，无法预先知道API，
</span></span></span><span class=line><span class=cl><span class=cm>                     *  只有在副本对象状态可用时，才能进行信号-槽连接。
</span></span></span><span class=line><span class=cl><span class=cm>                     *  并且无法使用自定义类型参数，如之前定义的枚举。
</span></span></span><span class=line><span class=cl><span class=cm>                     */</span>
</span></span><span class="line hl"><span class=cl>                    <span class=c1>// connect(replica, SIGNAL(statusChanged(int)), this, SLOT(onStatusChanged(int)));
</span></span></span><span class="line hl"><span class=cl><span class=c1></span>                    <span class=n>connect</span><span class=p>(</span><span class=n>replica</span><span class=p>,</span> <span class=n>SIGNAL</span><span class=p>(</span><span class=n>fileReceived</span><span class=p>(</span><span class=n>QString</span><span class=p>)),</span> <span class=k>this</span><span class=p>,</span> <span class=n>SLOT</span><span class=p>(</span><span class=n>onFileReceived</span><span class=p>(</span><span class=n>QString</span><span class=p>)));</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>                    <span class=cm>/** 调用接口需要使用元对象的`invokeMethod`方法
</span></span></span><span class=line><span class=cl><span class=cm>                      */</span>
</span></span><span class="line hl"><span class=cl>                    <span class=n>QMetaObject</span><span class=o>::</span><span class=n>invokeMethod</span><span class=p>(</span><span class=n>replica</span><span class=p>,</span> <span class=s>&#34;controlDevice&#34;</span><span class=p>,</span> <span class=n>Q_ARG</span><span class=p>(</span><span class=n>QString</span><span class=p>,</span> <span class=s>&#34;echo&#34;</span><span class=p>));</span>
</span></span><span class="line hl"><span class=cl>                    <span class=n>QMetaObject</span><span class=o>::</span><span class=n>invokeMethod</span><span class=p>(</span><span class=n>replica</span><span class=p>,</span> <span class=s>&#34;uploadFile&#34;</span><span class=p>,</span> <span class=n>Q_ARG</span><span class=p>(</span><span class=n>QString</span><span class=p>,</span> <span class=s>&#34;test.txt&#34;</span><span class=p>),</span>
</span></span><span class="line hl"><span class=cl>                                              <span class=n>Q_ARG</span><span class=p>(</span><span class=n>QByteArray</span><span class=p>,</span> <span class=n>QString</span><span class=p>(</span><span class=s>&#34;你好！世界。&#34;</span><span class=p>).</span><span class=n>toUtf8</span><span class=p>()));</span>
</span></span><span class=line><span class=cl>                <span class=p>}</span>
</span></span><span class=line><span class=cl>            <span class=p>});</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kt>void</span> <span class=n>MyDeviceController</span><span class=o>::</span><span class=n>onStatusChanged</span><span class=p>(</span><span class=kt>int</span> <span class=n>s</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>qDebug</span><span class=p>()</span> <span class=o>&lt;&lt;</span> <span class=s>&#34;Device status changed to:&#34;</span> <span class=o>&lt;&lt;</span> <span class=n>s</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kt>void</span> <span class=n>MyDeviceController</span><span class=o>::</span><span class=n>onFileReceived</span><span class=p>(</span><span class=k>const</span> <span class=n>QString</span> <span class=o>&amp;</span><span class=n>fileName</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>qDebug</span><span class=p>()</span> <span class=o>&lt;&lt;</span> <span class=s>&#34;File sent. file -&#34;</span> <span class=o>&lt;&lt;</span> <span class=n>fileName</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></td></tr></table></div></div></div></div><h2 id=注意事项>注意事项<a hidden class=anchor aria-hidden=true href=#注意事项>#</a></h2><p>Qt Remote Objects 使用内部协议在进程和/或设备之间传递数据。所有部分都需要使用相同的协议版本：如果版本不匹配，连接节点将输出警告，主机节点将不发送任何数据。</p><p>目前发布的版本：</p><table><thead><tr><th style=text-align:center>协议版本</th><th style=text-align:center>Qt版本</th></tr></thead><tbody><tr><td style=text-align:center>&lt;1.2</td><td style=text-align:center>在 QtRO 的技术预览阶段使用。</td></tr><tr><td style=text-align:center>1.2</td><td style=text-align:center>5.12.0</td></tr><tr><td style=text-align:center>1.3</td><td style=text-align:center>5.12.4</td></tr><tr><td style=text-align:center>2.0</td><td style=text-align:center>6.2.0</td></tr></tbody></table><p>See <a href=https://doc.qt.io/qt-6/qtremoteobjects-compatibility.html>Qt Remote Objects Protocol Versioning</a>.</p><p><strong>参考</strong></p><ul><li><a href=https://www.xnip.cn/ruanjian/anli/39413.html>Qt Remote Objects远程调用模块的基本使用</a></li><li><a href=https://blog.csdn.net/zzc116433008/article/details/99194118>Qt Remote Objects 学习笔记（Qt 远端可调用对象框架)</a></li><li><a href=https://zhuanlan.zhihu.com/p/613641170>Qt Remote Object（QtRO）动态Replica实现进程间通信</a></li></ul></div><footer class=post-footer><ul class=post-tags><li><a href=https://kira-96.github.io/tags/qt/>Qt</a></li></ul><nav class=paginav><a class=prev href=https://kira-96.github.io/posts/%E4%B8%AA%E4%BA%BA%E5%B8%B8%E7%94%A8%E8%BD%AF%E4%BB%B6%E5%88%86%E4%BA%AB/><span class=title>« 上一页</span><br><span>个人常用软件分享</span>
</a><a class=next href=https://kira-96.github.io/posts/qt5-quick2-extension-plugin/><span class=title>下一页 »</span><br><span>Qt5编写Qt Quick2插件</span></a></nav></footer><script src=https://utteranc.es/client.js repo=kira-96/kira-96.github.io issue-term=pathname theme=github-light crossorigin=anonymous async></script></article></main><footer class=footer><span>© 2019-2025 <a href=/>kira&rsquo;s blog</a> · LICENSED under <a href=https://github.com/kira-96/kira-96.github.io/tree/main/LICENSE>CC-BY-4.0</a></span> ·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
<a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentColor"><path d="M12 6H0l6-6z"/></svg>
</a><script>document.querySelectorAll(".fold-button").forEach(e=>{e.addEventListener("click",t=>{const n=t.target.closest(".mac-codeblock"),s=n.querySelector(".mac-content");s.classList.toggle("folded"),e.classList.toggle("folded")})})</script><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="复制";function s(){t.innerHTML="已复制！",setTimeout(()=>{t.innerHTML="复制"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>