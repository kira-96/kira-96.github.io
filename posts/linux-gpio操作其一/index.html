<!doctype html><html lang=zh dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Linux GPIO æ“ä½œå…¶ä¸€ | âœ¨kiraã®åšå®¢</title>
<meta name=keywords content="linux,GPIO"><meta name=description content="Linuxä¸‹GPIOçš„è¯»å†™æ“ä½œ"><meta name=author content><link rel=canonical href=https://kira-96.github.io/posts/linux-gpio%E6%93%8D%E4%BD%9C%E5%85%B6%E4%B8%80/><link crossorigin=anonymous href=/assets/css/stylesheet.a36f9a7cc535e1ab532df35a8bc942e2288add4af450966f180a2b545f766f78.css integrity="sha256-o2+afMU14atTLfNai8lC4iiK3Ur0UJZvGAorVF92b3g=" rel="preload stylesheet" as=style><link rel=icon href=https://cdn.jsdelivr.net/gh/kira-96/kira-96.github.io@gh-pages/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://cdn.jsdelivr.net/gh/kira-96/kira-96.github.io@gh-pages/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://cdn.jsdelivr.net/gh/kira-96/kira-96.github.io@gh-pages/favicon-32x32.png><link rel=apple-touch-icon href=https://cdn.jsdelivr.net/gh/kira-96/kira-96.github.io@gh-pages/icons/apple-icon-180x180.png><link rel=mask-icon href=https://cdn.jsdelivr.net/gh/kira-96/kira-96.github.io@gh-pages/icons/apple-icon-76x76.png><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><link rel=manifest href=https://cdn.jsdelivr.net/gh/kira-96/kira-96.github.io@gh-pages/manifest.json><script src=https://fastly.jsdelivr.net/gh/stevenjoezhang/live2d-widget@latest/autoload.js></script><script type=text/javascript src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><meta property="og:title" content="Linux GPIO æ“ä½œå…¶ä¸€"><meta property="og:description" content="Linuxä¸‹GPIOçš„è¯»å†™æ“ä½œ"><meta property="og:type" content="article"><meta property="og:url" content="https://kira-96.github.io/posts/linux-gpio%E6%93%8D%E4%BD%9C%E5%85%B6%E4%B8%80/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2023-01-12T13:33:37+08:00"><meta property="article:modified_time" content="2023-01-12T13:33:37+08:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="Linux GPIO æ“ä½œå…¶ä¸€"><meta name=twitter:description content="Linuxä¸‹GPIOçš„è¯»å†™æ“ä½œ"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://kira-96.github.io/posts/"},{"@type":"ListItem","position":2,"name":"Linux GPIO æ“ä½œå…¶ä¸€","item":"https://kira-96.github.io/posts/linux-gpio%E6%93%8D%E4%BD%9C%E5%85%B6%E4%B8%80/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Linux GPIO æ“ä½œå…¶ä¸€","name":"Linux GPIO æ“ä½œå…¶ä¸€","description":"Linuxä¸‹GPIOçš„è¯»å†™æ“ä½œ","keywords":["linux","GPIO"],"articleBody":"å‰è¨€ ç”±äºæ¢äº†æ–°çš„å·¥ä½œï¼Œæˆ‘çš„å·¥ä½œæ–¹å‘ä¹Ÿæœ‰äº†å¾ˆå¤§çš„å˜åŒ–ï¼Œä¹‹å‰åŸºæœ¬ä¸Šæ˜¯å•çº¯çš„å†™ä»£ç ï¼Œç°åœ¨åˆ™ç»å¸¸éœ€è¦å’Œç¡¬ä»¶è®¾å¤‡äº¤äº’ï¼Œå¼€å‘å¹³å°ä¹Ÿè½¬åˆ°äº†Linux+Qtã€‚ç¡¬ä»¶è®¾å¤‡çš„æ§åˆ¶ï¼Œå…¶ä¸­æœ€åŸºæœ¬çš„å°±æ˜¯LEDç¯ä»¥åŠä¸€äº›å¼€å…³ç»§ç”µå™¨çš„æ“ä½œï¼Œå…¶æœ¬è´¨å°±æ˜¯GPIOçš„æ“ä½œã€‚è€ƒè™‘åˆ°ç³»ç»Ÿçš„ç²¾ç®€å’Œæˆæœ¬æ§åˆ¶ï¼Œæœ€å¥½æ˜¯å¯ä»¥ç›´æ¥é€šè¿‡Linuxç³»ç»Ÿå»æ§åˆ¶ï¼Œå½“ç„¶ä¹Ÿæœ‰å…¶å®ƒæ›¿ä»£æ–¹æ¡ˆï¼Œæ¯”å¦‚ä½¿ç”¨æ”¯æŒModbusåè®®çš„IOæ¨¡å—ã€‚å…³äºModbusçš„ä½¿ç”¨ï¼Œåé¢æœ‰ç©ºå†è®²ï¼Œè¿™é‡Œå°±è®°å½•ä¸€ä¸‹æœ€ç®€å•çš„Linuxç³»ç»Ÿä¸‹çš„GPIOæ§åˆ¶ï¼Œç”¨æˆ·ç©ºé—´ä¸‹çš„GPIOæ–‡ä»¶ç³»ç»Ÿæ¥å£ã€‚\nåœ¨æ­¤ä¹‹å‰ï¼Œæœ‰å¿…è¦å†äº†è§£ä¸€ä¸‹GPIOçš„æ¦‚å¿µã€‚\nâ€œé€šç”¨è¾“å…¥/è¾“å‡ºâ€ï¼ˆGPIOï¼‰æ˜¯ä¸€ç§çµæ´»çš„è½¯ä»¶æ§åˆ¶æ•°å­—ä¿¡å·ã€‚å®ƒä»¬ç”±å¤šç§èŠ¯ç‰‡æä¾›ï¼Œå¯¹äºä½¿ç”¨åµŒå…¥å¼å’Œå®šåˆ¶ç¡¬ä»¶çš„Linuxå¼€å‘äººå‘˜æ¥è¯´å¾ˆç†Ÿæ‚‰ã€‚æ¯ä¸ªGPIOä»£è¡¨ä¸€ä¸ªè¿æ¥åˆ°ç‰¹å®šå¼•è„šçš„ä½ï¼Œå³çƒæ …é˜µåˆ—ï¼ˆBGAï¼‰å°è£…ä¸Šçš„â€œçƒâ€ã€‚ç”µè·¯æ¿ç¤ºæ„å›¾æ˜¾ç¤ºäº†å“ªäº›å¤–éƒ¨ç¡¬ä»¶è¿æ¥åˆ°å“ªäº›GPIOã€‚é©±åŠ¨ç¨‹åºå¯ä»¥é€šç”¨åœ°ç¼–å†™ï¼Œä»¥ä¾¿æ¿è®¾ç½®ä»£ç å°†è¿™æ ·çš„å¼•è„šé…ç½®æ•°æ®ä¼ é€’ç»™é©±åŠ¨ç¨‹åºã€‚\nA â€œGeneral Purpose Input/Outputâ€ (GPIO) is a flexible software-controlled digital signal. They are provided from many kinds of chip, and are familiar to Linux developers working with embedded and custom hardware. Each GPIO represents a bit connected to a particular pin, or â€œballâ€ on Ball Grid Array (BGA) packages. Board schematics show which external hardware connects to which GPIOs. Drivers can be written generically, so that board setup code passes such pin configuration data to drivers.\nåœ¨å•ç‰‡æœºä¸Šï¼Œæˆ‘ä»¬å¯ä»¥å¾ˆæ–¹ä¾¿çš„æ§åˆ¶GPIOï¼Œä½†åœ¨åµŒå…¥å¼Linuxä¸Šåˆ™ä¸ä¸€æ ·ï¼Œé€šå¸¸GPIOå¯¹äºç”¨æˆ·æ¥è¯´æ˜¯ä¸å¯è§çš„ï¼Œä¸è¿‡Linuxç³»ç»Ÿä¹Ÿæä¾›äº†ç›¸åº”çš„æ¥å£ä¾›ç”¨æˆ·æ§åˆ¶GPIOï¼Œæ¯ä¸ªéä¸“ç”¨çš„å¼•è„šéƒ½å¯ä»¥ç”¨ä½œGPIOã€‚\né…ç½®IOå¤šè·¯å¤ç”¨å™¨ï¼ˆIOMUXCï¼‰ å°†éœ€è¦å¤ç”¨çš„IOæ·»åŠ åˆ°pinctrl_hogèŠ‚ç‚¹ï¼Œä¾‹ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 /* kernel/arch/arm64/boot/dts/freescale/OK8MP-C.dts */ \u0026iomuxc { pinctrl-names = \"default\"; pinctrl-0 = \u003c\u0026pinctrl_hog\u003e; pinctrl_hog: hoggrp { fsl,pins = \u003c MX8MP_IOMUXC_HDMI_DDC_SCL__HDMIMIX_HDMI_SCL\t0x400001c3 MX8MP_IOMUXC_HDMI_DDC_SDA__HDMIMIX_HDMI_SDA\t0x400001c3 MX8MP_IOMUXC_HDMI_HPD__HDMIMIX_HDMI_HPD\t0x40000019 MX8MP_IOMUXC_HDMI_CEC__HDMIMIX_HDMI_CEC\t0x40000019 /* GPIO */ MX8MP_IOMUXC_GPIO1_IO07__GPIO1_IO07\t0x159 MX8MP_IOMUXC_GPIO1_IO09__GPIO1_IO09\t0x159 MX8MP_IOMUXC_GPIO1_IO12__GPIO1_IO12\t0x159 MX8MP_IOMUXC_ECSPI2_MOSI__GPIO5_IO11\t0x159 MX8MP_IOMUXC_ECSPI2_MISO__GPIO5_IO12\t0x159 MX8MP_IOMUXC_ECSPI2_SS0__GPIO5_IO13\t0x159 \u003e; }; } å…·ä½“çš„GPIOåå­—è¦å‚ç…§xxxx-pinfunc.hé‡Œé¢çš„å®šä¹‰ï¼Œé…ç½®ä¸ºGPIOæ—¶ï¼Œä¸€å®šè¦ä½¿ç”¨IOMUXC_xxxx_xxxx__GPIOn_IOxxçš„å®å®šä¹‰ã€‚\nç„¶åæ˜¯åé¢çš„ä¸Šä¸‹æ‹‰é…ç½®ï¼Œå…·ä½“çš„è®¡ç®—æ–¹æ³•å’Œå‚æ•°æ„ä¹‰å¦‚ä¸‹ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 PAD_CTL_HYS (1 \u003c\u003c 16) /* Hysteresis æ»åä½¿èƒ½*/ PAD_CTL_PUS_100K_DOWN (0 \u003c\u003c 14) /* 100KOhm Pull Down */ PAD_CTL_PUS_47K_UP (1 \u003c\u003c 14) /* 47KOhm Pull Up */ PAD_CTL_PUS_100K_UP (2 \u003c\u003c 14) /* 100KOhm Pull Up */ PAD_CTL_PUS_22K_UP (3 \u003c\u003c 14) /* 22KOhm Pull Up */ PAD_CTL_PUE (1 \u003c\u003c 13) /* Pull / Keep Enable */ PAD_CTL_PKE (1 \u003c\u003c 12) /* Pull / Keep Select 0: Keeper 1: Pull */ PAD_CTL_ODE (1 \u003c\u003c 11) /* Open Drain Enable æ¼æå¼€è·¯ */ PAD_CTL_SPEED_LOW (1 \u003c\u003c 6) /* å¸¦å®½é…ç½® */ PAD_CTL_SPEED_MED (2 \u003c\u003c 6) PAD_CTL_SPEED_HIGH (3 \u003c\u003c 6) PAD_CTL_DSE_DISABLE (0 \u003c\u003c 3) /* Drive Strength Field é©±åŠ¨èƒ½åŠ› */ PAD_CTL_DSE_240ohm (1 \u003c\u003c 3) PAD_CTL_DSE_120ohm (2 \u003c\u003c 3) PAD_CTL_DSE_80ohm (3 \u003c\u003c 3) PAD_CTL_DSE_60ohm (4 \u003c\u003c 3) PAD_CTL_DSE_48ohm (5 \u003c\u003c 3) PAD_CTL_DSE_40ohm (6 \u003c\u003c 3) PAD_CTL_DSE_34ohm (7 \u003c\u003c 3) PAD_CTL_SRE_FAST (1 \u003c\u003c 0) /* Slew Rate Field å‹æ‘†ç‡ */ PAD_CTL_SRE_SLOW (0 \u003c\u003c 0) æ³¨æ„ï¼šä¸è¦ç›´æ¥è®¾ç½®ä¸º0ï¼Œæ²¡æœ‰ä»»ä½•ä½œç”¨ã€‚å¯ä»¥ä½¿ç”¨0x80000000ï¼Œå®ƒè¡¨ç¤ºâ€œæˆ‘ä¸çŸ¥é“ï¼Œä¿æŒé»˜è®¤å€¼â€ã€‚\nç”¨æˆ·ç©ºé—´ä¸‹çš„GPIOè¯»å†™æ“ä½œ ç”¨æˆ·ç©ºé—´ä¸‹çš„GPIOæ–‡ä»¶ç³»ç»Ÿæ¥å£åœ¨/sys/class/gpio/ç›®å½•ä¸‹ã€‚\næ³¨æ„ï¼šä»¥ä¸‹æ“ä½œéƒ½éœ€è¦rootæƒé™ï¼\nä½¿èƒ½GPIO åœ¨æ­¤ä¹‹å‰ï¼Œéœ€è¦å…ˆçŸ¥é“GPIOå¯¹åº”çš„ç¼–å·æ•°å€¼ï¼Œè®¡ç®—æ–¹æ³•å¦‚ä¸‹ï¼š\nGPIOn_IOx = (n - 1) Ã— 32 + x\nä¾‹ï¼šGPIO5_IO13 = (5 - 1) Ã— 32 + 13 = 141\næ‰§è¡Œå‘½ä»¤\n1 2 3 # echo N \u003e /sys/class/gpio/export # Nä¸ºGPIOå¯¹åº”çš„ç¼–å·ï¼Œä¾‹ï¼š echo 141 \u003e /sys/class/gpio/export å¦‚æœéœ€è¦å–æ¶ˆä½¿èƒ½GPIOï¼Œåˆ™æ‰§è¡Œå‘½ä»¤\n1 2 3 # echo N \u003e /sys/class/gpio/unexport # Nä¸ºGPIOå¯¹åº”çš„ç¼–å·ï¼Œä¾‹ï¼š echo 141 \u003e /sys/class/gpio/unexport GPIOé…ç½® ä½¿èƒ½GPIOä¹‹åï¼Œ/sys/class/gpio/ç›®å½•ä¸‹å°±å¤šå‡ºæ¥äº†ç›¸åº”çš„GPIOèŠ‚ç‚¹ç›®å½•ã€‚ä¾‹ï¼šgpio141\nGPIOèŠ‚ç‚¹æœ‰ä»¥ä¸‹å±æ€§å¯ä»¥é…ç½®ï¼š\n/sys/class/gpio/gpioN/\ndirection\nè¯»å–ä¸ºinæˆ–è€…outã€‚é€šå¸¸å¯ä»¥å†™å…¥æ­¤å€¼ã€‚å†™å…¥outé»˜è®¤è¾“å‡ºä¸ºä½ã€‚ä¸ºäº†ç¡®ä¿æ“ä½œæ— è¯¯ï¼Œå¯ä»¥å†™å…¥å€¼â€œlowâ€å’Œâ€œhighâ€å°†GPIOé…ç½®ä¸ºå…·æœ‰è¯¥åˆå§‹å€¼çš„è¾“å‡ºã€‚\nè¯·æ³¨æ„ï¼Œå¦‚æœå†…æ ¸ä¸æ”¯æŒæ›´æ”¹GPIOçš„æ–¹å‘ï¼Œæˆ–è€…è¯¥å±æ€§æ˜¯ç”±å†…æ ¸ä»£ç å¯¼å‡ºçš„ï¼Œè€Œå†…æ ¸ä»£ç æ²¡æœ‰æ˜ç¡®å…è®¸ç”¨æˆ·ç©ºé—´é‡æ–°é…ç½®è¯¥GPIOæ–¹å‘ï¼Œåˆ™è¯¥å±æ€§å°†ä¸å­˜åœ¨ã€‚\nvalue\nè¯»å–ä¸º0ï¼ˆlowï¼‰æˆ–1ï¼ˆhighï¼‰ã€‚å¦‚æœGPIOè¢«é…ç½®ä¸ºè¾“å‡ºï¼Œåˆ™å¯ä»¥å†™å…¥è¯¥å€¼ï¼›ä»»ä½•éé›¶å€¼éƒ½è¢«è§†ä¸ºé«˜ã€‚\nå¦‚æœå¼•è„šå¯ä»¥é…ç½®ä¸ºä¸­æ–­ç”Ÿæˆï¼Œå¹¶ä¸”å®ƒå·²ç»é…ç½®ä¸ºç”Ÿæˆä¸­æ–­ï¼ˆè¯·å‚é˜…â€œedgeâ€çš„æè¿°ï¼‰ï¼Œé‚£ä¹ˆæ‚¨å¯ä»¥å¯¹è¯¥æ–‡ä»¶è¿›è¡Œè½®è¯¢ï¼ˆpollï¼‰ï¼Œæ¯å½“è§¦å‘ä¸­æ–­æ—¶ï¼Œè½®è¯¢ï¼ˆpollï¼‰å°†è¿”å›ã€‚å¦‚æœä½¿ç”¨pollï¼Œè¯·è®¾ç½®äº‹ä»¶ä¸ºPOLLPRIå’ŒPOLLERRã€‚å¦‚æœä½¿ç”¨selectï¼Œåˆ™å°†æ–‡ä»¶æè¿°ç¬¦è®¾ç½®ä¸ºexceptfdsã€‚è½®è¯¢è¿”å›åï¼Œè¦ä¹ˆlseekåˆ°sysfsæ–‡ä»¶çš„å¼€å¤´å¹¶è¯»å–æ–°å€¼ï¼Œè¦ä¹ˆå…³é—­æ–‡ä»¶å¹¶é‡æ–°æ‰“å¼€ä»¥è¯»å–å€¼ã€‚\nedge\nè¯»å–ä¸ºnoneã€risingã€fallingæˆ–è€…bothã€‚ç¼–å†™è¿™äº›å­—ç¬¦ä¸²ä»¥é€‰æ‹©å°†å¯¹â€œvalueâ€æ–‡ä»¶è¿”å›è¿›è¡Œè½®è¯¢çš„ä¿¡å·è¾¹ç¼˜ã€‚\nä»…å½“å¼•è„šå¯ä»¥é…ç½®ä¸ºä¸­æ–­ç”Ÿæˆè¾“å…¥å¼•è„šæ—¶ï¼Œæ­¤å±æ€§æ‰å­˜åœ¨ã€‚\nactive_low\nè¯»å–ä¸º0ï¼ˆå‡ï¼‰æˆ–1ï¼ˆçœŸï¼‰ã€‚å†™å…¥ä»»ä½•éé›¶å€¼ä»¥åè½¬è¯»å–å’Œå†™å…¥çš„å€¼å±æ€§ã€‚ç°æœ‰å’Œåç»­è½®è¯¢æ”¯æŒé€šè¿‡è¾¹ç¼˜å±æ€§é…ç½®â€œrisingâ€å’Œâ€œfallingâ€è¾¹ç¼˜å°†éµå¾ªæ­¤è®¾ç½®ã€‚\nä¾‹ï¼š\nå°†GPIOé…ç½®ä¸ºè¾“å‡º\n1 echo out \u003e /sys/class/gpio/gpio{N}/direction å°†GPIOé…ç½®ä¸ºè¾“å…¥ï¼Œä¸Šå‡æ²¿è§¦å‘ä¸­æ–­\n1 2 echo in \u003e /sys/class/gpio/gpio{N}/direction echo rising \u003e /sys/class/gpio/gpio{N}/edge GPIOè¯»å†™ GPIOé…ç½®ä¸ºè¾“å…¥ï¼ˆinï¼‰æ—¶ï¼Œåªèƒ½è¯»å–è¾“å…¥å€¼ï¼Œä¸èƒ½å†™å…¥\nGPIOé…ç½®ä¸ºè¾“å‡ºï¼ˆoutï¼‰æ—¶ï¼Œå¯ä»¥è¯»å–å½“å‰å€¼å’Œå†™å…¥æ–°å€¼\n1 2 3 4 5 # è¯»å–æ—¶ cat /sys/class/gpio/gpio{N}/value # å†™å…¥æ—¶ echo 0 \u003e /sys/class/gpio/gpio{N}/value echo 1 \u003e /sys/class/gpio/gpio{N}/value ç¨‹åºæ§åˆ¶GPIO ç¤ºä¾‹è¯»å–ï¼š\n1 2 3 4 5 6 7 8 9 10 11 int readGpio(unsigned short io) { QFile file(QString(\"/sys/class/gpio/gpio%1/value\").arg(io)); if (!file.open(QIODevice::ReadOnly)) return 0; QByteArray ba = file.readAll(); file.close(); return QString(ba).toInt(); } ç¤ºä¾‹å†™å…¥ï¼š\n1 2 3 4 5 6 bool writeGpio(unsigned short io, unsigned char value) { char buf[128]; sprintf(buf, \"echo %d \u003e /sys/class/gpio/gpio%d/value\", value, io); return ::system(buf) == 0; } å‚è€ƒ\nLegacy GPIO Interfaces GPIO Sysfs Interface for Userspace Definitive GPIO guide ","wordCount":"498","inLanguage":"zh","datePublished":"2023-01-12T13:33:37+08:00","dateModified":"2023-01-12T13:33:37+08:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://kira-96.github.io/posts/linux-gpio%E6%93%8D%E4%BD%9C%E5%85%B6%E4%B8%80/"},"publisher":{"@type":"Organization","name":"âœ¨kiraã®åšå®¢","logo":{"@type":"ImageObject","url":"https://cdn.jsdelivr.net/gh/kira-96/kira-96.github.io@gh-pages/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://kira-96.github.io/ accesskey=h title="âœ¨kiraã®åšå®¢ (Alt + H)">âœ¨kiraã®åšå®¢</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://kira-96.github.io/ title=ğŸ ä¸»é¡µ><span>ğŸ ä¸»é¡µ</span></a></li><li><a href=https://kira-96.github.io/notes/ title=ğŸ““ç¬”è®°><span>ğŸ““ç¬”è®°</span></a></li><li><a href=https://kira-96.github.io/search/ title=ğŸ”ï¸æœç´¢><span>ğŸ”ï¸æœç´¢</span></a></li><li><a href=https://kira-96.github.io/archives/ title=ğŸ—ƒï¸å­˜æ¡£><span>ğŸ—ƒï¸å­˜æ¡£</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://kira-96.github.io/>ä¸»é¡µ</a>&nbsp;Â»&nbsp;<a href=https://kira-96.github.io/posts/>Posts</a></div><h1 class="post-title entry-hint-parent">Linux GPIO æ“ä½œå…¶ä¸€</h1><div class=post-description>Linuxä¸‹GPIOçš„è¯»å†™æ“ä½œ</div><div class=post-meta><span title='2023-01-12 13:33:37 +0800 +0800'>ä¸€æœˆ 12, 2023</span>&nbsp;Â·&nbsp;3 åˆ†é’Ÿ&nbsp;Â·&nbsp;498 å­—&nbsp;|&nbsp;<a href=https://github.com/kira-96/kira-96.github.io/tree/main/content/posts/ rel="noopener noreferrer" target=_blank>âœï¸ç¼–è¾‘</a></div></header><aside id=toc-container class="toc-container wide"><div class=toc><details open><summary accesskey=c title="(Alt + C)"><span class=details>ç›®å½•</span></summary><div class=inner><ul><li><a href=#%e5%89%8d%e8%a8%80 aria-label=å‰è¨€>å‰è¨€</a></li><li><a href=#%e9%85%8d%e7%bd%aeio%e5%a4%9a%e8%b7%af%e5%a4%8d%e7%94%a8%e5%99%a8iomuxc aria-label=é…ç½®IOå¤šè·¯å¤ç”¨å™¨ï¼ˆIOMUXCï¼‰>é…ç½®IOå¤šè·¯å¤ç”¨å™¨ï¼ˆIOMUXCï¼‰</a></li><li><a href=#%e7%94%a8%e6%88%b7%e7%a9%ba%e9%97%b4%e4%b8%8b%e7%9a%84gpio%e8%af%bb%e5%86%99%e6%93%8d%e4%bd%9c aria-label=ç”¨æˆ·ç©ºé—´ä¸‹çš„GPIOè¯»å†™æ“ä½œ>ç”¨æˆ·ç©ºé—´ä¸‹çš„GPIOè¯»å†™æ“ä½œ</a><ul><li><a href=#%e4%bd%bf%e8%83%bdgpio aria-label=ä½¿èƒ½GPIO>ä½¿èƒ½GPIO</a></li><li><a href=#gpio%e9%85%8d%e7%bd%ae aria-label=GPIOé…ç½®>GPIOé…ç½®</a></li><li><a href=#gpio%e8%af%bb%e5%86%99 aria-label=GPIOè¯»å†™>GPIOè¯»å†™</a></li><li><a href=#%e7%a8%8b%e5%ba%8f%e6%8e%a7%e5%88%b6gpio aria-label=ç¨‹åºæ§åˆ¶GPIO>ç¨‹åºæ§åˆ¶GPIO</a></li></ul></li></ul></div></details></div></aside><script>let activeElement,elements;window.addEventListener("DOMContentLoaded",function(){checkTocPosition(),elements=document.querySelectorAll("h1[id],h2[id],h3[id],h4[id],h5[id],h6[id]"),activeElement=elements[0];const t=encodeURI(activeElement.getAttribute("id")).toLowerCase();document.querySelector(`.inner ul li a[href="#${t}"]`).classList.add("active")},!1),window.addEventListener("resize",function(){checkTocPosition()},!1),window.addEventListener("scroll",()=>{activeElement=Array.from(elements).find(e=>{if(getOffsetTop(e)-window.pageYOffset>0&&getOffsetTop(e)-window.pageYOffset<window.innerHeight/2)return e})||activeElement,elements.forEach(e=>{const t=encodeURI(e.getAttribute("id")).toLowerCase();e===activeElement?document.querySelector(`.inner ul li a[href="#${t}"]`).classList.add("active"):document.querySelector(`.inner ul li a[href="#${t}"]`).classList.remove("active")})},!1);const main=parseInt(getComputedStyle(document.body).getPropertyValue("--article-width"),10),toc=parseInt(getComputedStyle(document.body).getPropertyValue("--toc-width"),10),gap=parseInt(getComputedStyle(document.body).getPropertyValue("--gap"),10);function checkTocPosition(){const e=document.body.scrollWidth;e-main-toc*2-gap*4>0?document.getElementById("toc-container").classList.add("wide"):document.getElementById("toc-container").classList.remove("wide")}function getOffsetTop(e){if(!e.getClientRects().length)return 0;let t=e.getBoundingClientRect(),n=e.ownerDocument.defaultView;return t.top+n.pageYOffset}</script><div class=post-content><h2 id=å‰è¨€>å‰è¨€<a hidden class=anchor aria-hidden=true href=#å‰è¨€>#</a></h2><p>ç”±äºæ¢äº†æ–°çš„å·¥ä½œï¼Œæˆ‘çš„å·¥ä½œæ–¹å‘ä¹Ÿæœ‰äº†å¾ˆå¤§çš„å˜åŒ–ï¼Œä¹‹å‰åŸºæœ¬ä¸Šæ˜¯å•çº¯çš„å†™ä»£ç ï¼Œç°åœ¨åˆ™ç»å¸¸éœ€è¦å’Œç¡¬ä»¶è®¾å¤‡äº¤äº’ï¼Œå¼€å‘å¹³å°ä¹Ÿè½¬åˆ°äº†Linux+Qtã€‚ç¡¬ä»¶è®¾å¤‡çš„æ§åˆ¶ï¼Œå…¶ä¸­æœ€åŸºæœ¬çš„å°±æ˜¯LEDç¯ä»¥åŠä¸€äº›å¼€å…³ç»§ç”µå™¨çš„æ“ä½œï¼Œå…¶æœ¬è´¨å°±æ˜¯GPIOçš„æ“ä½œã€‚è€ƒè™‘åˆ°ç³»ç»Ÿçš„ç²¾ç®€å’Œæˆæœ¬æ§åˆ¶ï¼Œæœ€å¥½æ˜¯å¯ä»¥ç›´æ¥é€šè¿‡Linuxç³»ç»Ÿå»æ§åˆ¶ï¼Œå½“ç„¶ä¹Ÿæœ‰å…¶å®ƒæ›¿ä»£æ–¹æ¡ˆï¼Œæ¯”å¦‚ä½¿ç”¨æ”¯æŒModbusåè®®çš„IOæ¨¡å—ã€‚å…³äºModbusçš„ä½¿ç”¨ï¼Œåé¢æœ‰ç©ºå†è®²ï¼Œè¿™é‡Œå°±è®°å½•ä¸€ä¸‹æœ€ç®€å•çš„Linuxç³»ç»Ÿä¸‹çš„GPIOæ§åˆ¶ï¼Œ<strong>ç”¨æˆ·ç©ºé—´ä¸‹çš„GPIOæ–‡ä»¶ç³»ç»Ÿæ¥å£</strong>ã€‚</p><p>åœ¨æ­¤ä¹‹å‰ï¼Œæœ‰å¿…è¦å†äº†è§£ä¸€ä¸‹GPIOçš„æ¦‚å¿µã€‚</p><p>â€œé€šç”¨è¾“å…¥/è¾“å‡ºâ€ï¼ˆGPIOï¼‰æ˜¯ä¸€ç§çµæ´»çš„è½¯ä»¶æ§åˆ¶æ•°å­—ä¿¡å·ã€‚å®ƒä»¬ç”±å¤šç§èŠ¯ç‰‡æä¾›ï¼Œå¯¹äºä½¿ç”¨åµŒå…¥å¼å’Œå®šåˆ¶ç¡¬ä»¶çš„Linuxå¼€å‘äººå‘˜æ¥è¯´å¾ˆç†Ÿæ‚‰ã€‚æ¯ä¸ªGPIOä»£è¡¨ä¸€ä¸ªè¿æ¥åˆ°ç‰¹å®šå¼•è„šçš„ä½ï¼Œå³çƒæ …é˜µåˆ—ï¼ˆBGAï¼‰å°è£…ä¸Šçš„â€œçƒâ€ã€‚ç”µè·¯æ¿ç¤ºæ„å›¾æ˜¾ç¤ºäº†å“ªäº›å¤–éƒ¨ç¡¬ä»¶è¿æ¥åˆ°å“ªäº›GPIOã€‚é©±åŠ¨ç¨‹åºå¯ä»¥é€šç”¨åœ°ç¼–å†™ï¼Œä»¥ä¾¿æ¿è®¾ç½®ä»£ç å°†è¿™æ ·çš„å¼•è„šé…ç½®æ•°æ®ä¼ é€’ç»™é©±åŠ¨ç¨‹åºã€‚</p><blockquote><p>A â€œGeneral Purpose Input/Outputâ€ (GPIO) is a flexible software-controlled digital signal. They are provided from many kinds of chip, and are familiar to Linux developers working with embedded and custom hardware. Each GPIO represents a bit connected to a particular pin, or â€œballâ€ on Ball Grid Array (BGA) packages. Board schematics show which external hardware connects to which GPIOs. Drivers can be written generically, so that board setup code passes such pin configuration data to drivers.</p></blockquote><p>åœ¨å•ç‰‡æœºä¸Šï¼Œæˆ‘ä»¬å¯ä»¥å¾ˆæ–¹ä¾¿çš„æ§åˆ¶GPIOï¼Œä½†åœ¨åµŒå…¥å¼Linuxä¸Šåˆ™ä¸ä¸€æ ·ï¼Œé€šå¸¸GPIOå¯¹äºç”¨æˆ·æ¥è¯´æ˜¯ä¸å¯è§çš„ï¼Œä¸è¿‡Linuxç³»ç»Ÿä¹Ÿæä¾›äº†ç›¸åº”çš„æ¥å£ä¾›ç”¨æˆ·æ§åˆ¶GPIOï¼Œæ¯ä¸ªéä¸“ç”¨çš„å¼•è„šéƒ½å¯ä»¥ç”¨ä½œGPIOã€‚</p><h2 id=é…ç½®ioå¤šè·¯å¤ç”¨å™¨iomuxc>é…ç½®IOå¤šè·¯å¤ç”¨å™¨ï¼ˆIOMUXCï¼‰<a hidden class=anchor aria-hidden=true href=#é…ç½®ioå¤šè·¯å¤ç”¨å™¨iomuxc>#</a></h2><p>å°†éœ€è¦å¤ç”¨çš„IOæ·»åŠ åˆ°<code>pinctrl_hog</code>èŠ‚ç‚¹ï¼Œä¾‹ï¼š</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=cm>/* kernel/arch/arm64/boot/dts/freescale/OK8MP-C.dts */</span>
</span></span><span class=line><span class=cl><span class=o>&amp;</span><span class=n>iomuxc</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=n>pinctrl</span><span class=o>-</span><span class=n>names</span> <span class=o>=</span> <span class=s>&#34;default&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=n>pinctrl</span><span class=o>-</span><span class=mi>0</span> <span class=o>=</span> <span class=o>&lt;&amp;</span><span class=n>pinctrl_hog</span><span class=o>&gt;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=nl>pinctrl_hog</span><span class=p>:</span> <span class=n>hoggrp</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=n>fsl</span><span class=p>,</span><span class=n>pins</span> <span class=o>=</span> <span class=o>&lt;</span>
</span></span><span class=line><span class=cl>			<span class=n>MX8MP_IOMUXC_HDMI_DDC_SCL__HDMIMIX_HDMI_SCL</span>	<span class=mh>0x400001c3</span>
</span></span><span class=line><span class=cl>			<span class=n>MX8MP_IOMUXC_HDMI_DDC_SDA__HDMIMIX_HDMI_SDA</span>	<span class=mh>0x400001c3</span>
</span></span><span class=line><span class=cl>			<span class=n>MX8MP_IOMUXC_HDMI_HPD__HDMIMIX_HDMI_HPD</span>		<span class=mh>0x40000019</span>
</span></span><span class=line><span class=cl>			<span class=n>MX8MP_IOMUXC_HDMI_CEC__HDMIMIX_HDMI_CEC</span>		<span class=mh>0x40000019</span>
</span></span><span class=line><span class=cl>			<span class=cm>/* GPIO */</span>
</span></span><span class=line><span class=cl>			<span class=n>MX8MP_IOMUXC_GPIO1_IO07__GPIO1_IO07</span>			<span class=mh>0x159</span>
</span></span><span class=line><span class=cl>			<span class=n>MX8MP_IOMUXC_GPIO1_IO09__GPIO1_IO09</span>			<span class=mh>0x159</span>
</span></span><span class=line><span class=cl>			<span class=n>MX8MP_IOMUXC_GPIO1_IO12__GPIO1_IO12</span>			<span class=mh>0x159</span>
</span></span><span class=line><span class=cl>			<span class=n>MX8MP_IOMUXC_ECSPI2_MOSI__GPIO5_IO11</span>		<span class=mh>0x159</span>
</span></span><span class=line><span class=cl>			<span class=n>MX8MP_IOMUXC_ECSPI2_MISO__GPIO5_IO12</span>		<span class=mh>0x159</span>
</span></span><span class=line><span class=cl>			<span class=n>MX8MP_IOMUXC_ECSPI2_SS0__GPIO5_IO13</span>			<span class=mh>0x159</span>
</span></span><span class=line><span class=cl>		<span class=o>&gt;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=p>};</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>å…·ä½“çš„GPIOåå­—è¦å‚ç…§<code>xxxx-pinfunc.h</code>é‡Œé¢çš„å®šä¹‰ï¼Œé…ç½®ä¸ºGPIOæ—¶ï¼Œä¸€å®šè¦ä½¿ç”¨<code>IOMUXC_xxxx_xxxx__GPIOn_IOxx</code>çš„å®å®šä¹‰ã€‚</p><p>ç„¶åæ˜¯åé¢çš„ä¸Šä¸‹æ‹‰é…ç½®ï¼Œå…·ä½“çš„è®¡ç®—æ–¹æ³•å’Œå‚æ•°æ„ä¹‰å¦‚ä¸‹ï¼š</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=nf>PAD_CTL_HYS</span>                     <span class=p>(</span><span class=mi>1</span> <span class=o>&lt;&lt;</span> <span class=mi>16</span><span class=p>)</span> <span class=cm>/* Hysteresis æ»åä½¿èƒ½*/</span>
</span></span><span class=line><span class=cl><span class=nf>PAD_CTL_PUS_100K_DOWN</span>           <span class=p>(</span><span class=mi>0</span> <span class=o>&lt;&lt;</span> <span class=mi>14</span><span class=p>)</span> <span class=cm>/* 100KOhm Pull Down */</span>
</span></span><span class=line><span class=cl><span class=nf>PAD_CTL_PUS_47K_UP</span>              <span class=p>(</span><span class=mi>1</span> <span class=o>&lt;&lt;</span> <span class=mi>14</span><span class=p>)</span> <span class=cm>/* 47KOhm Pull Up */</span>
</span></span><span class=line><span class=cl><span class=nf>PAD_CTL_PUS_100K_UP</span>             <span class=p>(</span><span class=mi>2</span> <span class=o>&lt;&lt;</span> <span class=mi>14</span><span class=p>)</span> <span class=cm>/* 100KOhm Pull Up */</span>
</span></span><span class=line><span class=cl><span class=nf>PAD_CTL_PUS_22K_UP</span>              <span class=p>(</span><span class=mi>3</span> <span class=o>&lt;&lt;</span> <span class=mi>14</span><span class=p>)</span> <span class=cm>/* 22KOhm Pull Up */</span>
</span></span><span class=line><span class=cl><span class=nf>PAD_CTL_PUE</span>                     <span class=p>(</span><span class=mi>1</span> <span class=o>&lt;&lt;</span> <span class=mi>13</span><span class=p>)</span> <span class=cm>/* Pull / Keep Enable */</span>
</span></span><span class=line><span class=cl><span class=nf>PAD_CTL_PKE</span>                     <span class=p>(</span><span class=mi>1</span> <span class=o>&lt;&lt;</span> <span class=mi>12</span><span class=p>)</span> <span class=cm>/* Pull / Keep Select 0: Keeper 1: Pull */</span>
</span></span><span class=line><span class=cl><span class=nf>PAD_CTL_ODE</span>                     <span class=p>(</span><span class=mi>1</span> <span class=o>&lt;&lt;</span> <span class=mi>11</span><span class=p>)</span> <span class=cm>/* Open Drain Enable æ¼æå¼€è·¯ */</span>
</span></span><span class=line><span class=cl><span class=nf>PAD_CTL_SPEED_LOW</span>               <span class=p>(</span><span class=mi>1</span> <span class=o>&lt;&lt;</span> <span class=mi>6</span><span class=p>)</span>  <span class=cm>/* å¸¦å®½é…ç½® */</span>
</span></span><span class=line><span class=cl><span class=nf>PAD_CTL_SPEED_MED</span>               <span class=p>(</span><span class=mi>2</span> <span class=o>&lt;&lt;</span> <span class=mi>6</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nf>PAD_CTL_SPEED_HIGH</span>              <span class=p>(</span><span class=mi>3</span> <span class=o>&lt;&lt;</span> <span class=mi>6</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nf>PAD_CTL_DSE_DISABLE</span>             <span class=p>(</span><span class=mi>0</span> <span class=o>&lt;&lt;</span> <span class=mi>3</span><span class=p>)</span>  <span class=cm>/* Drive Strength Field é©±åŠ¨èƒ½åŠ› */</span>
</span></span><span class=line><span class=cl><span class=nf>PAD_CTL_DSE_240ohm</span>              <span class=p>(</span><span class=mi>1</span> <span class=o>&lt;&lt;</span> <span class=mi>3</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nf>PAD_CTL_DSE_120ohm</span>              <span class=p>(</span><span class=mi>2</span> <span class=o>&lt;&lt;</span> <span class=mi>3</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nf>PAD_CTL_DSE_80ohm</span>               <span class=p>(</span><span class=mi>3</span> <span class=o>&lt;&lt;</span> <span class=mi>3</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nf>PAD_CTL_DSE_60ohm</span>               <span class=p>(</span><span class=mi>4</span> <span class=o>&lt;&lt;</span> <span class=mi>3</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nf>PAD_CTL_DSE_48ohm</span>               <span class=p>(</span><span class=mi>5</span> <span class=o>&lt;&lt;</span> <span class=mi>3</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nf>PAD_CTL_DSE_40ohm</span>               <span class=p>(</span><span class=mi>6</span> <span class=o>&lt;&lt;</span> <span class=mi>3</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nf>PAD_CTL_DSE_34ohm</span>               <span class=p>(</span><span class=mi>7</span> <span class=o>&lt;&lt;</span> <span class=mi>3</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nf>PAD_CTL_SRE_FAST</span>                <span class=p>(</span><span class=mi>1</span> <span class=o>&lt;&lt;</span> <span class=mi>0</span><span class=p>)</span>  <span class=cm>/* Slew Rate Field å‹æ‘†ç‡ */</span>
</span></span><span class=line><span class=cl><span class=nf>PAD_CTL_SRE_SLOW</span>                <span class=p>(</span><span class=mi>0</span> <span class=o>&lt;&lt;</span> <span class=mi>0</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><blockquote><p>æ³¨æ„ï¼šä¸è¦ç›´æ¥è®¾ç½®ä¸º<code>0</code>ï¼Œæ²¡æœ‰ä»»ä½•ä½œç”¨ã€‚å¯ä»¥ä½¿ç”¨<code>0x80000000</code>ï¼Œå®ƒè¡¨ç¤ºâ€œæˆ‘ä¸çŸ¥é“ï¼Œä¿æŒé»˜è®¤å€¼â€ã€‚</p></blockquote><h2 id=ç”¨æˆ·ç©ºé—´ä¸‹çš„gpioè¯»å†™æ“ä½œ>ç”¨æˆ·ç©ºé—´ä¸‹çš„GPIOè¯»å†™æ“ä½œ<a hidden class=anchor aria-hidden=true href=#ç”¨æˆ·ç©ºé—´ä¸‹çš„gpioè¯»å†™æ“ä½œ>#</a></h2><p>ç”¨æˆ·ç©ºé—´ä¸‹çš„GPIOæ–‡ä»¶ç³»ç»Ÿæ¥å£åœ¨<code>/sys/class/gpio/</code>ç›®å½•ä¸‹ã€‚</p><blockquote><p>æ³¨æ„ï¼šä»¥ä¸‹æ“ä½œéƒ½éœ€è¦rootæƒé™ï¼</p></blockquote><h3 id=ä½¿èƒ½gpio>ä½¿èƒ½GPIO<a hidden class=anchor aria-hidden=true href=#ä½¿èƒ½gpio>#</a></h3><p>åœ¨æ­¤ä¹‹å‰ï¼Œéœ€è¦å…ˆçŸ¥é“GPIOå¯¹åº”çš„ç¼–å·æ•°å€¼ï¼Œè®¡ç®—æ–¹æ³•å¦‚ä¸‹ï¼š</p><p>GPIOn_IOx = (n - 1) Ã— 32 + x</p><p>ä¾‹ï¼šGPIO5_IO13 = (5 - 1) Ã— 32 + 13 = 141</p><p>æ‰§è¡Œå‘½ä»¤</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl><span class=c1># echo N &gt; /sys/class/gpio/export</span>
</span></span><span class=line><span class=cl><span class=c1># Nä¸ºGPIOå¯¹åº”çš„ç¼–å·ï¼Œä¾‹ï¼š</span>
</span></span><span class=line><span class=cl><span class=nb>echo</span> <span class=m>141</span> &gt; /sys/class/gpio/export
</span></span></code></pre></td></tr></table></div></div><p>å¦‚æœéœ€è¦å–æ¶ˆä½¿èƒ½GPIOï¼Œåˆ™æ‰§è¡Œå‘½ä»¤</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl><span class=c1># echo N &gt; /sys/class/gpio/unexport</span>
</span></span><span class=line><span class=cl><span class=c1># Nä¸ºGPIOå¯¹åº”çš„ç¼–å·ï¼Œä¾‹ï¼š</span>
</span></span><span class=line><span class=cl><span class=nb>echo</span> <span class=m>141</span> &gt; /sys/class/gpio/unexport
</span></span></code></pre></td></tr></table></div></div><h3 id=gpioé…ç½®>GPIOé…ç½®<a hidden class=anchor aria-hidden=true href=#gpioé…ç½®>#</a></h3><p>ä½¿èƒ½GPIOä¹‹åï¼Œ<code>/sys/class/gpio/</code>ç›®å½•ä¸‹å°±å¤šå‡ºæ¥äº†ç›¸åº”çš„GPIOèŠ‚ç‚¹ç›®å½•ã€‚ä¾‹ï¼š<code>gpio141</code></p><p>GPIOèŠ‚ç‚¹æœ‰ä»¥ä¸‹å±æ€§å¯ä»¥é…ç½®ï¼š</p><p><code>/sys/class/gpio/gpioN/</code></p><ul><li><p><strong>direction</strong></p><p>è¯»å–ä¸º<code>in</code>æˆ–è€…<code>out</code>ã€‚é€šå¸¸å¯ä»¥å†™å…¥æ­¤å€¼ã€‚å†™å…¥<code>out</code>é»˜è®¤è¾“å‡ºä¸ºä½ã€‚ä¸ºäº†ç¡®ä¿æ“ä½œæ— è¯¯ï¼Œå¯ä»¥å†™å…¥å€¼â€œlowâ€å’Œâ€œhighâ€å°†GPIOé…ç½®ä¸ºå…·æœ‰è¯¥åˆå§‹å€¼çš„è¾“å‡ºã€‚</p><p>è¯·æ³¨æ„ï¼Œå¦‚æœå†…æ ¸ä¸æ”¯æŒæ›´æ”¹GPIOçš„æ–¹å‘ï¼Œæˆ–è€…è¯¥å±æ€§æ˜¯ç”±å†…æ ¸ä»£ç å¯¼å‡ºçš„ï¼Œè€Œå†…æ ¸ä»£ç æ²¡æœ‰æ˜ç¡®å…è®¸ç”¨æˆ·ç©ºé—´é‡æ–°é…ç½®è¯¥GPIOæ–¹å‘ï¼Œåˆ™è¯¥å±æ€§å°†ä¸å­˜åœ¨ã€‚</p></li><li><p><strong>value</strong></p><p>è¯»å–ä¸º<code>0</code>ï¼ˆlowï¼‰æˆ–<code>1</code>ï¼ˆhighï¼‰ã€‚å¦‚æœGPIOè¢«é…ç½®ä¸ºè¾“å‡ºï¼Œåˆ™å¯ä»¥å†™å…¥è¯¥å€¼ï¼›<strong>ä»»ä½•éé›¶å€¼éƒ½è¢«è§†ä¸ºé«˜</strong>ã€‚</p><p>å¦‚æœå¼•è„šå¯ä»¥é…ç½®ä¸ºä¸­æ–­ç”Ÿæˆï¼Œå¹¶ä¸”å®ƒå·²ç»é…ç½®ä¸ºç”Ÿæˆä¸­æ–­ï¼ˆè¯·å‚é˜…â€œedgeâ€çš„æè¿°ï¼‰ï¼Œé‚£ä¹ˆæ‚¨å¯ä»¥å¯¹è¯¥æ–‡ä»¶è¿›è¡Œè½®è¯¢ï¼ˆpollï¼‰ï¼Œæ¯å½“è§¦å‘ä¸­æ–­æ—¶ï¼Œè½®è¯¢ï¼ˆpollï¼‰å°†è¿”å›ã€‚å¦‚æœä½¿ç”¨pollï¼Œè¯·è®¾ç½®äº‹ä»¶ä¸º<code>POLLPRI</code>å’Œ<code>POLLERR</code>ã€‚å¦‚æœä½¿ç”¨selectï¼Œåˆ™å°†æ–‡ä»¶æè¿°ç¬¦è®¾ç½®ä¸º<code>exceptfds</code>ã€‚è½®è¯¢è¿”å›åï¼Œè¦ä¹ˆlseekåˆ°sysfsæ–‡ä»¶çš„å¼€å¤´å¹¶è¯»å–æ–°å€¼ï¼Œè¦ä¹ˆå…³é—­æ–‡ä»¶å¹¶é‡æ–°æ‰“å¼€ä»¥è¯»å–å€¼ã€‚</p></li><li><p><strong>edge</strong></p><p>è¯»å–ä¸º<code>none</code>ã€<code>rising</code>ã€<code>falling</code>æˆ–è€…<code>both</code>ã€‚ç¼–å†™è¿™äº›å­—ç¬¦ä¸²ä»¥é€‰æ‹©å°†å¯¹â€œvalueâ€æ–‡ä»¶è¿”å›è¿›è¡Œè½®è¯¢çš„ä¿¡å·è¾¹ç¼˜ã€‚</p><p>ä»…å½“å¼•è„šå¯ä»¥é…ç½®ä¸ºä¸­æ–­ç”Ÿæˆè¾“å…¥å¼•è„šæ—¶ï¼Œæ­¤å±æ€§æ‰å­˜åœ¨ã€‚</p></li><li><p><strong>active_low</strong></p><p>è¯»å–ä¸º0ï¼ˆå‡ï¼‰æˆ–1ï¼ˆçœŸï¼‰ã€‚å†™å…¥ä»»ä½•éé›¶å€¼ä»¥åè½¬è¯»å–å’Œå†™å…¥çš„å€¼å±æ€§ã€‚ç°æœ‰å’Œåç»­è½®è¯¢æ”¯æŒé€šè¿‡è¾¹ç¼˜å±æ€§é…ç½®â€œrisingâ€å’Œâ€œfallingâ€è¾¹ç¼˜å°†éµå¾ªæ­¤è®¾ç½®ã€‚</p></li></ul><p>ä¾‹ï¼š</p><p>å°†GPIOé…ç½®ä¸ºè¾“å‡º</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl><span class=nb>echo</span> out &gt; /sys/class/gpio/gpio<span class=o>{</span>N<span class=o>}</span>/direction
</span></span></code></pre></td></tr></table></div></div><p>å°†GPIOé…ç½®ä¸ºè¾“å…¥ï¼Œä¸Šå‡æ²¿è§¦å‘ä¸­æ–­</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl><span class=nb>echo</span> in &gt; /sys/class/gpio/gpio<span class=o>{</span>N<span class=o>}</span>/direction
</span></span><span class=line><span class=cl><span class=nb>echo</span> rising &gt; /sys/class/gpio/gpio<span class=o>{</span>N<span class=o>}</span>/edge
</span></span></code></pre></td></tr></table></div></div><h3 id=gpioè¯»å†™>GPIOè¯»å†™<a hidden class=anchor aria-hidden=true href=#gpioè¯»å†™>#</a></h3><p>GPIOé…ç½®ä¸ºè¾“å…¥ï¼ˆinï¼‰æ—¶ï¼Œåªèƒ½è¯»å–è¾“å…¥å€¼ï¼Œä¸èƒ½å†™å…¥</p><p>GPIOé…ç½®ä¸ºè¾“å‡ºï¼ˆoutï¼‰æ—¶ï¼Œå¯ä»¥è¯»å–å½“å‰å€¼å’Œå†™å…¥æ–°å€¼</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl><span class=c1># è¯»å–æ—¶</span>
</span></span><span class=line><span class=cl>cat /sys/class/gpio/gpio<span class=o>{</span>N<span class=o>}</span>/value
</span></span><span class=line><span class=cl><span class=c1># å†™å…¥æ—¶</span>
</span></span><span class=line><span class=cl><span class=nb>echo</span> <span class=m>0</span> &gt; /sys/class/gpio/gpio<span class=o>{</span>N<span class=o>}</span>/value
</span></span><span class=line><span class=cl><span class=nb>echo</span> <span class=m>1</span> &gt; /sys/class/gpio/gpio<span class=o>{</span>N<span class=o>}</span>/value
</span></span></code></pre></td></tr></table></div></div><h3 id=ç¨‹åºæ§åˆ¶gpio>ç¨‹åºæ§åˆ¶GPIO<a hidden class=anchor aria-hidden=true href=#ç¨‹åºæ§åˆ¶gpio>#</a></h3><p>ç¤ºä¾‹è¯»å–ï¼š</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=kt>int</span> <span class=nf>readGpio</span><span class=p>(</span><span class=kt>unsigned</span> <span class=kt>short</span> <span class=n>io</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>QFile</span> <span class=n>file</span><span class=p>(</span><span class=n>QString</span><span class=p>(</span><span class=s>&#34;/sys/class/gpio/gpio%1/value&#34;</span><span class=p>).</span><span class=n>arg</span><span class=p>(</span><span class=n>io</span><span class=p>));</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=o>!</span><span class=n>file</span><span class=p>.</span><span class=n>open</span><span class=p>(</span><span class=n>QIODevice</span><span class=o>::</span><span class=n>ReadOnly</span><span class=p>))</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>QByteArray</span> <span class=n>ba</span> <span class=o>=</span> <span class=n>file</span><span class=p>.</span><span class=n>readAll</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=n>file</span><span class=p>.</span><span class=n>close</span><span class=p>();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>QString</span><span class=p>(</span><span class=n>ba</span><span class=p>).</span><span class=n>toInt</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>ç¤ºä¾‹å†™å…¥ï¼š</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=kt>bool</span> <span class=nf>writeGpio</span><span class=p>(</span><span class=kt>unsigned</span> <span class=kt>short</span> <span class=n>io</span><span class=p>,</span> <span class=kt>unsigned</span> <span class=kt>char</span> <span class=n>value</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kt>char</span> <span class=n>buf</span><span class=p>[</span><span class=mi>128</span><span class=p>];</span>
</span></span><span class=line><span class=cl>    <span class=n>sprintf</span><span class=p>(</span><span class=n>buf</span><span class=p>,</span> <span class=s>&#34;echo %d &gt; /sys/class/gpio/gpio%d/value&#34;</span><span class=p>,</span> <span class=n>value</span><span class=p>,</span> <span class=n>io</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=o>::</span><span class=n>system</span><span class=p>(</span><span class=n>buf</span><span class=p>)</span> <span class=o>==</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p><strong>å‚è€ƒ</strong></p><ul><li><a href=https://www.kernel.org/doc/html/latest/driver-api/gpio/legacy.html>Legacy GPIO Interfaces</a></li><li><a href=https://www.kernel.org/doc/html/latest/admin-guide/gpio/sysfs.html>GPIO Sysfs Interface for Userspace</a></li><li><a href="https://kosagi.com/w/index.php?title=Definitive_GPIO_guide">Definitive GPIO guide</a></li></ul></div><footer class=post-footer><ul class=post-tags><li><a href=https://kira-96.github.io/tags/linux/>linux</a></li></ul><nav class=paginav><a class=prev href=https://kira-96.github.io/posts/%E9%BE%99%E8%8A%AF3a5000loongarch64%E4%B8%8A%E7%BC%96%E8%AF%91%E8%BF%90%E8%A1%8Cepics/><span class=title>Â« ä¸Šä¸€é¡µ</span><br><span>é¾™èŠ¯3A5000(loongarch64)ä¸Šç¼–è¯‘è¿è¡ŒEPICS</span>
</a><a class=next href=https://kira-96.github.io/posts/wsl-libcuda.so.1-is-not-a-symbolic-link-%E7%9A%84%E8%A7%A3%E5%86%B3%E6%96%B9%E6%B3%95/><span class=title>ä¸‹ä¸€é¡µ Â»</span><br><span>WSL libcuda.so.1 is not a symbolic link çš„è§£å†³æ–¹æ³•</span></a></nav></footer><script src=https://utteranc.es/client.js repo=kira-96/kira-96.github.io issue-term=pathname theme=github-light crossorigin=anonymous async></script></article></main><footer class=footer><span>Copyright Â© 2019-2024 <a href=/>kira&rsquo;s blog</a> Â·</span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="å¤åˆ¶";function s(){t.innerHTML="å·²å¤åˆ¶ï¼",setTimeout(()=>{t.innerHTML="å¤åˆ¶"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>