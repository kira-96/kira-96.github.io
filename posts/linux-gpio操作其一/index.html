<!doctype html><html lang=zh dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Linux GPIO 操作其一 | kira's 博客</title><meta name=keywords content="linux,GPIO"><meta name=description content="Linux下GPIO的读写操作"><meta name=author content><link rel=canonical href=https://kira-96.github.io/posts/linux-gpio%E6%93%8D%E4%BD%9C%E5%85%B6%E4%B8%80/><link crossorigin=anonymous href=/assets/css/stylesheet.bccfefac377bc340f06c260aed1bddf49a4354816d7c570d6aac75a997986c95.css integrity="sha256-vM/vrDd7w0DwbCYK7Rvd9JpDVIFtfFcNaqx1qZeYbJU=" rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/assets/js/highlight.f413e19d0714851f6474e7ee9632408e58ac146fbdbe62747134bea2fa3415e0.js integrity="sha256-9BPhnQcUhR9kdOfuljJAjlisFG+9vmJ0cTS+ovo0FeA=" onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href=https://cdn.jsdelivr.net/gh/kira-96/kira-96.github.io@gh-pages/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://cdn.jsdelivr.net/gh/kira-96/kira-96.github.io@gh-pages/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://cdn.jsdelivr.net/gh/kira-96/kira-96.github.io@gh-pages/favicon-32x32.png><link rel=apple-touch-icon href=https://cdn.jsdelivr.net/gh/kira-96/kira-96.github.io@gh-pages/icons/apple-icon-180x180.png><link rel=mask-icon href=https://cdn.jsdelivr.net/gh/kira-96/kira-96.github.io@gh-pages/icons/apple-icon-76x76.png><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><link rel=manifest href=https://cdn.jsdelivr.net/gh/kira-96/kira-96.github.io@gh-pages/manifest.json><script src=https://fastly.jsdelivr.net/gh/stevenjoezhang/live2d-widget@latest/autoload.js></script><meta property="og:title" content="Linux GPIO 操作其一"><meta property="og:description" content="Linux下GPIO的读写操作"><meta property="og:type" content="article"><meta property="og:url" content="https://kira-96.github.io/posts/linux-gpio%E6%93%8D%E4%BD%9C%E5%85%B6%E4%B8%80/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2023-01-12T13:33:37+08:00"><meta property="article:modified_time" content="2023-01-12T13:33:37+08:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="Linux GPIO 操作其一"><meta name=twitter:description content="Linux下GPIO的读写操作"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://kira-96.github.io/posts/"},{"@type":"ListItem","position":2,"name":"Linux GPIO 操作其一","item":"https://kira-96.github.io/posts/linux-gpio%E6%93%8D%E4%BD%9C%E5%85%B6%E4%B8%80/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Linux GPIO 操作其一","name":"Linux GPIO 操作其一","description":"Linux下GPIO的读写操作","keywords":["linux","GPIO"],"articleBody":"前言 由于换了新的工作，我的工作方向也有了很大的变化，之前基本上是单纯的写代码，现在则经常需要和硬件设备交互，开发平台也转到了Linux+Qt。硬件设备的控制，其中最基本的就是LED灯以及一些开关继电器的操作，其本质就是GPIO的操作。考虑到系统的精简和成本控制，最好是可以直接通过Linux系统去控制，当然也有其它替代方案，比如使用支持Modbus协议的IO模块。关于Modbus的使用，后面有空再讲，这里就记录一下最简单的Linux系统下的GPIO控制，用户空间下的GPIO文件系统接口。\n在此之前，有必要再了解一下GPIO的概念。\n“通用输入/输出”（GPIO）是一种灵活的软件控制数字信号。它们由多种芯片提供，对于使用嵌入式和定制硬件的Linux开发人员来说很熟悉。每个GPIO代表一个连接到特定引脚的位，即球栅阵列（BGA）封装上的“球”。电路板示意图显示了哪些外部硬件连接到哪些GPIO。驱动程序可以通用地编写，以便板设置代码将这样的引脚配置数据传递给驱动程序。\nA “General Purpose Input/Output” (GPIO) is a flexible software-controlled digital signal. They are provided from many kinds of chip, and are familiar to Linux developers working with embedded and custom hardware. Each GPIO represents a bit connected to a particular pin, or “ball” on Ball Grid Array (BGA) packages. Board schematics show which external hardware connects to which GPIOs. Drivers can be written generically, so that board setup code passes such pin configuration data to drivers.\n在单片机上，我们可以很方便的控制GPIO，但在嵌入式Linux上则不一样，通常GPIO对于用户来说是不可见的，不过Linux系统也提供了相应的接口供用户控制GPIO，每个非专用的引脚都可以用作GPIO。\n配置IO多路复用器（IOMUXC） 将需要复用的IO添加到pinctrl_hog节点，例：\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 /* kernel/arch/arm64/boot/dts/freescale/OK8MP-C.dts */ \u0026iomuxc { pinctrl-names = \"default\"; pinctrl-0 = \u003c\u0026pinctrl_hog\u003e; pinctrl_hog: hoggrp { fsl,pins = \u003c MX8MP_IOMUXC_HDMI_DDC_SCL__HDMIMIX_HDMI_SCL\t0x400001c3 MX8MP_IOMUXC_HDMI_DDC_SDA__HDMIMIX_HDMI_SDA\t0x400001c3 MX8MP_IOMUXC_HDMI_HPD__HDMIMIX_HDMI_HPD\t0x40000019 MX8MP_IOMUXC_HDMI_CEC__HDMIMIX_HDMI_CEC\t0x40000019 /* GPIO */ MX8MP_IOMUXC_GPIO1_IO07__GPIO1_IO07\t0x159 MX8MP_IOMUXC_GPIO1_IO09__GPIO1_IO09\t0x159 MX8MP_IOMUXC_GPIO1_IO12__GPIO1_IO12\t0x159 MX8MP_IOMUXC_ECSPI2_MOSI__GPIO5_IO11\t0x159 MX8MP_IOMUXC_ECSPI2_MISO__GPIO5_IO12\t0x159 MX8MP_IOMUXC_ECSPI2_SS0__GPIO5_IO13\t0x159 \u003e; }; } 具体的GPIO名字要参照xxxx-pinfunc.h里面的定义，配置为GPIO时，一定要使用IOMUXC_xxxx_xxxx__GPIOn_IOxx的宏定义。\n然后是后面的上下拉配置，具体的计算方法和参数意义如下：\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 PAD_CTL_HYS (1 \u003c\u003c 16) /* Hysteresis 滞后使能*/ PAD_CTL_PUS_100K_DOWN (0 \u003c\u003c 14) /* 100KOhm Pull Down */ PAD_CTL_PUS_47K_UP (1 \u003c\u003c 14) /* 47KOhm Pull Up */ PAD_CTL_PUS_100K_UP (2 \u003c\u003c 14) /* 100KOhm Pull Up */ PAD_CTL_PUS_22K_UP (3 \u003c\u003c 14) /* 22KOhm Pull Up */ PAD_CTL_PUE (1 \u003c\u003c 13) /* Pull / Keep Enable */ PAD_CTL_PKE (1 \u003c\u003c 12) /* Pull / Keep Select 0: Keeper 1: Pull */ PAD_CTL_ODE (1 \u003c\u003c 11) /* Open Drain Enable 漏极开路 */ PAD_CTL_SPEED_LOW (1 \u003c\u003c 6) /* 带宽配置 */ PAD_CTL_SPEED_MED (2 \u003c\u003c 6) PAD_CTL_SPEED_HIGH (3 \u003c\u003c 6) PAD_CTL_DSE_DISABLE (0 \u003c\u003c 3) /* Drive Strength Field 驱动能力 */ PAD_CTL_DSE_240ohm (1 \u003c\u003c 3) PAD_CTL_DSE_120ohm (2 \u003c\u003c 3) PAD_CTL_DSE_80ohm (3 \u003c\u003c 3) PAD_CTL_DSE_60ohm (4 \u003c\u003c 3) PAD_CTL_DSE_48ohm (5 \u003c\u003c 3) PAD_CTL_DSE_40ohm (6 \u003c\u003c 3) PAD_CTL_DSE_34ohm (7 \u003c\u003c 3) PAD_CTL_SRE_FAST (1 \u003c\u003c 0) /* Slew Rate Field 压摆率 */ PAD_CTL_SRE_SLOW (0 \u003c\u003c 0) 注意：不要直接设置为0，没有任何作用。可以使用0x80000000，它表示“我不知道，保持默认值”。\n用户空间下的GPIO读写操作 用户空间下的GPIO文件系统接口在/sys/class/gpio/目录下。\n注意：以下操作都需要root权限！\n使能GPIO 在此之前，需要先知道GPIO对应的编号数值，计算方法如下：\nGPIOn_IOx = (n - 1) × 32 + x\n例：GPIO5_IO13 = (5 - 1) × 32 + 13 = 141\n执行命令\n1 2 3 # echo N \u003e /sys/class/gpio/export # N为GPIO对应的编号，例： echo 141 \u003e /sys/class/gpio/export 如果需要取消使能GPIO，则执行命令\n1 2 3 # echo N \u003e /sys/class/gpio/unexport # N为GPIO对应的编号，例： echo 141 \u003e /sys/class/gpio/unexport GPIO配置 使能GPIO之后，/sys/class/gpio/目录下就多出来了相应的GPIO节点目录。例：gpio141\nGPIO节点有以下属性可以配置：\n/sys/class/gpio/gpioN/\ndirection\n读取为in或者out。通常可以写入此值。写入out默认输出为低。为了确保操作无误，可以写入值“low”和“high”将GPIO配置为具有该初始值的输出。\n请注意，如果内核不支持更改GPIO的方向，或者该属性是由内核代码导出的，而内核代码没有明确允许用户空间重新配置该GPIO方向，则该属性将不存在。\nvalue\n读取为0（low）或1（high）。如果GPIO被配置为输出，则可以写入该值；任何非零值都被视为高。\n如果引脚可以配置为中断生成，并且它已经配置为生成中断（请参阅“edge”的描述），那么您可以对该文件进行轮询（poll），每当触发中断时，轮询（poll）将返回。如果使用poll，请设置事件为POLLPRI和POLLERR。如果使用select，则将文件描述符设置为exceptfds。轮询返回后，要么lseek到sysfs文件的开头并读取新值，要么关闭文件并重新打开以读取值。\nedge\n读取为none、rising、falling或者both。编写这些字符串以选择将对“value”文件返回进行轮询的信号边缘。\n仅当引脚可以配置为中断生成输入引脚时，此属性才存在。\nactive_low\n读取为0（假）或1（真）。写入任何非零值以反转读取和写入的值属性。现有和后续轮询支持通过边缘属性配置“rising”和“falling”边缘将遵循此设置。\n例：\n将GPIO配置为输出\n1 echo out \u003e /sys/class/gpio/gpio{N}/direction 将GPIO配置为输入，上升沿触发中断\n1 2 echo in \u003e /sys/class/gpio/gpio{N}/direction echo rising \u003e /sys/class/gpio/gpio{N}/edge GPIO读写 GPIO配置为输入（in）时，只能读取输入值，不能写入\nGPIO配置为输出（out）时，可以读取当前值和写入新值\n1 2 3 4 5 # 读取时 cat /sys/class/gpio/gpio{N}/value # 写入时 echo 0 \u003e /sys/class/gpio/gpio{N}/value echo 1 \u003e /sys/class/gpio/gpio{N}/value 程序控制GPIO 示例读取：\n1 2 3 4 5 6 7 8 9 10 11 int readGpio(unsigned short io) { QFile file(QString(\"/sys/class/gpio/gpio%1/value\").arg(io)); if (!file.open(QIODevice::ReadOnly)) return 0; QByteArray ba = file.readAll(); file.close(); return QString(ba).toInt(); } 示例写入：\n1 2 3 4 5 6 bool writeGpio(unsigned short io, unsigned char value) { char buf[128]; sprintf(buf, \"echo %d \u003e /sys/class/gpio/gpio%d/value\", value, io); return ::system(buf) == 0; } 参考\nLegacy GPIO Interfaces GPIO Sysfs Interface for Userspace Definitive GPIO guide ","wordCount":"498","inLanguage":"zh","datePublished":"2023-01-12T13:33:37+08:00","dateModified":"2023-01-12T13:33:37+08:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://kira-96.github.io/posts/linux-gpio%E6%93%8D%E4%BD%9C%E5%85%B6%E4%B8%80/"},"publisher":{"@type":"Organization","name":"kira's 博客","logo":{"@type":"ImageObject","url":"https://cdn.jsdelivr.net/gh/kira-96/kira-96.github.io@gh-pages/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://kira-96.github.io/ accesskey=h title="kira's 博客 (Alt + H)">kira's 博客</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://kira-96.github.io/ title=主页><span>主页</span></a></li><li><a href=https://kira-96.github.io/notes/ title=笔记><span>笔记</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://kira-96.github.io/>主页</a>&nbsp;»&nbsp;<a href=https://kira-96.github.io/posts/>Posts</a></div><h1 class=post-title>Linux GPIO 操作其一</h1><div class=post-description>Linux下GPIO的读写操作</div><div class=post-meta><span title='2023-01-12 13:33:37 +0800 +0800'>一月 12, 2023</span>&nbsp;·&nbsp;3 分钟&nbsp;·&nbsp;498 字&nbsp;|&nbsp;<a href=https://github.com/kira-96/kira-96.github.io/tree/main/content/posts/ rel="noopener noreferrer" target=_blank>编辑</a></div></header><div class=post-content><h2 id=前言>前言<a hidden class=anchor aria-hidden=true href=#前言>#</a></h2><p>由于换了新的工作，我的工作方向也有了很大的变化，之前基本上是单纯的写代码，现在则经常需要和硬件设备交互，开发平台也转到了Linux+Qt。硬件设备的控制，其中最基本的就是LED灯以及一些开关继电器的操作，其本质就是GPIO的操作。考虑到系统的精简和成本控制，最好是可以直接通过Linux系统去控制，当然也有其它替代方案，比如使用支持Modbus协议的IO模块。关于Modbus的使用，后面有空再讲，这里就记录一下最简单的Linux系统下的GPIO控制，<strong>用户空间下的GPIO文件系统接口</strong>。</p><p>在此之前，有必要再了解一下GPIO的概念。</p><p>“通用输入/输出”（GPIO）是一种灵活的软件控制数字信号。它们由多种芯片提供，对于使用嵌入式和定制硬件的Linux开发人员来说很熟悉。每个GPIO代表一个连接到特定引脚的位，即球栅阵列（BGA）封装上的“球”。电路板示意图显示了哪些外部硬件连接到哪些GPIO。驱动程序可以通用地编写，以便板设置代码将这样的引脚配置数据传递给驱动程序。</p><blockquote><p>A “General Purpose Input/Output” (GPIO) is a flexible software-controlled digital signal. They are provided from many kinds of chip, and are familiar to Linux developers working with embedded and custom hardware. Each GPIO represents a bit connected to a particular pin, or “ball” on Ball Grid Array (BGA) packages. Board schematics show which external hardware connects to which GPIOs. Drivers can be written generically, so that board setup code passes such pin configuration data to drivers.</p></blockquote><p>在单片机上，我们可以很方便的控制GPIO，但在嵌入式Linux上则不一样，通常GPIO对于用户来说是不可见的，不过Linux系统也提供了相应的接口供用户控制GPIO，每个非专用的引脚都可以用作GPIO。</p><h2 id=配置io多路复用器iomuxc>配置IO多路复用器（IOMUXC）<a hidden class=anchor aria-hidden=true href=#配置io多路复用器iomuxc>#</a></h2><p>将需要复用的IO添加到<code>pinctrl_hog</code>节点，例：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=cm>/* kernel/arch/arm64/boot/dts/freescale/OK8MP-C.dts */</span>
</span></span><span class=line><span class=cl><span class=o>&amp;</span><span class=n>iomuxc</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=n>pinctrl</span><span class=o>-</span><span class=n>names</span> <span class=o>=</span> <span class=s>&#34;default&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=n>pinctrl</span><span class=o>-</span><span class=mi>0</span> <span class=o>=</span> <span class=o>&lt;&amp;</span><span class=n>pinctrl_hog</span><span class=o>&gt;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=nl>pinctrl_hog</span><span class=p>:</span> <span class=n>hoggrp</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=n>fsl</span><span class=p>,</span><span class=n>pins</span> <span class=o>=</span> <span class=o>&lt;</span>
</span></span><span class=line><span class=cl>			<span class=n>MX8MP_IOMUXC_HDMI_DDC_SCL__HDMIMIX_HDMI_SCL</span>	<span class=mh>0x400001c3</span>
</span></span><span class=line><span class=cl>			<span class=n>MX8MP_IOMUXC_HDMI_DDC_SDA__HDMIMIX_HDMI_SDA</span>	<span class=mh>0x400001c3</span>
</span></span><span class=line><span class=cl>			<span class=n>MX8MP_IOMUXC_HDMI_HPD__HDMIMIX_HDMI_HPD</span>		<span class=mh>0x40000019</span>
</span></span><span class=line><span class=cl>			<span class=n>MX8MP_IOMUXC_HDMI_CEC__HDMIMIX_HDMI_CEC</span>		<span class=mh>0x40000019</span>
</span></span><span class=line><span class=cl>			<span class=cm>/* GPIO */</span>
</span></span><span class=line><span class=cl>			<span class=n>MX8MP_IOMUXC_GPIO1_IO07__GPIO1_IO07</span>			<span class=mh>0x159</span>
</span></span><span class=line><span class=cl>			<span class=n>MX8MP_IOMUXC_GPIO1_IO09__GPIO1_IO09</span>			<span class=mh>0x159</span>
</span></span><span class=line><span class=cl>			<span class=n>MX8MP_IOMUXC_GPIO1_IO12__GPIO1_IO12</span>			<span class=mh>0x159</span>
</span></span><span class=line><span class=cl>			<span class=n>MX8MP_IOMUXC_ECSPI2_MOSI__GPIO5_IO11</span>		<span class=mh>0x159</span>
</span></span><span class=line><span class=cl>			<span class=n>MX8MP_IOMUXC_ECSPI2_MISO__GPIO5_IO12</span>		<span class=mh>0x159</span>
</span></span><span class=line><span class=cl>			<span class=n>MX8MP_IOMUXC_ECSPI2_SS0__GPIO5_IO13</span>			<span class=mh>0x159</span>
</span></span><span class=line><span class=cl>		<span class=o>&gt;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=p>};</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>具体的GPIO名字要参照<code>xxxx-pinfunc.h</code>里面的定义，配置为GPIO时，一定要使用<code>IOMUXC_xxxx_xxxx__GPIOn_IOxx</code>的宏定义。</p><p>然后是后面的上下拉配置，具体的计算方法和参数意义如下：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=nf>PAD_CTL_HYS</span>                     <span class=p>(</span><span class=mi>1</span> <span class=o>&lt;&lt;</span> <span class=mi>16</span><span class=p>)</span> <span class=cm>/* Hysteresis 滞后使能*/</span>
</span></span><span class=line><span class=cl><span class=nf>PAD_CTL_PUS_100K_DOWN</span>           <span class=p>(</span><span class=mi>0</span> <span class=o>&lt;&lt;</span> <span class=mi>14</span><span class=p>)</span> <span class=cm>/* 100KOhm Pull Down */</span>
</span></span><span class=line><span class=cl><span class=nf>PAD_CTL_PUS_47K_UP</span>              <span class=p>(</span><span class=mi>1</span> <span class=o>&lt;&lt;</span> <span class=mi>14</span><span class=p>)</span> <span class=cm>/* 47KOhm Pull Up */</span>
</span></span><span class=line><span class=cl><span class=nf>PAD_CTL_PUS_100K_UP</span>             <span class=p>(</span><span class=mi>2</span> <span class=o>&lt;&lt;</span> <span class=mi>14</span><span class=p>)</span> <span class=cm>/* 100KOhm Pull Up */</span>
</span></span><span class=line><span class=cl><span class=nf>PAD_CTL_PUS_22K_UP</span>              <span class=p>(</span><span class=mi>3</span> <span class=o>&lt;&lt;</span> <span class=mi>14</span><span class=p>)</span> <span class=cm>/* 22KOhm Pull Up */</span>
</span></span><span class=line><span class=cl><span class=nf>PAD_CTL_PUE</span>                     <span class=p>(</span><span class=mi>1</span> <span class=o>&lt;&lt;</span> <span class=mi>13</span><span class=p>)</span> <span class=cm>/* Pull / Keep Enable */</span>
</span></span><span class=line><span class=cl><span class=nf>PAD_CTL_PKE</span>                     <span class=p>(</span><span class=mi>1</span> <span class=o>&lt;&lt;</span> <span class=mi>12</span><span class=p>)</span> <span class=cm>/* Pull / Keep Select 0: Keeper 1: Pull */</span>
</span></span><span class=line><span class=cl><span class=nf>PAD_CTL_ODE</span>                     <span class=p>(</span><span class=mi>1</span> <span class=o>&lt;&lt;</span> <span class=mi>11</span><span class=p>)</span> <span class=cm>/* Open Drain Enable 漏极开路 */</span>
</span></span><span class=line><span class=cl><span class=nf>PAD_CTL_SPEED_LOW</span>               <span class=p>(</span><span class=mi>1</span> <span class=o>&lt;&lt;</span> <span class=mi>6</span><span class=p>)</span>  <span class=cm>/* 带宽配置 */</span>
</span></span><span class=line><span class=cl><span class=nf>PAD_CTL_SPEED_MED</span>               <span class=p>(</span><span class=mi>2</span> <span class=o>&lt;&lt;</span> <span class=mi>6</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nf>PAD_CTL_SPEED_HIGH</span>              <span class=p>(</span><span class=mi>3</span> <span class=o>&lt;&lt;</span> <span class=mi>6</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nf>PAD_CTL_DSE_DISABLE</span>             <span class=p>(</span><span class=mi>0</span> <span class=o>&lt;&lt;</span> <span class=mi>3</span><span class=p>)</span>  <span class=cm>/* Drive Strength Field 驱动能力 */</span>
</span></span><span class=line><span class=cl><span class=nf>PAD_CTL_DSE_240ohm</span>              <span class=p>(</span><span class=mi>1</span> <span class=o>&lt;&lt;</span> <span class=mi>3</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nf>PAD_CTL_DSE_120ohm</span>              <span class=p>(</span><span class=mi>2</span> <span class=o>&lt;&lt;</span> <span class=mi>3</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nf>PAD_CTL_DSE_80ohm</span>               <span class=p>(</span><span class=mi>3</span> <span class=o>&lt;&lt;</span> <span class=mi>3</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nf>PAD_CTL_DSE_60ohm</span>               <span class=p>(</span><span class=mi>4</span> <span class=o>&lt;&lt;</span> <span class=mi>3</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nf>PAD_CTL_DSE_48ohm</span>               <span class=p>(</span><span class=mi>5</span> <span class=o>&lt;&lt;</span> <span class=mi>3</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nf>PAD_CTL_DSE_40ohm</span>               <span class=p>(</span><span class=mi>6</span> <span class=o>&lt;&lt;</span> <span class=mi>3</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nf>PAD_CTL_DSE_34ohm</span>               <span class=p>(</span><span class=mi>7</span> <span class=o>&lt;&lt;</span> <span class=mi>3</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nf>PAD_CTL_SRE_FAST</span>                <span class=p>(</span><span class=mi>1</span> <span class=o>&lt;&lt;</span> <span class=mi>0</span><span class=p>)</span>  <span class=cm>/* Slew Rate Field 压摆率 */</span>
</span></span><span class=line><span class=cl><span class=nf>PAD_CTL_SRE_SLOW</span>                <span class=p>(</span><span class=mi>0</span> <span class=o>&lt;&lt;</span> <span class=mi>0</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><blockquote><p>注意：不要直接设置为<code>0</code>，没有任何作用。可以使用<code>0x80000000</code>，它表示“我不知道，保持默认值”。</p></blockquote><h2 id=用户空间下的gpio读写操作>用户空间下的GPIO读写操作<a hidden class=anchor aria-hidden=true href=#用户空间下的gpio读写操作>#</a></h2><p>用户空间下的GPIO文件系统接口在<code>/sys/class/gpio/</code>目录下。</p><blockquote><p>注意：以下操作都需要root权限！</p></blockquote><h3 id=使能gpio>使能GPIO<a hidden class=anchor aria-hidden=true href=#使能gpio>#</a></h3><p>在此之前，需要先知道GPIO对应的编号数值，计算方法如下：</p><p>GPIOn_IOx = (n - 1) × 32 + x</p><p>例：GPIO5_IO13 = (5 - 1) × 32 + 13 = 141</p><p>执行命令</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl><span class=c1># echo N &gt; /sys/class/gpio/export</span>
</span></span><span class=line><span class=cl><span class=c1># N为GPIO对应的编号，例：</span>
</span></span><span class=line><span class=cl><span class=nb>echo</span> <span class=m>141</span> &gt; /sys/class/gpio/export
</span></span></code></pre></td></tr></table></div></div><p>如果需要取消使能GPIO，则执行命令</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl><span class=c1># echo N &gt; /sys/class/gpio/unexport</span>
</span></span><span class=line><span class=cl><span class=c1># N为GPIO对应的编号，例：</span>
</span></span><span class=line><span class=cl><span class=nb>echo</span> <span class=m>141</span> &gt; /sys/class/gpio/unexport
</span></span></code></pre></td></tr></table></div></div><h3 id=gpio配置>GPIO配置<a hidden class=anchor aria-hidden=true href=#gpio配置>#</a></h3><p>使能GPIO之后，<code>/sys/class/gpio/</code>目录下就多出来了相应的GPIO节点目录。例：<code>gpio141</code></p><p>GPIO节点有以下属性可以配置：</p><p><code>/sys/class/gpio/gpioN/</code></p><ul><li><p><strong>direction</strong></p><p>读取为<code>in</code>或者<code>out</code>。通常可以写入此值。写入<code>out</code>默认输出为低。为了确保操作无误，可以写入值“low”和“high”将GPIO配置为具有该初始值的输出。</p><p>请注意，如果内核不支持更改GPIO的方向，或者该属性是由内核代码导出的，而内核代码没有明确允许用户空间重新配置该GPIO方向，则该属性将不存在。</p></li><li><p><strong>value</strong></p><p>读取为<code>0</code>（low）或<code>1</code>（high）。如果GPIO被配置为输出，则可以写入该值；<strong>任何非零值都被视为高</strong>。</p><p>如果引脚可以配置为中断生成，并且它已经配置为生成中断（请参阅“edge”的描述），那么您可以对该文件进行轮询（poll），每当触发中断时，轮询（poll）将返回。如果使用poll，请设置事件为<code>POLLPRI</code>和<code>POLLERR</code>。如果使用select，则将文件描述符设置为<code>exceptfds</code>。轮询返回后，要么lseek到sysfs文件的开头并读取新值，要么关闭文件并重新打开以读取值。</p></li><li><p><strong>edge</strong></p><p>读取为<code>none</code>、<code>rising</code>、<code>falling</code>或者<code>both</code>。编写这些字符串以选择将对“value”文件返回进行轮询的信号边缘。</p><p>仅当引脚可以配置为中断生成输入引脚时，此属性才存在。</p></li><li><p><strong>active_low</strong></p><p>读取为0（假）或1（真）。写入任何非零值以反转读取和写入的值属性。现有和后续轮询支持通过边缘属性配置“rising”和“falling”边缘将遵循此设置。</p></li></ul><p>例：</p><p>将GPIO配置为输出</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl><span class=nb>echo</span> out &gt; /sys/class/gpio/gpio<span class=o>{</span>N<span class=o>}</span>/direction
</span></span></code></pre></td></tr></table></div></div><p>将GPIO配置为输入，上升沿触发中断</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl><span class=nb>echo</span> in &gt; /sys/class/gpio/gpio<span class=o>{</span>N<span class=o>}</span>/direction
</span></span><span class=line><span class=cl><span class=nb>echo</span> rising &gt; /sys/class/gpio/gpio<span class=o>{</span>N<span class=o>}</span>/edge
</span></span></code></pre></td></tr></table></div></div><h3 id=gpio读写>GPIO读写<a hidden class=anchor aria-hidden=true href=#gpio读写>#</a></h3><p>GPIO配置为输入（in）时，只能读取输入值，不能写入</p><p>GPIO配置为输出（out）时，可以读取当前值和写入新值</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl><span class=c1># 读取时</span>
</span></span><span class=line><span class=cl>cat /sys/class/gpio/gpio<span class=o>{</span>N<span class=o>}</span>/value
</span></span><span class=line><span class=cl><span class=c1># 写入时</span>
</span></span><span class=line><span class=cl><span class=nb>echo</span> <span class=m>0</span> &gt; /sys/class/gpio/gpio<span class=o>{</span>N<span class=o>}</span>/value
</span></span><span class=line><span class=cl><span class=nb>echo</span> <span class=m>1</span> &gt; /sys/class/gpio/gpio<span class=o>{</span>N<span class=o>}</span>/value
</span></span></code></pre></td></tr></table></div></div><h3 id=程序控制gpio>程序控制GPIO<a hidden class=anchor aria-hidden=true href=#程序控制gpio>#</a></h3><p>示例读取：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=kt>int</span> <span class=nf>readGpio</span><span class=p>(</span><span class=kt>unsigned</span> <span class=kt>short</span> <span class=n>io</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>QFile</span> <span class=n>file</span><span class=p>(</span><span class=n>QString</span><span class=p>(</span><span class=s>&#34;/sys/class/gpio/gpio%1/value&#34;</span><span class=p>).</span><span class=n>arg</span><span class=p>(</span><span class=n>io</span><span class=p>));</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=o>!</span><span class=n>file</span><span class=p>.</span><span class=n>open</span><span class=p>(</span><span class=n>QIODevice</span><span class=o>::</span><span class=n>ReadOnly</span><span class=p>))</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>QByteArray</span> <span class=n>ba</span> <span class=o>=</span> <span class=n>file</span><span class=p>.</span><span class=n>readAll</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=n>file</span><span class=p>.</span><span class=n>close</span><span class=p>();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>QString</span><span class=p>(</span><span class=n>ba</span><span class=p>).</span><span class=n>toInt</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>示例写入：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=kt>bool</span> <span class=nf>writeGpio</span><span class=p>(</span><span class=kt>unsigned</span> <span class=kt>short</span> <span class=n>io</span><span class=p>,</span> <span class=kt>unsigned</span> <span class=kt>char</span> <span class=n>value</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kt>char</span> <span class=n>buf</span><span class=p>[</span><span class=mi>128</span><span class=p>];</span>
</span></span><span class=line><span class=cl>    <span class=n>sprintf</span><span class=p>(</span><span class=n>buf</span><span class=p>,</span> <span class=s>&#34;echo %d &gt; /sys/class/gpio/gpio%d/value&#34;</span><span class=p>,</span> <span class=n>value</span><span class=p>,</span> <span class=n>io</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=o>::</span><span class=n>system</span><span class=p>(</span><span class=n>buf</span><span class=p>)</span> <span class=o>==</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p><strong>参考</strong></p><ul><li><a href=https://www.kernel.org/doc/html/latest/driver-api/gpio/legacy.html>Legacy GPIO Interfaces</a></li><li><a href=https://www.kernel.org/doc/html/latest/admin-guide/gpio/sysfs.html>GPIO Sysfs Interface for Userspace</a></li><li><a href="https://kosagi.com/w/index.php?title=Definitive_GPIO_guide">Definitive GPIO guide</a></li></ul></div><footer class=post-footer><ul class=post-tags><li><a href=https://kira-96.github.io/tags/linux/>linux</a></li></ul><nav class=paginav><a class=prev href=https://kira-96.github.io/posts/%E5%9C%A8%E9%BE%99%E8%8A%AF3a5000loongarch64%E4%B8%8A%E7%BC%96%E8%AF%91%E8%BF%90%E8%A1%8Cepics/><span class=title>« 上一页</span><br><span>龙芯3A5000(loongarch64)上编译运行EPICS</span></a>
<a class=next href=https://kira-96.github.io/posts/wsl-libcuda.so.1-is-not-a-symbolic-link-%E7%9A%84%E8%A7%A3%E5%86%B3%E6%96%B9%E6%B3%95/><span class=title>下一页 »</span><br><span>WSL libcuda.so.1 is not a symbolic link 的解决方法</span></a></nav></footer><script src=https://utteranc.es/client.js repo=kira-96/kira-96.github.io issue-term=pathname theme=github-light crossorigin=anonymous async></script></article></main><footer class=footer><span>© 2019-2023 <a href=/>kira</a> ·</span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="复制";function s(){t.innerHTML="已复制！",setTimeout(()=>{t.innerHTML="复制"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>