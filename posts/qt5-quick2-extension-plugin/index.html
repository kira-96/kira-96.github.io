<!doctype html><html lang=zh dir=auto data-theme=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Qt5ç¼–å†™Qt Quick2æ’ä»¶ | âœ¨kiraã®åšå®¢</title><meta name=keywords content="Qt,QML"><meta name=description content="ä½¿ç”¨Qt5ç¼–å†™Qt Quick2æ’ä»¶é‡åˆ°çš„é—®é¢˜è®°å½•"><meta name=author content><link rel=canonical href=https://kira-96.github.io/posts/qt5-quick2-extension-plugin/><link crossorigin=anonymous href=/assets/css/stylesheet.98f7858d07353d656e458d003f39cc16b592a5fbc04fe02e7136bfef3d45dd16.css integrity="sha256-mPeFjQc1PWVuRY0APznMFrWSpfvAT+AucTa/7z1F3RY=" rel="preload stylesheet" as=style><link rel=icon href=https://cdn.jsdelivr.net/gh/kira-96/kira-96.github.io@gh-pages/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://cdn.jsdelivr.net/gh/kira-96/kira-96.github.io@gh-pages/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://cdn.jsdelivr.net/gh/kira-96/kira-96.github.io@gh-pages/favicon-32x32.png><link rel=apple-touch-icon href=https://cdn.jsdelivr.net/gh/kira-96/kira-96.github.io@gh-pages/icons/apple-icon-180x180.png><link rel=mask-icon href=https://cdn.jsdelivr.net/gh/kira-96/kira-96.github.io@gh-pages/icons/apple-icon-76x76.png><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=zh href=https://kira-96.github.io/posts/qt5-quick2-extension-plugin/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51);color-scheme:dark}.list{background:var(--theme)}.toc{background:var(--entry)}}@media(prefers-color-scheme:light){.list::-webkit-scrollbar-thumb{border-color:var(--code-bg)}}</style></noscript><script>localStorage.getItem("pref-theme")==="dark"?document.querySelector("html").dataset.theme="dark":localStorage.getItem("pref-theme")==="light"?document.querySelector("html").dataset.theme="light":window.matchMedia("(prefers-color-scheme: dark)").matches?document.querySelector("html").dataset.theme="dark":document.querySelector("html").dataset.theme="light"</script><link rel=manifest href=https://cdn.jsdelivr.net/gh/kira-96/kira-96.github.io@gh-pages/manifest.json><link rel=stylesheet href=https://cdn.bootcdn.net/ajax/libs/lxgw-wenkai-screen-webfont/1.7.0/style.min.css><script src=https://fastly.jsdelivr.net/npm/live2d-widgets@0/autoload.js></script><script type=text/javascript src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><meta property="og:url" content="https://kira-96.github.io/posts/qt5-quick2-extension-plugin/"><meta property="og:site_name" content="âœ¨kiraã®åšå®¢"><meta property="og:title" content="Qt5ç¼–å†™Qt Quick2æ’ä»¶"><meta property="og:description" content="ä½¿ç”¨Qt5ç¼–å†™Qt Quick2æ’ä»¶é‡åˆ°çš„é—®é¢˜è®°å½•"><meta property="og:locale" content="zh"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2025-03-13T10:23:47+08:00"><meta property="article:modified_time" content="2025-04-07T20:52:22+08:00"><meta property="article:tag" content="Qt"><meta property="article:tag" content="QML"><meta name=twitter:card content="summary"><meta name=twitter:title content="Qt5ç¼–å†™Qt Quick2æ’ä»¶"><meta name=twitter:description content="ä½¿ç”¨Qt5ç¼–å†™Qt Quick2æ’ä»¶é‡åˆ°çš„é—®é¢˜è®°å½•"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://kira-96.github.io/posts/"},{"@type":"ListItem","position":2,"name":"Qt5ç¼–å†™Qt Quick2æ’ä»¶","item":"https://kira-96.github.io/posts/qt5-quick2-extension-plugin/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Qt5ç¼–å†™Qt Quick2æ’ä»¶","name":"Qt5ç¼–å†™Qt Quick2æ’ä»¶","description":"ä½¿ç”¨Qt5ç¼–å†™Qt Quick2æ’ä»¶é‡åˆ°çš„é—®é¢˜è®°å½•","keywords":["Qt","QML"],"articleBody":"å‰è¨€ æœ€è¿‘åœ¨è¯•ç€æŠŠè‡ªå®šä¹‰çš„QMLæ§ä»¶å°è£…æˆæ’ä»¶ä¾›å…¶ä»–ç¨‹åºè°ƒç”¨ï¼Œç”±äºæˆ‘ä½¿ç”¨çš„è¿˜æ˜¯Qt5ï¼Œåœ¨æ„å»ºçš„è¿‡ç¨‹ä¸­é‡åˆ°ä¸å°‘é—®é¢˜ï¼Œè¿™é‡Œåšä¸€ä¸‹ç®€å•æ±‡æ€»ã€‚\næ–°å»ºé¡¹ç›® æ–°å»ºåº“â†’Qt Quick2 Extension Pluginï¼ŒQt 5ç‰ˆæœ¬ä»…æ”¯æŒä½¿ç”¨QMakeä½œä¸ºæ„å»ºå¥—ä»¶ã€‚Qt 6æ‰æ”¯æŒä½¿ç”¨CMakeä½œä¸ºQMLæ‰©å±•æ’ä»¶çš„æ„å»ºå¥—ä»¶ã€‚\nç¼–å†™æ’ä»¶ ä¾‹å¦‚ï¼Œæˆ‘æ–°å»ºäº†ä¸€ä¸ªå«åšTestçš„æ’ä»¶åº“ï¼Œé¡¹ç›®ä¼šè‡ªåŠ¨åˆ›å»ºä¸€ä¸ªTestPluginçš„ç±»ï¼Œè¿™ä¸ªç±»ç»§æ‰¿è‡ªQQmlExtensionPluginï¼Œæˆ‘ä»¬éœ€è¦é‡å†™å®ƒçš„ä¸¤ä¸ªè™šå‡½æ•°ã€‚\ntestplugin.h â–¼ 1 2 3 4 5 6 7 8 9 10 11 #include class TestPlugin : public QQmlExtensionPlugin { Q_OBJECT Q_PLUGIN_METADATA(IID QQmlExtensionInterface_iid) public: void registerTypes(const char *uri) Q_DECL_OVERRIDE; void initializeEngine(QQmlEngine *engine, const char *uri) Q_DECL_OVERRIDE; }; testplugin.cpp â–¼ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 #include \"testplugin.h\" #include \"myitem.h\" #include void TestPlugin::registerTypes(const char *uri) { // @uri com.mycompany.qmlcomponents qmlRegisterType\u003cMyItem\u003e(uri, 1, 0, \"MyItem\"); } void TestPlugin::initializeEngine(QQmlEngine *engine, const char *uri) { QQmlExtensionPlugin::initializeEngine(engine, uri); } å…¶ä¸­ï¼ŒMyItemå°±æ˜¯æˆ‘ä»¬è‡ªå®šä¹‰çš„æ§ä»¶ã€‚ç®€å•çœ‹ä¸€ä¸‹ç¤ºä¾‹ä»£ç ï¼š\nmyitem.h â–¼ 1 2 3 4 5 6 7 8 9 10 11 12 #include class MyItem : public QQuickPaintedItem { Q_OBJECT QML_ELEMENT Q_DISABLE_COPY(MyItem) public: explicit MyItem(QQuickItem *parent = Q_NULLPTR); void paint(QPainter *painter) Q_DECL_OVERRIDE; ~MyItem() Q_DECL_OVERRIDE; }; MyItemç»§æ‰¿è‡ªQQuickItemï¼Œå¹¶ä½¿ç”¨QML_ELEMENTå£°æ˜äº†å®ƒæ˜¯ä¸€ä¸ªQMLå…ƒç´ ï¼Œæœ€åå†ä½¿ç”¨qmlRegisterTypeæ³¨å†Œã€‚è¿™æ ·MyItemå°±å¯ä»¥åœ¨QMLä¸­ä½¿ç”¨äº†ã€‚\nä½¿ç”¨è¿™ç§æ–¹å¼ä¹Ÿå¯ä»¥æ³¨å†Œç»§æ‰¿è‡ªQObjectçš„ç±»ã€‚ä¾‹å¦‚ï¼š\nmyobject.h â–¼ 1 2 3 4 5 6 7 class MyObject : public QObject { Q_OBJECT Q_DISABLE_COPY(MyObject) public: explicit MyObject(QObject *parent = Q_NULLPTR); }; ç„¶ååœ¨Pluginç±»ä¸­è¿›è¡Œæ³¨å†Œï¼š\ntestplugin.cpp â–¼ 1 2 3 4 5 6 void TestPlugin::registerTypes(const char *uri) { // @uri com.mycompany.qmlcomponents qmlRegisterType\u003cMyItem\u003e(uri, 1, 0, \"MyItem\"); qmlRegisterType\u003cMyObject\u003e(uri, 1, 0, \"MyObject\"); } è‡ªå®šä¹‰QMLæ§ä»¶ QMLæ’ä»¶åº“å½“ç„¶ä¹Ÿå¯ä»¥å°è£….qmlçš„è‡ªå®šä¹‰æ’ä»¶ã€‚ä¾‹å¦‚ï¼š\nMyLabel.qml â–¼ 1 2 3 4 5 6 7 8 9 10 11 12 import QtQuick 2.15 import QtQuick.Controls 2.15 Label { id: control property string backgroundColor background: Rectangle { color: backgroundColor } } æŠŠè‡ªå®šä¹‰çš„qmlæ§ä»¶æ·»åŠ åˆ°èµ„æºæ–‡ä»¶ï¼Œç„¶åå¯ä»¥åœ¨Pluginç±»ä¸­è¿›è¡Œæ³¨å†Œã€‚\ntestplugin.cpp â–¼ 1 2 3 4 5 6 7 8 9 10 void TestPlugin::registerTypes(const char *uri) { // @uri com.mycompany.qmlcomponents qmlRegisterType\u003cMyItem\u003e(uri, 1, 0, \"MyItem\"); qmlRegisterType\u003cMyObject\u003e(uri, 1, 0, \"MyObject\"); // register qml types qmlRegisterType(QUrl(\"qrc:/qml/MyLabel.qml\"), uri, MAJOR, MINOR, \"MyLabel\"); } qmldiræ–‡ä»¶ qmldiræ–‡ä»¶ç”¨äºQMLæ’ä»¶æ¨¡å—ç®¡ç†ï¼Œæè¿°äº†qmlæ’ä»¶çš„åŸºæœ¬ä¿¡æ¯ã€‚ç¤ºä¾‹ï¼š\nqmldir â–¼ 1 2 3 4 5 6 module com.mycompany.qmlcomponents plugin testplugin classname TestPlugin typeinfo plugins.qmltypes designersupported depends QtQuick.Controls 2.12 module å’Œæ’ä»¶çš„urié…ç½®ç›¸åŒ plugin æ’ä»¶æ–‡ä»¶åå­—ï¼Œé€šå¸¸æ˜¯å°å†™ classname æ’ä»¶ç±»çš„åå­— typeinfo æ’ä»¶çš„å…ƒæ•°æ®æ–‡ä»¶ï¼Œç¨åä¼šå†™æ€ä¹ˆç”Ÿæˆè¿™ä¸ªæ–‡ä»¶ é¡¹ç›®æ–‡ä»¶é…ç½® ä¸‹é¢æ˜¯æˆ‘çš„ä¸€ä¸ªé¡¹ç›®é…ç½®ï¼ŒåŒ…å«æ’ä»¶ä¿¡æ¯é…ç½®ï¼Œå’Œç”Ÿæˆå…ƒæ•°æ®çš„è‡ªå®šä¹‰å‘½ä»¤ã€‚\nTestPlugin.pro â–¼ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 ## TestPlugin.pro TEMPLATE = lib TARGET = testplugin QT += core qml quick CONFIG += plugin c++11 # CONFIG += qmltypes # æ’ä»¶çš„URI uri = com.mycompany.qmlcomponents QML_PLUGIN_NAME = $$TARGET # å¯ä»¥é€šè¿‡ import çš„æ–¹å¼åœ¨qmlä¸­ä½¿ç”¨æ’ä»¶ä¸­çš„æ§ä»¶ QML_IMPORT_NAME = $$uri # æ’ä»¶çš„ç‰ˆæœ¬å· QML_IMPORT_MAJOR_VERSION = 1 QML_IMPORT_MINOR_VERSION = 0 # ç”Ÿæˆæ’ä»¶çš„è·¯å¾„ DESTDIR = imports/$$replace(QML_IMPORT_NAME, \\., $$QMAKE_DIR_SEP) QMLTYPES_FILENAME = $$DESTDIR/plugins.qmltypes TARGET = $$qtLibraryTarget($$TARGET) HEADERS += ... SOURCES += ... # æ‹·è´qmldiræ–‡ä»¶åˆ°è¾“å‡ºç›®å½• DISTFILES = qmldir !equals(_PRO_FILE_PWD_, $$OUT_PWD) { copy_qmldir.target = $$DESTDIR/qmldir copy_qmldir.depends = $$_PRO_FILE_PWD_/qmldir copy_qmldir.commands = $(COPY_FILE) \"$$replace(copy_qmldir.depends, /, $$QMAKE_DIR_SEP)\" \"$$replace(copy_qmldir.target, /, $$QMAKE_DIR_SEP)\" QMAKE_EXTRA_TARGETS += copy_qmldir PRE_TARGETDEPS += $$copy_qmldir.target } # æ·»åŠ æ„å»ºåç”Ÿæˆå…ƒæ•°æ®çš„è‡ªå®šä¹‰å‘½ä»¤ qmltypes.commands = $$[QT_INSTALL_PREFIX]/bin/qmlplugindump -nonrelocatable $$QML_IMPORT_NAME \"$${QML_IMPORT_MAJOR_VERSION}.$${QML_IMPORT_MINOR_VERSION}\" $$OUT_PWD/imports \u003e $$OUT_PWD/$$DESTDIR/plugins.qmltypes qmltypes.depends = $$QML_PLUGIN_NAME.target QMAKE_EXTRA_TARGETS += qmltypes # ç¡®ä¿æ„å»ºåæ‰§è¡Œå…ƒæ•°æ®ç”Ÿæˆ # POST_TARGETDEPS += $$QML_PLUGIN_NAME POST_TARGETDEPS += qmltypes è¿™é‡Œæœ‰å‡ ç‚¹éœ€è¦æ³¨æ„çš„ï¼š\næœ‰èµ„æ–™è¯´åŠ å…¥ CONFIG += qmltypes é…ç½®å°±å¯ä»¥è‡ªåŠ¨ç”Ÿæˆæ’ä»¶å…ƒæ•°æ®ä¿¡æ¯ï¼Œè¿™ç‚¹æˆ‘æµ‹è¯•ç¡®å®å¯ä»¥ï¼Œä½†ç”Ÿæˆçš„å…ƒæ•°æ®æ˜¯ä¸å®Œæ•´çš„ã€‚è¿™ä¸ªé…ç½®åªèƒ½ç”Ÿæˆä½¿ç”¨äº†QML_ELEMENTå®çš„ç±»ï¼Œæ— æ³•ç”ŸæˆQObjectç±»å’ŒQMLæ§ä»¶çš„å…ƒæ•°æ®ï¼ŒåŸºæœ¬ä¸Šæ— ç”¨ã€‚ ç”Ÿæˆå…ƒæ•°æ®å¿…é¡»ä½¿ç”¨qmlplugindumpå·¥å…·ï¼Œè¿™ä¸ªå·¥å…·å’Œqmakeåœ¨åŒä¸€ä¸ªç›®å½•ä¸‹ã€‚ qmlplugindumpå·¥å…·çš„ä½¿ç”¨ è¿™é‡Œä½¿ç”¨çš„å‘½ä»¤å¦‚ä¸‹ï¼š\nqmlplugindump -nonrelocatable QMLå¯¼å…¥URI æ’ä»¶ç‰ˆæœ¬ æ’ä»¶ç›®å½• \u003e ç”Ÿæˆplugins.qmltypesè·¯å¾„\nQMLå¯¼å…¥URIï¼šç¼–è¯‘æ’ä»¶æ—¶æŒ‡å®šçš„uriï¼Œå¦‚ï¼šcom.mycompany.qmlcomponents æ’ä»¶æœ¬æœ¬ï¼šç¼–è¯‘æ’ä»¶æ—¶æŒ‡å®šçš„ç‰ˆæœ¬ï¼Œå¦‚ï¼š1.0 æ’ä»¶ç›®å½•ï¼šè¿™ä¸ªéœ€è¦ç‰¹åˆ«æ³¨æ„ï¼Œè¿™ä¸ªæŒ‡çš„æ˜¯æ’ä»¶çš„ç›®å½•ï¼Œä¸æ˜¯æ’ä»¶åº“çš„ç›®å½•ã€‚æ¯”å¦‚æˆ‘ç”Ÿæˆçš„æ’ä»¶æ˜¯åœ¨importsç›®å½•ï¼Œæ„å»ºå¥—ä»¶ä¼šæ ¹æ®æ’ä»¶çš„uriè‡ªåŠ¨ç”Ÿæˆæ’ä»¶åº“çš„ç›®å½•ï¼Œå¦‚ï¼šimports/com/mycompany/qmlcomponents/testplugin.soï¼Œé‚£ä¹ˆè¿™é‡Œåº”è¯¥ä¼ å…¥å‚æ•°/path/to/importsï¼Œä¸è¦ä¼ å…¥æ’ä»¶åº“æ‰€åœ¨çš„ç›®å½•ã€‚ ç”Ÿæˆplugins.qmltypesè·¯å¾„ï¼šè¿™ä¸ªæ²¡ä»€ä¹ˆå¥½è§£é‡Šçš„ï¼Œä½†æ³¨æ„plugins.qmltypeséœ€è¦å’Œæ’ä»¶åº“æ”¾åœ¨ç»Ÿä¸€ç›®å½•ï¼Œæ‰€ä»¥è¿™é‡Œæœ€åä¼ å…¥å‚æ•°/path/to/imports/com/mycompany/qmlcomponents/plugins.qmltypesã€‚ æ³¨æ„ï¼š\nqmldiræ–‡ä»¶å’Œç”Ÿæˆçš„æ’ä»¶éœ€è¦æ”¾åˆ°åŒä¸€ç›®å½•ä¸‹ï¼Œå¦åˆ™qmlplugindumpè¯»ä¸åˆ°æ’ä»¶ä¿¡æ¯ã€‚ å¦‚æœç”Ÿæˆçš„æ’ä»¶ä¾èµ–å…¶ä»–åŠ¨æ€åº“ï¼Œä¸€å®šè¦ç¡®ä¿qmlplugindumpèƒ½æ‰¾åˆ°è¿™äº›åº“ï¼Œå¦åˆ™æ’ä»¶æ— æ³•åŠ è½½å°±ä¸èƒ½ç”Ÿæˆå…ƒæ•°æ®ã€‚ é—®é¢˜ï¼š\nplugin cannot be loaded for module â€œcom.mycompany.qmlcomponentsâ€: Cannot load library testplugin.dll: æ‰¾ä¸åˆ°æŒ‡å®šçš„æ¨¡å—ã€‚(æ£€æŸ¥åŠ¨æ€åº“çš„è·¯å¾„ï¼Œå¯å°è¯•æ·»åŠ åˆ°ç¯å¢ƒå˜é‡) QQmlComponent: Component is not ready file:///path/to/imports/com/mycompany/qmlcomponents/qmldir: plugin cannot be loaded for module â€œâ€: Module namespace â€˜com.mycompany.qmlcomponentsâ€™ does not match import URI â€™â€™ (æ£€æŸ¥ä¼ å…¥å‚æ•°çš„æ’ä»¶ç›®å½•æ˜¯å¦æ­£ç¡®ï¼Ÿ) ä½¿ç”¨QMLæ’ä»¶ ç¡®ä¿æ’ä»¶ç›®å½•ä¸­åŒ…å«ä»¥ä¸‹å‡ ä¸ªæ–‡ä»¶ï¼štestplugin.soã€plugins.qmltypesã€qmldirã€‚ å°†æ’ä»¶ç›®å½•æ·»åŠ åˆ°Qml Emgineçš„å¯¼å…¥ç›®å½•åˆ—è¡¨ï¼š main.cpp â–¼ 1 2 3 4 5 6 QGuiApplication app(argc, argv); QQmlApplicationEngine engine(\u0026app); ... // æ·»åŠ æ’ä»¶è·¯å¾„åˆ°å¯¼å…¥ç›®å½•åˆ—è¡¨ engine.addImportPath(\"imports\"); engine.load(url); åœ¨qmlä¸­å¯¼å…¥ã€ä½¿ç”¨è‡ªå®šä¹‰æ§ä»¶ main.qml â–¼ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 import com.mycompany.qmlcomponents 1.0 Window { id: window width: 640 height: 480 visible: true title: qsTr(\"Hello World\") // @disable-check M16 MyItem { id: myitem } MyLabel { id: mylabel text: qsTr(\"Hello World\") backgroundColor: 'red' } } å¦‚ä½•ä½¿ç”¨æ’ä»¶ä¸­çš„é™æ€å‡½æ•°ï¼Ÿ è¿™é‡Œéœ€è¦å¯¹é™æ€å‡½æ•°åšä¸€ä¸‹å°è£…ã€‚ä¾‹å¦‚ï¼Œæˆ‘å®šä¹‰äº†ä¸€ä¸ªé™æ€å‡½æ•°ï¼š\nmyutils.h â–¼ 1 2 3 4 5 6 7 8 class MyUtils { public: static void myFunc() { printf(\"Hello from myFunc().\"); } }; è¿™é‡Œéœ€è¦å®šä¹‰ä¸€ä¸ªæ’ä»¶çš„Helperç±»ï¼Œç„¶ååœ¨æ’ä»¶é‡Œé¢æ³¨å†Œè¿™ä¸ªç±»ï¼Œåœ¨è¿™ä¸ªç±»é‡Œé¢å®ç°é™æ€å‡½æ•°è°ƒç”¨ã€‚ä¾‹å¦‚ï¼š\ntestplugin.cpp â–¼ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 #include \"myutils.h\" class TestPluginHelper : public QObject { Q_OBJECT public: Q_INVOKABLE void callMyFunc() { MyUtils::myFunc(); } }; #include \"testplugin.moc\" void TestPlugin::initializeEngine(QQmlEngine *engine, const char *uri) { QQmlExtensionPlugin::initializeEngine(engine, uri); // æ³¨å†Œå¯¹è±¡åˆ°ä¸Šä¸‹æ–‡ engine-\u003erootContext()-\u003esetContextProperty(\"testPluginHelper\", new TestPluginHelper); } åœ¨QMLä¸­è°ƒç”¨ï¼š\nqml â–¼ 1 2 3 4 5 6 7 Item { id: item Component.onCompleted: { testPluginHelper.callMyFunc() } } ","wordCount":"695","inLanguage":"zh","datePublished":"2025-03-13T10:23:47+08:00","dateModified":"2025-04-07T20:52:22+08:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://kira-96.github.io/posts/qt5-quick2-extension-plugin/"},"publisher":{"@type":"Organization","name":"âœ¨kiraã®åšå®¢","logo":{"@type":"ImageObject","url":"https://cdn.jsdelivr.net/gh/kira-96/kira-96.github.io@gh-pages/favicon.ico"}}}</script></head><body id=top><header class=header><nav class=nav><div class=logo><a href=https://kira-96.github.io/ accesskey=h title="âœ¨kiraã®åšå®¢ (Alt + H)">âœ¨kiraã®åšå®¢</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)" aria-label="Toggle theme">
<svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg>
<svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://kira-96.github.io/ title=ğŸ ä¸»é¡µ><span>ğŸ ä¸»é¡µ</span></a></li><li><a href=https://kira-96.github.io/notes/ title=ğŸ““ç¬”è®°><span>ğŸ““ç¬”è®°</span></a></li><li><a href=https://kira-96.github.io/search/ title=ğŸ”ï¸æœç´¢><span>ğŸ”ï¸æœç´¢</span></a></li><li><a href=https://kira-96.github.io/archives/ title=ğŸ—ƒï¸å­˜æ¡£><span>ğŸ—ƒï¸å­˜æ¡£</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://kira-96.github.io/>ä¸»é¡µ</a>&nbsp;Â»&nbsp;<a href=https://kira-96.github.io/posts/>Posts</a></div><h1 class="post-title entry-hint-parent">Qt5ç¼–å†™Qt Quick2æ’ä»¶</h1><div class=post-description>ä½¿ç”¨Qt5ç¼–å†™Qt Quick2æ’ä»¶é‡åˆ°çš„é—®é¢˜è®°å½•</div><div class=post-meta><span title='2025-03-13 10:23:47 +0800 +0800'>2025å¹´3æœˆ13æ—¥</span>&nbsp;Â·&nbsp;<span>4 åˆ†é’Ÿ</span>&nbsp;Â·&nbsp;<span>695 å­—</span>&nbsp;|&nbsp;<span>
<a href=https://github.com/kira-96/kira-96.github.io/tree/main/content/posts/ rel="noopener noreferrer edit" target=_blank>âœï¸ç¼–è¾‘</a></span></div></header><aside id=toc-container class="toc-container wide"><div class=toc><details open><summary accesskey=c title="(Alt + C)"><span class=details>ç›®å½•</span></summary><div class=inner><ul><li><a href=#%e5%89%8d%e8%a8%80 aria-label=å‰è¨€>å‰è¨€</a></li><li><a href=#%e6%96%b0%e5%bb%ba%e9%a1%b9%e7%9b%ae aria-label=æ–°å»ºé¡¹ç›®>æ–°å»ºé¡¹ç›®</a></li><li><a href=#%e7%bc%96%e5%86%99%e6%8f%92%e4%bb%b6 aria-label=ç¼–å†™æ’ä»¶>ç¼–å†™æ’ä»¶</a></li><li><a href=#%e8%87%aa%e5%ae%9a%e4%b9%89qml%e6%8e%a7%e4%bb%b6 aria-label=è‡ªå®šä¹‰QMLæ§ä»¶>è‡ªå®šä¹‰QMLæ§ä»¶</a></li><li><a href=#qmldir%e6%96%87%e4%bb%b6 aria-label=qmldiræ–‡ä»¶>qmldiræ–‡ä»¶</a></li><li><a href=#%e9%a1%b9%e7%9b%ae%e6%96%87%e4%bb%b6%e9%85%8d%e7%bd%ae aria-label=é¡¹ç›®æ–‡ä»¶é…ç½®>é¡¹ç›®æ–‡ä»¶é…ç½®</a></li><li><a href=#qmlplugindump%e5%b7%a5%e5%85%b7%e7%9a%84%e4%bd%bf%e7%94%a8 aria-label=qmlplugindumpå·¥å…·çš„ä½¿ç”¨>qmlplugindumpå·¥å…·çš„ä½¿ç”¨</a></li><li><a href=#%e4%bd%bf%e7%94%a8qml%e6%8f%92%e4%bb%b6 aria-label=ä½¿ç”¨QMLæ’ä»¶>ä½¿ç”¨QMLæ’ä»¶</a></li><li><a href=#%e5%a6%82%e4%bd%95%e4%bd%bf%e7%94%a8%e6%8f%92%e4%bb%b6%e4%b8%ad%e7%9a%84%e9%9d%99%e6%80%81%e5%87%bd%e6%95%b0 aria-label=å¦‚ä½•ä½¿ç”¨æ’ä»¶ä¸­çš„é™æ€å‡½æ•°ï¼Ÿ>å¦‚ä½•ä½¿ç”¨æ’ä»¶ä¸­çš„é™æ€å‡½æ•°ï¼Ÿ</a></li></ul></div></details></div></aside><script>let activeElement,elements;window.addEventListener("DOMContentLoaded",function(){checkTocPosition(),elements=document.querySelectorAll("h1[id],h2[id],h3[id],h4[id],h5[id],h6[id]"),activeElement=elements[0];const t=encodeURI(activeElement.getAttribute("id")).toLowerCase();document.querySelector(`.inner ul li a[href="#${t}"]`).classList.add("active")},!1),window.addEventListener("resize",function(){checkTocPosition()},!1),window.addEventListener("scroll",()=>{activeElement=Array.from(elements).find(e=>{if(getOffsetTop(e)-window.pageYOffset>0&&getOffsetTop(e)-window.pageYOffset<window.innerHeight/2)return e})||activeElement,elements.forEach(e=>{const t=encodeURI(e.getAttribute("id")).toLowerCase();e===activeElement?document.querySelector(`.inner ul li a[href="#${t}"]`).classList.add("active"):document.querySelector(`.inner ul li a[href="#${t}"]`).classList.remove("active")})},!1);const main=parseInt(getComputedStyle(document.body).getPropertyValue("--article-width"),10),toc=parseInt(getComputedStyle(document.body).getPropertyValue("--toc-width"),10),gap=parseInt(getComputedStyle(document.body).getPropertyValue("--gap"),10);function checkTocPosition(){const e=document.body.scrollWidth;e-main-toc*2-gap*4>0?document.getElementById("toc-container").classList.add("wide"):document.getElementById("toc-container").classList.remove("wide")}function getOffsetTop(e){if(!e.getClientRects().length)return 0;let t=e.getBoundingClientRect(),n=e.ownerDocument.defaultView;return t.top+n.pageYOffset}</script><div class=post-content><h2 id=å‰è¨€>å‰è¨€<a hidden class=anchor aria-hidden=true href=#å‰è¨€>#</a></h2><p>æœ€è¿‘åœ¨è¯•ç€æŠŠè‡ªå®šä¹‰çš„QMLæ§ä»¶å°è£…æˆæ’ä»¶ä¾›å…¶ä»–ç¨‹åºè°ƒç”¨ï¼Œç”±äºæˆ‘ä½¿ç”¨çš„è¿˜æ˜¯Qt5ï¼Œåœ¨æ„å»ºçš„è¿‡ç¨‹ä¸­é‡åˆ°ä¸å°‘é—®é¢˜ï¼Œè¿™é‡Œåšä¸€ä¸‹ç®€å•æ±‡æ€»ã€‚</p><h2 id=æ–°å»ºé¡¹ç›®>æ–°å»ºé¡¹ç›®<a hidden class=anchor aria-hidden=true href=#æ–°å»ºé¡¹ç›®>#</a></h2><p>æ–°å»º<em>åº“â†’Qt Quick2 Extension Plugin</em>ï¼Œ<code>Qt 5</code>ç‰ˆæœ¬ä»…æ”¯æŒä½¿ç”¨<code>QMake</code>ä½œä¸ºæ„å»ºå¥—ä»¶ã€‚<code>Qt 6</code>æ‰æ”¯æŒä½¿ç”¨<code>CMake</code>ä½œä¸ºQMLæ‰©å±•æ’ä»¶çš„æ„å»ºå¥—ä»¶ã€‚</p><h2 id=ç¼–å†™æ’ä»¶>ç¼–å†™æ’ä»¶<a hidden class=anchor aria-hidden=true href=#ç¼–å†™æ’ä»¶>#</a></h2><p>ä¾‹å¦‚ï¼Œæˆ‘æ–°å»ºäº†ä¸€ä¸ªå«åš<code>Test</code>çš„æ’ä»¶åº“ï¼Œé¡¹ç›®ä¼šè‡ªåŠ¨åˆ›å»ºä¸€ä¸ª<code>TestPlugin</code>çš„ç±»ï¼Œè¿™ä¸ªç±»ç»§æ‰¿è‡ª<code>QQmlExtensionPlugin</code>ï¼Œæˆ‘ä»¬éœ€è¦é‡å†™å®ƒçš„ä¸¤ä¸ªè™šå‡½æ•°ã€‚</p><div class=mac-codeblock><div class=mac-titlebar><div class=mac-left-group><span class=mac-close></span>
<span class=mac-minimize></span>
<span class=mac-expand></span></div><div class=mac-title title=testplugin.h>testplugin.h</div><div class=mac-right-group><button class=fold-button>&#9660;</button></div></div><div class=mac-content><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;QQmlExtensionPlugin&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>TestPlugin</span> <span class=o>:</span> <span class=k>public</span> <span class=n>QQmlExtensionPlugin</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>Q_OBJECT</span>
</span></span><span class=line><span class=cl>    <span class=nf>Q_PLUGIN_METADATA</span><span class=p>(</span><span class=n>IID</span> <span class=n>QQmlExtensionInterface_iid</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>public</span><span class=o>:</span>
</span></span><span class=line><span class=cl>    <span class=kt>void</span> <span class=n>registerTypes</span><span class=p>(</span><span class=k>const</span> <span class=kt>char</span> <span class=o>*</span><span class=n>uri</span><span class=p>)</span> <span class=n>Q_DECL_OVERRIDE</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kt>void</span> <span class=nf>initializeEngine</span><span class=p>(</span><span class=n>QQmlEngine</span> <span class=o>*</span><span class=n>engine</span><span class=p>,</span> <span class=k>const</span> <span class=kt>char</span> <span class=o>*</span><span class=n>uri</span><span class=p>)</span> <span class=n>Q_DECL_OVERRIDE</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>};</span></span></span></code></pre></td></tr></table></div></div></div></div><div class=mac-codeblock><div class=mac-titlebar><div class=mac-left-group><span class=mac-close></span>
<span class=mac-minimize></span>
<span class=mac-expand></span></div><div class=mac-title title=testplugin.cpp>testplugin.cpp</div><div class=mac-right-group><button class=fold-button>&#9660;</button></div></div><div class=mac-content><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&#34;testplugin.h&#34;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&#34;myitem.h&#34;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;qqml.h&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kt>void</span> <span class=n>TestPlugin</span><span class=o>::</span><span class=n>registerTypes</span><span class=p>(</span><span class=k>const</span> <span class=kt>char</span> <span class=o>*</span><span class=n>uri</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// @uri com.mycompany.qmlcomponents
</span></span></span><span class=line><span class=cl>    <span class=n>qmlRegisterType</span><span class=o>&lt;</span><span class=n>MyItem</span><span class=o>&gt;</span><span class=p>(</span><span class=n>uri</span><span class=p>,</span> <span class=mi>1</span><span class=p>,</span> <span class=mi>0</span><span class=p>,</span> <span class=s>&#34;MyItem&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kt>void</span> <span class=n>TestPlugin</span><span class=o>::</span><span class=n>initializeEngine</span><span class=p>(</span><span class=n>QQmlEngine</span> <span class=o>*</span><span class=n>engine</span><span class=p>,</span> <span class=k>const</span> <span class=kt>char</span> <span class=o>*</span><span class=n>uri</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>QQmlExtensionPlugin</span><span class=o>::</span><span class=n>initializeEngine</span><span class=p>(</span><span class=n>engine</span><span class=p>,</span> <span class=n>uri</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></td></tr></table></div></div></div></div><p>å…¶ä¸­ï¼Œ<code>MyItem</code>å°±æ˜¯æˆ‘ä»¬è‡ªå®šä¹‰çš„æ§ä»¶ã€‚ç®€å•çœ‹ä¸€ä¸‹ç¤ºä¾‹ä»£ç ï¼š</p><div class=mac-codeblock><div class=mac-titlebar><div class=mac-left-group><span class=mac-close></span>
<span class=mac-minimize></span>
<span class=mac-expand></span></div><div class=mac-title title=myitem.h>myitem.h</div><div class=mac-right-group><button class=fold-button>&#9660;</button></div></div><div class=mac-content><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;QtQuick/QQuickPaintedItem&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>MyItem</span> <span class=o>:</span> <span class=k>public</span> <span class=n>QQuickPaintedItem</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>Q_OBJECT</span>
</span></span><span class=line><span class=cl>    <span class=n>QML_ELEMENT</span>
</span></span><span class=line><span class=cl>    <span class=nf>Q_DISABLE_COPY</span><span class=p>(</span><span class=n>MyItem</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=k>public</span><span class=o>:</span>
</span></span><span class=line><span class=cl>    <span class=k>explicit</span> <span class=n>MyItem</span><span class=p>(</span><span class=n>QQuickItem</span> <span class=o>*</span><span class=n>parent</span> <span class=o>=</span> <span class=n>Q_NULLPTR</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=kt>void</span> <span class=nf>paint</span><span class=p>(</span><span class=n>QPainter</span> <span class=o>*</span><span class=n>painter</span><span class=p>)</span> <span class=n>Q_DECL_OVERRIDE</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=o>~</span><span class=n>MyItem</span><span class=p>()</span> <span class=n>Q_DECL_OVERRIDE</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>};</span></span></span></code></pre></td></tr></table></div></div></div></div><p><code>MyItem</code>ç»§æ‰¿è‡ª<code>QQuickItem</code>ï¼Œå¹¶ä½¿ç”¨<code>QML_ELEMENT</code>å£°æ˜äº†å®ƒæ˜¯ä¸€ä¸ªQMLå…ƒç´ ï¼Œæœ€åå†ä½¿ç”¨<code>qmlRegisterType</code>æ³¨å†Œã€‚è¿™æ ·<code>MyItem</code>å°±å¯ä»¥åœ¨QMLä¸­ä½¿ç”¨äº†ã€‚</p><p>ä½¿ç”¨è¿™ç§æ–¹å¼ä¹Ÿå¯ä»¥æ³¨å†Œç»§æ‰¿è‡ª<code>QObject</code>çš„ç±»ã€‚ä¾‹å¦‚ï¼š</p><div class=mac-codeblock><div class=mac-titlebar><div class=mac-left-group><span class=mac-close></span>
<span class=mac-minimize></span>
<span class=mac-expand></span></div><div class=mac-title title=myobject.h>myobject.h</div><div class=mac-right-group><button class=fold-button>&#9660;</button></div></div><div class=mac-content><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=k>class</span> <span class=nc>MyObject</span> <span class=o>:</span> <span class=k>public</span> <span class=n>QObject</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>Q_OBJECT</span>
</span></span><span class=line><span class=cl>    <span class=nf>Q_DISABLE_COPY</span><span class=p>(</span><span class=n>MyObject</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=k>public</span><span class=o>:</span>
</span></span><span class=line><span class=cl>    <span class=k>explicit</span> <span class=n>MyObject</span><span class=p>(</span><span class=n>QObject</span> <span class=o>*</span><span class=n>parent</span> <span class=o>=</span> <span class=n>Q_NULLPTR</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>};</span></span></span></code></pre></td></tr></table></div></div></div></div><p>ç„¶ååœ¨<code>Plugin</code>ç±»ä¸­è¿›è¡Œæ³¨å†Œï¼š</p><div class=mac-codeblock><div class=mac-titlebar><div class=mac-left-group><span class=mac-close></span>
<span class=mac-minimize></span>
<span class=mac-expand></span></div><div class=mac-title title=testplugin.cpp>testplugin.cpp</div><div class=mac-right-group><button class=fold-button>&#9660;</button></div></div><div class=mac-content><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=kt>void</span> <span class=n>TestPlugin</span><span class=o>::</span><span class=n>registerTypes</span><span class=p>(</span><span class=k>const</span> <span class=kt>char</span> <span class=o>*</span><span class=n>uri</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// @uri com.mycompany.qmlcomponents
</span></span></span><span class=line><span class=cl>    <span class=n>qmlRegisterType</span><span class=o>&lt;</span><span class=n>MyItem</span><span class=o>&gt;</span><span class=p>(</span><span class=n>uri</span><span class=p>,</span> <span class=mi>1</span><span class=p>,</span> <span class=mi>0</span><span class=p>,</span> <span class=s>&#34;MyItem&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=n>qmlRegisterType</span><span class=o>&lt;</span><span class=n>MyObject</span><span class=o>&gt;</span><span class=p>(</span><span class=n>uri</span><span class=p>,</span> <span class=mi>1</span><span class=p>,</span> <span class=mi>0</span><span class=p>,</span> <span class=s>&#34;MyObject&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></td></tr></table></div></div></div></div><h2 id=è‡ªå®šä¹‰qmlæ§ä»¶>è‡ªå®šä¹‰QMLæ§ä»¶<a hidden class=anchor aria-hidden=true href=#è‡ªå®šä¹‰qmlæ§ä»¶>#</a></h2><p>QMLæ’ä»¶åº“å½“ç„¶ä¹Ÿå¯ä»¥å°è£…<code>.qml</code>çš„è‡ªå®šä¹‰æ’ä»¶ã€‚ä¾‹å¦‚ï¼š</p><div class=mac-codeblock><div class=mac-titlebar><div class=mac-left-group><span class=mac-close></span>
<span class=mac-minimize></span>
<span class=mac-expand></span></div><div class=mac-title title=MyLabel.qml>MyLabel.qml</div><div class=mac-right-group><button class=fold-button>&#9660;</button></div></div><div class=mac-content><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-qml data-lang=qml><span class=line><span class=cl><span class=kr>import</span> <span class=nx>QtQuick</span> <span class=mf>2.15</span>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=nx>QtQuick</span><span class=p>.</span><span class=nx>Controls</span> <span class=mf>2.15</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>Label</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>id: control</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nx>property</span> <span class=nx>string</span> <span class=nx>backgroundColor</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>background:</span> <span class=nx>Rectangle</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>color:</span> <span class=nx>backgroundColor</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></td></tr></table></div></div></div></div><p>æŠŠè‡ªå®šä¹‰çš„qmlæ§ä»¶æ·»åŠ åˆ°èµ„æºæ–‡ä»¶ï¼Œç„¶åå¯ä»¥åœ¨<code>Plugin</code>ç±»ä¸­è¿›è¡Œæ³¨å†Œã€‚</p><div class=mac-codeblock><div class=mac-titlebar><div class=mac-left-group><span class=mac-close></span>
<span class=mac-minimize></span>
<span class=mac-expand></span></div><div class=mac-title title=testplugin.cpp>testplugin.cpp</div><div class=mac-right-group><button class=fold-button>&#9660;</button></div></div><div class=mac-content><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=kt>void</span> <span class=n>TestPlugin</span><span class=o>::</span><span class=n>registerTypes</span><span class=p>(</span><span class=k>const</span> <span class=kt>char</span> <span class=o>*</span><span class=n>uri</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// @uri com.mycompany.qmlcomponents
</span></span></span><span class=line><span class=cl>    <span class=n>qmlRegisterType</span><span class=o>&lt;</span><span class=n>MyItem</span><span class=o>&gt;</span><span class=p>(</span><span class=n>uri</span><span class=p>,</span> <span class=mi>1</span><span class=p>,</span> <span class=mi>0</span><span class=p>,</span> <span class=s>&#34;MyItem&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=n>qmlRegisterType</span><span class=o>&lt;</span><span class=n>MyObject</span><span class=o>&gt;</span><span class=p>(</span><span class=n>uri</span><span class=p>,</span> <span class=mi>1</span><span class=p>,</span> <span class=mi>0</span><span class=p>,</span> <span class=s>&#34;MyObject&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// register qml types
</span></span></span><span class=line><span class=cl>    <span class=n>qmlRegisterType</span><span class=p>(</span><span class=n>QUrl</span><span class=p>(</span><span class=s>&#34;qrc:/qml/MyLabel.qml&#34;</span><span class=p>),</span>
</span></span><span class=line><span class=cl>                    <span class=n>uri</span><span class=p>,</span> <span class=n>MAJOR</span><span class=p>,</span> <span class=n>MINOR</span><span class=p>,</span> <span class=s>&#34;MyLabel&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></td></tr></table></div></div></div></div><h2 id=qmldiræ–‡ä»¶>qmldiræ–‡ä»¶<a hidden class=anchor aria-hidden=true href=#qmldiræ–‡ä»¶>#</a></h2><p><code>qmldir</code>æ–‡ä»¶ç”¨äºQMLæ’ä»¶æ¨¡å—ç®¡ç†ï¼Œæè¿°äº†qmlæ’ä»¶çš„åŸºæœ¬ä¿¡æ¯ã€‚ç¤ºä¾‹ï¼š</p><div class=mac-codeblock><div class=mac-titlebar><div class=mac-left-group><span class=mac-close></span>
<span class=mac-minimize></span>
<span class=mac-expand></span></div><div class=mac-title title=qmldir>qmldir</div><div class=mac-right-group><button class=fold-button>&#9660;</button></div></div><div class=mac-content><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>module com.mycompany.qmlcomponents
</span></span><span class=line><span class=cl>plugin testplugin
</span></span><span class=line><span class=cl>classname TestPlugin
</span></span><span class=line><span class=cl>typeinfo plugins.qmltypes
</span></span><span class=line><span class=cl>designersupported
</span></span><span class=line><span class=cl>depends QtQuick.Controls 2.12</span></span></code></pre></td></tr></table></div></div></div></div><ul><li><code>module</code> å’Œæ’ä»¶çš„urié…ç½®ç›¸åŒ</li><li><code>plugin</code> æ’ä»¶æ–‡ä»¶åå­—ï¼Œé€šå¸¸æ˜¯å°å†™</li><li><code>classname</code> æ’ä»¶ç±»çš„åå­—</li><li><code>typeinfo</code> æ’ä»¶çš„å…ƒæ•°æ®æ–‡ä»¶ï¼Œç¨åä¼šå†™æ€ä¹ˆç”Ÿæˆè¿™ä¸ªæ–‡ä»¶</li></ul><h2 id=é¡¹ç›®æ–‡ä»¶é…ç½®>é¡¹ç›®æ–‡ä»¶é…ç½®<a hidden class=anchor aria-hidden=true href=#é¡¹ç›®æ–‡ä»¶é…ç½®>#</a></h2><p>ä¸‹é¢æ˜¯æˆ‘çš„ä¸€ä¸ªé¡¹ç›®é…ç½®ï¼ŒåŒ…å«æ’ä»¶ä¿¡æ¯é…ç½®ï¼Œå’Œ<strong>ç”Ÿæˆå…ƒæ•°æ®çš„è‡ªå®šä¹‰å‘½ä»¤</strong>ã€‚</p><div class=mac-codeblock><div class=mac-titlebar><div class=mac-left-group><span class=mac-close></span>
<span class=mac-minimize></span>
<span class=mac-expand></span></div><div class=mac-title title=TestPlugin.pro>TestPlugin.pro</div><div class=mac-right-group><button class=fold-button>&#9660;</button></div></div><div class=mac-content><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl><span class=c1>## TestPlugin.pro</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nv>TEMPLATE</span> <span class=o>=</span> lib
</span></span><span class=line><span class=cl><span class=nv>TARGET</span> <span class=o>=</span> testplugin
</span></span><span class=line><span class=cl><span class=nv>QT</span> <span class=o>+=</span> core qml quick
</span></span><span class=line><span class=cl><span class=nv>CONFIG</span> <span class=o>+=</span> plugin c++11
</span></span><span class=line><span class=cl><span class=c1># CONFIG += qmltypes</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># æ’ä»¶çš„URI</span>
</span></span><span class=line><span class=cl><span class=nv>uri</span> <span class=o>=</span> com.mycompany.qmlcomponents
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nv>QML_PLUGIN_NAME</span> <span class=o>=</span> <span class=nv>$$</span>TARGET
</span></span><span class=line><span class=cl><span class=c1># å¯ä»¥é€šè¿‡ import çš„æ–¹å¼åœ¨qmlä¸­ä½¿ç”¨æ’ä»¶ä¸­çš„æ§ä»¶</span>
</span></span><span class=line><span class=cl><span class=nv>QML_IMPORT_NAME</span> <span class=o>=</span> <span class=nv>$$</span>uri
</span></span><span class=line><span class=cl><span class=c1># æ’ä»¶çš„ç‰ˆæœ¬å·</span>
</span></span><span class=line><span class=cl><span class=nv>QML_IMPORT_MAJOR_VERSION</span> <span class=o>=</span> <span class=m>1</span>
</span></span><span class=line><span class=cl><span class=nv>QML_IMPORT_MINOR_VERSION</span> <span class=o>=</span> <span class=m>0</span>
</span></span><span class=line><span class=cl><span class=c1># ç”Ÿæˆæ’ä»¶çš„è·¯å¾„</span>
</span></span><span class=line><span class=cl><span class=nv>DESTDIR</span> <span class=o>=</span> imports/<span class=nv>$$</span>replace<span class=o>(</span>QML_IMPORT_NAME, <span class=se>\.</span>, <span class=nv>$$</span>QMAKE_DIR_SEP<span class=o>)</span>
</span></span><span class=line><span class=cl><span class=nv>QMLTYPES_FILENAME</span> <span class=o>=</span> <span class=nv>$$</span>DESTDIR/plugins.qmltypes
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nv>TARGET</span> <span class=o>=</span> <span class=nv>$$</span>qtLibraryTarget<span class=o>(</span><span class=nv>$$</span>TARGET<span class=o>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nv>HEADERS</span> <span class=o>+=</span> ...
</span></span><span class=line><span class=cl><span class=nv>SOURCES</span> <span class=o>+=</span> ...
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># æ‹·è´qmldiræ–‡ä»¶åˆ°è¾“å‡ºç›®å½•</span>
</span></span><span class=line><span class=cl><span class=nv>DISTFILES</span> <span class=o>=</span> qmldir
</span></span><span class=line><span class=cl>!equals<span class=o>(</span>_PRO_FILE_PWD_, <span class=nv>$$</span>OUT_PWD<span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    copy_qmldir.target <span class=o>=</span> <span class=nv>$$</span>DESTDIR/qmldir
</span></span><span class=line><span class=cl>    copy_qmldir.depends <span class=o>=</span> <span class=nv>$$</span>_PRO_FILE_PWD_/qmldir
</span></span><span class=line><span class=cl>    copy_qmldir.commands <span class=o>=</span> <span class=k>$(</span>COPY_FILE<span class=k>)</span> <span class=s2>&#34;</span><span class=nv>$$</span><span class=s2>replace(copy_qmldir.depends, /, </span><span class=nv>$$</span><span class=s2>QMAKE_DIR_SEP)&#34;</span> <span class=s2>&#34;</span><span class=nv>$$</span><span class=s2>replace(copy_qmldir.target, /, </span><span class=nv>$$</span><span class=s2>QMAKE_DIR_SEP)&#34;</span>
</span></span><span class=line><span class=cl>    <span class=nv>QMAKE_EXTRA_TARGETS</span> <span class=o>+=</span> copy_qmldir
</span></span><span class=line><span class=cl>    <span class=nv>PRE_TARGETDEPS</span> <span class=o>+=</span> <span class=nv>$$</span>copy_qmldir.target
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># æ·»åŠ æ„å»ºåç”Ÿæˆå…ƒæ•°æ®çš„è‡ªå®šä¹‰å‘½ä»¤</span>
</span></span><span class=line><span class=cl>qmltypes.commands <span class=o>=</span> <span class=nv>$$</span><span class=o>[</span>QT_INSTALL_PREFIX<span class=o>]</span>/bin/qmlplugindump -nonrelocatable <span class=nv>$$</span>QML_IMPORT_NAME <span class=s2>&#34;</span><span class=nv>$$</span><span class=s2>{QML_IMPORT_MAJOR_VERSION}.</span><span class=nv>$$</span><span class=s2>{QML_IMPORT_MINOR_VERSION}&#34;</span> <span class=nv>$$</span>OUT_PWD/imports &gt; <span class=nv>$$</span>OUT_PWD/<span class=nv>$$</span>DESTDIR/plugins.qmltypes
</span></span><span class=line><span class=cl>qmltypes.depends <span class=o>=</span> <span class=nv>$$</span>QML_PLUGIN_NAME.target
</span></span><span class=line><span class=cl><span class=nv>QMAKE_EXTRA_TARGETS</span> <span class=o>+=</span> qmltypes
</span></span><span class=line><span class=cl><span class=c1># ç¡®ä¿æ„å»ºåæ‰§è¡Œå…ƒæ•°æ®ç”Ÿæˆ</span>
</span></span><span class=line><span class=cl><span class=c1># POST_TARGETDEPS += $$QML_PLUGIN_NAME</span>
</span></span><span class=line><span class=cl><span class=nv>POST_TARGETDEPS</span> <span class=o>+=</span> qmltypes</span></span></code></pre></td></tr></table></div></div></div></div><p>è¿™é‡Œæœ‰å‡ ç‚¹éœ€è¦æ³¨æ„çš„ï¼š</p><ul><li>æœ‰èµ„æ–™è¯´åŠ å…¥ <code>CONFIG += qmltypes</code> é…ç½®å°±å¯ä»¥è‡ªåŠ¨ç”Ÿæˆæ’ä»¶å…ƒæ•°æ®ä¿¡æ¯ï¼Œè¿™ç‚¹æˆ‘æµ‹è¯•ç¡®å®å¯ä»¥ï¼Œä½†ç”Ÿæˆçš„å…ƒæ•°æ®æ˜¯ä¸å®Œæ•´çš„ã€‚è¿™ä¸ªé…ç½®åªèƒ½ç”Ÿæˆä½¿ç”¨äº†<code>QML_ELEMENT</code>å®çš„ç±»ï¼Œæ— æ³•ç”Ÿæˆ<code>QObject</code>ç±»å’Œ<code>QML</code>æ§ä»¶çš„å…ƒæ•°æ®ï¼ŒåŸºæœ¬ä¸Šæ— ç”¨ã€‚</li><li>ç”Ÿæˆå…ƒæ•°æ®å¿…é¡»ä½¿ç”¨<code>qmlplugindump</code>å·¥å…·ï¼Œè¿™ä¸ªå·¥å…·å’Œ<code>qmake</code>åœ¨åŒä¸€ä¸ªç›®å½•ä¸‹ã€‚</li></ul><h2 id=qmlplugindumpå·¥å…·çš„ä½¿ç”¨>qmlplugindumpå·¥å…·çš„ä½¿ç”¨<a hidden class=anchor aria-hidden=true href=#qmlplugindumpå·¥å…·çš„ä½¿ç”¨>#</a></h2><p>è¿™é‡Œä½¿ç”¨çš„å‘½ä»¤å¦‚ä¸‹ï¼š</p><p><code>qmlplugindump -nonrelocatable QMLå¯¼å…¥URI æ’ä»¶ç‰ˆæœ¬ æ’ä»¶ç›®å½• > ç”Ÿæˆplugins.qmltypesè·¯å¾„</code></p><ul><li>QMLå¯¼å…¥URIï¼šç¼–è¯‘æ’ä»¶æ—¶æŒ‡å®šçš„uriï¼Œå¦‚ï¼šcom.mycompany.qmlcomponents</li><li>æ’ä»¶æœ¬æœ¬ï¼šç¼–è¯‘æ’ä»¶æ—¶æŒ‡å®šçš„ç‰ˆæœ¬ï¼Œå¦‚ï¼š1.0</li><li><strong>æ’ä»¶ç›®å½•</strong>ï¼šè¿™ä¸ªéœ€è¦ç‰¹åˆ«æ³¨æ„ï¼Œè¿™ä¸ªæŒ‡çš„æ˜¯æ’ä»¶çš„ç›®å½•ï¼Œä¸æ˜¯æ’ä»¶åº“çš„ç›®å½•ã€‚æ¯”å¦‚æˆ‘ç”Ÿæˆçš„æ’ä»¶æ˜¯åœ¨<code>imports</code>ç›®å½•ï¼Œæ„å»ºå¥—ä»¶ä¼šæ ¹æ®æ’ä»¶çš„uriè‡ªåŠ¨ç”Ÿæˆæ’ä»¶åº“çš„ç›®å½•ï¼Œå¦‚ï¼š<code>imports/com/mycompany/qmlcomponents/testplugin.so</code>ï¼Œé‚£ä¹ˆè¿™é‡Œåº”è¯¥ä¼ å…¥å‚æ•°<code>/path/to/imports</code>ï¼Œä¸è¦ä¼ å…¥æ’ä»¶åº“æ‰€åœ¨çš„ç›®å½•ã€‚</li><li>ç”Ÿæˆplugins.qmltypesè·¯å¾„ï¼šè¿™ä¸ªæ²¡ä»€ä¹ˆå¥½è§£é‡Šçš„ï¼Œä½†æ³¨æ„<code>plugins.qmltypes</code>éœ€è¦å’Œæ’ä»¶åº“æ”¾åœ¨ç»Ÿä¸€ç›®å½•ï¼Œæ‰€ä»¥è¿™é‡Œæœ€åä¼ å…¥å‚æ•°<code>/path/to/imports/com/mycompany/qmlcomponents/plugins.qmltypes</code>ã€‚</li></ul><p>æ³¨æ„ï¼š</p><ol><li>qmldiræ–‡ä»¶å’Œç”Ÿæˆçš„æ’ä»¶éœ€è¦æ”¾åˆ°åŒä¸€ç›®å½•ä¸‹ï¼Œå¦åˆ™<code>qmlplugindump</code>è¯»ä¸åˆ°æ’ä»¶ä¿¡æ¯ã€‚</li><li>å¦‚æœç”Ÿæˆçš„æ’ä»¶ä¾èµ–å…¶ä»–åŠ¨æ€åº“ï¼Œä¸€å®šè¦ç¡®ä¿<code>qmlplugindump</code>èƒ½æ‰¾åˆ°è¿™äº›åº“ï¼Œå¦åˆ™æ’ä»¶æ— æ³•åŠ è½½å°±ä¸èƒ½ç”Ÿæˆå…ƒæ•°æ®ã€‚</li></ol><p>é—®é¢˜ï¼š</p><ol><li>plugin cannot be loaded for module &ldquo;com.mycompany.qmlcomponents&rdquo;: Cannot load library testplugin.dll: æ‰¾ä¸åˆ°æŒ‡å®šçš„æ¨¡å—ã€‚(æ£€æŸ¥åŠ¨æ€åº“çš„è·¯å¾„ï¼Œå¯å°è¯•æ·»åŠ åˆ°ç¯å¢ƒå˜é‡)</li><li>QQmlComponent: Component is not ready
file:///path/to/imports/com/mycompany/qmlcomponents/qmldir: plugin cannot be loaded for module &ldquo;&rdquo;: Module namespace &lsquo;com.mycompany.qmlcomponents&rsquo; does not match import URI &rsquo;&rsquo;
(æ£€æŸ¥ä¼ å…¥å‚æ•°çš„<em>æ’ä»¶ç›®å½•</em>æ˜¯å¦æ­£ç¡®ï¼Ÿ)</li></ol><h2 id=ä½¿ç”¨qmlæ’ä»¶>ä½¿ç”¨QMLæ’ä»¶<a hidden class=anchor aria-hidden=true href=#ä½¿ç”¨qmlæ’ä»¶>#</a></h2><ol><li>ç¡®ä¿æ’ä»¶ç›®å½•ä¸­åŒ…å«ä»¥ä¸‹å‡ ä¸ªæ–‡ä»¶ï¼štestplugin.soã€plugins.qmltypesã€qmldirã€‚</li><li>å°†æ’ä»¶ç›®å½•æ·»åŠ åˆ°Qml Emgineçš„å¯¼å…¥ç›®å½•åˆ—è¡¨ï¼š</li></ol><div class=mac-codeblock><div class=mac-titlebar><div class=mac-left-group><span class=mac-close></span>
<span class=mac-minimize></span>
<span class=mac-expand></span></div><div class=mac-title title=main.cpp>main.cpp</div><div class=mac-right-group><button class=fold-button>&#9660;</button></div></div><div class=mac-content><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=n>QGuiApplication</span> <span class=nf>app</span><span class=p>(</span><span class=n>argc</span><span class=p>,</span> <span class=n>argv</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=n>QQmlApplicationEngine</span> <span class=nf>engine</span><span class=p>(</span><span class=o>&amp;</span><span class=n>app</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>...</span>
</span></span><span class=line><span class=cl><span class=c1>// æ·»åŠ æ’ä»¶è·¯å¾„åˆ°å¯¼å…¥ç›®å½•åˆ—è¡¨
</span></span></span><span class=line><span class=cl><span class=n>engine</span><span class=p>.</span><span class=n>addImportPath</span><span class=p>(</span><span class=s>&#34;imports&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=n>engine</span><span class=p>.</span><span class=n>load</span><span class=p>(</span><span class=n>url</span><span class=p>);</span></span></span></code></pre></td></tr></table></div></div></div></div><ol start=3><li>åœ¨qmlä¸­å¯¼å…¥ã€ä½¿ç”¨è‡ªå®šä¹‰æ§ä»¶</li></ol><div class=mac-codeblock><div class=mac-titlebar><div class=mac-left-group><span class=mac-close></span>
<span class=mac-minimize></span>
<span class=mac-expand></span></div><div class=mac-title title=main.qml>main.qml</div><div class=mac-right-group><button class=fold-button>&#9660;</button></div></div><div class=mac-content><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-qml data-lang=qml><span class=line><span class=cl><span class=kr>import</span> <span class=nx>com</span><span class=p>.</span><span class=nx>mycompany</span><span class=p>.</span><span class=nx>qmlcomponents</span> <span class=mf>1.0</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>Window</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kd>id: window</span>
</span></span><span class=line><span class=cl>  <span class=k>width:</span> <span class=mi>640</span>
</span></span><span class=line><span class=cl>  <span class=k>height:</span> <span class=mi>480</span>
</span></span><span class=line><span class=cl>  <span class=k>visible:</span> <span class=kc>true</span>
</span></span><span class=line><span class=cl>  <span class=k>title:</span> <span class=nx>qsTr</span><span class=p>(</span><span class=s2>&#34;Hello World&#34;</span><span class=p>)</span>  <span class=c1>// @disable-check M16
</span></span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nx>MyItem</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=kd>id: myitem</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nx>MyLabel</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=kd>id: mylabel</span>
</span></span><span class=line><span class=cl>      <span class=k>text:</span> <span class=nx>qsTr</span><span class=p>(</span><span class=s2>&#34;Hello World&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>      <span class=k>backgroundColor:</span> <span class=s1>&#39;red&#39;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></td></tr></table></div></div></div></div><h2 id=å¦‚ä½•ä½¿ç”¨æ’ä»¶ä¸­çš„é™æ€å‡½æ•°>å¦‚ä½•ä½¿ç”¨æ’ä»¶ä¸­çš„é™æ€å‡½æ•°ï¼Ÿ<a hidden class=anchor aria-hidden=true href=#å¦‚ä½•ä½¿ç”¨æ’ä»¶ä¸­çš„é™æ€å‡½æ•°>#</a></h2><p>è¿™é‡Œéœ€è¦å¯¹é™æ€å‡½æ•°åšä¸€ä¸‹å°è£…ã€‚ä¾‹å¦‚ï¼Œæˆ‘å®šä¹‰äº†ä¸€ä¸ªé™æ€å‡½æ•°ï¼š</p><div class=mac-codeblock><div class=mac-titlebar><div class=mac-left-group><span class=mac-close></span>
<span class=mac-minimize></span>
<span class=mac-expand></span></div><div class=mac-title title=myutils.h>myutils.h</div><div class=mac-right-group><button class=fold-button>&#9660;</button></div></div><div class=mac-content><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=k>class</span> <span class=nc>MyUtils</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl><span class=k>public</span><span class=o>:</span>
</span></span><span class=line><span class=cl>    <span class=k>static</span> <span class=kt>void</span> <span class=n>myFunc</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>printf</span><span class=p>(</span><span class=s>&#34;Hello from myFunc().&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>};</span></span></span></code></pre></td></tr></table></div></div></div></div><p>è¿™é‡Œéœ€è¦å®šä¹‰ä¸€ä¸ªæ’ä»¶çš„Helperç±»ï¼Œç„¶ååœ¨æ’ä»¶é‡Œé¢æ³¨å†Œè¿™ä¸ªç±»ï¼Œåœ¨è¿™ä¸ªç±»é‡Œé¢å®ç°é™æ€å‡½æ•°è°ƒç”¨ã€‚ä¾‹å¦‚ï¼š</p><div class=mac-codeblock><div class=mac-titlebar><div class=mac-left-group><span class=mac-close></span>
<span class=mac-minimize></span>
<span class=mac-expand></span></div><div class=mac-title title=testplugin.cpp>testplugin.cpp</div><div class=mac-right-group><button class=fold-button>&#9660;</button></div></div><div class=mac-content><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&#34;myutils.h&#34;</span><span class=cp>
</span></span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>TestPluginHelper</span> <span class=o>:</span> <span class=k>public</span> <span class=n>QObject</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>Q_OBJECT</span>
</span></span><span class=line><span class=cl><span class=k>public</span><span class=o>:</span>
</span></span><span class=line><span class=cl>    <span class=n>Q_INVOKABLE</span> <span class=kt>void</span> <span class=n>callMyFunc</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>MyUtils</span><span class=o>::</span><span class=n>myFunc</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&#34;testplugin.moc&#34;</span><span class=cp>
</span></span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kt>void</span> <span class=n>TestPlugin</span><span class=o>::</span><span class=n>initializeEngine</span><span class=p>(</span><span class=n>QQmlEngine</span> <span class=o>*</span><span class=n>engine</span><span class=p>,</span> <span class=k>const</span> <span class=kt>char</span> <span class=o>*</span><span class=n>uri</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>QQmlExtensionPlugin</span><span class=o>::</span><span class=n>initializeEngine</span><span class=p>(</span><span class=n>engine</span><span class=p>,</span> <span class=n>uri</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=c1>// æ³¨å†Œå¯¹è±¡åˆ°ä¸Šä¸‹æ–‡
</span></span></span><span class=line><span class=cl>    <span class=n>engine</span><span class=o>-&gt;</span><span class=n>rootContext</span><span class=p>()</span><span class=o>-&gt;</span><span class=n>setContextProperty</span><span class=p>(</span><span class=s>&#34;testPluginHelper&#34;</span><span class=p>,</span> <span class=k>new</span> <span class=n>TestPluginHelper</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></td></tr></table></div></div></div></div><p>åœ¨QMLä¸­è°ƒç”¨ï¼š</p><div class=mac-codeblock><div class=mac-titlebar><div class=mac-left-group><span class=mac-close></span>
<span class=mac-minimize></span>
<span class=mac-expand></span></div><div class=mac-title title=qml>qml</div><div class=mac-right-group><button class=fold-button>&#9660;</button></div></div><div class=mac-content><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-qml data-lang=qml><span class=line><span class=cl><span class=nx>Item</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>id: item</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>Component.onCompleted:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>testPluginHelper</span><span class=p>.</span><span class=nx>callMyFunc</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></td></tr></table></div></div></div></div></div><footer class=post-footer><ul class=post-tags><li><a href=https://kira-96.github.io/tags/qt/>Qt</a></li><li><a href=https://kira-96.github.io/tags/qml/>QML</a></li></ul><nav class=paginav><a class=prev href=https://kira-96.github.io/posts/qt-remote-objects/><span class=title>Â« ä¸Šä¸€é¡µ</span><br><span>Qt Remote Objects ç®€å•ä½¿ç”¨</span>
</a><a class=next href=https://kira-96.github.io/posts/qml%E6%8E%A7%E4%BB%B6%E8%AE%BF%E9%97%AEepics%E8%BF%87%E7%A8%8B%E5%8F%98%E9%87%8F%E7%9A%84%E6%80%9D%E8%B7%AF/><span class=title>ä¸‹ä¸€é¡µ Â»</span><br><span>QMLæ§ä»¶è®¿é—®EPICSè¿‡ç¨‹å˜é‡çš„æ€è·¯</span></a></nav></footer><script src=https://utteranc.es/client.js repo=kira-96/kira-96.github.io issue-term=pathname theme=github-light crossorigin=anonymous async></script></article></main><footer class=footer><span>Â© 2019-2026 <a href=/>kira&rsquo;s blog</a> Â· LICENSED under <a href=https://github.com/kira-96/kira-96.github.io/tree/main/LICENSE>CC-BY-4.0</a></span> Â·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
<a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentColor"><path d="M12 6H0l6-6z"/></svg>
</a><script>document.querySelectorAll(".fold-button").forEach(e=>{e.addEventListener("click",t=>{const n=t.target.closest(".mac-codeblock"),s=n.querySelector(".mac-content");s.classList.toggle("folded"),e.classList.toggle("folded")})})</script><script>let menu=document.getElementById("menu");if(menu){const e=localStorage.getItem("menu-scroll-position");e&&(menu.scrollLeft=parseInt(e,10)),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}}document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{const e=document.querySelector("html");e.dataset.theme==="dark"?(e.dataset.theme="light",localStorage.setItem("pref-theme","light")):(e.dataset.theme="dark",localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="å¤åˆ¶";function s(){t.innerHTML="å·²å¤åˆ¶ï¼",setTimeout(()=>{t.innerHTML="å¤åˆ¶"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>