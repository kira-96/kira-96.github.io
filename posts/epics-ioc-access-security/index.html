<!doctype html><html lang=zh dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>EPICS IOC 访问安全 | ✨kiraの博客</title>
<meta name=keywords content="linux,EPICS"><meta name=description content="EPICS IOC 数据访问安全配置"><meta name=author content><link rel=canonical href=https://kira-96.github.io/posts/epics-ioc-access-security/><link crossorigin=anonymous href=/assets/css/stylesheet.026333dcafeaf3c82b8515026af0a6531c530abffdaf73d32779337b0ace14c0.css integrity="sha256-AmMz3K/q88grhRUCavCmUxxTCr/9r3PTJ3kzewrOFMA=" rel="preload stylesheet" as=style><link rel=icon href=https://cdn.jsdelivr.net/gh/kira-96/kira-96.github.io@gh-pages/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://cdn.jsdelivr.net/gh/kira-96/kira-96.github.io@gh-pages/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://cdn.jsdelivr.net/gh/kira-96/kira-96.github.io@gh-pages/favicon-32x32.png><link rel=apple-touch-icon href=https://cdn.jsdelivr.net/gh/kira-96/kira-96.github.io@gh-pages/icons/apple-icon-180x180.png><link rel=mask-icon href=https://cdn.jsdelivr.net/gh/kira-96/kira-96.github.io@gh-pages/icons/apple-icon-76x76.png><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=zh href=https://kira-96.github.io/posts/epics-ioc-access-security/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><link rel=manifest href=https://cdn.jsdelivr.net/gh/kira-96/kira-96.github.io@gh-pages/manifest.json><script src=https://fastly.jsdelivr.net/gh/stevenjoezhang/live2d-widget@latest/autoload.js></script><script type=text/javascript src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><meta property="og:url" content="https://kira-96.github.io/posts/epics-ioc-access-security/"><meta property="og:site_name" content="✨kiraの博客"><meta property="og:title" content="EPICS IOC 访问安全"><meta property="og:description" content="EPICS IOC 数据访问安全配置"><meta property="og:locale" content="zh"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2024-03-18T09:52:05+08:00"><meta property="article:modified_time" content="2024-10-09T11:25:49+08:00"><meta property="article:tag" content="Linux"><meta property="article:tag" content="EPICS"><meta name=twitter:card content="summary"><meta name=twitter:title content="EPICS IOC 访问安全"><meta name=twitter:description content="EPICS IOC 数据访问安全配置"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://kira-96.github.io/posts/"},{"@type":"ListItem","position":2,"name":"EPICS IOC 访问安全","item":"https://kira-96.github.io/posts/epics-ioc-access-security/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"EPICS IOC 访问安全","name":"EPICS IOC 访问安全","description":"EPICS IOC 数据访问安全配置","keywords":["linux","EPICS"],"articleBody":"原文：IOC Access Security\n功能 访问安全功能用于保护IOC数据库，限制来自未经授权的CA或pvAccess客户端访问。访问安全性基于以下几点：\nWho 客户端的用户ID（Channel Access/pvAccess）。\nWhere 用户登录的主机 ID。客户端运行的主机，但不会分辨用户是本地用户或远程登录到主机的用户。\nWhat 记录的各个字段都受到保护。每条记录都有一个字段包含记录的访问安全组（ASG）。每个字段都有一个访问安全级别（ASL0或ASL1）。安全级别在记录定义文件（.dbd）中定义。\nWhen 访问规则可以包含类似于CALC Record的输入计算。\n定义 ASL 访问安全级别\nASG 访问安全组\nUAG 用户访问组\nHAG 主机访问组\n快速上手 为了启用特定 IOC 的访问安全性，需要完成以下操作：\n创建访问安全文件（.acf） 可能需要修改IOC数据库 记录实例可能需要设置访问安全组ASG字段。如果ASG为空，记录将会使用“DEFAULT”访问安全组。\n访问安全文件可以在iocInit之后通过asSubInit和asSubProcess作为关联的子程序重新加载。将值1写入此记录将导致重新加载。\n必须启动脚本在的iocInit之前包含以下命令：\n1 2 3 4 asSetFilename(\"/full/path/to/accessSecurityFile\") /* 下面是一个可选命令 */ /* 使用宏替换 */ asSetSubstitutions(\"var1=sub1,var2=sub2,...\") 如果在iocInit之前未执行asSetFilename，就不会启用访问安全限制。\n如果给定asSetFilename，但在首次初始化访问安全性时发生错误，则对该IOC的所有访问都会被拒绝。\n成功启动访问安全性后，尝试重新启动时出现错误，将会保持上次的访问安全配置。\n启动IOC并启用访问安全后，可以通过asSetFilename、asSetSubstitutions和asInit来更改访问安全规则。也可以使用函数asInitialize、asInitFile和asInitFP。\n在启动IOC之后重新初始化访问安全配置操作是“非常昂贵”的操作，尽量不要这样做。\n访问安全配置文件 本节介绍包含用户访问组（UAG）、主机访问组（HAG）和访问安全组（ASG）。IOC会读取访问配置文件（建议使用扩展名.acf）然后创建访问配置数据库。首先给出一个简单的例子，然后是完整的语法描述。\n简单示例\n1 2 3 4 5 6 7 8 9 UAG(uag) {user1,user2} HAG(hag) {host1,host2} ASG(DEFAULT) { RULE(1,READ) RULE(1,WRITE) { UAG(uag) HAG(hag) } } 上面的规则提供了无限制的读权限（READ），而位于主机host1和host2上的用户user1和user2则拥有写权限（WRITE）。\n语法定义\n在以下描述中：\n[] 可选项\n| 备选项\n... 任意数量的定义\n元素、、、和可以是带引号或不带引号的字符串。\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 UAG(\u003cname\u003e) [{ \u003cuser\u003e [, \u003cuser\u003e ...] }] ... HAG(\u003cname\u003e) [{ \u003chost\u003e [, \u003chost\u003e ...] }] ... ASG(\u003cname\u003e) [{ [INP\u003cindex\u003e(\u003cpvname\u003e) ...] RULE(\u003clevel\u003e,NONE | READ | WRITE [, NOTRAPWRITE | TRAPWRITE]) { [UAG(\u003cname\u003e [,\u003cname\u003e ...])] [HAG(\u003cname\u003e [,\u003cname\u003e ...])] CALC(\u003ccalculation\u003e) } ... }] ... UAG：用户访问组。这是用户名列表，列表可以空。一个用户名可以出现在多个UAG中。用户名必须和运行CA客户端的主机上的用户名相同。对于vxWorks客户端，用户名通常取自引导参数的用户字段。\nHAG：主机访问组。这是主机名列表，列表可以空。同一主机名可以出现在多个HAG中。主机名必须和运行CA客户端的主机主机名相同。对于vxWorks客户端，主机名通常取自引导参数的目标名称。\nASG：访问安全组。DEFAULT是默认的访问安全组。\nINP：index必须是A到L中的一个值。类似于CALC record的INP字段。如果在ASG的规则中定义了CALC字段，则需要INP字段。\nRULE：定义访问权限必须为0或1。级别1字段的权限继承了级别0字段的权限。权限为NONE、READ和WRITE，WRITE也继承了READ权限。标准EPICS记录类型的所有字段除VAL、CMD（命令）和RES（重置）外都设置为1级。可选参数指定是否应捕获写入，如果未给定，则默认为NOTRAPWRITE。\nUAG指定可以访问的用户访问组列表。如果未定义UAG，则允许所有用户访问。\nHAG指定具有访问权限的主机访问组列表。如果未定义HAG，则允许所有主机访问。\nCALC与计算记录的CALC字段类似，但结果必须计算为TRUE或FALSE。只有当计算结果为TRUE才适用该规则（RULE），其中实际测试对于（0.99 \u003c result \u003c 1.01）为TRUE。任何其他结果都被认为FALSE，并将导致该规则被忽略。\n可以为ASG定义多条RULE，相同的RULE级别和访问权限也可以有多个。用于客户端的TRAPWRITE设置由通过规则检查的第一个WRITE规则确定。\n每个记录类型的字段都有一个关联的访问安全级别ASL0或ASL1（默认值）。操作员通常更改的字段被分配为ASL0，其他字段被分配给ASL1。例如，模拟输出记录的VAL字段被分配为ASL0，其他字段分配为ASL1。这是因为在正常操作过程中只应修改VAL字段。\n创建或修改访问配置文件后，可以使用ascheck命令查找语法错误：\n1 ascheck -S \"xxx=yyy,...\" \u003c \"filename\" -S表示使用宏替换。此命令会显示语法错误的位置，正确则不会有任何输出。\n实验 首先新建一个示例IOC。\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 $ mkdir example $ cd example/ $ makeBaseApp.pl -t example test $ makeBaseApp.pl -i -t example test The following target architectures are available in base: linux-loong64 linux-x86_64 What architecture do you want to use? linux-x86_64 The following applications are available: test What application should the IOC(s) boot? The default uses the IOC's name, even if not listed above. Application name? test $ make 然后创建访问安全配置文件accessSecurity.acf。\n1 2 cd iocBoot/ioctest/ touch accessSecurity.acf 修改配置文件内容，示例：\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 UAG(read) {deepin} UAG(write) {deepin} HAG(hosts) {LAPTOP-CTDCXXXX, 172.19.176.1} ASG(DEFAULT) { RULE(1,READ) RULE(1,WRITE) { HAG(hosts) } } ASG(deepin) { RULE(1,READ) { UAG(read,write) HAG(hosts) } RULE(1,WRITE,TRAPWRITE) { UAG(write) HAG(hosts) } } 稍微解释一下：\n创建了两个用户访问组（UAG），名称为read和write，两个用户访问组都只包含用户deepin。\n创建了一个主机访问组（HAG），名称为hosts，包含主机名LAPTOP-CTDCXXXX和一个IP地址。\n创建了默认（DEFAULT）访问安全组（ASG），不限制读取（READ）权限，只有hosts主机访问组的用户拥有写入（WRITE）权限。\n创建了访问安全组（ASG），名称为deepin，hosts主机访问组所包含主机上的deepin用户才拥有读取（READ）和写入（WRITE）权限。\n可以使用ascheck工具检查一下语法是否正确。\n1 ascheck accessSecurity.acf 然后还可以修改一下db文件，例：\n1 2 cd example/db/ vi dbExample2.db 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 record(ai, \"$(user):aiExample$(no)\") { field(DESC, \"Analog input No. $(no)\") field(INP, \"$(user):calcExample$(no).VAL NPP NMS\") field(EGUF, \"10\") field(EGU, \"Counts\") field(HOPR, \"10\") field(LOPR, \"0\") field(HIHI, \"8\") field(HIGH, \"6\") field(LOW, \"4\") field(LOLO, \"2\") field(HHSV, \"MAJOR\") field(HSV, \"MINOR\") field(LSV, \"MINOR\") field(LLSV, \"MAJOR\") +\tfield(ASG, \"deepin\") } alias(\"$(user):aiExample$(no)\",\"$(user):ai$(no)\") 这里指定$(user):aiExample$(no) record使用 deepin 访问安全组。\n最后，修改st.cmd来启用访问安全配置功能。\n1 2 cd example/iocBoot/ioctest/ vi st.cmd 1 2 3 4 5 6 7 8 9 #- Run this to trace the stages of iocInit #-traceIocInit + #- Set asCheckClientIP=1 to translate hostnames into IPs + var asCheckClientIP 1 + asSetFilename(\"${TOP}/iocBoot/${IOC}/accessSecurity.acf\") cd \"${TOP}/iocBoot/${IOC}\" iocInit 启动IOC。\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 cd example/iocBoot/ioctest/ ./st.cmd #!../../bin/linux-x86_64/test \u003c envPaths epicsEnvSet(\"IOC\",\"ioctest\") epicsEnvSet(\"TOP\",\"/home/deepin/example\") epicsEnvSet(\"EPICS_BASE\",\"/usr/local/epics/base-7.0.8\") epicsEnvSet(\"EPICS_HOST_ARCH\", \"linux-x86_64\") cd \"/home/deepin/example\" ## Register all support components dbLoadDatabase \"dbd/test.dbd\" test_registerRecordDeviceDriver pdbbase ## Load record instances dbLoadTemplate \"db/user.substitutions\" dbLoadRecords \"db/testVersion.db\", \"user=deepin\" dbLoadRecords \"db/dbSubExample.db\", \"user=deepin\" asSetFilename(\"/home/deepin/example/iocBoot/ioctest/accessSecurity.acf\") cd \"/home/deepin/example/iocBoot/ioctest\" iocInit Starting iocInit ############################################################################ ## EPICS R7.0.8 ## Rev. 2024-03-01T16:27+0800 ## Rev. Date build date/time: ############################################################################ iocRun: All initialization complete ## Start any sequence programs #seq sncExample, \"user=deepin\" epics\u003e 然后打开一个新的终端窗口进行测试。\n注意，我这里的主机名是LAPTOP-CTDCXXXX，主机有两个用户deepin和root。\n分别使用两个用户访问使用默认（DEFAULT）和名为deepin访问安全组的变量。\n1 2 3 4 deepin@LAPTOP-CTDCXXXX:~$ caget deepin:circle:angle deepin:circle:angle 186 deepin@LAPTOP-CTDCXXXX:~$ caget deepin:aiExample1 deepin:aiExample1 6 用户deepin对使用不同访问安全组的变量都可以访问。\n1 2 3 4 5 6 7 8 # 使用root用户 deepin@LAPTOP-CTDCXXXX:~$ sudo su root@LAPTOP-CTDCXXXX:/home/deepin# caget deepin:circle:angle deepin:circle:angle 55 root@LAPTOP-CTDCXXXX:/home/deepin# caget deepin:aiExample1 Read operation timed out: some PV data was not read. deepin:aiExample1 *** no read access 用户root可以访问使用默认（DEFAULT）访问安全组的变量，而不可访问使用名为deepin访问安全组的变量。\n测试结果与编写的访问安全配置规则相符合，说明访问安全配置成功。\n不过，此次实验只测试了本机上的不同用户，对于更为复杂的控制系统的数据安全访问权限，则需要做更完善的安全配置。\n","wordCount":"580","inLanguage":"zh","datePublished":"2024-03-18T09:52:05+08:00","dateModified":"2024-10-09T11:25:49+08:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://kira-96.github.io/posts/epics-ioc-access-security/"},"publisher":{"@type":"Organization","name":"✨kiraの博客","logo":{"@type":"ImageObject","url":"https://cdn.jsdelivr.net/gh/kira-96/kira-96.github.io@gh-pages/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://kira-96.github.io/ accesskey=h title="✨kiraの博客 (Alt + H)">✨kiraの博客</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)" aria-label="Toggle theme"><svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://kira-96.github.io/ title=🏠主页><span>🏠主页</span></a></li><li><a href=https://kira-96.github.io/notes/ title=📓笔记><span>📓笔记</span></a></li><li><a href=https://kira-96.github.io/search/ title=🔍️搜索><span>🔍️搜索</span></a></li><li><a href=https://kira-96.github.io/archives/ title=🗃️存档><span>🗃️存档</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://kira-96.github.io/>主页</a>&nbsp;»&nbsp;<a href=https://kira-96.github.io/posts/>Posts</a></div><h1 class="post-title entry-hint-parent">EPICS IOC 访问安全</h1><div class=post-description>EPICS IOC 数据访问安全配置</div><div class=post-meta><span title='2024-03-18 09:52:05 +0800 +0800'>三月 18, 2024</span>&nbsp;·&nbsp;3 分钟&nbsp;·&nbsp;580 字&nbsp;|&nbsp;<a href=https://github.com/kira-96/kira-96.github.io/tree/main/content/posts/ rel="noopener noreferrer" target=_blank>✏️编辑</a></div></header><aside id=toc-container class="toc-container wide"><div class=toc><details open><summary accesskey=c title="(Alt + C)"><span class=details>目录</span></summary><div class=inner><ul><li><a href=#%e5%8a%9f%e8%83%bd aria-label=功能>功能</a></li><li><a href=#%e5%ae%9a%e4%b9%89 aria-label=定义>定义</a></li><li><a href=#%e5%bf%ab%e9%80%9f%e4%b8%8a%e6%89%8b aria-label=快速上手>快速上手</a></li><li><a href=#%e8%ae%bf%e9%97%ae%e5%ae%89%e5%85%a8%e9%85%8d%e7%bd%ae%e6%96%87%e4%bb%b6 aria-label=访问安全配置文件>访问安全配置文件</a></li><li><a href=#%e5%ae%9e%e9%aa%8c aria-label=实验>实验</a></li></ul></div></details></div></aside><script>let activeElement,elements;window.addEventListener("DOMContentLoaded",function(){checkTocPosition(),elements=document.querySelectorAll("h1[id],h2[id],h3[id],h4[id],h5[id],h6[id]"),activeElement=elements[0];const t=encodeURI(activeElement.getAttribute("id")).toLowerCase();document.querySelector(`.inner ul li a[href="#${t}"]`).classList.add("active")},!1),window.addEventListener("resize",function(){checkTocPosition()},!1),window.addEventListener("scroll",()=>{activeElement=Array.from(elements).find(e=>{if(getOffsetTop(e)-window.pageYOffset>0&&getOffsetTop(e)-window.pageYOffset<window.innerHeight/2)return e})||activeElement,elements.forEach(e=>{const t=encodeURI(e.getAttribute("id")).toLowerCase();e===activeElement?document.querySelector(`.inner ul li a[href="#${t}"]`).classList.add("active"):document.querySelector(`.inner ul li a[href="#${t}"]`).classList.remove("active")})},!1);const main=parseInt(getComputedStyle(document.body).getPropertyValue("--article-width"),10),toc=parseInt(getComputedStyle(document.body).getPropertyValue("--toc-width"),10),gap=parseInt(getComputedStyle(document.body).getPropertyValue("--gap"),10);function checkTocPosition(){const e=document.body.scrollWidth;e-main-toc*2-gap*4>0?document.getElementById("toc-container").classList.add("wide"):document.getElementById("toc-container").classList.remove("wide")}function getOffsetTop(e){if(!e.getClientRects().length)return 0;let t=e.getBoundingClientRect(),n=e.ownerDocument.defaultView;return t.top+n.pageYOffset}</script><div class=post-content><p>原文：<a href=https://docs.epics-controls.org/en/latest/appdevguide/AccessSecurity.html>IOC Access Security</a></p><h3 id=功能>功能<a hidden class=anchor aria-hidden=true href=#功能>#</a></h3><p>访问安全功能用于保护IOC数据库，限制来自未经授权的CA或pvAccess客户端访问。访问安全性基于以下几点：</p><p><strong>Who</strong> 客户端的用户ID（Channel Access/pvAccess）。<br><strong>Where</strong> 用户登录的主机 ID。客户端运行的主机，但不会分辨用户是本地用户或远程登录到主机的用户。<br><strong>What</strong> 记录的各个字段都受到保护。每条记录都有一个字段包含记录的访问安全组（ASG）。每个字段都有一个访问安全级别（ASL0或ASL1）。安全级别在记录定义文件（.dbd）中定义。<br><strong>When</strong> 访问规则可以包含类似于CALC Record的输入计算。</p><h3 id=定义>定义<a hidden class=anchor aria-hidden=true href=#定义>#</a></h3><p><strong>ASL</strong> 访问安全级别<br><strong>ASG</strong> 访问安全组<br><strong>UAG</strong> 用户访问组<br><strong>HAG</strong> 主机访问组</p><h3 id=快速上手>快速上手<a hidden class=anchor aria-hidden=true href=#快速上手>#</a></h3><p>为了启用特定 IOC 的访问安全性，需要完成以下操作：</p><ul><li>创建访问安全文件（.acf）</li><li>可能需要修改IOC数据库</li></ul><p>记录实例可能需要设置访问安全组<code>ASG</code>字段。如果<code>ASG</code>为空，记录将会使用“<code>DEFAULT</code>”访问安全组。</p><p>访问安全文件可以在<code>iocInit</code>之后通过<code>asSubInit</code>和<code>asSubProcess</code>作为关联的子程序重新加载。将值<em>1</em>写入此记录将导致重新加载。</p><p>必须启动脚本在的<code>iocInit</code>之前包含以下命令：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=nf>asSetFilename</span><span class=p>(</span><span class=s>&#34;/full/path/to/accessSecurityFile&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=cm>/* 下面是一个可选命令 */</span>
</span></span><span class=line><span class=cl><span class=cm>/* 使用宏替换 */</span>
</span></span><span class=line><span class=cl><span class=nf>asSetSubstitutions</span><span class=p>(</span><span class=s>&#34;var1=sub1,var2=sub2,...&#34;</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><p>如果在<code>iocInit</code>之前未执行<code>asSetFilename</code>，就不会启用访问安全限制。</p><p>如果给定<code>asSetFilename</code>，但在首次初始化访问安全性时发生错误，则对该IOC的所有访问都会被拒绝。</p><p>成功启动访问安全性后，尝试重新启动时出现错误，将会保持上次的访问安全配置。</p><p>启动IOC并启用访问安全后，可以通过<code>asSetFilename</code>、<code>asSetSubstitutions</code>和<code>asInit</code>来更改访问安全规则。也可以使用函数<code>asInitialize</code>、<code>asInitFile</code>和<code>asInitFP</code>。<br><strong>在启动IOC之后重新初始化访问安全配置操作是“非常昂贵”的操作，尽量不要这样做。</strong></p><h3 id=访问安全配置文件>访问安全配置文件<a hidden class=anchor aria-hidden=true href=#访问安全配置文件>#</a></h3><p>本节介绍包含用户访问组（UAG）、主机访问组（HAG）和访问安全组（ASG）。IOC会读取访问配置文件（建议使用扩展名.acf）然后创建访问配置数据库。首先给出一个简单的例子，然后是完整的语法描述。</p><p><strong>简单示例</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span><span class=lnt>9
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=nf>UAG</span><span class=p>(</span><span class=n>uag</span><span class=p>)</span> <span class=p>{</span><span class=n>user1</span><span class=p>,</span><span class=n>user2</span><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=nf>HAG</span><span class=p>(</span><span class=n>hag</span><span class=p>)</span> <span class=p>{</span><span class=n>host1</span><span class=p>,</span><span class=n>host2</span><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=nf>ASG</span><span class=p>(</span><span class=n>DEFAULT</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nf>RULE</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span><span class=n>READ</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=nf>RULE</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span><span class=n>WRITE</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=nf>UAG</span><span class=p>(</span><span class=n>uag</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=nf>HAG</span><span class=p>(</span><span class=n>hag</span><span class=p>)</span>
</span></span><span class=line><span class=cl>       <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>上面的规则提供了无限制的读权限（READ），而位于主机<code>host1</code>和<code>host2</code>上的用户<code>user1</code>和<code>user2</code>则拥有写权限（WRITE）。</p><p><strong>语法定义</strong></p><p>在以下描述中：</p><p><code>[]</code> 可选项<br><code>|</code> 备选项<br><code>...</code> 任意数量的定义</p><p>元素<code>&lt;name></code>、<code>&lt;user></code>、<code>&lt;host></code>、<code>&lt;pvname></code>和<code>&lt;calculation></code>可以是带引号或不带引号的字符串。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=nf>UAG</span><span class=p>(</span><span class=o>&lt;</span><span class=n>name</span><span class=o>&gt;</span><span class=p>)</span> <span class=p>[{</span> <span class=o>&lt;</span><span class=n>user</span><span class=o>&gt;</span> <span class=p>[,</span> <span class=o>&lt;</span><span class=n>user</span><span class=o>&gt;</span> <span class=p>...]</span> <span class=p>}]</span>
</span></span><span class=line><span class=cl><span class=p>...</span>
</span></span><span class=line><span class=cl><span class=nf>HAG</span><span class=p>(</span><span class=o>&lt;</span><span class=n>name</span><span class=o>&gt;</span><span class=p>)</span> <span class=p>[{</span> <span class=o>&lt;</span><span class=n>host</span><span class=o>&gt;</span> <span class=p>[,</span> <span class=o>&lt;</span><span class=n>host</span><span class=o>&gt;</span> <span class=p>...]</span> <span class=p>}]</span>
</span></span><span class=line><span class=cl><span class=p>...</span>
</span></span><span class=line><span class=cl><span class=nf>ASG</span><span class=p>(</span><span class=o>&lt;</span><span class=n>name</span><span class=o>&gt;</span><span class=p>)</span> <span class=p>[{</span>
</span></span><span class=line><span class=cl>    <span class=p>[</span><span class=n>INP</span><span class=o>&lt;</span><span class=n>index</span><span class=o>&gt;</span><span class=p>(</span><span class=o>&lt;</span><span class=n>pvname</span><span class=o>&gt;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>...]</span>
</span></span><span class=line><span class=cl>    <span class=nf>RULE</span><span class=p>(</span><span class=o>&lt;</span><span class=n>level</span><span class=o>&gt;</span><span class=p>,</span><span class=n>NONE</span> <span class=o>|</span> <span class=n>READ</span> <span class=o>|</span> <span class=n>WRITE</span> <span class=p>[,</span> <span class=n>NOTRAPWRITE</span> <span class=o>|</span> <span class=n>TRAPWRITE</span><span class=p>])</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=p>[</span><span class=nf>UAG</span><span class=p>(</span><span class=o>&lt;</span><span class=n>name</span><span class=o>&gt;</span> <span class=p>[,</span><span class=o>&lt;</span><span class=n>name</span><span class=o>&gt;</span> <span class=p>...])]</span>
</span></span><span class=line><span class=cl>        <span class=p>[</span><span class=nf>HAG</span><span class=p>(</span><span class=o>&lt;</span><span class=n>name</span><span class=o>&gt;</span> <span class=p>[,</span><span class=o>&lt;</span><span class=n>name</span><span class=o>&gt;</span> <span class=p>...])]</span>
</span></span><span class=line><span class=cl>        <span class=nf>CALC</span><span class=p>(</span><span class=o>&lt;</span><span class=n>calculation</span><span class=o>&gt;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>...</span>
</span></span><span class=line><span class=cl><span class=p>}]</span>
</span></span><span class=line><span class=cl><span class=p>...</span>
</span></span></code></pre></td></tr></table></div></div><p><strong>UAG</strong>：用户访问组。这是用户名列表，列表可以空。一个用户名可以出现在多个UAG中。用户名必须和运行CA客户端的主机上的用户名相同。对于vxWorks客户端，用户名通常取自引导参数的用户字段。</p><p><strong>HAG</strong>：主机访问组。这是主机名列表，列表可以空。同一主机名可以出现在多个HAG中。主机名必须和运行CA客户端的主机主机名相同。对于vxWorks客户端，主机名通常取自引导参数的目标名称。</p><p><strong>ASG</strong>：访问安全组。<code>DEFAULT</code>是默认的访问安全组。</p><p><strong>INP<code>&lt;index></code></strong>：<code>index</code>必须是A到L中的一个值。类似于CALC record的INP字段。如果在ASG的规则中定义了CALC字段，则需要INP字段。</p><p><strong>RULE</strong>：定义访问权限<code>&lt;level></code>必须为<code>0</code>或<code>1</code>。级别<code>1</code>字段的权限继承了级别<code>0</code>字段的权限。权限为<code>NONE</code>、<code>READ</code>和<code>WRITE</code>，<code>WRITE</code>也继承了<code>READ</code>权限。标准EPICS记录类型的所有字段除<code>VAL</code>、<code>CMD</code>（命令）和<code>RES</code>（重置）外都设置为1级。可选参数指定是否应捕获写入，如果未给定，则默认为<code>NOTRAPWRITE</code>。</p><p><code>UAG</code>指定可以访问的用户访问组列表。如果未定义UAG，则允许所有用户访问。</p><p><code>HAG</code>指定具有访问权限的主机访问组列表。如果未定义HAG，则允许所有主机访问。</p><p><code>CALC</code>与计算记录的<code>CALC</code>字段类似，但结果必须计算为<code>TRUE</code>或<code>FALSE</code>。只有当计算结果为<code>TRUE</code>才适用该规则（RULE），其中实际测试对于（0.99 &lt; result &lt; 1.01）为<code>TRUE</code>。任何其他结果都被认为<code>FALSE</code>，并将导致该规则被忽略。</p><p>可以为ASG定义多条RULE，相同的RULE级别和访问权限也可以有多个。用于客户端的TRAPWRITE设置由通过规则检查的第一个WRITE规则确定。</p><p>每个记录类型的字段都有一个关联的访问安全级别<code>ASL0</code>或<code>ASL1</code>（默认值）。操作员通常更改的字段被分配为<code>ASL0</code>，其他字段被分配给<code>ASL1</code>。例如，模拟输出记录的<code>VAL</code>字段被分配为<code>ASL0</code>，其他字段分配为<code>ASL1</code>。这是因为在正常操作过程中只应修改<code>VAL</code>字段。</p><p>创建或修改访问配置文件后，可以使用<code>ascheck</code>命令查找语法错误：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>ascheck -S <span class=s2>&#34;xxx=yyy,...&#34;</span> &lt; <span class=s2>&#34;filename&#34;</span>
</span></span></code></pre></td></tr></table></div></div><p><code>-S</code>表示使用宏替换。此命令会显示语法错误的位置，正确则不会有任何输出。</p><h3 id=实验>实验<a hidden class=anchor aria-hidden=true href=#实验>#</a></h3><p>首先新建一个示例IOC。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>$ mkdir example
</span></span><span class=line><span class=cl>$ <span class=nb>cd</span> example/
</span></span><span class=line><span class=cl>$ makeBaseApp.pl -t example <span class=nb>test</span>
</span></span><span class=line><span class=cl>$ makeBaseApp.pl -i -t example <span class=nb>test</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>The following target architectures are available in base:
</span></span><span class=line><span class=cl>    linux-loong64
</span></span><span class=line><span class=cl>    linux-x86_64
</span></span><span class=line><span class=cl>What architecture <span class=k>do</span> you want to use? linux-x86_64
</span></span><span class=line><span class=cl>The following applications are available:
</span></span><span class=line><span class=cl>    <span class=nb>test</span>
</span></span><span class=line><span class=cl>What application should the IOC<span class=o>(</span>s<span class=o>)</span> boot?
</span></span><span class=line><span class=cl>The default uses the IOC<span class=err>&#39;</span>s name, even <span class=k>if</span> not listed above.
</span></span><span class=line><span class=cl>Application name? <span class=nb>test</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>$ make
</span></span></code></pre></td></tr></table></div></div><p>然后创建访问安全配置文件<em>accessSecurity.acf</em>。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl><span class=nb>cd</span> iocBoot/ioctest/
</span></span><span class=line><span class=cl>touch accessSecurity.acf
</span></span></code></pre></td></tr></table></div></div><p>修改配置文件内容，示例：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=nf>UAG</span><span class=p>(</span><span class=n>read</span><span class=p>)</span> <span class=p>{</span><span class=n>deepin</span><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=nf>UAG</span><span class=p>(</span><span class=n>write</span><span class=p>)</span> <span class=p>{</span><span class=n>deepin</span><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=nf>HAG</span><span class=p>(</span><span class=n>hosts</span><span class=p>)</span> <span class=p>{</span><span class=n>LAPTOP</span><span class=o>-</span><span class=n>CTDCXXXX</span><span class=p>,</span> <span class=mf>172.19.176.1</span><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nf>ASG</span><span class=p>(</span><span class=n>DEFAULT</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=nf>RULE</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span><span class=n>READ</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=nf>RULE</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span><span class=n>WRITE</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=nf>HAG</span><span class=p>(</span><span class=n>hosts</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=nf>ASG</span><span class=p>(</span><span class=n>deepin</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=nf>RULE</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span><span class=n>READ</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=nf>UAG</span><span class=p>(</span><span class=n>read</span><span class=p>,</span><span class=n>write</span><span class=p>)</span>
</span></span><span class=line><span class=cl>		<span class=nf>HAG</span><span class=p>(</span><span class=n>hosts</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=nf>RULE</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span><span class=n>WRITE</span><span class=p>,</span><span class=n>TRAPWRITE</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=nf>UAG</span><span class=p>(</span><span class=n>write</span><span class=p>)</span>
</span></span><span class=line><span class=cl>		<span class=nf>HAG</span><span class=p>(</span><span class=n>hosts</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>稍微解释一下：<br>创建了两个<strong>用户访问组</strong>（UAG），名称为read和write，两个用户访问组都只包含用户<em>deepin</em>。<br>创建了一个<strong>主机访问组</strong>（HAG），名称为hosts，包含主机名<em>LAPTOP-CTDCXXXX</em>和一个IP地址。<br>创建了默认（DEFAULT）<strong>访问安全组</strong>（ASG），不限制读取（READ）权限，只有hosts主机访问组的用户拥有写入（WRITE）权限。<br>创建了<strong>访问安全组</strong>（ASG），名称为deepin，hosts主机访问组所包含主机上的deepin用户才拥有读取（READ）和写入（WRITE）权限。</p><p>可以使用<code>ascheck</code>工具检查一下语法是否正确。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>ascheck accessSecurity.acf
</span></span></code></pre></td></tr></table></div></div><p>然后还可以修改一下db文件，例：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl><span class=nb>cd</span> example/db/
</span></span><span class=line><span class=cl>vi dbExample2.db
</span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-diff data-lang=diff><span class=line><span class=cl>record(ai, &#34;$(user):aiExample$(no)&#34;)
</span></span><span class=line><span class=cl>{
</span></span><span class=line><span class=cl>	field(DESC, &#34;Analog input No. $(no)&#34;)
</span></span><span class=line><span class=cl>	field(INP, &#34;$(user):calcExample$(no).VAL NPP NMS&#34;)
</span></span><span class=line><span class=cl>	field(EGUF, &#34;10&#34;)
</span></span><span class=line><span class=cl>	field(EGU, &#34;Counts&#34;)
</span></span><span class=line><span class=cl>	field(HOPR, &#34;10&#34;)
</span></span><span class=line><span class=cl>	field(LOPR, &#34;0&#34;)
</span></span><span class=line><span class=cl>	field(HIHI, &#34;8&#34;)
</span></span><span class=line><span class=cl>	field(HIGH, &#34;6&#34;)
</span></span><span class=line><span class=cl>	field(LOW, &#34;4&#34;)
</span></span><span class=line><span class=cl>	field(LOLO, &#34;2&#34;)
</span></span><span class=line><span class=cl>	field(HHSV, &#34;MAJOR&#34;)
</span></span><span class=line><span class=cl>	field(HSV, &#34;MINOR&#34;)
</span></span><span class=line><span class=cl>	field(LSV, &#34;MINOR&#34;)
</span></span><span class=line><span class=cl>	field(LLSV, &#34;MAJOR&#34;)
</span></span><span class=line><span class=cl><span class=gi>+	field(ASG, &#34;deepin&#34;)
</span></span></span><span class=line><span class=cl><span class=gi></span>}
</span></span><span class=line><span class=cl>alias(&#34;$(user):aiExample$(no)&#34;,&#34;$(user):ai$(no)&#34;)
</span></span></code></pre></td></tr></table></div></div><p>这里指定<code>$(user):aiExample$(no)</code> record使用 <em>deepin</em> <strong>访问安全组</strong>。</p><p>最后，修改<em>st.cmd</em>来启用访问安全配置功能。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl><span class=nb>cd</span> example/iocBoot/ioctest/
</span></span><span class=line><span class=cl>vi st.cmd
</span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span><span class=lnt>9
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-diff data-lang=diff><span class=line><span class=cl>  #- Run this to trace the stages of iocInit
</span></span><span class=line><span class=cl>  #-traceIocInit
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=gi>+ #- Set asCheckClientIP=1 to translate hostnames into IPs
</span></span></span><span class=line><span class=cl><span class=gi>+ var asCheckClientIP 1
</span></span></span><span class=line><span class=cl><span class=gi>+ asSetFilename(&#34;${TOP}/iocBoot/${IOC}/accessSecurity.acf&#34;)
</span></span></span><span class=line><span class=cl><span class=gi></span>
</span></span><span class=line><span class=cl>  cd &#34;${TOP}/iocBoot/${IOC}&#34;
</span></span><span class=line><span class=cl>  iocInit
</span></span></code></pre></td></tr></table></div></div><p>启动IOC。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl><span class=nb>cd</span> example/iocBoot/ioctest/
</span></span><span class=line><span class=cl>./st.cmd
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>#!../../bin/linux-x86_64/test</span>
</span></span><span class=line><span class=cl>&lt; envPaths
</span></span><span class=line><span class=cl>epicsEnvSet<span class=o>(</span><span class=s2>&#34;IOC&#34;</span>,<span class=s2>&#34;ioctest&#34;</span><span class=o>)</span>
</span></span><span class=line><span class=cl>epicsEnvSet<span class=o>(</span><span class=s2>&#34;TOP&#34;</span>,<span class=s2>&#34;/home/deepin/example&#34;</span><span class=o>)</span>
</span></span><span class=line><span class=cl>epicsEnvSet<span class=o>(</span><span class=s2>&#34;EPICS_BASE&#34;</span>,<span class=s2>&#34;/usr/local/epics/base-7.0.8&#34;</span><span class=o>)</span>
</span></span><span class=line><span class=cl>epicsEnvSet<span class=o>(</span><span class=s2>&#34;EPICS_HOST_ARCH&#34;</span>, <span class=s2>&#34;linux-x86_64&#34;</span><span class=o>)</span>
</span></span><span class=line><span class=cl><span class=nb>cd</span> <span class=s2>&#34;/home/deepin/example&#34;</span>
</span></span><span class=line><span class=cl><span class=c1>## Register all support components</span>
</span></span><span class=line><span class=cl>dbLoadDatabase <span class=s2>&#34;dbd/test.dbd&#34;</span>
</span></span><span class=line><span class=cl>test_registerRecordDeviceDriver pdbbase
</span></span><span class=line><span class=cl><span class=c1>## Load record instances</span>
</span></span><span class=line><span class=cl>dbLoadTemplate <span class=s2>&#34;db/user.substitutions&#34;</span>
</span></span><span class=line><span class=cl>dbLoadRecords <span class=s2>&#34;db/testVersion.db&#34;</span>, <span class=s2>&#34;user=deepin&#34;</span>
</span></span><span class=line><span class=cl>dbLoadRecords <span class=s2>&#34;db/dbSubExample.db&#34;</span>, <span class=s2>&#34;user=deepin&#34;</span>
</span></span><span class=line><span class=cl>asSetFilename<span class=o>(</span><span class=s2>&#34;/home/deepin/example/iocBoot/ioctest/accessSecurity.acf&#34;</span><span class=o>)</span>
</span></span><span class=line><span class=cl><span class=nb>cd</span> <span class=s2>&#34;/home/deepin/example/iocBoot/ioctest&#34;</span>
</span></span><span class=line><span class=cl>iocInit
</span></span><span class=line><span class=cl>Starting iocInit
</span></span><span class=line><span class=cl><span class=c1>############################################################################</span>
</span></span><span class=line><span class=cl><span class=c1>## EPICS R7.0.8</span>
</span></span><span class=line><span class=cl><span class=c1>## Rev. 2024-03-01T16:27+0800</span>
</span></span><span class=line><span class=cl><span class=c1>## Rev. Date build date/time:</span>
</span></span><span class=line><span class=cl><span class=c1>############################################################################</span>
</span></span><span class=line><span class=cl>iocRun: All initialization <span class=nb>complete</span>
</span></span><span class=line><span class=cl><span class=c1>## Start any sequence programs</span>
</span></span><span class=line><span class=cl><span class=c1>#seq sncExample, &#34;user=deepin&#34;</span>
</span></span><span class=line><span class=cl>epics&gt;
</span></span></code></pre></td></tr></table></div></div><p>然后打开一个新的终端窗口进行测试。<br>注意，我这里的主机名是<em>LAPTOP-CTDCXXXX</em>，主机有两个用户<em>deepin</em>和<em>root</em>。<br>分别使用两个用户访问使用默认（DEFAULT）和名为deepin<strong>访问安全组</strong>的变量。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>deepin@LAPTOP-CTDCXXXX:~$ caget deepin:circle:angle
</span></span><span class=line><span class=cl>deepin:circle:angle            <span class=m>186</span>
</span></span><span class=line><span class=cl>deepin@LAPTOP-CTDCXXXX:~$ caget deepin:aiExample1
</span></span><span class=line><span class=cl>deepin:aiExample1              <span class=m>6</span>
</span></span></code></pre></td></tr></table></div></div><p>用户<em>deepin</em>对使用不同<strong>访问安全组</strong>的变量都可以访问。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl><span class=c1># 使用root用户</span>
</span></span><span class=line><span class=cl>deepin@LAPTOP-CTDCXXXX:~$ sudo su
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>root@LAPTOP-CTDCXXXX:/home/deepin# caget deepin:circle:angle
</span></span><span class=line><span class=cl>deepin:circle:angle            <span class=m>55</span>
</span></span><span class=line><span class=cl>root@LAPTOP-CTDCXXXX:/home/deepin# caget deepin:aiExample1
</span></span><span class=line><span class=cl>Read operation timed out: some PV data was not read.
</span></span><span class=line><span class=cl>deepin:aiExample1              *** no <span class=nb>read</span> access
</span></span></code></pre></td></tr></table></div></div><p>用户<em>root</em>可以访问使用默认（DEFAULT）<strong>访问安全组</strong>的变量，而不可访问使用名为deepin<strong>访问安全组</strong>的变量。</p><p>测试结果与编写的访问安全配置规则相符合，说明访问安全配置成功。</p><p>不过，此次实验只测试了本机上的不同用户，对于更为复杂的控制系统的数据安全访问权限，则需要做更完善的安全配置。</p></div><footer class=post-footer><ul class=post-tags><li><a href=https://kira-96.github.io/tags/linux/>Linux</a></li><li><a href=https://kira-96.github.io/tags/epics/>EPICS</a></li></ul><nav class=paginav><a class=prev href=https://kira-96.github.io/posts/epics-ioc-gpio-device-support/><span class=title>« 上一页</span><br><span>EPICS IOC GPIO设备支持的使用</span>
</a><a class=next href=https://kira-96.github.io/posts/%E9%BE%99%E8%8A%AF%E5%BC%80%E5%8F%91%E6%9D%BF%E7%A7%BB%E6%A4%8Digh-ethercat-master/><span class=title>下一页 »</span><br><span>龙芯开发板移植 IgH EtherCAT Master</span></a></nav></footer><script src=https://utteranc.es/client.js repo=kira-96/kira-96.github.io issue-term=pathname theme=github-light crossorigin=anonymous async></script></article></main><footer class=footer><span>© 2019-2025 <a href=/>kira&rsquo;s blog</a></span> ·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="复制";function s(){t.innerHTML="已复制！",setTimeout(()=>{t.innerHTML="复制"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>