<!doctype html><html lang=zh dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>é¾™èŠ¯å¼€å‘æ¿ç§»æ¤ IgH EtherCAT Master | âœ¨kiraã®åšå®¢</title>
<meta name=keywords content="linux,EPICS,EtherCAT,é¾™èŠ¯"><meta name=description content="é¾™èŠ¯2K0500å¼€å‘æ¿ç§»æ¤EtherCATä¸»ç«™ç¨‹åºå’ŒEPICS EtherCATæ¨¡å—"><meta name=author content><link rel=canonical href=https://kira-96.github.io/posts/%E9%BE%99%E8%8A%AF%E5%BC%80%E5%8F%91%E6%9D%BF%E7%A7%BB%E6%A4%8Digh-ethercat-master/><link crossorigin=anonymous href=/assets/css/stylesheet.3885277a87a498ed2522e7ff68054e29ab8db4095b653379837d1193311cfcc9.css integrity="sha256-OIUneoekmO0lIuf/aAVOKauNtAlbZTN5g30RkzEc/Mk=" rel="preload stylesheet" as=style><link rel=icon href=https://cdn.jsdelivr.net/gh/kira-96/kira-96.github.io@gh-pages/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://cdn.jsdelivr.net/gh/kira-96/kira-96.github.io@gh-pages/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://cdn.jsdelivr.net/gh/kira-96/kira-96.github.io@gh-pages/favicon-32x32.png><link rel=apple-touch-icon href=https://cdn.jsdelivr.net/gh/kira-96/kira-96.github.io@gh-pages/icons/apple-icon-180x180.png><link rel=mask-icon href=https://cdn.jsdelivr.net/gh/kira-96/kira-96.github.io@gh-pages/icons/apple-icon-76x76.png><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=zh href=https://kira-96.github.io/posts/%E9%BE%99%E8%8A%AF%E5%BC%80%E5%8F%91%E6%9D%BF%E7%A7%BB%E6%A4%8Digh-ethercat-master/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><link rel=manifest href=https://cdn.jsdelivr.net/gh/kira-96/kira-96.github.io@gh-pages/manifest.json><script src=https://fastly.jsdelivr.net/gh/stevenjoezhang/live2d-widget@latest/autoload.js></script><script type=text/javascript src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><meta property="og:title" content="é¾™èŠ¯å¼€å‘æ¿ç§»æ¤ IgH EtherCAT Master"><meta property="og:description" content="é¾™èŠ¯2K0500å¼€å‘æ¿ç§»æ¤EtherCATä¸»ç«™ç¨‹åºå’ŒEPICS EtherCATæ¨¡å—"><meta property="og:type" content="article"><meta property="og:url" content="https://kira-96.github.io/posts/%E9%BE%99%E8%8A%AF%E5%BC%80%E5%8F%91%E6%9D%BF%E7%A7%BB%E6%A4%8Digh-ethercat-master/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2024-02-23T12:54:31+08:00"><meta property="article:modified_time" content="2024-03-12T15:57:25+08:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="é¾™èŠ¯å¼€å‘æ¿ç§»æ¤ IgH EtherCAT Master"><meta name=twitter:description content="é¾™èŠ¯2K0500å¼€å‘æ¿ç§»æ¤EtherCATä¸»ç«™ç¨‹åºå’ŒEPICS EtherCATæ¨¡å—"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://kira-96.github.io/posts/"},{"@type":"ListItem","position":2,"name":"é¾™èŠ¯å¼€å‘æ¿ç§»æ¤ IgH EtherCAT Master","item":"https://kira-96.github.io/posts/%E9%BE%99%E8%8A%AF%E5%BC%80%E5%8F%91%E6%9D%BF%E7%A7%BB%E6%A4%8Digh-ethercat-master/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"é¾™èŠ¯å¼€å‘æ¿ç§»æ¤ IgH EtherCAT Master","name":"é¾™èŠ¯å¼€å‘æ¿ç§»æ¤ IgH EtherCAT Master","description":"é¾™èŠ¯2K0500å¼€å‘æ¿ç§»æ¤EtherCATä¸»ç«™ç¨‹åºå’ŒEPICS EtherCATæ¨¡å—","keywords":["linux","EPICS","EtherCAT","é¾™èŠ¯"],"articleBody":"å‰è¨€ IgH EtherCAT Master æ˜¯ä¸€ä¸ªå¼€æºçš„EtherCATä¸»ç«™é©±åŠ¨ç¨‹åºï¼Œç”¨äºç®¡ç†EtherCATä»ç«™è®¾å¤‡ï¼Œæ”¯æŒLinuxæ“ä½œç³»ç»Ÿï¼Œå·¥æ§ä¸Šä½¿ç”¨çš„æ¯”è¾ƒå¤šã€‚\ndls ethercatæ˜¯ç”±è‹±å›½é’»çŸ³å…‰æºå¼€å‘çš„ç”¨äº EPICS æ§åˆ¶ç³»ç»Ÿ EtherCAT è®¾å¤‡çš„æ”¯æŒç¨‹åºï¼ŒåŸºäº IgH Master ä¸»ç«™ç¨‹åºå¼€å‘ï¼Œå®ç°å¯¹ EtherCAT æ€»çº¿è®¾å¤‡çš„è¯»å†™ã€‚\näº¤å‰ç¼–è¯‘ç¯å¢ƒï¼šUbuntu\nè¿è¡Œå¼€å‘æ¿ï¼šé¾™èŠ¯2K0500é‡‘é¾™å¼€å‘æ¿\nå†…æ ¸ç‰ˆæœ¬ï¼šLinux LS-GD 5.10.0-rt17.lsgd #1 PREEMPT_RT\nç›¸å…³è½¯ä»¶åŒ…ä¸‹è½½åœ°å€ epics-base - (launchpad.net) / epics-base/epics-base / EPICS Base (anl.gov)\nepics-modules/asyn: EPICS module for driver and device support\nepics-modules/busy: APS BCDA synApps module: busy\nepics-modules/autosave: APS BCDA synApps module: autosave\ndls-controls/ethercat: EPICS support to read/write to ethercat based hardware\nIgH EtherCAT Master for Linux\nPREEMPT RT patch\né…ç½®äº¤å‰ç¼–è¯‘ç¯å¢ƒ å…³äºè¿™ä¸€èŠ‚ï¼Œä¹‹å‰çš„æ–‡ç« å·²ç»è¯¦ç»†è®²è¿‡ï¼Œå‚è€ƒé…ç½®äº¤å‰ç¼–è¯‘ç¯å¢ƒã€‚\nå¦‚æœä½ ä½¿ç”¨çš„æ˜¯å…¶ä»–å¼€å‘å¥—ä»¶ï¼Œè¯·æŒ‰ç…§å¼€å‘æ‰‹å†Œå®‰è£…é…ç½®å¥½ç¯å¢ƒã€‚\nç¼–è¯‘ IgH EtherCAT Master æºç ä¸€å®šè¦ä¸‹è½½ stable-1.5 åˆ†æ”¯çš„ï¼Œå…¶ä»–ç‰ˆæœ¬æˆ‘ä¹Ÿæ²¡æœ‰æµ‹è¯•ï¼\næ‰“è¡¥ä¸ 1 2 3 4 5 6 7 # å…ˆå°†è¡¥ä¸å¤åˆ¶åˆ°ethercaté©±åŠ¨æºç ä¸‹ cp ethercat-master/etc/makeDocumentation/configurable-error-suppression.patch ethercat-stable-1.5/ cd ethercat-stable-1.5/ # æ‰“è¡¥ä¸ patch -p1 \u003c configurable-error-suppression.patch # è¿™é‡Œéœ€è¦æ³¨æ„ä¸€ä¸‹patchçš„è¾“å‡ºç»“æœ ç”±äºè¡¥ä¸çš„æ—¶é—´æ¯”è¾ƒæ—©ï¼Œè·Ÿç°æœ‰çš„æºç ä¸å¤ªåŒ¹é…ï¼Œæœ‰äº›åœ°æ–¹è¡¥ä¸ä¼šå¤±è´¥ï¼ˆFAILEDï¼‰ã€‚æ¯”å¦‚æˆ‘è¿™é‡Œçš„æŠ¥é”™ï¼Œå¯èƒ½éœ€è¦å†æ‰‹åŠ¨ä¿®æ”¹ä¸€ä¸‹ã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 patching file lib/Makefile.am Hunk #1 succeeded at 32 (offset -2 lines). patching file lib/common.c patching file lib/domain.c patching file lib/liberror-documentation.txt patching file lib/liberror.c patching file lib/liberror.h patching file lib/master.c Hunk #1 succeeded at 37 (offset -2 lines). ... Hunk #12 FAILED at 419. Hunk #13 FAILED at 448. ... 2 out of 31 hunks FAILED -- saving rejects to file lib/master.c.rej patching file lib/reg_request.c Hunk #1 succeeded at 39 (offset -2 lines). ... patching file lib/sdo_request.c Hunk #1 succeeded at 39 (offset -2 lines). ... patching file lib/slave_config.c Hunk #1 succeeded at 39 (offset -1 lines). ... patching file lib/voe_handler.c Hunk #1 succeeded at 40 (offset -2 lines). ... æˆ‘ä»¬å‚è€ƒlib/master.c.rejï¼Œæ‰‹åŠ¨ä¿®æ”¹ä¸€ä¸‹ã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 # lib/master.c.rej --- lib/master.c\tTue Feb 12 17:31:08 2013 +0100 +++ lib/master.c\tMon Mar 23 15:52:53 2015 +0000 @@ -419,7 +431,8 @@ if (EC_IOCTL_ERRNO(ret) == EIO \u0026\u0026 abort_code) { *abort_code = download.abort_code; } - fprintf(stderr, \"Failed to execute SDO download: %s\\n\", + ecrt_errcode = ECRT_ERRMASTERSDODOWNLOAD; + ERRPRINTF(\"Failed to execute SDO download: %s\\n\", strerror(EC_IOCTL_ERRNO(ret))); return -EC_IOCTL_ERRNO(ret); } @@ -448,7 +461,8 @@ if (EC_IOCTL_ERRNO(ret) == EIO \u0026\u0026 abort_code) { *abort_code = download.abort_code; } - fprintf(stderr, \"Failed to execute SDO download: %s\\n\", + ecrt_errcode = ECRT_ERRMASTERSDODOWNLOADCOMPLETE; + ERRPRINTF(\"Failed to execute SDO download: %s\\n\", strerror(EC_IOCTL_ERRNO(ret))); return -EC_IOCTL_ERRNO(ret); } ç„¶åè¿™ä¸ªè¡¥ä¸è¿˜æœ‰ç‚¹é—®é¢˜ï¼Œæˆ‘ä»¬éœ€è¦æ‰‹åŠ¨ä¿®æ”¹ä¸€ä¸‹lib/liberror.cã€‚è¿™é‡Œæºæ–‡ä»¶å’Œå¤´æ–‡ä»¶å˜é‡å®šä¹‰ä¸ä¸€è‡´ï¼Œç¼–è¯‘ä¼šæŠ¥é”™ï¼Œä»¥å¤´æ–‡ä»¶ä¸ºå‡†ã€‚\n1 2 3 4 5 6 7 #include \"liberror.h\" int ecrt_err_to_stderr = 1; // char *ecrt_errstring[ERRSTRING_LEN]; char ecrt_errstring[ERRSTRING_LEN]; int ecrt_errcode; å‡†å¤‡å†…æ ¸æºç  ç”±äºéœ€è¦å°†æºç ç¼–è¯‘æˆç›¸åº”çš„ç³»ç»Ÿé©±åŠ¨ï¼Œæ‰€ä»¥è¿™é‡Œéœ€è¦ä½¿ç”¨å†…æ ¸çš„æºç ã€‚\nå¦‚æœæ˜¯æ ‡å‡†ç³»ç»Ÿï¼Œå¯ä»¥ç›´æ¥å®‰è£…linux-headersã€‚\n1 2 # Ubuntu/Debian sudo apt install linux-headers-$(uname -r) æ ‘è“æ´¾ç³»ç»Ÿ\n1 sudo apt install raspberrypi-kernel-headers è€Œå¯¹äºå¼€å‘æ¿ç³»ç»Ÿï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨éšå¼€å‘æ¿æä¾›çš„å†…æ ¸æºç ã€‚\nå†…æ ¸çš„ç¼–è¯‘æ­¥éª¤è¯·æ ¹æ®å¼€å‘æ¿çš„ç”¨æˆ·æ‰‹å†Œå®Œæˆã€‚\næœ€å¥½å†ç»™å†…æ ¸æ‰“ä¸Š PREEMPT_RT è¡¥ä¸ã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 # è§£å‹å†…æ ¸æºç  tar -xvf linux-5.10-2k500-src-f45937d-build.20230721100738.tar.gz # linux-5.10-2k500-cbd-src cd linux-5.10-2k500-cbd-src/ # ä¸ºå†…æ ¸æ‰“ä¸Šå®æ—¶è¡¥ä¸ï¼ˆå¯é€‰ï¼‰ patch -p1 \u003c patch-5.10-rt17.patch # é…ç½®äº¤å‰ç¼–è¯‘å™¨ ./set_env.sh # ç¼–è¯‘å†…æ ¸ make loongson_2k500_defconfig # make menuconfig make uImage # ç¼–è¯‘æ¨¡å— make modules ç¼–è¯‘ EtherCAT Master é©±åŠ¨ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 cd ethercat-stable-1.5/ # to create the configure script, if downloaded from the repo ./bootstrap # è¿™é‡Œéœ€è¦æ³¨æ„æ˜¯å¦å‡ºç°æŠ¥é”™ï¼Œéœ€è¦å®‰è£… autoconfã€pkg-config ç­‰å·¥å…· # æ‰§è¡Œconfigure # --host æŒ‡å®šç¨‹åºè¿è¡Œçš„ä¸»æœºæ¶æ„ # --with-linux-dir æŒ‡å®šæºç ç›®å½• # å¦‚æœæ˜¯å®‰è£…çš„linux-headersï¼Œé€šå¸¸åœ¨ /usr/src/linux-headers-xxx # å¦‚æœç›´æ¥ä½¿ç”¨å†…æ ¸æºç ï¼Œåˆ™å¿…é¡»é€šè¿‡ä¸Šè¿°ç¼–è¯‘æ­¥éª¤ï¼ # --prefix æŒ‡å®šå®‰è£…ç›®å½• ./configure --host=loongarch64-linux-gnu CC=loongarch64-linux-gnu-gcc --enable-generic=yes --enable-8139too=no --with-linux-dir=/path/to/linux-5.10-2k500-cbd-src --prefix=/path/to/__install_dir # ç¼–è¯‘ make all modules # æˆ–è€… # make # make ARCH=loongarch CORSS_COMPILE=loongarch64-linux-gnu- modules # å®‰è£…ç”Ÿæˆçš„æ–‡ä»¶ # make install å¦‚æœå®Œå…¨æŒ‰ç…§ä¸Šè¿°æ­¥éª¤ï¼Œåº”è¯¥å¯ä»¥ç¼–è¯‘æˆåŠŸã€‚\nä¸‹é¢æ•´ç†ä¸€ä¸‹ç”Ÿæˆçš„æ–‡ä»¶ã€‚\n1 2 3 4 5 # å¤åˆ¶ç”Ÿæˆçš„ä¸»ç¨‹åº cp tool/ethercat /path/to/__install_dir/bin/ # å¤åˆ¶ç”Ÿæˆçš„é©±åŠ¨ç¨‹åº cp device/ec_generic.ko /path/to/__install_dir/modules/ cp master/ec_master.ko /path/to/__install_dir/modules/ è¿™æ˜¯æˆ‘æ•´ç†çš„æ–‡ä»¶ï¼Œåé¢éœ€è¦å°†è¿™äº›æ–‡ä»¶ä¸‹è½½åˆ°å¼€å‘æ¿ã€‚\n__install_dir â”œâ”€ bin â”‚ â””â”€ ethercat (ä¸»ç¨‹åº) â”œâ”€ etc (é…ç½®) â”œâ”€ include (å¤´æ–‡ä»¶) â”œâ”€ lib (libethercat.so) â”œâ”€ modules (é©±åŠ¨ç›®å½•) â”‚ â”œâ”€ ec_master.ko â”‚ â””â”€ ec_generic.ko â”œâ”€ sbin â”‚ â””â”€ ethercatctl â””â”€ share â””â”€ bash-completion/ (bashè‡ªåŠ¨è¡¥å…¨) ç¼–è¯‘ EPICS ethercat æ¨¡å— ä»¥ä¸‹æ­¥éª¤éœ€è¦å…ˆå®‰è£…å¥½EPICS Base!\nç¼–è¯‘ asyn 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 cd asyn touch configure/RELEASE.local vi configure/RELEASE.local # ä¿®æ”¹æˆå’ŒEPICS Baseä¸€æ ·çš„æ¶æ„ EPICS_HOST_ARCH=linux-la64 # EPICS Baseè·¯å¾„ï¼ˆç¤ºä¾‹ï¼‰ EPICS_BASE=/home/ubuntu/loongson/base-7.0.8 # æ”¾ç½®EPICSæ¨¡å—çš„è·¯å¾„ï¼ˆç¤ºä¾‹ï¼‰ SUPPORT=/home/ubuntu/loongson/modules # SSCANæ¨¡å—è·¯å¾„ # SSCAN=$(SUPPORT)/sscan # CALCæ¨¡å—è·¯å¾„ # CALC=$(SUPPORT)/calc # ç›´æ¥ç¼–è¯‘ # make # äº¤å‰ç¼–è¯‘ï¼ˆç¤ºä¾‹ï¼‰ make LD=loongarch64-linux-gnu-ld CC=loongarch64-linux-gnu-gcc CCC=loongarch64-linux-gnu-g++ ç¼–è¯‘ autosave 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 cd autosave touch configure/RELEASE.local vi configure/RELEASE.local # ä¿®æ”¹æˆå’ŒEPICS Baseä¸€æ ·çš„æ¶æ„ EPICS_HOST_ARCH=linux-la64 # EPICS Baseè·¯å¾„ï¼ˆç¤ºä¾‹ï¼‰ EPICS_BASE=/home/ubuntu/loongson/base-7.0.8 # æ”¾ç½®EPICSæ¨¡å—çš„è·¯å¾„ï¼ˆç¤ºä¾‹ï¼‰ SUPPORT=/home/ubuntu/loongson/modules # ç›´æ¥ç¼–è¯‘ # make # äº¤å‰ç¼–è¯‘ï¼ˆç¤ºä¾‹ï¼‰ make LD=loongarch64-linux-gnu-ld CC=loongarch64-linux-gnu-gcc CCC=loongarch64-linux-gnu-g++ ç¼–è¯‘ busy 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 cd busy touch configure/RELEASE.local vi configure/RELEASE.local # ä¿®æ”¹æˆå’ŒEPICS Baseä¸€æ ·çš„æ¶æ„ EPICS_HOST_ARCH=linux-la64 # EPICS Baseè·¯å¾„ï¼ˆç¤ºä¾‹ï¼‰ EPICS_BASE=/home/ubuntu/loongson/base-7.0.8 # æ”¾ç½®EPICSæ¨¡å—çš„è·¯å¾„ï¼ˆç¤ºä¾‹ï¼‰ SUPPORT=/home/ubuntu/loongson/modules # ASYNæ¨¡å—è·¯å¾„ ASYN=$(SUPPORT)/asyn # AUTOSAVEæ¨¡å—è·¯å¾„ AUTOSAVE=$(SUPPORT)/autosave # BUSYæ¨¡å—è·¯å¾„ BUSY=$(SUPPORT)/busy # ç›´æ¥ç¼–è¯‘ # make # äº¤å‰ç¼–è¯‘ï¼ˆç¤ºä¾‹ï¼‰ make LD=loongarch64-linux-gnu-ld CC=loongarch64-linux-gnu-gcc CCC=loongarch64-linux-gnu-g++ ç¼–è¯‘ ethercat è¿™ä¸€æ­¥å¯ä»¥è¯´æ˜¯æœ€éº»çƒ¦ï¼Œé—®é¢˜æœ€å¤šçš„ã€‚ç¼–è¯‘å‡ºä»€ä¹ˆé—®é¢˜éƒ½éœ€è¦å»æ‰¾åˆ°ç›¸åº”çš„Makefileä¿®æ”¹ã€‚\nç”±äºè¯¥è½¯ä»¶åŒ…å·²ç»é•¿æ—¶é—´æ— äººç»´æŠ¤ï¼Œå»ºè®®ä½¿ç”¨æˆ‘ä¿®æ”¹è¿‡çš„ç‰ˆæœ¬ã€‚\né¦–å…ˆéœ€è¦å®‰è£…æ‰€éœ€çš„åŒ…libxml2-devã€‚ä½†æˆ‘ä»¬å®é™…ä¸Šå¹¶ä¸éœ€è¦ç”¨è¿™ä¸ªè½¯ä»¶åŒ…ï¼Œæˆ‘ä»¬åªéœ€è¦å®ƒçš„å¤´æ–‡ä»¶ã€‚\nè½¯ä»¶ä¾èµ–çš„åŠ¨æ€åº“(.so)æ–‡ä»¶ï¼Œæˆ‘ä»¬åˆ™éœ€è¦ä»å¼€å‘æ¿ç³»ç»Ÿä¸­æ‹·è´å‡ºæ¥ï¼Œæ— æ³•ç›´æ¥ç”¨ç¼–è¯‘ç”µè„‘çš„åŠ¨æ€åº“ã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 cd ethercat-master/ # åˆ›å»º 3rd ç›®å½•ï¼Œç”¨äºæ”¾ç½®æ‰€éœ€çš„å¤´æ–‡ä»¶å’ŒåŠ¨æ€åº“ mkdir 3rd mkdir 3rd/include mkdir 3rd/lib # å®‰è£… libxml2-dev sudo apt install libxml2-dev # ä»ç³»ç»Ÿç›®å½•ä¸­å¤åˆ¶å‡ºlibxml2çš„å¤´æ–‡ä»¶ # å› ä¸ºè¿˜éœ€è¦åšä¸€äº›ä¿®æ”¹ï¼Œä¸èƒ½ç›´æ¥ä½¿ç”¨ cp -r /usr/include/libxml2/ ./3rd/include/ # å¤åˆ¶åˆšåˆšç¼–è¯‘ç”Ÿæˆçš„ libethercat cp /path/to/__install_dir/lib/libethercat.so* ./3rd/lib/ # ä»å¼€å‘æ¿ç³»ç»Ÿå¤åˆ¶æ‰€éœ€è¦çš„åŠ¨æ€åº“ # libxml2 ä¾èµ– libz å’Œ liblzma scp root@192.168.1.10:/usr/lib/libxml2.so.2.9.12 ./3rd/lib/ scp root@192.168.1.10:/usr/lib/libz.so.1.2.11 ./3rd/lib/ scp root@192.168.1.10:/usr/lib/liblzma.so.5.2.5 ./3rd/lib/ # æ‰‹åŠ¨åˆ›å»ºä¸€ä¸‹é“¾æ¥ cd 3rd/lib/ ln -s libxml2.so.2.9.12 libxml2.so.2 ln -s libxml2.so.2 libxml2.so ln -s liblzma.so.5.2.5 liblzma.so.5 ln -s liblzma.so.5 liblzma.so ln -s libz.so.1.2.11 libz.so.1 ln -s libz.so.1 libz.so ç„¶åéœ€è¦ä¿®æ”¹ä¸€ä¸‹libxml2çš„å¤´æ–‡ä»¶ï¼Œä¸ç„¶ç¼–è¯‘çš„æ—¶å€™ä¼šæŠ¥é”™ã€‚\næŠ¥é”™ä¿¡æ¯ï¼š\n1 2 3 4 5 6 7 8 9 10 In file included from ../../../libxml2/libxml/parser.h:812, from ../../../libxml2/libxml/globals.h:18, from ../../../libxml2/libxml/threads.h:35, from ../../../libxml2/libxml/xmlmemory.h:218, from ../../../libxml2/libxml/tree.h:1307, from ../parser.c:10: ../../../libxml2/libxml/encoding.h:31:10: fatal error: unicode/ucnv.h: No such file or directory #include ^~~~~~~~~~~~~~~~ compilation terminated. è§£å†³æ–¹æ³•ï¼š\n1 2 3 4 5 6 # ä¿®æ”¹ xmlversion.h vi 3rd/include/libxml2/libxml/xmlversion.h # æ‰¾åˆ°ä¸‹é¢è¡Œï¼Œç¦ç”¨ LIBXML_ICU_ENABLED #define LIBXML_ICU_ENABLED # å°† #if 1 æ”¹ä¸º #if 0 1 2 3 4 5 6 7 8 9 /** * LIBXML_ICU_ENABLED: * * Whether icu support is available */ - #if 0 + #if 1 #define LIBXML_ICU_ENABLED #endif åšå¥½ä¸Šé¢çš„å‡†å¤‡å·¥ä½œï¼Œè¿˜éœ€è¦ä¿®æ”¹æºç ä¸­çš„è·¯å¾„é…ç½®ï¼Œç„¶åæ‰èƒ½æ­£å¸¸ç¼–è¯‘ã€‚\nä¸‹é¢éƒ½æ˜¯æˆ‘è¸©å‘ç•™ä¸‹çš„è®°å½•ã€‚\nä¿®æ”¹ configure/RELEASE 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 cd ethercat-master/ # é¦–å…ˆä¿®æ”¹ configure/RELEASE vi configure/RELEASE # éœ€è¦ä¿®æ”¹çš„æœ‰4é¡¹ # æ”¾ç½®EPICSæ¨¡å—çš„è·¯å¾„ï¼ˆç¤ºä¾‹ï¼‰ SUPPORT=/home/ubuntu/loongson/modules # ASYNæ¨¡å—è·¯å¾„ ASYN=$(SUPPORT)/asyn # BUSYæ¨¡å—è·¯å¾„ BUSY=$(SUPPORT)/busy # ä¿®æ”¹æˆå’ŒEPICS Baseä¸€æ ·çš„æ¶æ„ EPICS_HOST_ARCH=linux-la64 # EPICS Baseè·¯å¾„ï¼ˆç¤ºä¾‹ï¼‰ EPICS_BASE=/home/ubuntu/loongson/base-7.0.8 ä¿®æ”¹ ethercatApp/scannerSrc/Makefile 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 cd ethercat-master/ # ä¿®æ”¹ ethercatApp/scannerSrc/Makefile vi ethercatApp/scannerSrc/Makefile # éœ€è¦ä¿®æ”¹ EtherCAT Master æºç ç›¸å…³è·¯å¾„ã€ # libxml2å¤´æ–‡ä»¶è·¯å¾„ã€åŠ¨æ€åº“(.so)è·¯å¾„ # ä¿®æ”¹ ETHERLAB æºç è·¯å¾„ ETHERLAB=/path/to/ethercat-stable-1.5 ETHERLABPREFIX=$(ETHERLAB) USR_INCLUDES += -I$(ETHERLABPREFIX)/include # ä¿®æ”¹åŠ¨æ€åº“è·¯å¾„ USR_LDFLAGS += -L$(TOP)/3rd/lib -Wl,-rpath=$(TOP)/3rd/lib # ä¿®æ”¹ libxml2 å¤´æ–‡ä»¶è·¯å¾„ USR_INCLUDES += -I$(TOP)/3rd/include/libxml2 USR_SYS_LIBS += ethercat xml2 # ä¸‹é¢ç±»ä¼¼ scanner_INCLUDES += -I$(ETHERLAB)/lib serialtool_INCLUDES += -I$(ETHERLAB)/master get-slave-revisions_INCLUDES += -I$(ETHERLAB)/master ä¿®æ”¹ ethercatApp/src/Makefileï¼Œä¸ä¸Šé¢ç±»ä¼¼ã€‚ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 cd ethercat-master/ # ä¿®æ”¹ ethercatApp/src/Makefile vi ethercatApp/src/Makefile # éœ€è¦ä¿®æ”¹ EtherCAT Master æºç ç›¸å…³è·¯å¾„ã€ # libxml2å¤´æ–‡ä»¶è·¯å¾„ã€åŠ¨æ€åº“(.so)è·¯å¾„ # ä¿®æ”¹ ETHERLAB æºç è·¯å¾„ ETHERLAB=/path/to/ethercat-stable-1.5 # ecAsyn_INCLUDES += -I$(ETHERLAB)/src/ethercat-$(subst -,.,$(VERSION))/include # gadc_INCLUDES += -I$(ETHERLAB)/src/ethercat-$(subst -,.,$(VERSION))/include ecAsyn_INCLUDES += -I$(ETHERLAB)/include gadc_INCLUDES += -I$(ETHERLAB)/include # ä¿®æ”¹ libxml2 å¤´æ–‡ä»¶è·¯å¾„ USR_INCLUDES += -I$(TOP)/3rd/include/libxml2 # æ·»åŠ åŠ¨æ€åº“è·¯å¾„ USR_LDFLAGS += -L$(TOP)/3rd/lib -Wl,-rpath=$(TOP)/3rd/lib USR_SYS_LIBS += xml2 ä¿®æ”¹æºç  ç”±äºethercat-masterçš„æºç åŸæœ¬æ˜¯ä¸ºx86_64æ¶æ„ç¼–å†™çš„ï¼Œç¼–è¯‘åˆ°LoongArchæ¶æ„çš„è®¾å¤‡ä¸Šè¿è¡Œå¯èƒ½ä¼šå‡ºç°ä¸€äº›å¥‡æ€ªçš„é”™è¯¯ã€‚\nä¾‹å¦‚ï¼Œåœ¨è¿è¡Œslaveinfoæ—¶ä¼šå‡ºç°Segmentation faulté”™è¯¯ï¼Œè€Œè¿™é€šå¸¸æ˜¯ç©ºæŒ‡é’ˆå¯¼è‡´å†…å­˜è®¿é—®å‡ºé”™ã€‚\nåŸå› åˆ†æï¼š\nslaveinfoåœ¨è¿è¡Œæ—¶ä¼šæ ¹æ®ç¨‹åºè‡ªå·±çš„è·¯å¾„å¯»æ‰¾slave-types.txtæ–‡ä»¶ï¼Œé—®é¢˜å°±å‡ºåœ¨è¿™é‡Œã€‚æ¥çœ‹æºç  ethercatApp/scannerSrc/slave-list-path.cã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 // ethercatApp/scannerSrc/slave-list-path.c int get_root_dir_index(const char *program_name) { // Search for the binary path char binary_dir[] = \"bin/linux-x86_64/\"; // Find the binary path in the program path and return the pointer char *found = strstr(program_name, binary_dir); // Handle the case where it is not found if (found == NULL) { return -1; } // Calculate the difference in the pointers to get the index return found - program_name; } è¿™ä¸ªget_root_dir_indexå‡½æ•°æ˜¯ç”¨äºè®¡ç®—å½“å‰ç¨‹åº(slaveinfo)æ‰€åœ¨çš„æ ¹ç›®å½•ã€‚è¿™é‡Œå‘ä¸ŠæŸ¥æ‰¾çš„è·¯å¾„ä¸ºbin/linux-x86_64ï¼Œå½“ç„¶ä¸èƒ½æ‰¾åˆ°LoongArchçš„ç›®å½•bin/linux-la64äº†ã€‚æ‰€ä»¥ï¼Œæ­¤å‡½æ•°åªåœ¨è·¯å¾„ä¸ºbin/linux-x86_64/slaveinfoæ—¶æ‰èƒ½æ­£å¸¸è¿è¡Œï¼Œå…¶å®ƒæƒ…å†µéƒ½è¿”å›-1ã€‚ï¼ˆç¬¬ä¸€æ¬¡è§åˆ°è¿™æ ·å†™çš„ï¼ŒçœŸæ— è¯­äº†â€¦â€¦ï¼‰\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 // ethercatApp/scannerSrc/slave-list-path.c char *get_slave_list_filename(const char *program_path) { char relative_path[] = \"etc/scripts/slave-types.txt\"; char *slave_list_filename = NULL; // Get absolute path of application char *real_path = calloc(PATH_MAX, sizeof(char)); get_app_path(program_path, real_path); // Get root directory int root_dir_index = get_root_dir_index(real_path); if (root_dir_index != -1) { slave_list_filename = calloc(root_dir_index + strlen(relative_path) + 1, sizeof(char)); strncpy(slave_list_filename, real_path, root_dir_index); } // Append relative path strcat(slave_list_filename, relative_path); // Check file struct stat fstat; int result = stat(slave_list_filename, \u0026fstat); if (result) { printf(\"Could not find slave list file at %s\\n\", slave_list_filename); } // Cleanup free(real_path); return slave_list_filename; } è€Œåœ¨get_slave_list_filenameå‡½æ•°ä¸­ï¼Œåªå¤„ç†äº†get_root_dir_indexæ­£å¸¸è¿”å›çš„æƒ…å†µã€‚å½“get_root_dir_indexè¿”å›-1æ—¶ï¼Œslave_list_filenameå§‹ç»ˆä¸ºNULLï¼Œè¿™å°±å¯¼è‡´åç»­æ“ä½œå‡ºé”™ã€‚\nå…¶å®è¿™ä¸ªé—®é¢˜ç›´æ¥æŠŠç¨‹åºæ”¾åˆ°bin/linux-x86_64ç›®å½•ä¸‹è¿è¡Œå°±å¯ä»¥äº†ï¼Œä¸è¿‡æ—¢ç„¶æ‰¾åˆ°äº†é—®é¢˜ï¼Œç´¢æ€§å°±æ”¹ä¸€æ”¹ã€‚\nç°åœ¨å·²ç»çŸ¥é“äº†å‡ºé”™çš„åœ°æ–¹ï¼Œè¯¥å¦‚ä½•ä¿®æ”¹å‘¢ï¼Ÿè¿™é‡Œæˆ‘æœ¬ç€å°½é‡å°‘æ”¹åŠ¨æºç çš„åŸåˆ™ï¼Œåœ¨get_root_dir_indexæŸ¥æ‰¾æ ¹ç›®å½•å‡ºé”™æ—¶ï¼Œç›´æ¥ä½¿ç”¨å½“å‰ç›®å½•ã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 char *get_slave_list_filename(const char *program_path) { char relative_path[] = \"etc/scripts/slave-types.txt\"; char *slave_list_filename = NULL; // Get absolute path of application char *real_path = calloc(PATH_MAX, sizeof(char)); get_app_path(program_path, real_path); // Get root directory int root_dir_index = get_root_dir_index(real_path); if (root_dir_index != -1) { slave_list_filename = calloc(root_dir_index + strlen(relative_path) + 1, sizeof(char)); strncpy(slave_list_filename, real_path, root_dir_index); } + else + { + slave_list_filename = calloc(PATH_MAX, sizeof(char)); + if (NULL != getcwd(slave_list_filename, PATH_MAX)) + { + strcat(slave_list_filename, \"/\"); + } + } // Append relative path strcat(slave_list_filename, relative_path); // Check file struct stat fstat; int result = stat(slave_list_filename, \u0026fstat); if (result) { printf(\"Could not find slave list file at %s\\n\", slave_list_filename); } // Cleanup free(real_path); return slave_list_filename; } ç›®å‰åªå‘ç°äº†è¿™ä¸ªé—®é¢˜ï¼Œå¸Œæœ›åé¢æ²¡æœ‰å‘äº†ã€‚\nç¼–è¯‘ æœ€åç»ˆäºå¯ä»¥å¼€å§‹ç¼–è¯‘äº†ã€‚\n1 2 3 cd ethercat-master/ # æ‰§è¡Œäº¤å‰ç¼–è¯‘ make LD=loongarch64-linux-gnu-ld CC=loongarch64-linux-gnu-gcc CCC=loongarch64-linux-gnu-g++ åˆ°è¿™é‡Œï¼Œç¼–è¯‘è¿‡ç¨‹è¿˜å¯èƒ½ä¼šå‡ºé”™ï¼Œä¸è¿‡å·²ç»å¯ä»¥ç¼–è¯‘å‡ºæˆ‘ä»¬æ‰€éœ€è¦çš„ä¸œè¥¿äº†ã€‚\næœ€ç»ˆç¼–è¯‘å¾—åˆ°scannerã€slaveinfoç¨‹åºå°±å¯ä»¥äº†ã€‚\nä»¥ä¸‹æ˜¯æˆ‘ç¼–è¯‘æ—¶çš„è¾“å‡ºï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 ... Installing library ../../../lib/linux-la64/libscannerlib.a ... Installing created executable ../../../bin/linux-la64/serialtool Installing created executable ../../../bin/linux-la64/get-slave-revisions Installing created executable ../../../bin/linux-la64/scanner Installing created executable ../../../bin/linux-la64/slaveinfo Installing created executable ../../../bin/linux-la64/parsertest ... Installing shared library ../../../lib/linux-la64/libecAsyn.so Installing library ../../../lib/linux-la64/libecAsyn.a Installing created executable ../../../bin/linux-la64/parsertest ... Installing template file ../../../db/EK1100.template ... make -C ./protocol install make[2]: è¿›å…¥ç›®å½•â€œ/home/deepin/ethercat-master/ethercatApp/protocolâ€ make[2]: *** æ²¡æœ‰è§„åˆ™å¯åˆ¶ä½œç›®æ ‡â€œinstallâ€ã€‚ åœæ­¢ã€‚ make[2]: ç¦»å¼€ç›®å½•â€œ/home/deepin/ethercat-master/ethercatApp/protocolâ€ make[1]: *** [/usr/local/epics/base-7.0.8/configure/RULES_DIRS:85ï¼šprotocol.install] é”™è¯¯ 2 make[1]: ç¦»å¼€ç›®å½•â€œ/home/deepin/ethercat-master/ethercatAppâ€ make: *** [/usr/local/epics/base-7.0.8/configure/RULES_DIRS:85ï¼šethercatApp.install] é”™è¯¯ 2 æœ€åçš„é”™è¯¯ï¼Œæˆ‘ç›´æ¥å¿½ç•¥äº†ï¼Œå› ä¸ºå·²ç»å¾—åˆ°äº†éœ€è¦çš„å¯æ‰§è¡Œç¨‹åºã€‚\næ•´ç†ä¸€ä¸‹ç¼–è¯‘ç”Ÿæˆçš„æ–‡ä»¶ï¼š\nethercat-master â”œâ”€ bin â”‚ â””â”€ linux-la64 â”œâ”€ db â”œâ”€ dbd â””â”€ lib â””â”€ linux-la64 æµ‹è¯•è¿è¡Œ å°†æ•´ç†å¥½çš„æ–‡ä»¶ä¸‹è½½åˆ°å¼€å‘æ¿åï¼Œæˆ‘ä»¬æµ‹è¯•è¿è¡Œä¸€ä¸‹ã€‚\næµ‹è¯•å®‰è£… EtherCAT ä¸»ç«™é©±åŠ¨ç¨‹åºã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 [root@LS-GD modules]# modinfo ec_generic.ko filename: /root/__install/modules/ec_generic.ko version: 1.5.2 unknown license: GPL description: EtherCAT master generic Ethernet device module author: Florian Pose srcversion: 848BB80F1C588A2FDA42EDB depends: ec_master name: ec_generic vermagic: 5.10.0-rt17.lsgd preempt_rt mod_unload modversions LOONGARCH 64BIT [root@LS-GD modules]# insmod ec_master.ko [root@LS-GD modules]# insmod ec_generic.ko [root@LS-GD modules]# lsmod Module Size Used by ec_generic 6427 0 ec_master 464125 1 ec_generic æµ‹è¯•ethercatä¸»ç¨‹åºã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 [root@LS-GD tool]# ./ethercat Please specify a command! Usage: ethercat [OPTIONS] [ARGUMENTS] Commands (can be abbreviated): alias Write alias addresses. config Show slave configurations. crc CRC error register diagnosis. cstruct Generate slave PDO information in C language. data Output binary domain process data. debug Set the master's debug level. domains Show configured domains. download Write an SDO entry to a slave. eoe Display Ethernet over EtherCAT statictics. foe_read Read a file from a slave via FoE. foe_write Store a file on a slave via FoE. graph Output the bus topology as a graph. master Show master and Ethernet device information. pdos List Sync managers, PDO assignment and mapping. reg_read Output a slave's register contents. reg_write Write data to a slave's registers. rescan Rescan the bus. sdos List SDO dictionaries. sii_read Output a slave's SII contents. sii_write Write SII contents to a slave. slaves Display slaves on the bus. soe_read Read an SoE IDN from a slave. soe_write Write an SoE IDN to a slave. states Request application-layer states. upload Read an SDO entry from a slave. version Show version information. xml Generate slave information XML. Global options: --master -m Comma separated list of masters to select, ranges are allowed. Examples: '1,3', '5-7,9', '-3'. Default: '-' (all). --force -f Force a command. --quiet -q Output less information. --verbose -v Output more information. --help -h Show this help. Numerical values can be specified either with decimal (no prefix), octal (prefix '0') or hexadecimal (prefix '0x') base. Call 'ethercat --help' for command-specific help. Send bug reports to fp@igh.de. æµ‹è¯•scannerä¸»ç¨‹åºã€‚\n1 2 3 [root@LS-GD linux-la64]# chmod +x scanner [root@LS-GD linux-la64]# ./scanner usage: scanner [-m master_index] [-s] [-q] scanner.xml socket_path å¯ä»¥çœ‹åˆ°ï¼Œé©±åŠ¨ç¨‹åºå’Œä¸»ç¨‹åºéƒ½èƒ½åœ¨å¼€å‘æ¿ä¸Šè¿è¡Œï¼Œè¯´æ˜å·²ç»ç¼–è¯‘å®Œæˆäº†ã€‚\nå®‰è£… EtherCAT ä¸»ç«™åˆ°å¼€å‘æ¿ç³»ç»Ÿ é¦–å…ˆå°†ç¼–è¯‘å¥½çš„EtherCAT Masterä¸‹è½½åˆ°å¼€å‘æ¿ç³»ç»Ÿï¼Œç„¶åå°†å„ä¸ªç›®å½•ä¸‹çš„æ–‡ä»¶æ”¾åˆ°ç›¸åº”çš„ç³»ç»Ÿç›®å½•ä¸‹ã€‚ï¼ˆè¿™é‡Œæˆ‘è¿˜ä»¥__install_dirçš„ç›®å½•ç»“æ„ä¸ºä¾‹ã€‚ï¼‰\nåŸæ–‡ä»¶/ç›®å½• ç³»ç»Ÿæ–‡ä»¶/ç›®å½• bin/ethercat /usr/bin/ethercat etc/init.d/ethercat /etc/init.d/ethercat etc/sysconfig/ethercat /etc/sysconfig/ethercat etc/ethercat.conf /etc/ethercat.conf include/ - lib/libethercat.so* /usr/lib/libethercat.so* modules/ /lib/modules/5.10.0-rt17.lsgd/ sbin/ethercatctl /sbin/ethercatctl share/bash-completion/ usr/share/bash-completion/ æ³¨æ„ï¼šå¦‚æœç³»ç»Ÿç›®å½•å­˜åœ¨/lib/modules/{å†…æ ¸ç‰ˆæœ¬}ç›®å½•ï¼Œåˆ™å¯ä»¥å°†modulesç›®å½•ä¸‹çš„ec_master.koå’Œec_generic.koå¤åˆ¶åˆ°è¯¥ç›®å½•ä¸‹ï¼Œç„¶ååœ¨ç»ˆç«¯æ‰§è¡Œdepmodå‘½ä»¤ã€‚å¦åˆ™ï¼Œå¯ä»¥æŒ‰ç…§ä¸‹é¢çš„æ­¥éª¤åšç›¸åº”ä¿®æ”¹ã€‚\nä¾‹å¦‚ï¼Œå°†modulesä¸‹çš„é©±åŠ¨æ–‡ä»¶æ”¾åˆ°å¼€å‘æ¿æ–‡ä»¶ç³»ç»Ÿçš„/root/modules/ç›®å½•ä¸‹ã€‚\nä¿®æ”¹/etc/init.d/ethercatå’Œ/sbin/ethercatctlè„šæœ¬æ–‡ä»¶ã€‚\nä¾‹ï¼š/etc/init.d/ethercat\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 LSMOD=/sbin/lsmod MODPROBE=/sbin/modprobe + INSMOD=/sbin/insmod RMMOD=/sbin/rmmod MODINFO=/sbin/modinfo - ETHERCAT=/home/loongson/__install_dir/bin/ethercat + ETHERCAT=/usr/bin/ethercat MASTER_ARGS= + MODULE_DIR=/root/modules start) echo -n \"Starting EtherCAT master 1.5.2 \" ... # load master module - if ! ${MODPROBE} ${MODPROBE_FLAGS} ec_master \"${MASTER_ARGS}\" \\ + if ! ${INSMOD} ${MODULE_DIR}/ec_master.ko \"${MASTER_ARGS}\" \\ main_devices=\"${DEVICES}\" backup_devices=\"${BACKUPS}\"; then exit_fail fi # check for modules to replace for MODULE in ${DEVICE_MODULES}; do ECMODULE=ec_${MODULE} - if ! ${MODINFO} \"${ECMODULE}\" \u003e /dev/null; then - continue # ec_* module not found - fi if [ \"${MODULE}\" != \"generic\" ]; then if ${LSMOD} | grep \"^${MODULE} \" \u003e /dev/null; then if ! ${RMMOD} \"${MODULE}\"; then exit_fail fi fi fi - if ! ${MODPROBE} ${MODPROBE_FLAGS} \"${ECMODULE}\"; then + if ! ${INSMOD} \"${MODULE_DIR}/${ECMODULE}.ko\"; then if [ \"${MODULE}\" != \"generic\" ]; then ${MODPROBE} ${MODPROBE_FLAGS} \"${MODULE}\" # try to restore fi exit_fail fi done exit_success ;; ä¾‹ï¼š/sbin/ethercatctl\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 LSMOD=/sbin/lsmod MODPROBE=/sbin/modprobe + INSMOD=/sbin/insmod RMMOD=/sbin/rmmod MODINFO=/sbin/modinfo IP=/bin/ip - ETHERCAT=/home/loongson/__install_dir/bin/ethercat + ETHERCAT=/usr/bin/ethercat + MODULE_DIR=/root/modules #------------------------------------------------------------------------------ - ETHERCAT_CONFIG=/home/loongson/__install_dir/etc/ethercat.conf + ETHERCAT_CONFIG=/etc/ethercat.conf start) ... # load master module - if ! ${MODPROBE} ${MODPROBE_FLAGS} ec_master \\ + if ! ${INSMOD} ${MODULE_DIR}/ec_master.ko \\ main_devices=\"${DEVICES}\" backup_devices=\"${BACKUPS}\"; then exit 1 fi LOADED_MODULES=ec_master # check for modules to replace for MODULE in ${DEVICE_MODULES}; do ECMODULE=ec_${MODULE} - if ! ${MODINFO} \"${ECMODULE}\" \u003e /dev/null; then - continue # ec_* module not found - fi if [ \"${MODULE}\" != \"generic\" ] \u0026\u0026 [ \"${MODULE}\" != \"ccat\" ]; then # unload standard module and check if unloading was successful ${RMMOD} \"${MODULE}\" 2\u003e /dev/null || true if ${LSMOD} | grep \"^${MODULE} \" \u003e /dev/null; then # could not unload module ${RMMOD} ${LOADED_MODULES} exit 1 fi fi - if ! ${MODPROBE} ${MODPROBE_FLAGS} \"${ECMODULE}\"; then + if ! ${INSMOD} \"${MODULE_DIR}/${ECMODULE}.ko\"; then if [ \"${MODULE}\" != \"generic\" ] \u0026\u0026 [ \"${MODULE}\" != \"ccat\" ]; then ${MODPROBE} ${MODPROBE_FLAGS} \"${MODULE}\" # try to restore fi ${RMMOD} ${LOADED_MODULES} exit 1 fi LOADED_MODULES=\"${ECMODULE} ${LOADED_MODULES}\" done exit 0 ;; ä¿®æ”¹ EtherCAT Master é…ç½®æ–‡ä»¶ã€‚\nä¾‹ï¼š/etc/sysconfig/ethercatå’Œ/etc/ethercat.conf\n1 2 3 4 5 6 MASTER0_DEVICE=\"00:11:22:33:44:55\" #MASTER1_DEVICE=\"\" #MASTER0_BACKUP=\"\" DEVICE_MODULES=\"generic\" MASTER_DEVICEé…ç½®ç½‘å¡çš„ç‰©ç†åœ°å€ï¼ˆMACï¼‰ï¼Œå¯é€šè¿‡ifconfigå‘½ä»¤æŸ¥çœ‹ã€‚\nDEVICE_MODULESé…ç½®ä½¿ç”¨çš„æ¨¡å—åç§°ï¼Œè¿™é‡Œä»…ä½¿ç”¨é€šç”¨ç½‘å¡é©±åŠ¨genericã€‚\nè¿è¡Œ EtherCAT Master å¯åŠ¨EtherCATä¸»ç«™ç¨‹åºã€‚\n1 2 3 /etc/init.d/ethercat start # æˆ–è€… /sbin/ethercatctl start å¦‚æœä¸€åˆ‡æ­£å¸¸ï¼Œå¯ä»¥çœ‹åˆ°/devç›®å½•ä¸‹æœ‰EtherCAT0è®¾å¤‡æ–‡ä»¶ã€‚\næŸ¥çœ‹ä¸»ç«™ä¿¡æ¯\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 [root@LS-GD ~]# ethercat master Master0 Phase: Idle Active: no Slaves: 1 Ethernet devices: Main: 00:11:22:33:44:55 (attached) Link: UP Tx frames: 370862 Tx bytes: 22319896 Rx frames: 370861 Rx bytes: 22319836 Tx errors: 0 Tx frame rate [1/s]: 125 125 125 Tx rate [KByte/s]: 7.3 7.3 7.3 Rx frame rate [1/s]: 125 125 125 Rx rate [KByte/s]: 7.3 7.3 7.3 Common: Tx frames: 1108336 Tx bytes: 66704720 Rx frames: 1108307 Rx bytes: 66702980 Lost frames: 29 Tx frame rate [1/s]: 125 125 125 Tx rate [KByte/s]: 7.3 7.3 7.3 Rx frame rate [1/s]: 125 125 125 Rx rate [KByte/s]: 7.3 7.3 7.3 Loss rate [1/s]: 0 0 0 Frame loss [%]: 0.0 0.0 0.0 Distributed clocks: Reference clock: Slave 0 DC reference time: 0 Application time: 0 2000-01-01 00:00:00.000000000 æŸ¥çœ‹ä»ç«™è®¾å¤‡\n1 2 [root@LS-GD ~]# ethercat slaves 0 0:0 PREOP + XB6-EC0002(Modules/Slots and MDP) ç”Ÿæˆä»ç«™ä¿¡æ¯XMLæ–‡ä»¶\n1 [root@LS-GD ~]# ethercat xml \u003e scanner.xml å…¶ä»–ethercatå‘½ä»¤\nä½¿ç”¨ethercat -hå‘½ä»¤æŸ¥çœ‹å…¶ä»–å‘½ä»¤çš„ä½¿ç”¨æ–¹æ³•ã€‚\nå‚è€ƒ IgH EtherCAT Master Building and installing IgH EtherCAT Master IgH EtherCAT Master for Linux EtherCAT DRIVER AND TOOLS FOR EPICS AND LINUX AT PSI INTEGRATION OF EtherCAT HARDWARE INTO THE EPICS BASED DISTRIBUTED CONTROL SYSTEM AT iThemba LABS åœ¨â€œç¦ç‘2.0â€ä¸»æœºä¸Šç¼–è¯‘EPICS Ehtercaté©±åŠ¨è½¯ä»¶çš„ä½“éªŒ ","wordCount":"2759","inLanguage":"zh","datePublished":"2024-02-23T12:54:31+08:00","dateModified":"2024-03-12T15:57:25+08:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://kira-96.github.io/posts/%E9%BE%99%E8%8A%AF%E5%BC%80%E5%8F%91%E6%9D%BF%E7%A7%BB%E6%A4%8Digh-ethercat-master/"},"publisher":{"@type":"Organization","name":"âœ¨kiraã®åšå®¢","logo":{"@type":"ImageObject","url":"https://cdn.jsdelivr.net/gh/kira-96/kira-96.github.io@gh-pages/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://kira-96.github.io/ accesskey=h title="âœ¨kiraã®åšå®¢ (Alt + H)">âœ¨kiraã®åšå®¢</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://kira-96.github.io/ title=ğŸ ä¸»é¡µ><span>ğŸ ä¸»é¡µ</span></a></li><li><a href=https://kira-96.github.io/notes/ title=ğŸ““ç¬”è®°><span>ğŸ““ç¬”è®°</span></a></li><li><a href=https://kira-96.github.io/search/ title=ğŸ”ï¸æœç´¢><span>ğŸ”ï¸æœç´¢</span></a></li><li><a href=https://kira-96.github.io/archives/ title=ğŸ—ƒï¸å­˜æ¡£><span>ğŸ—ƒï¸å­˜æ¡£</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://kira-96.github.io/>ä¸»é¡µ</a>&nbsp;Â»&nbsp;<a href=https://kira-96.github.io/posts/>Posts</a></div><h1 class="post-title entry-hint-parent">é¾™èŠ¯å¼€å‘æ¿ç§»æ¤ IgH EtherCAT Master</h1><div class=post-description>é¾™èŠ¯2K0500å¼€å‘æ¿ç§»æ¤EtherCATä¸»ç«™ç¨‹åºå’ŒEPICS EtherCATæ¨¡å—</div><div class=post-meta><span title='2024-02-23 12:54:31 +0800 +0800'>äºŒæœˆ 23, 2024</span>&nbsp;Â·&nbsp;13 åˆ†é’Ÿ&nbsp;Â·&nbsp;2759 å­—&nbsp;|&nbsp;<a href=https://github.com/kira-96/kira-96.github.io/tree/main/content/posts/ rel="noopener noreferrer" target=_blank>âœï¸ç¼–è¾‘</a></div></header><aside id=toc-container class="toc-container wide"><div class=toc><details open><summary accesskey=c title="(Alt + C)"><span class=details>ç›®å½•</span></summary><div class=inner><ul><li><a href=#%e5%89%8d%e8%a8%80 aria-label=å‰è¨€>å‰è¨€</a></li><li><a href=#%e7%9b%b8%e5%85%b3%e8%bd%af%e4%bb%b6%e5%8c%85%e4%b8%8b%e8%bd%bd%e5%9c%b0%e5%9d%80 aria-label=ç›¸å…³è½¯ä»¶åŒ…ä¸‹è½½åœ°å€>ç›¸å…³è½¯ä»¶åŒ…ä¸‹è½½åœ°å€</a></li><li><a href=#%e9%85%8d%e7%bd%ae%e4%ba%a4%e5%8f%89%e7%bc%96%e8%af%91%e7%8e%af%e5%a2%83 aria-label=é…ç½®äº¤å‰ç¼–è¯‘ç¯å¢ƒ>é…ç½®äº¤å‰ç¼–è¯‘ç¯å¢ƒ</a></li><li><a href=#%e7%bc%96%e8%af%91-igh-ethercat-master aria-label="ç¼–è¯‘ IgH EtherCAT Master">ç¼–è¯‘ IgH EtherCAT Master</a><ul><li><a href=#%e6%89%93%e8%a1%a5%e4%b8%81 aria-label=æ‰“è¡¥ä¸>æ‰“è¡¥ä¸</a></li><li><a href=#%e5%87%86%e5%a4%87%e5%86%85%e6%a0%b8%e6%ba%90%e7%a0%81 aria-label=å‡†å¤‡å†…æ ¸æºç >å‡†å¤‡å†…æ ¸æºç </a></li><li><a href=#%e7%bc%96%e8%af%91-ethercat-master-%e9%a9%b1%e5%8a%a8 aria-label="ç¼–è¯‘ EtherCAT Master é©±åŠ¨">ç¼–è¯‘ EtherCAT Master é©±åŠ¨</a></li></ul></li><li><a href=#%e7%bc%96%e8%af%91-epics-ethercat-%e6%a8%a1%e5%9d%97 aria-label="ç¼–è¯‘ EPICS ethercat æ¨¡å—">ç¼–è¯‘ EPICS ethercat æ¨¡å—</a><ul><li><a href=#%e7%bc%96%e8%af%91-asyn aria-label="ç¼–è¯‘ asyn">ç¼–è¯‘ asyn</a></li><li><a href=#%e7%bc%96%e8%af%91-autosave aria-label="ç¼–è¯‘ autosave">ç¼–è¯‘ autosave</a></li><li><a href=#%e7%bc%96%e8%af%91-busy aria-label="ç¼–è¯‘ busy">ç¼–è¯‘ busy</a></li><li><a href=#%e7%bc%96%e8%af%91-ethercat aria-label="ç¼–è¯‘ ethercat">ç¼–è¯‘ ethercat</a></li></ul></li><li><a href=#%e6%b5%8b%e8%af%95%e8%bf%90%e8%a1%8c aria-label=æµ‹è¯•è¿è¡Œ>æµ‹è¯•è¿è¡Œ</a></li><li><a href=#%e5%ae%89%e8%a3%85-ethercat-%e4%b8%bb%e7%ab%99%e5%88%b0%e5%bc%80%e5%8f%91%e6%9d%bf%e7%b3%bb%e7%bb%9f aria-label="å®‰è£… EtherCAT ä¸»ç«™åˆ°å¼€å‘æ¿ç³»ç»Ÿ">å®‰è£… EtherCAT ä¸»ç«™åˆ°å¼€å‘æ¿ç³»ç»Ÿ</a></li><li><a href=#%e8%bf%90%e8%a1%8c-ethercat-master aria-label="è¿è¡Œ EtherCAT Master">è¿è¡Œ EtherCAT Master</a></li><li><a href=#%e5%8f%82%e8%80%83 aria-label=å‚è€ƒ>å‚è€ƒ</a></li></ul></div></details></div></aside><script>let activeElement,elements;window.addEventListener("DOMContentLoaded",function(){checkTocPosition(),elements=document.querySelectorAll("h1[id],h2[id],h3[id],h4[id],h5[id],h6[id]"),activeElement=elements[0];const t=encodeURI(activeElement.getAttribute("id")).toLowerCase();document.querySelector(`.inner ul li a[href="#${t}"]`).classList.add("active")},!1),window.addEventListener("resize",function(){checkTocPosition()},!1),window.addEventListener("scroll",()=>{activeElement=Array.from(elements).find(e=>{if(getOffsetTop(e)-window.pageYOffset>0&&getOffsetTop(e)-window.pageYOffset<window.innerHeight/2)return e})||activeElement,elements.forEach(e=>{const t=encodeURI(e.getAttribute("id")).toLowerCase();e===activeElement?document.querySelector(`.inner ul li a[href="#${t}"]`).classList.add("active"):document.querySelector(`.inner ul li a[href="#${t}"]`).classList.remove("active")})},!1);const main=parseInt(getComputedStyle(document.body).getPropertyValue("--article-width"),10),toc=parseInt(getComputedStyle(document.body).getPropertyValue("--toc-width"),10),gap=parseInt(getComputedStyle(document.body).getPropertyValue("--gap"),10);function checkTocPosition(){const e=document.body.scrollWidth;e-main-toc*2-gap*4>0?document.getElementById("toc-container").classList.add("wide"):document.getElementById("toc-container").classList.remove("wide")}function getOffsetTop(e){if(!e.getClientRects().length)return 0;let t=e.getBoundingClientRect(),n=e.ownerDocument.defaultView;return t.top+n.pageYOffset}</script><div class=post-content><h2 id=å‰è¨€>å‰è¨€<a hidden class=anchor aria-hidden=true href=#å‰è¨€>#</a></h2><p>IgH EtherCAT Master æ˜¯ä¸€ä¸ªå¼€æºçš„EtherCATä¸»ç«™é©±åŠ¨ç¨‹åºï¼Œç”¨äºç®¡ç†EtherCATä»ç«™è®¾å¤‡ï¼Œæ”¯æŒLinuxæ“ä½œç³»ç»Ÿï¼Œå·¥æ§ä¸Šä½¿ç”¨çš„æ¯”è¾ƒå¤šã€‚</p><p>dls ethercatæ˜¯ç”±è‹±å›½é’»çŸ³å…‰æºå¼€å‘çš„ç”¨äº EPICS æ§åˆ¶ç³»ç»Ÿ EtherCAT è®¾å¤‡çš„æ”¯æŒç¨‹åºï¼ŒåŸºäº IgH Master ä¸»ç«™ç¨‹åºå¼€å‘ï¼Œå®ç°å¯¹ EtherCAT æ€»çº¿è®¾å¤‡çš„è¯»å†™ã€‚</p><p>äº¤å‰ç¼–è¯‘ç¯å¢ƒï¼šUbuntu</p><p>è¿è¡Œå¼€å‘æ¿ï¼šé¾™èŠ¯2K0500é‡‘é¾™å¼€å‘æ¿</p><p>å†…æ ¸ç‰ˆæœ¬ï¼šLinux LS-GD 5.10.0-rt17.lsgd #1 PREEMPT_RT</p><h2 id=ç›¸å…³è½¯ä»¶åŒ…ä¸‹è½½åœ°å€>ç›¸å…³è½¯ä»¶åŒ…ä¸‹è½½åœ°å€<a hidden class=anchor aria-hidden=true href=#ç›¸å…³è½¯ä»¶åŒ…ä¸‹è½½åœ°å€>#</a></h2><ul><li><p><a href=https://git.launchpad.net/epics-base>epics-base - (launchpad.net)</a> / <a href=https://github.com/epics-base/epics-base>epics-base/epics-base</a> / <a href=https://epics.anl.gov/base/index.php>EPICS Base (anl.gov)</a></p></li><li><p><a href=https://github.com/epics-modules/asyn>epics-modules/asyn: EPICS module for driver and device support</a></p></li><li><p><a href=https://github.com/epics-modules/busy>epics-modules/busy: APS BCDA synApps module: busy</a></p></li><li><p><a href=https://github.com/epics-modules/autosave>epics-modules/autosave: APS BCDA synApps module: autosave</a></p></li><li><p><a href=https://github.com/dls-controls/ethercat>dls-controls/ethercat: EPICS support to read/write to ethercat based hardware</a></p></li><li><p><a href=https://gitlab.com/etherlab.org/ethercat/-/tree/stable-1.5>IgH EtherCAT Master for Linux</a></p></li><li><p><a href=https://mirrors.tuna.tsinghua.edu.cn/kernel/projects/rt/>PREEMPT RT patch</a></p></li></ul><h2 id=é…ç½®äº¤å‰ç¼–è¯‘ç¯å¢ƒ>é…ç½®äº¤å‰ç¼–è¯‘ç¯å¢ƒ<a hidden class=anchor aria-hidden=true href=#é…ç½®äº¤å‰ç¼–è¯‘ç¯å¢ƒ>#</a></h2><p>å…³äºè¿™ä¸€èŠ‚ï¼Œä¹‹å‰çš„æ–‡ç« å·²ç»è¯¦ç»†è®²è¿‡ï¼Œå‚è€ƒ<a href=../%E9%BE%99%E8%8A%AF2k500%E5%BC%80%E5%8F%91%E6%9D%BF%E4%B8%8A%E5%AE%9E%E7%8E%B0%E7%9A%84%E5%91%BC%E5%90%B8%E7%81%AF%E6%95%88%E6%9E%9C/#%E9%85%8D%E7%BD%AE%E4%BA%A4%E5%8F%89%E7%BC%96%E8%AF%91%E7%8E%AF%E5%A2%83>é…ç½®äº¤å‰ç¼–è¯‘ç¯å¢ƒ</a>ã€‚</p><p>å¦‚æœä½ ä½¿ç”¨çš„æ˜¯å…¶ä»–å¼€å‘å¥—ä»¶ï¼Œè¯·æŒ‰ç…§å¼€å‘æ‰‹å†Œå®‰è£…é…ç½®å¥½ç¯å¢ƒã€‚</p><h2 id=ç¼–è¯‘-igh-ethercat-master>ç¼–è¯‘ IgH EtherCAT Master<a hidden class=anchor aria-hidden=true href=#ç¼–è¯‘-igh-ethercat-master>#</a></h2><p><strong>æºç ä¸€å®šè¦ä¸‹è½½ <em>stable-1.5</em> åˆ†æ”¯çš„ï¼Œå…¶ä»–ç‰ˆæœ¬æˆ‘ä¹Ÿæ²¡æœ‰æµ‹è¯•ï¼</strong></p><h3 id=æ‰“è¡¥ä¸>æ‰“è¡¥ä¸<a hidden class=anchor aria-hidden=true href=#æ‰“è¡¥ä¸>#</a></h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl><span class=c1># å…ˆå°†è¡¥ä¸å¤åˆ¶åˆ°ethercaté©±åŠ¨æºç ä¸‹</span>
</span></span><span class=line><span class=cl>cp ethercat-master/etc/makeDocumentation/configurable-error-suppression.patch ethercat-stable-1.5/
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>cd</span> ethercat-stable-1.5/
</span></span><span class=line><span class=cl><span class=c1># æ‰“è¡¥ä¸</span>
</span></span><span class=line><span class=cl>patch -p1 &lt; configurable-error-suppression.patch
</span></span><span class=line><span class=cl><span class=c1># è¿™é‡Œéœ€è¦æ³¨æ„ä¸€ä¸‹patchçš„è¾“å‡ºç»“æœ</span>
</span></span></code></pre></td></tr></table></div></div><p>ç”±äºè¡¥ä¸çš„æ—¶é—´æ¯”è¾ƒæ—©ï¼Œè·Ÿç°æœ‰çš„æºç ä¸å¤ªåŒ¹é…ï¼Œæœ‰äº›åœ°æ–¹è¡¥ä¸ä¼šå¤±è´¥ï¼ˆFAILEDï¼‰ã€‚æ¯”å¦‚æˆ‘è¿™é‡Œçš„æŠ¥é”™ï¼Œå¯èƒ½éœ€è¦å†æ‰‹åŠ¨ä¿®æ”¹ä¸€ä¸‹ã€‚</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>patching file lib/Makefile.am
</span></span><span class=line><span class=cl>Hunk <span class=c1>#1 succeeded at 32 (offset -2 lines).</span>
</span></span><span class=line><span class=cl>patching file lib/common.c
</span></span><span class=line><span class=cl>patching file lib/domain.c
</span></span><span class=line><span class=cl>patching file lib/liberror-documentation.txt
</span></span><span class=line><span class=cl>patching file lib/liberror.c
</span></span><span class=line><span class=cl>patching file lib/liberror.h
</span></span><span class=line><span class=cl>patching file lib/master.c
</span></span><span class=line><span class=cl>Hunk <span class=c1>#1 succeeded at 37 (offset -2 lines).</span>
</span></span><span class=line><span class=cl>...
</span></span><span class=line><span class=cl>Hunk <span class=c1>#12 FAILED at 419.</span>
</span></span><span class=line><span class=cl>Hunk <span class=c1>#13 FAILED at 448.</span>
</span></span><span class=line><span class=cl>...
</span></span><span class=line><span class=cl><span class=m>2</span> out of <span class=m>31</span> hunks FAILED -- saving rejects to file lib/master.c.rej
</span></span><span class=line><span class=cl>patching file lib/reg_request.c
</span></span><span class=line><span class=cl>Hunk <span class=c1>#1 succeeded at 39 (offset -2 lines).</span>
</span></span><span class=line><span class=cl>...
</span></span><span class=line><span class=cl>patching file lib/sdo_request.c
</span></span><span class=line><span class=cl>Hunk <span class=c1>#1 succeeded at 39 (offset -2 lines).</span>
</span></span><span class=line><span class=cl>...
</span></span><span class=line><span class=cl>patching file lib/slave_config.c
</span></span><span class=line><span class=cl>Hunk <span class=c1>#1 succeeded at 39 (offset -1 lines).</span>
</span></span><span class=line><span class=cl>...
</span></span><span class=line><span class=cl>patching file lib/voe_handler.c
</span></span><span class=line><span class=cl>Hunk <span class=c1>#1 succeeded at 40 (offset -2 lines).</span>
</span></span><span class=line><span class=cl>...
</span></span></code></pre></td></tr></table></div></div><p>æˆ‘ä»¬å‚è€ƒ<code>lib/master.c.rej</code>ï¼Œæ‰‹åŠ¨ä¿®æ”¹ä¸€ä¸‹ã€‚</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-diff data-lang=diff><span class=line><span class=cl># lib/master.c.rej
</span></span><span class=line><span class=cl><span class=gd>--- lib/master.c	Tue Feb 12 17:31:08 2013 +0100
</span></span></span><span class=line><span class=cl><span class=gd></span><span class=gi>+++ lib/master.c	Mon Mar 23 15:52:53 2015 +0000
</span></span></span><span class=line><span class=cl><span class=gi></span><span class=gu>@@ -419,7 +431,8 @@
</span></span></span><span class=line><span class=cl><span class=gu></span>         if (EC_IOCTL_ERRNO(ret) == EIO &amp;&amp; abort_code) {
</span></span><span class=line><span class=cl>             *abort_code = download.abort_code;
</span></span><span class=line><span class=cl>         }
</span></span><span class=line><span class=cl><span class=gd>-        fprintf(stderr, &#34;Failed to execute SDO download: %s\n&#34;,
</span></span></span><span class=line><span class=cl><span class=gd></span><span class=gi>+        ecrt_errcode = ECRT_ERRMASTERSDODOWNLOAD;
</span></span></span><span class=line><span class=cl><span class=gi>+        ERRPRINTF(&#34;Failed to execute SDO download: %s\n&#34;,
</span></span></span><span class=line><span class=cl><span class=gi></span>             strerror(EC_IOCTL_ERRNO(ret)));
</span></span><span class=line><span class=cl>         return -EC_IOCTL_ERRNO(ret);
</span></span><span class=line><span class=cl>     }
</span></span><span class=line><span class=cl><span class=gu>@@ -448,7 +461,8 @@
</span></span></span><span class=line><span class=cl><span class=gu></span>         if (EC_IOCTL_ERRNO(ret) == EIO &amp;&amp; abort_code) {
</span></span><span class=line><span class=cl>             *abort_code = download.abort_code;
</span></span><span class=line><span class=cl>         }
</span></span><span class=line><span class=cl><span class=gd>-        fprintf(stderr, &#34;Failed to execute SDO download: %s\n&#34;,
</span></span></span><span class=line><span class=cl><span class=gd></span><span class=gi>+        ecrt_errcode = ECRT_ERRMASTERSDODOWNLOADCOMPLETE;
</span></span></span><span class=line><span class=cl><span class=gi>+        ERRPRINTF(&#34;Failed to execute SDO download: %s\n&#34;,
</span></span></span><span class=line><span class=cl><span class=gi></span>             strerror(EC_IOCTL_ERRNO(ret)));
</span></span><span class=line><span class=cl>         return -EC_IOCTL_ERRNO(ret);
</span></span><span class=line><span class=cl>     }
</span></span></code></pre></td></tr></table></div></div><p>ç„¶åè¿™ä¸ªè¡¥ä¸è¿˜æœ‰ç‚¹é—®é¢˜ï¼Œæˆ‘ä»¬éœ€è¦æ‰‹åŠ¨ä¿®æ”¹ä¸€ä¸‹<code>lib/liberror.c</code>ã€‚è¿™é‡Œæºæ–‡ä»¶å’Œå¤´æ–‡ä»¶å˜é‡å®šä¹‰ä¸ä¸€è‡´ï¼Œç¼–è¯‘ä¼šæŠ¥é”™ï¼Œä»¥å¤´æ–‡ä»¶ä¸ºå‡†ã€‚</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&#34;liberror.h&#34;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp></span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=n>ecrt_err_to_stderr</span> <span class=o>=</span> <span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=c1>// char *ecrt_errstring[ERRSTRING_LEN];
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kt>char</span> <span class=n>ecrt_errstring</span><span class=p>[</span><span class=n>ERRSTRING_LEN</span><span class=p>];</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=n>ecrt_errcode</span><span class=p>;</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=å‡†å¤‡å†…æ ¸æºç >å‡†å¤‡å†…æ ¸æºç <a hidden class=anchor aria-hidden=true href=#å‡†å¤‡å†…æ ¸æºç >#</a></h3><p>ç”±äºéœ€è¦å°†æºç ç¼–è¯‘æˆç›¸åº”çš„ç³»ç»Ÿé©±åŠ¨ï¼Œæ‰€ä»¥è¿™é‡Œéœ€è¦ä½¿ç”¨å†…æ ¸çš„æºç ã€‚</p><p>å¦‚æœæ˜¯æ ‡å‡†ç³»ç»Ÿï¼Œå¯ä»¥ç›´æ¥å®‰è£…<code>linux-headers</code>ã€‚</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl><span class=c1># Ubuntu/Debian</span>
</span></span><span class=line><span class=cl>sudo apt install linux-headers-<span class=k>$(</span>uname -r<span class=k>)</span>
</span></span></code></pre></td></tr></table></div></div><p>æ ‘è“æ´¾ç³»ç»Ÿ</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>sudo apt install raspberrypi-kernel-headers
</span></span></code></pre></td></tr></table></div></div><p><strong>è€Œå¯¹äºå¼€å‘æ¿ç³»ç»Ÿï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨éšå¼€å‘æ¿æä¾›çš„å†…æ ¸æºç ã€‚</strong></p><p><em>å†…æ ¸çš„ç¼–è¯‘æ­¥éª¤è¯·æ ¹æ®å¼€å‘æ¿çš„ç”¨æˆ·æ‰‹å†Œå®Œæˆã€‚</em></p><p><strong>æœ€å¥½å†ç»™å†…æ ¸æ‰“ä¸Š <code>PREEMPT_RT</code> è¡¥ä¸ã€‚</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl><span class=c1># è§£å‹å†…æ ¸æºç </span>
</span></span><span class=line><span class=cl>tar -xvf linux-5.10-2k500-src-f45937d-build.20230721100738.tar.gz
</span></span><span class=line><span class=cl><span class=c1># linux-5.10-2k500-cbd-src</span>
</span></span><span class=line><span class=cl><span class=nb>cd</span> linux-5.10-2k500-cbd-src/
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># ä¸ºå†…æ ¸æ‰“ä¸Šå®æ—¶è¡¥ä¸ï¼ˆå¯é€‰ï¼‰</span>
</span></span><span class=line><span class=cl>patch -p1 &lt; patch-5.10-rt17.patch
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># é…ç½®äº¤å‰ç¼–è¯‘å™¨</span>
</span></span><span class=line><span class=cl>./set_env.sh
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># ç¼–è¯‘å†…æ ¸</span>
</span></span><span class=line><span class=cl>make loongson_2k500_defconfig
</span></span><span class=line><span class=cl><span class=c1># make menuconfig</span>
</span></span><span class=line><span class=cl>make uImage
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># ç¼–è¯‘æ¨¡å—</span>
</span></span><span class=line><span class=cl>make modules
</span></span></code></pre></td></tr></table></div></div><h3 id=ç¼–è¯‘-ethercat-master-é©±åŠ¨>ç¼–è¯‘ EtherCAT Master é©±åŠ¨<a hidden class=anchor aria-hidden=true href=#ç¼–è¯‘-ethercat-master-é©±åŠ¨>#</a></h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl><span class=nb>cd</span> ethercat-stable-1.5/
</span></span><span class=line><span class=cl><span class=c1># to create the configure script, if downloaded from the repo</span>
</span></span><span class=line><span class=cl>./bootstrap
</span></span><span class=line><span class=cl><span class=c1># è¿™é‡Œéœ€è¦æ³¨æ„æ˜¯å¦å‡ºç°æŠ¥é”™ï¼Œéœ€è¦å®‰è£… autoconfã€pkg-config ç­‰å·¥å…·</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># æ‰§è¡Œconfigure</span>
</span></span><span class=line><span class=cl><span class=c1># --host æŒ‡å®šç¨‹åºè¿è¡Œçš„ä¸»æœºæ¶æ„</span>
</span></span><span class=line><span class=cl><span class=c1># --with-linux-dir æŒ‡å®šæºç ç›®å½•</span>
</span></span><span class=line><span class=cl><span class=c1># å¦‚æœæ˜¯å®‰è£…çš„linux-headersï¼Œé€šå¸¸åœ¨ /usr/src/linux-headers-xxx</span>
</span></span><span class=line><span class=cl><span class=c1># å¦‚æœç›´æ¥ä½¿ç”¨å†…æ ¸æºç ï¼Œåˆ™å¿…é¡»é€šè¿‡ä¸Šè¿°ç¼–è¯‘æ­¥éª¤ï¼</span>
</span></span><span class=line><span class=cl><span class=c1># --prefix æŒ‡å®šå®‰è£…ç›®å½•</span>
</span></span><span class=line><span class=cl>./configure --host<span class=o>=</span>loongarch64-linux-gnu <span class=nv>CC</span><span class=o>=</span>loongarch64-linux-gnu-gcc --enable-generic<span class=o>=</span>yes --enable-8139too<span class=o>=</span>no --with-linux-dir<span class=o>=</span>/path/to/linux-5.10-2k500-cbd-src --prefix<span class=o>=</span>/path/to/__install_dir
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># ç¼–è¯‘</span>
</span></span><span class=line><span class=cl>make all modules
</span></span><span class=line><span class=cl><span class=c1># æˆ–è€…</span>
</span></span><span class=line><span class=cl><span class=c1># make</span>
</span></span><span class=line><span class=cl><span class=c1># make ARCH=loongarch CORSS_COMPILE=loongarch64-linux-gnu- modules</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># å®‰è£…ç”Ÿæˆçš„æ–‡ä»¶</span>
</span></span><span class=line><span class=cl><span class=c1># make install</span>
</span></span></code></pre></td></tr></table></div></div><p>å¦‚æœå®Œå…¨æŒ‰ç…§ä¸Šè¿°æ­¥éª¤ï¼Œåº”è¯¥å¯ä»¥ç¼–è¯‘æˆåŠŸã€‚</p><p>ä¸‹é¢æ•´ç†ä¸€ä¸‹ç”Ÿæˆçš„æ–‡ä»¶ã€‚</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl><span class=c1># å¤åˆ¶ç”Ÿæˆçš„ä¸»ç¨‹åº</span>
</span></span><span class=line><span class=cl>cp tool/ethercat /path/to/__install_dir/bin/
</span></span><span class=line><span class=cl><span class=c1># å¤åˆ¶ç”Ÿæˆçš„é©±åŠ¨ç¨‹åº</span>
</span></span><span class=line><span class=cl>cp device/ec_generic.ko /path/to/__install_dir/modules/
</span></span><span class=line><span class=cl>cp master/ec_master.ko /path/to/__install_dir/modules/
</span></span></code></pre></td></tr></table></div></div><p>è¿™æ˜¯æˆ‘æ•´ç†çš„æ–‡ä»¶ï¼Œåé¢éœ€è¦å°†è¿™äº›æ–‡ä»¶ä¸‹è½½åˆ°å¼€å‘æ¿ã€‚</p><pre tabindex=0><code>__install_dir
â”œâ”€ bin
â”‚   â””â”€ ethercat (ä¸»ç¨‹åº)
â”œâ”€ etc (é…ç½®)
â”œâ”€ include (å¤´æ–‡ä»¶)
â”œâ”€ lib (libethercat.so)
â”œâ”€ modules (é©±åŠ¨ç›®å½•)
â”‚   â”œâ”€ ec_master.ko
â”‚   â””â”€ ec_generic.ko
â”œâ”€ sbin
â”‚   â””â”€ ethercatctl
â””â”€ share
    â””â”€ bash-completion/ (bashè‡ªåŠ¨è¡¥å…¨)
</code></pre><h2 id=ç¼–è¯‘-epics-ethercat-æ¨¡å—>ç¼–è¯‘ <strong>EPICS</strong> ethercat æ¨¡å—<a hidden class=anchor aria-hidden=true href=#ç¼–è¯‘-epics-ethercat-æ¨¡å—>#</a></h2><p><strong>ä»¥ä¸‹æ­¥éª¤éœ€è¦å…ˆå®‰è£…å¥½EPICS Base!</strong></p><h3 id=ç¼–è¯‘-asyn>ç¼–è¯‘ asyn<a hidden class=anchor aria-hidden=true href=#ç¼–è¯‘-asyn>#</a></h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl><span class=nb>cd</span> asyn
</span></span><span class=line><span class=cl>touch configure/RELEASE.local
</span></span><span class=line><span class=cl>vi configure/RELEASE.local
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># ä¿®æ”¹æˆå’ŒEPICS Baseä¸€æ ·çš„æ¶æ„</span>
</span></span><span class=line><span class=cl><span class=nv>EPICS_HOST_ARCH</span><span class=o>=</span>linux-la64
</span></span><span class=line><span class=cl><span class=c1># EPICS Baseè·¯å¾„ï¼ˆç¤ºä¾‹ï¼‰</span>
</span></span><span class=line><span class=cl><span class=nv>EPICS_BASE</span><span class=o>=</span>/home/ubuntu/loongson/base-7.0.8
</span></span><span class=line><span class=cl><span class=c1># æ”¾ç½®EPICSæ¨¡å—çš„è·¯å¾„ï¼ˆç¤ºä¾‹ï¼‰</span>
</span></span><span class=line><span class=cl><span class=nv>SUPPORT</span><span class=o>=</span>/home/ubuntu/loongson/modules
</span></span><span class=line><span class=cl><span class=c1># SSCANæ¨¡å—è·¯å¾„</span>
</span></span><span class=line><span class=cl><span class=c1># SSCAN=$(SUPPORT)/sscan</span>
</span></span><span class=line><span class=cl><span class=c1># CALCæ¨¡å—è·¯å¾„</span>
</span></span><span class=line><span class=cl><span class=c1># CALC=$(SUPPORT)/calc</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># ç›´æ¥ç¼–è¯‘</span>
</span></span><span class=line><span class=cl><span class=c1># make</span>
</span></span><span class=line><span class=cl><span class=c1># äº¤å‰ç¼–è¯‘ï¼ˆç¤ºä¾‹ï¼‰</span>
</span></span><span class=line><span class=cl>make <span class=nv>LD</span><span class=o>=</span>loongarch64-linux-gnu-ld <span class=nv>CC</span><span class=o>=</span>loongarch64-linux-gnu-gcc <span class=nv>CCC</span><span class=o>=</span>loongarch64-linux-gnu-g++
</span></span></code></pre></td></tr></table></div></div><h3 id=ç¼–è¯‘-autosave>ç¼–è¯‘ autosave<a hidden class=anchor aria-hidden=true href=#ç¼–è¯‘-autosave>#</a></h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl><span class=nb>cd</span> autosave
</span></span><span class=line><span class=cl>touch configure/RELEASE.local
</span></span><span class=line><span class=cl>vi configure/RELEASE.local
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># ä¿®æ”¹æˆå’ŒEPICS Baseä¸€æ ·çš„æ¶æ„</span>
</span></span><span class=line><span class=cl><span class=nv>EPICS_HOST_ARCH</span><span class=o>=</span>linux-la64
</span></span><span class=line><span class=cl><span class=c1># EPICS Baseè·¯å¾„ï¼ˆç¤ºä¾‹ï¼‰</span>
</span></span><span class=line><span class=cl><span class=nv>EPICS_BASE</span><span class=o>=</span>/home/ubuntu/loongson/base-7.0.8
</span></span><span class=line><span class=cl><span class=c1># æ”¾ç½®EPICSæ¨¡å—çš„è·¯å¾„ï¼ˆç¤ºä¾‹ï¼‰</span>
</span></span><span class=line><span class=cl><span class=nv>SUPPORT</span><span class=o>=</span>/home/ubuntu/loongson/modules
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># ç›´æ¥ç¼–è¯‘</span>
</span></span><span class=line><span class=cl><span class=c1># make</span>
</span></span><span class=line><span class=cl><span class=c1># äº¤å‰ç¼–è¯‘ï¼ˆç¤ºä¾‹ï¼‰</span>
</span></span><span class=line><span class=cl>make <span class=nv>LD</span><span class=o>=</span>loongarch64-linux-gnu-ld <span class=nv>CC</span><span class=o>=</span>loongarch64-linux-gnu-gcc <span class=nv>CCC</span><span class=o>=</span>loongarch64-linux-gnu-g++
</span></span></code></pre></td></tr></table></div></div><h3 id=ç¼–è¯‘-busy>ç¼–è¯‘ busy<a hidden class=anchor aria-hidden=true href=#ç¼–è¯‘-busy>#</a></h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl><span class=nb>cd</span> busy
</span></span><span class=line><span class=cl>touch configure/RELEASE.local
</span></span><span class=line><span class=cl>vi configure/RELEASE.local
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># ä¿®æ”¹æˆå’ŒEPICS Baseä¸€æ ·çš„æ¶æ„</span>
</span></span><span class=line><span class=cl><span class=nv>EPICS_HOST_ARCH</span><span class=o>=</span>linux-la64
</span></span><span class=line><span class=cl><span class=c1># EPICS Baseè·¯å¾„ï¼ˆç¤ºä¾‹ï¼‰</span>
</span></span><span class=line><span class=cl><span class=nv>EPICS_BASE</span><span class=o>=</span>/home/ubuntu/loongson/base-7.0.8
</span></span><span class=line><span class=cl><span class=c1># æ”¾ç½®EPICSæ¨¡å—çš„è·¯å¾„ï¼ˆç¤ºä¾‹ï¼‰</span>
</span></span><span class=line><span class=cl><span class=nv>SUPPORT</span><span class=o>=</span>/home/ubuntu/loongson/modules
</span></span><span class=line><span class=cl><span class=c1># ASYNæ¨¡å—è·¯å¾„</span>
</span></span><span class=line><span class=cl><span class=nv>ASYN</span><span class=o>=</span><span class=k>$(</span>SUPPORT<span class=k>)</span>/asyn
</span></span><span class=line><span class=cl><span class=c1># AUTOSAVEæ¨¡å—è·¯å¾„</span>
</span></span><span class=line><span class=cl><span class=nv>AUTOSAVE</span><span class=o>=</span><span class=k>$(</span>SUPPORT<span class=k>)</span>/autosave
</span></span><span class=line><span class=cl><span class=c1># BUSYæ¨¡å—è·¯å¾„</span>
</span></span><span class=line><span class=cl><span class=nv>BUSY</span><span class=o>=</span><span class=k>$(</span>SUPPORT<span class=k>)</span>/busy
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># ç›´æ¥ç¼–è¯‘</span>
</span></span><span class=line><span class=cl><span class=c1># make</span>
</span></span><span class=line><span class=cl><span class=c1># äº¤å‰ç¼–è¯‘ï¼ˆç¤ºä¾‹ï¼‰</span>
</span></span><span class=line><span class=cl>make <span class=nv>LD</span><span class=o>=</span>loongarch64-linux-gnu-ld <span class=nv>CC</span><span class=o>=</span>loongarch64-linux-gnu-gcc <span class=nv>CCC</span><span class=o>=</span>loongarch64-linux-gnu-g++
</span></span></code></pre></td></tr></table></div></div><h3 id=ç¼–è¯‘-ethercat>ç¼–è¯‘ ethercat<a hidden class=anchor aria-hidden=true href=#ç¼–è¯‘-ethercat>#</a></h3><p>è¿™ä¸€æ­¥å¯ä»¥è¯´æ˜¯æœ€éº»çƒ¦ï¼Œé—®é¢˜æœ€å¤šçš„ã€‚ç¼–è¯‘å‡ºä»€ä¹ˆé—®é¢˜éƒ½éœ€è¦å»æ‰¾åˆ°ç›¸åº”çš„<code>Makefile</code>ä¿®æ”¹ã€‚</p><blockquote><p>ç”±äºè¯¥è½¯ä»¶åŒ…å·²ç»é•¿æ—¶é—´æ— äººç»´æŠ¤ï¼Œå»ºè®®ä½¿ç”¨æˆ‘<a href=https://github.com/kira-96/epics-ethercat>ä¿®æ”¹è¿‡çš„ç‰ˆæœ¬</a>ã€‚</p></blockquote><p>é¦–å…ˆéœ€è¦å®‰è£…æ‰€éœ€çš„åŒ…<em>libxml2-dev</em>ã€‚ä½†æˆ‘ä»¬å®é™…ä¸Šå¹¶ä¸éœ€è¦ç”¨è¿™ä¸ªè½¯ä»¶åŒ…ï¼Œæˆ‘ä»¬åªéœ€è¦å®ƒçš„å¤´æ–‡ä»¶ã€‚</p><p><strong>è½¯ä»¶ä¾èµ–çš„åŠ¨æ€åº“(.so)æ–‡ä»¶ï¼Œæˆ‘ä»¬åˆ™éœ€è¦ä»å¼€å‘æ¿ç³»ç»Ÿä¸­æ‹·è´å‡ºæ¥ï¼Œæ— æ³•ç›´æ¥ç”¨ç¼–è¯‘ç”µè„‘çš„åŠ¨æ€åº“ã€‚</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl><span class=nb>cd</span> ethercat-master/
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># åˆ›å»º 3rd ç›®å½•ï¼Œç”¨äºæ”¾ç½®æ‰€éœ€çš„å¤´æ–‡ä»¶å’ŒåŠ¨æ€åº“</span>
</span></span><span class=line><span class=cl>mkdir 3rd
</span></span><span class=line><span class=cl>mkdir 3rd/include
</span></span><span class=line><span class=cl>mkdir 3rd/lib
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># å®‰è£… libxml2-dev</span>
</span></span><span class=line><span class=cl>sudo apt install libxml2-dev
</span></span><span class=line><span class=cl><span class=c1># ä»ç³»ç»Ÿç›®å½•ä¸­å¤åˆ¶å‡ºlibxml2çš„å¤´æ–‡ä»¶</span>
</span></span><span class=line><span class=cl><span class=c1># å› ä¸ºè¿˜éœ€è¦åšä¸€äº›ä¿®æ”¹ï¼Œä¸èƒ½ç›´æ¥ä½¿ç”¨</span>
</span></span><span class=line><span class=cl>cp -r /usr/include/libxml2/ ./3rd/include/
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># å¤åˆ¶åˆšåˆšç¼–è¯‘ç”Ÿæˆçš„ libethercat</span>
</span></span><span class=line><span class=cl>cp /path/to/__install_dir/lib/libethercat.so* ./3rd/lib/
</span></span><span class=line><span class=cl><span class=c1># ä»å¼€å‘æ¿ç³»ç»Ÿå¤åˆ¶æ‰€éœ€è¦çš„åŠ¨æ€åº“</span>
</span></span><span class=line><span class=cl><span class=c1># libxml2 ä¾èµ– libz å’Œ liblzma</span>
</span></span><span class=line><span class=cl>scp root@192.168.1.10:/usr/lib/libxml2.so.2.9.12 ./3rd/lib/
</span></span><span class=line><span class=cl>scp root@192.168.1.10:/usr/lib/libz.so.1.2.11 ./3rd/lib/
</span></span><span class=line><span class=cl>scp root@192.168.1.10:/usr/lib/liblzma.so.5.2.5 ./3rd/lib/
</span></span><span class=line><span class=cl><span class=c1># æ‰‹åŠ¨åˆ›å»ºä¸€ä¸‹é“¾æ¥</span>
</span></span><span class=line><span class=cl><span class=nb>cd</span> 3rd/lib/
</span></span><span class=line><span class=cl>ln -s libxml2.so.2.9.12 libxml2.so.2
</span></span><span class=line><span class=cl>ln -s libxml2.so.2 libxml2.so
</span></span><span class=line><span class=cl>ln -s liblzma.so.5.2.5 liblzma.so.5
</span></span><span class=line><span class=cl>ln -s liblzma.so.5 liblzma.so
</span></span><span class=line><span class=cl>ln -s libz.so.1.2.11 libz.so.1
</span></span><span class=line><span class=cl>ln -s libz.so.1 libz.so
</span></span></code></pre></td></tr></table></div></div><p>ç„¶åéœ€è¦ä¿®æ”¹ä¸€ä¸‹<em>libxml2</em>çš„å¤´æ–‡ä»¶ï¼Œä¸ç„¶ç¼–è¯‘çš„æ—¶å€™ä¼šæŠ¥é”™ã€‚</p><p>æŠ¥é”™ä¿¡æ¯ï¼š</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>In file included from ../../../libxml2/libxml/parser.h:812,
</span></span><span class=line><span class=cl>                 from ../../../libxml2/libxml/globals.h:18,
</span></span><span class=line><span class=cl>                 from ../../../libxml2/libxml/threads.h:35,
</span></span><span class=line><span class=cl>                 from ../../../libxml2/libxml/xmlmemory.h:218,
</span></span><span class=line><span class=cl>                 from ../../../libxml2/libxml/tree.h:1307,
</span></span><span class=line><span class=cl>                 from ../parser.c:10:
</span></span><span class=line><span class=cl>../../../libxml2/libxml/encoding.h:31:10: fatal error: unicode/ucnv.h: No such file or directory
</span></span><span class=line><span class=cl> <span class=c1>#include &lt;unicode/ucnv.h&gt;</span>
</span></span><span class=line><span class=cl>          ^~~~~~~~~~~~~~~~
</span></span><span class=line><span class=cl>compilation terminated.
</span></span></code></pre></td></tr></table></div></div><p>è§£å†³æ–¹æ³•ï¼š</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl><span class=c1># ä¿®æ”¹ xmlversion.h</span>
</span></span><span class=line><span class=cl>vi 3rd/include/libxml2/libxml/xmlversion.h
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># æ‰¾åˆ°ä¸‹é¢è¡Œï¼Œç¦ç”¨ LIBXML_ICU_ENABLED</span>
</span></span><span class=line><span class=cl><span class=c1>#define LIBXML_ICU_ENABLED</span>
</span></span><span class=line><span class=cl><span class=c1># å°† #if 1 æ”¹ä¸º #if 0</span>
</span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span><span class=lnt>9
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-diff data-lang=diff><span class=line><span class=cl>/**
</span></span><span class=line><span class=cl> * LIBXML_ICU_ENABLED:
</span></span><span class=line><span class=cl> *
</span></span><span class=line><span class=cl> * Whether icu support is available
</span></span><span class=line><span class=cl> */
</span></span><span class=line><span class=cl><span class=gd>- #if 0
</span></span></span><span class=line><span class=cl><span class=gd></span><span class=gi>+ #if 1
</span></span></span><span class=line><span class=cl><span class=gi></span>#define LIBXML_ICU_ENABLED
</span></span><span class=line><span class=cl>#endif
</span></span></code></pre></td></tr></table></div></div><p>åšå¥½ä¸Šé¢çš„å‡†å¤‡å·¥ä½œï¼Œè¿˜éœ€è¦ä¿®æ”¹æºç ä¸­çš„è·¯å¾„é…ç½®ï¼Œç„¶åæ‰èƒ½æ­£å¸¸ç¼–è¯‘ã€‚<br>ä¸‹é¢éƒ½æ˜¯æˆ‘è¸©å‘ç•™ä¸‹çš„è®°å½•ã€‚</p><ol><li>ä¿®æ”¹ <em>configure/RELEASE</em></li></ol><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl><span class=nb>cd</span> ethercat-master/
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># é¦–å…ˆä¿®æ”¹ configure/RELEASE</span>
</span></span><span class=line><span class=cl>vi configure/RELEASE
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># éœ€è¦ä¿®æ”¹çš„æœ‰4é¡¹</span>
</span></span><span class=line><span class=cl><span class=c1># æ”¾ç½®EPICSæ¨¡å—çš„è·¯å¾„ï¼ˆç¤ºä¾‹ï¼‰</span>
</span></span><span class=line><span class=cl><span class=nv>SUPPORT</span><span class=o>=</span>/home/ubuntu/loongson/modules
</span></span><span class=line><span class=cl><span class=c1># ASYNæ¨¡å—è·¯å¾„</span>
</span></span><span class=line><span class=cl><span class=nv>ASYN</span><span class=o>=</span><span class=k>$(</span>SUPPORT<span class=k>)</span>/asyn
</span></span><span class=line><span class=cl><span class=c1># BUSYæ¨¡å—è·¯å¾„</span>
</span></span><span class=line><span class=cl><span class=nv>BUSY</span><span class=o>=</span><span class=k>$(</span>SUPPORT<span class=k>)</span>/busy
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># ä¿®æ”¹æˆå’ŒEPICS Baseä¸€æ ·çš„æ¶æ„</span>
</span></span><span class=line><span class=cl><span class=nv>EPICS_HOST_ARCH</span><span class=o>=</span>linux-la64
</span></span><span class=line><span class=cl><span class=c1># EPICS Baseè·¯å¾„ï¼ˆç¤ºä¾‹ï¼‰</span>
</span></span><span class=line><span class=cl><span class=nv>EPICS_BASE</span><span class=o>=</span>/home/ubuntu/loongson/base-7.0.8
</span></span></code></pre></td></tr></table></div></div><ol start=2><li>ä¿®æ”¹ <em>ethercatApp/scannerSrc/Makefile</em></li></ol><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl><span class=nb>cd</span> ethercat-master/
</span></span><span class=line><span class=cl><span class=c1># ä¿®æ”¹ ethercatApp/scannerSrc/Makefile</span>
</span></span><span class=line><span class=cl>vi ethercatApp/scannerSrc/Makefile
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># éœ€è¦ä¿®æ”¹ EtherCAT Master æºç ç›¸å…³è·¯å¾„ã€</span>
</span></span><span class=line><span class=cl><span class=c1># libxml2å¤´æ–‡ä»¶è·¯å¾„ã€åŠ¨æ€åº“(.so)è·¯å¾„</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># ä¿®æ”¹ ETHERLAB æºç è·¯å¾„</span>
</span></span><span class=line><span class=cl><span class=nv>ETHERLAB</span><span class=o>=</span>/path/to/ethercat-stable-1.5
</span></span><span class=line><span class=cl><span class=nv>ETHERLABPREFIX</span><span class=o>=</span><span class=k>$(</span>ETHERLAB<span class=k>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nv>USR_INCLUDES</span> <span class=o>+=</span> -I<span class=k>$(</span>ETHERLABPREFIX<span class=k>)</span>/include
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># ä¿®æ”¹åŠ¨æ€åº“è·¯å¾„</span>
</span></span><span class=line><span class=cl><span class=nv>USR_LDFLAGS</span> <span class=o>+=</span> -L<span class=k>$(</span>TOP<span class=k>)</span>/3rd/lib -Wl,-rpath<span class=o>=</span><span class=k>$(</span>TOP<span class=k>)</span>/3rd/lib
</span></span><span class=line><span class=cl><span class=c1># ä¿®æ”¹ libxml2 å¤´æ–‡ä»¶è·¯å¾„</span>
</span></span><span class=line><span class=cl><span class=nv>USR_INCLUDES</span> <span class=o>+=</span> -I<span class=k>$(</span>TOP<span class=k>)</span>/3rd/include/libxml2
</span></span><span class=line><span class=cl><span class=nv>USR_SYS_LIBS</span> <span class=o>+=</span> ethercat xml2
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># ä¸‹é¢ç±»ä¼¼</span>
</span></span><span class=line><span class=cl><span class=nv>scanner_INCLUDES</span> <span class=o>+=</span> -I<span class=k>$(</span>ETHERLAB<span class=k>)</span>/lib
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nv>serialtool_INCLUDES</span> <span class=o>+=</span> -I<span class=k>$(</span>ETHERLAB<span class=k>)</span>/master
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>get-slave-revisions_INCLUDES +<span class=o>=</span> -I<span class=k>$(</span>ETHERLAB<span class=k>)</span>/master
</span></span></code></pre></td></tr></table></div></div><ol start=3><li>ä¿®æ”¹ <em>ethercatApp/src/Makefile</em>ï¼Œä¸ä¸Šé¢ç±»ä¼¼ã€‚</li></ol><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl><span class=nb>cd</span> ethercat-master/
</span></span><span class=line><span class=cl><span class=c1># ä¿®æ”¹ ethercatApp/src/Makefile</span>
</span></span><span class=line><span class=cl>vi ethercatApp/src/Makefile
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># éœ€è¦ä¿®æ”¹ EtherCAT Master æºç ç›¸å…³è·¯å¾„ã€</span>
</span></span><span class=line><span class=cl><span class=c1># libxml2å¤´æ–‡ä»¶è·¯å¾„ã€åŠ¨æ€åº“(.so)è·¯å¾„</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># ä¿®æ”¹ ETHERLAB æºç è·¯å¾„</span>
</span></span><span class=line><span class=cl><span class=nv>ETHERLAB</span><span class=o>=</span>/path/to/ethercat-stable-1.5
</span></span><span class=line><span class=cl><span class=c1># ecAsyn_INCLUDES += -I$(ETHERLAB)/src/ethercat-$(subst -,.,$(VERSION))/include</span>
</span></span><span class=line><span class=cl><span class=c1># gadc_INCLUDES += -I$(ETHERLAB)/src/ethercat-$(subst -,.,$(VERSION))/include</span>
</span></span><span class=line><span class=cl><span class=nv>ecAsyn_INCLUDES</span> <span class=o>+=</span> -I<span class=k>$(</span>ETHERLAB<span class=k>)</span>/include
</span></span><span class=line><span class=cl><span class=nv>gadc_INCLUDES</span> <span class=o>+=</span> -I<span class=k>$(</span>ETHERLAB<span class=k>)</span>/include
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># ä¿®æ”¹ libxml2 å¤´æ–‡ä»¶è·¯å¾„</span>
</span></span><span class=line><span class=cl><span class=nv>USR_INCLUDES</span> <span class=o>+=</span> -I<span class=k>$(</span>TOP<span class=k>)</span>/3rd/include/libxml2
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># æ·»åŠ åŠ¨æ€åº“è·¯å¾„</span>
</span></span><span class=line><span class=cl><span class=nv>USR_LDFLAGS</span> <span class=o>+=</span> -L<span class=k>$(</span>TOP<span class=k>)</span>/3rd/lib -Wl,-rpath<span class=o>=</span><span class=k>$(</span>TOP<span class=k>)</span>/3rd/lib
</span></span><span class=line><span class=cl><span class=nv>USR_SYS_LIBS</span> <span class=o>+=</span> xml2
</span></span></code></pre></td></tr></table></div></div><ol start=4><li>ä¿®æ”¹æºç </li></ol><p>ç”±äº<code>ethercat-master</code>çš„æºç åŸæœ¬æ˜¯ä¸º<code>x86_64</code>æ¶æ„ç¼–å†™çš„ï¼Œç¼–è¯‘åˆ°<code>LoongArch</code>æ¶æ„çš„è®¾å¤‡ä¸Šè¿è¡Œå¯èƒ½ä¼šå‡ºç°ä¸€äº›å¥‡æ€ªçš„é”™è¯¯ã€‚</p><p>ä¾‹å¦‚ï¼Œåœ¨è¿è¡Œ<code>slaveinfo</code>æ—¶ä¼šå‡ºç°<code>Segmentation fault</code>é”™è¯¯ï¼Œè€Œè¿™é€šå¸¸æ˜¯<strong>ç©ºæŒ‡é’ˆ</strong>å¯¼è‡´å†…å­˜è®¿é—®å‡ºé”™ã€‚</p><p>åŸå› åˆ†æï¼š</p><p><code>slaveinfo</code>åœ¨è¿è¡Œæ—¶ä¼šæ ¹æ®ç¨‹åºè‡ªå·±çš„è·¯å¾„å¯»æ‰¾<code>slave-types.txt</code>æ–‡ä»¶ï¼Œé—®é¢˜å°±å‡ºåœ¨è¿™é‡Œã€‚æ¥çœ‹æºç  <code>ethercatApp/scannerSrc/slave-list-path.c</code>ã€‚</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=c1>// ethercatApp/scannerSrc/slave-list-path.c
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>get_root_dir_index</span><span class=p>(</span><span class=k>const</span> <span class=kt>char</span> <span class=o>*</span><span class=n>program_name</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// Search for the binary path
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kt>char</span> <span class=n>binary_dir</span><span class=p>[]</span> <span class=o>=</span> <span class=s>&#34;bin/linux-x86_64/&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// Find the binary path in the program path and return the pointer
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kt>char</span> <span class=o>*</span><span class=n>found</span> <span class=o>=</span> <span class=nf>strstr</span><span class=p>(</span><span class=n>program_name</span><span class=p>,</span> <span class=n>binary_dir</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// Handle the case where it is not found
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=k>if</span> <span class=p>(</span><span class=n>found</span> <span class=o>==</span> <span class=nb>NULL</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=o>-</span><span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1>// Calculate the difference in the pointers to get the index
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=k>return</span> <span class=n>found</span> <span class=o>-</span> <span class=n>program_name</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>è¿™ä¸ª<code>get_root_dir_index</code>å‡½æ•°æ˜¯ç”¨äºè®¡ç®—å½“å‰ç¨‹åº(<code>slaveinfo</code>)æ‰€åœ¨çš„<strong>æ ¹</strong>ç›®å½•ã€‚è¿™é‡Œå‘ä¸ŠæŸ¥æ‰¾çš„è·¯å¾„ä¸º<code>bin/linux-x86_64</code>ï¼Œå½“ç„¶ä¸èƒ½æ‰¾åˆ°<code>LoongArch</code>çš„ç›®å½•<code>bin/linux-la64</code>äº†ã€‚æ‰€ä»¥ï¼Œæ­¤å‡½æ•°åªåœ¨è·¯å¾„ä¸º<code>bin/linux-x86_64/slaveinfo</code>æ—¶æ‰èƒ½æ­£å¸¸è¿è¡Œï¼Œå…¶å®ƒæƒ…å†µéƒ½è¿”å›<code>-1</code>ã€‚ï¼ˆç¬¬ä¸€æ¬¡è§åˆ°è¿™æ ·å†™çš„ï¼ŒçœŸæ— è¯­äº†â€¦â€¦ï¼‰</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=c1>//  ethercatApp/scannerSrc/slave-list-path.c
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=kt>char</span> <span class=o>*</span><span class=nf>get_slave_list_filename</span><span class=p>(</span><span class=k>const</span> <span class=kt>char</span> <span class=o>*</span><span class=n>program_path</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kt>char</span> <span class=n>relative_path</span><span class=p>[]</span> <span class=o>=</span> <span class=s>&#34;etc/scripts/slave-types.txt&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kt>char</span> <span class=o>*</span><span class=n>slave_list_filename</span> <span class=o>=</span> <span class=nb>NULL</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// Get absolute path of application
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kt>char</span> <span class=o>*</span><span class=n>real_path</span> <span class=o>=</span> <span class=nf>calloc</span><span class=p>(</span><span class=n>PATH_MAX</span><span class=p>,</span> <span class=k>sizeof</span><span class=p>(</span><span class=kt>char</span><span class=p>));</span>
</span></span><span class=line><span class=cl>    <span class=nf>get_app_path</span><span class=p>(</span><span class=n>program_path</span><span class=p>,</span> <span class=n>real_path</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// Get root directory
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kt>int</span> <span class=n>root_dir_index</span> <span class=o>=</span> <span class=nf>get_root_dir_index</span><span class=p>(</span><span class=n>real_path</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=n>root_dir_index</span> <span class=o>!=</span> <span class=o>-</span><span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>slave_list_filename</span> <span class=o>=</span> <span class=nf>calloc</span><span class=p>(</span><span class=n>root_dir_index</span> <span class=o>+</span> <span class=nf>strlen</span><span class=p>(</span><span class=n>relative_path</span><span class=p>)</span> <span class=o>+</span> <span class=mi>1</span><span class=p>,</span> <span class=k>sizeof</span><span class=p>(</span><span class=kt>char</span><span class=p>));</span>
</span></span><span class=line><span class=cl>        <span class=nf>strncpy</span><span class=p>(</span><span class=n>slave_list_filename</span><span class=p>,</span> <span class=n>real_path</span><span class=p>,</span> <span class=n>root_dir_index</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// Append relative path
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nf>strcat</span><span class=p>(</span><span class=n>slave_list_filename</span><span class=p>,</span> <span class=n>relative_path</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// Check file
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=k>struct</span> <span class=n>stat</span> <span class=n>fstat</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kt>int</span> <span class=n>result</span> <span class=o>=</span> <span class=nf>stat</span><span class=p>(</span><span class=n>slave_list_filename</span><span class=p>,</span> <span class=o>&amp;</span><span class=n>fstat</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=n>result</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nf>printf</span><span class=p>(</span><span class=s>&#34;Could not find slave list file at %s</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>,</span> <span class=n>slave_list_filename</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// Cleanup
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nf>free</span><span class=p>(</span><span class=n>real_path</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>slave_list_filename</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>è€Œåœ¨<code>get_slave_list_filename</code>å‡½æ•°ä¸­ï¼Œåªå¤„ç†äº†<code>get_root_dir_index</code>æ­£å¸¸è¿”å›çš„æƒ…å†µã€‚å½“<code>get_root_dir_index</code>è¿”å›<code>-1</code>æ—¶ï¼Œ<code>slave_list_filename</code>å§‹ç»ˆä¸º<code>NULL</code>ï¼Œè¿™å°±å¯¼è‡´åç»­æ“ä½œå‡ºé”™ã€‚</p><p>å…¶å®è¿™ä¸ªé—®é¢˜ç›´æ¥æŠŠç¨‹åºæ”¾åˆ°<code>bin/linux-x86_64</code>ç›®å½•ä¸‹è¿è¡Œå°±å¯ä»¥äº†ï¼Œä¸è¿‡æ—¢ç„¶æ‰¾åˆ°äº†é—®é¢˜ï¼Œç´¢æ€§å°±æ”¹ä¸€æ”¹ã€‚</p><p>ç°åœ¨å·²ç»çŸ¥é“äº†å‡ºé”™çš„åœ°æ–¹ï¼Œè¯¥å¦‚ä½•ä¿®æ”¹å‘¢ï¼Ÿè¿™é‡Œæˆ‘æœ¬ç€å°½é‡å°‘æ”¹åŠ¨æºç çš„åŸåˆ™ï¼Œåœ¨<code>get_root_dir_index</code>æŸ¥æ‰¾<strong>æ ¹</strong>ç›®å½•å‡ºé”™æ—¶ï¼Œç›´æ¥ä½¿ç”¨å½“å‰ç›®å½•ã€‚</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-diff data-lang=diff><span class=line><span class=cl>char *get_slave_list_filename(const char *program_path)
</span></span><span class=line><span class=cl>{
</span></span><span class=line><span class=cl>    char relative_path[] = &#34;etc/scripts/slave-types.txt&#34;;
</span></span><span class=line><span class=cl>    char *slave_list_filename = NULL;
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    // Get absolute path of application
</span></span><span class=line><span class=cl>    char *real_path = calloc(PATH_MAX, sizeof(char));
</span></span><span class=line><span class=cl>    get_app_path(program_path, real_path);
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    // Get root directory
</span></span><span class=line><span class=cl>    int root_dir_index = get_root_dir_index(real_path);
</span></span><span class=line><span class=cl>    if (root_dir_index != -1)
</span></span><span class=line><span class=cl>    {
</span></span><span class=line><span class=cl>        slave_list_filename = calloc(root_dir_index + strlen(relative_path) + 1, sizeof(char));
</span></span><span class=line><span class=cl>        strncpy(slave_list_filename, real_path, root_dir_index);
</span></span><span class=line><span class=cl>    }
</span></span><span class=line><span class=cl><span class=gi>+    else
</span></span></span><span class=line><span class=cl><span class=gi>+    {
</span></span></span><span class=line><span class=cl><span class=gi>+        slave_list_filename = calloc(PATH_MAX, sizeof(char));
</span></span></span><span class=line><span class=cl><span class=gi>+        if (NULL != getcwd(slave_list_filename, PATH_MAX))
</span></span></span><span class=line><span class=cl><span class=gi>+        {
</span></span></span><span class=line><span class=cl><span class=gi>+            strcat(slave_list_filename, &#34;/&#34;);
</span></span></span><span class=line><span class=cl><span class=gi>+        }
</span></span></span><span class=line><span class=cl><span class=gi>+    }
</span></span></span><span class=line><span class=cl><span class=gi></span>
</span></span><span class=line><span class=cl>    // Append relative path
</span></span><span class=line><span class=cl>    strcat(slave_list_filename, relative_path);
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    // Check file
</span></span><span class=line><span class=cl>    struct stat fstat;
</span></span><span class=line><span class=cl>    int result = stat(slave_list_filename, &amp;fstat);
</span></span><span class=line><span class=cl>    if (result)
</span></span><span class=line><span class=cl>    {
</span></span><span class=line><span class=cl>        printf(&#34;Could not find slave list file at %s\n&#34;, slave_list_filename);
</span></span><span class=line><span class=cl>    }
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    // Cleanup
</span></span><span class=line><span class=cl>    free(real_path);
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    return slave_list_filename;
</span></span><span class=line><span class=cl>}
</span></span></code></pre></td></tr></table></div></div><p>ç›®å‰åªå‘ç°äº†è¿™ä¸ªé—®é¢˜ï¼Œå¸Œæœ›åé¢æ²¡æœ‰å‘äº†ã€‚</p><ol start=5><li>ç¼–è¯‘</li></ol><p>æœ€åç»ˆäºå¯ä»¥å¼€å§‹ç¼–è¯‘äº†ã€‚</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl><span class=nb>cd</span> ethercat-master/
</span></span><span class=line><span class=cl><span class=c1># æ‰§è¡Œäº¤å‰ç¼–è¯‘</span>
</span></span><span class=line><span class=cl>make <span class=nv>LD</span><span class=o>=</span>loongarch64-linux-gnu-ld <span class=nv>CC</span><span class=o>=</span>loongarch64-linux-gnu-gcc <span class=nv>CCC</span><span class=o>=</span>loongarch64-linux-gnu-g++
</span></span></code></pre></td></tr></table></div></div><p>åˆ°è¿™é‡Œï¼Œç¼–è¯‘è¿‡ç¨‹è¿˜å¯èƒ½ä¼šå‡ºé”™ï¼Œä¸è¿‡å·²ç»å¯ä»¥ç¼–è¯‘å‡ºæˆ‘ä»¬æ‰€éœ€è¦çš„ä¸œè¥¿äº†ã€‚<br>æœ€ç»ˆç¼–è¯‘å¾—åˆ°<code>scanner</code>ã€<code>slaveinfo</code>ç¨‹åºå°±å¯ä»¥äº†ã€‚</p><p>ä»¥ä¸‹æ˜¯æˆ‘ç¼–è¯‘æ—¶çš„è¾“å‡ºï¼š</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>...
</span></span><span class=line><span class=cl>Installing library ../../../lib/linux-la64/libscannerlib.a
</span></span><span class=line><span class=cl>...
</span></span><span class=line><span class=cl>Installing created executable ../../../bin/linux-la64/serialtool
</span></span><span class=line><span class=cl>Installing created executable ../../../bin/linux-la64/get-slave-revisions
</span></span><span class=line><span class=cl>Installing created executable ../../../bin/linux-la64/scanner
</span></span><span class=line><span class=cl>Installing created executable ../../../bin/linux-la64/slaveinfo
</span></span><span class=line><span class=cl>Installing created executable ../../../bin/linux-la64/parsertest
</span></span><span class=line><span class=cl>...
</span></span><span class=line><span class=cl>Installing shared library ../../../lib/linux-la64/libecAsyn.so
</span></span><span class=line><span class=cl>Installing library ../../../lib/linux-la64/libecAsyn.a
</span></span><span class=line><span class=cl>Installing created executable ../../../bin/linux-la64/parsertest
</span></span><span class=line><span class=cl>...
</span></span><span class=line><span class=cl>Installing template file ../../../db/EK1100.template
</span></span><span class=line><span class=cl>...
</span></span><span class=line><span class=cl>make -C ./protocol install
</span></span><span class=line><span class=cl>make<span class=o>[</span>2<span class=o>]</span>: è¿›å…¥ç›®å½•â€œ/home/deepin/ethercat-master/ethercatApp/protocolâ€
</span></span><span class=line><span class=cl>make<span class=o>[</span>2<span class=o>]</span>: *** æ²¡æœ‰è§„åˆ™å¯åˆ¶ä½œç›®æ ‡â€œinstallâ€ã€‚ åœæ­¢ã€‚
</span></span><span class=line><span class=cl>make<span class=o>[</span>2<span class=o>]</span>: ç¦»å¼€ç›®å½•â€œ/home/deepin/ethercat-master/ethercatApp/protocolâ€
</span></span><span class=line><span class=cl>make<span class=o>[</span>1<span class=o>]</span>: *** <span class=o>[</span>/usr/local/epics/base-7.0.8/configure/RULES_DIRS:85ï¼šprotocol.install<span class=o>]</span> é”™è¯¯ <span class=m>2</span>
</span></span><span class=line><span class=cl>make<span class=o>[</span>1<span class=o>]</span>: ç¦»å¼€ç›®å½•â€œ/home/deepin/ethercat-master/ethercatAppâ€
</span></span><span class=line><span class=cl>make: *** <span class=o>[</span>/usr/local/epics/base-7.0.8/configure/RULES_DIRS:85ï¼šethercatApp.install<span class=o>]</span> é”™è¯¯ <span class=m>2</span>
</span></span></code></pre></td></tr></table></div></div><p>æœ€åçš„é”™è¯¯ï¼Œæˆ‘ç›´æ¥å¿½ç•¥äº†ï¼Œå› ä¸ºå·²ç»å¾—åˆ°äº†éœ€è¦çš„å¯æ‰§è¡Œç¨‹åºã€‚</p><p>æ•´ç†ä¸€ä¸‹ç¼–è¯‘ç”Ÿæˆçš„æ–‡ä»¶ï¼š</p><pre tabindex=0><code>ethercat-master
â”œâ”€ bin
â”‚   â””â”€ linux-la64
â”œâ”€ db
â”œâ”€ dbd
â””â”€ lib
    â””â”€ linux-la64
</code></pre><h2 id=æµ‹è¯•è¿è¡Œ>æµ‹è¯•è¿è¡Œ<a hidden class=anchor aria-hidden=true href=#æµ‹è¯•è¿è¡Œ>#</a></h2><p>å°†æ•´ç†å¥½çš„æ–‡ä»¶ä¸‹è½½åˆ°å¼€å‘æ¿åï¼Œæˆ‘ä»¬æµ‹è¯•è¿è¡Œä¸€ä¸‹ã€‚</p><p>æµ‹è¯•å®‰è£… <strong>EtherCAT</strong> ä¸»ç«™é©±åŠ¨ç¨‹åºã€‚</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl><span class=o>[</span>root@LS-GD modules<span class=o>]</span><span class=c1># modinfo ec_generic.ko</span>
</span></span><span class=line><span class=cl>filename:       /root/__install/modules/ec_generic.ko
</span></span><span class=line><span class=cl>version:        1.5.2 unknown
</span></span><span class=line><span class=cl>license:        GPL
</span></span><span class=line><span class=cl>description:    EtherCAT master generic Ethernet device module
</span></span><span class=line><span class=cl>author:         Florian Pose &lt;fp@igh-essen.com&gt;
</span></span><span class=line><span class=cl>srcversion:     848BB80F1C588A2FDA42EDB
</span></span><span class=line><span class=cl>depends:        ec_master
</span></span><span class=line><span class=cl>name:           ec_generic
</span></span><span class=line><span class=cl>vermagic:       5.10.0-rt17.lsgd preempt_rt mod_unload modversions LOONGARCH 64BIT
</span></span><span class=line><span class=cl><span class=o>[</span>root@LS-GD modules<span class=o>]</span><span class=c1># insmod ec_master.ko</span>
</span></span><span class=line><span class=cl><span class=o>[</span>root@LS-GD modules<span class=o>]</span><span class=c1># insmod ec_generic.ko</span>
</span></span><span class=line><span class=cl><span class=o>[</span>root@LS-GD modules<span class=o>]</span><span class=c1># lsmod</span>
</span></span><span class=line><span class=cl>Module                  Size  Used by
</span></span><span class=line><span class=cl>ec_generic              <span class=m>6427</span>  <span class=m>0</span>
</span></span><span class=line><span class=cl>ec_master             <span class=m>464125</span>  <span class=m>1</span> ec_generic
</span></span></code></pre></td></tr></table></div></div><p>æµ‹è¯•<code>ethercat</code>ä¸»ç¨‹åºã€‚</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl><span class=o>[</span>root@LS-GD tool<span class=o>]</span><span class=c1># ./ethercat</span>
</span></span><span class=line><span class=cl>Please specify a command!
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Usage: ethercat &lt;COMMAND&gt; <span class=o>[</span>OPTIONS<span class=o>]</span> <span class=o>[</span>ARGUMENTS<span class=o>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Commands <span class=o>(</span>can be abbreviated<span class=o>)</span>:
</span></span><span class=line><span class=cl>  <span class=nb>alias</span>      Write <span class=nb>alias</span> addresses.
</span></span><span class=line><span class=cl>  config     Show slave configurations.
</span></span><span class=line><span class=cl>  crc        CRC error register diagnosis.
</span></span><span class=line><span class=cl>  cstruct    Generate slave PDO information in C language.
</span></span><span class=line><span class=cl>  data       Output binary domain process data.
</span></span><span class=line><span class=cl>  debug      Set the master<span class=s1>&#39;s debug level.
</span></span></span><span class=line><span class=cl><span class=s1>  domains    Show configured domains.
</span></span></span><span class=line><span class=cl><span class=s1>  download   Write an SDO entry to a slave.
</span></span></span><span class=line><span class=cl><span class=s1>  eoe        Display Ethernet over EtherCAT statictics.
</span></span></span><span class=line><span class=cl><span class=s1>  foe_read   Read a file from a slave via FoE.
</span></span></span><span class=line><span class=cl><span class=s1>  foe_write  Store a file on a slave via FoE.
</span></span></span><span class=line><span class=cl><span class=s1>  graph      Output the bus topology as a graph.
</span></span></span><span class=line><span class=cl><span class=s1>  master     Show master and Ethernet device information.
</span></span></span><span class=line><span class=cl><span class=s1>  pdos       List Sync managers, PDO assignment and mapping.
</span></span></span><span class=line><span class=cl><span class=s1>  reg_read   Output a slave&#39;</span>s register contents.
</span></span><span class=line><span class=cl>  reg_write  Write data to a slave<span class=s1>&#39;s registers.
</span></span></span><span class=line><span class=cl><span class=s1>  rescan     Rescan the bus.
</span></span></span><span class=line><span class=cl><span class=s1>  sdos       List SDO dictionaries.
</span></span></span><span class=line><span class=cl><span class=s1>  sii_read   Output a slave&#39;</span>s SII contents.
</span></span><span class=line><span class=cl>  sii_write  Write SII contents to a slave.
</span></span><span class=line><span class=cl>  slaves     Display slaves on the bus.
</span></span><span class=line><span class=cl>  soe_read   Read an SoE IDN from a slave.
</span></span><span class=line><span class=cl>  soe_write  Write an SoE IDN to a slave.
</span></span><span class=line><span class=cl>  states     Request application-layer states.
</span></span><span class=line><span class=cl>  upload     Read an SDO entry from a slave.
</span></span><span class=line><span class=cl>  version    Show version information.
</span></span><span class=line><span class=cl>  xml        Generate slave information XML.
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Global options:
</span></span><span class=line><span class=cl>  --master  -m &lt;master&gt;  Comma separated list of masters
</span></span><span class=line><span class=cl>                         to <span class=k>select</span>, ranges are allowed.
</span></span><span class=line><span class=cl>                         Examples: <span class=s1>&#39;1,3&#39;</span>, <span class=s1>&#39;5-7,9&#39;</span>, <span class=s1>&#39;-3&#39;</span>.
</span></span><span class=line><span class=cl>                         Default: <span class=s1>&#39;-&#39;</span> <span class=o>(</span>all<span class=o>)</span>.
</span></span><span class=line><span class=cl>  --force   -f           Force a command.
</span></span><span class=line><span class=cl>  --quiet   -q           Output less information.
</span></span><span class=line><span class=cl>  --verbose -v           Output more information.
</span></span><span class=line><span class=cl>  --help    -h           Show this help.
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Numerical values can be specified either with decimal <span class=o>(</span>no
</span></span><span class=line><span class=cl>prefix<span class=o>)</span>, octal <span class=o>(</span>prefix <span class=s1>&#39;0&#39;</span><span class=o>)</span> or hexadecimal <span class=o>(</span>prefix <span class=s1>&#39;0x&#39;</span><span class=o>)</span> base.
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Call <span class=s1>&#39;ethercat &lt;COMMAND&gt; --help&#39;</span> <span class=k>for</span> command-specific help.
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Send bug reports to fp@igh.de.
</span></span></code></pre></td></tr></table></div></div><p>æµ‹è¯•<code>scanner</code>ä¸»ç¨‹åºã€‚</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl><span class=o>[</span>root@LS-GD linux-la64<span class=o>]</span><span class=c1># chmod +x scanner</span>
</span></span><span class=line><span class=cl><span class=o>[</span>root@LS-GD linux-la64<span class=o>]</span><span class=c1># ./scanner</span>
</span></span><span class=line><span class=cl>usage: scanner <span class=o>[</span>-m master_index<span class=o>]</span> <span class=o>[</span>-s<span class=o>]</span> <span class=o>[</span>-q<span class=o>]</span> scanner.xml socket_path
</span></span></code></pre></td></tr></table></div></div><p>å¯ä»¥çœ‹åˆ°ï¼Œé©±åŠ¨ç¨‹åºå’Œä¸»ç¨‹åºéƒ½èƒ½åœ¨å¼€å‘æ¿ä¸Šè¿è¡Œï¼Œè¯´æ˜å·²ç»ç¼–è¯‘å®Œæˆäº†ã€‚</p><h2 id=å®‰è£…-ethercat-ä¸»ç«™åˆ°å¼€å‘æ¿ç³»ç»Ÿ>å®‰è£… EtherCAT ä¸»ç«™åˆ°å¼€å‘æ¿ç³»ç»Ÿ<a hidden class=anchor aria-hidden=true href=#å®‰è£…-ethercat-ä¸»ç«™åˆ°å¼€å‘æ¿ç³»ç»Ÿ>#</a></h2><p>é¦–å…ˆå°†ç¼–è¯‘å¥½çš„<code>EtherCAT Master</code>ä¸‹è½½åˆ°å¼€å‘æ¿ç³»ç»Ÿï¼Œç„¶åå°†å„ä¸ªç›®å½•ä¸‹çš„æ–‡ä»¶æ”¾åˆ°ç›¸åº”çš„ç³»ç»Ÿç›®å½•ä¸‹ã€‚ï¼ˆè¿™é‡Œæˆ‘è¿˜ä»¥<code>__install_dir</code>çš„ç›®å½•ç»“æ„ä¸ºä¾‹ã€‚ï¼‰</p><table><thead><tr><th style=text-align:left>åŸæ–‡ä»¶/ç›®å½•</th><th style=text-align:left>ç³»ç»Ÿæ–‡ä»¶/ç›®å½•</th></tr></thead><tbody><tr><td style=text-align:left>bin/ethercat</td><td style=text-align:left>/usr/bin/ethercat</td></tr><tr><td style=text-align:left>etc/init.d/ethercat</td><td style=text-align:left>/etc/init.d/ethercat</td></tr><tr><td style=text-align:left>etc/sysconfig/ethercat</td><td style=text-align:left>/etc/sysconfig/ethercat</td></tr><tr><td style=text-align:left>etc/ethercat.conf</td><td style=text-align:left>/etc/ethercat.conf</td></tr><tr><td style=text-align:left>include/</td><td style=text-align:left>-</td></tr><tr><td style=text-align:left>lib/libethercat.so*</td><td style=text-align:left>/usr/lib/libethercat.so*</td></tr><tr><td style=text-align:left>modules/</td><td style=text-align:left>/lib/modules/5.10.0-rt17.lsgd/</td></tr><tr><td style=text-align:left>sbin/ethercatctl</td><td style=text-align:left>/sbin/ethercatctl</td></tr><tr><td style=text-align:left>share/bash-completion/</td><td style=text-align:left>usr/share/bash-completion/</td></tr></tbody></table><blockquote><p>æ³¨æ„ï¼šå¦‚æœç³»ç»Ÿç›®å½•å­˜åœ¨<code>/lib/modules/{å†…æ ¸ç‰ˆæœ¬}</code>ç›®å½•ï¼Œåˆ™å¯ä»¥å°†<code>modules</code>ç›®å½•ä¸‹çš„<code>ec_master.ko</code>å’Œ<code>ec_generic.ko</code>å¤åˆ¶åˆ°è¯¥ç›®å½•ä¸‹ï¼Œç„¶ååœ¨ç»ˆç«¯æ‰§è¡Œ<code>depmod</code>å‘½ä»¤ã€‚å¦åˆ™ï¼Œå¯ä»¥æŒ‰ç…§ä¸‹é¢çš„æ­¥éª¤åšç›¸åº”ä¿®æ”¹ã€‚</p></blockquote><p>ä¾‹å¦‚ï¼Œå°†<code>modules</code>ä¸‹çš„é©±åŠ¨æ–‡ä»¶æ”¾åˆ°å¼€å‘æ¿æ–‡ä»¶ç³»ç»Ÿçš„<code>/root/modules/</code>ç›®å½•ä¸‹ã€‚</p><p>ä¿®æ”¹<code>/etc/init.d/ethercat</code>å’Œ<code>/sbin/ethercatctl</code>è„šæœ¬æ–‡ä»¶ã€‚</p><p>ä¾‹ï¼š<code>/etc/init.d/ethercat</code></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-diff data-lang=diff><span class=line><span class=cl>LSMOD=/sbin/lsmod
</span></span><span class=line><span class=cl>MODPROBE=/sbin/modprobe
</span></span><span class=line><span class=cl><span class=gi>+ INSMOD=/sbin/insmod
</span></span></span><span class=line><span class=cl><span class=gi></span>RMMOD=/sbin/rmmod
</span></span><span class=line><span class=cl>MODINFO=/sbin/modinfo
</span></span><span class=line><span class=cl><span class=gd>- ETHERCAT=/home/loongson/__install_dir/bin/ethercat
</span></span></span><span class=line><span class=cl><span class=gd></span><span class=gi>+ ETHERCAT=/usr/bin/ethercat
</span></span></span><span class=line><span class=cl><span class=gi></span>MASTER_ARGS=
</span></span><span class=line><span class=cl><span class=gi>+ MODULE_DIR=/root/modules
</span></span></span><span class=line><span class=cl><span class=gi></span>
</span></span><span class=line><span class=cl>start)
</span></span><span class=line><span class=cl>    echo -n &#34;Starting EtherCAT master 1.5.2 &#34;
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>...
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl># load master module
</span></span><span class=line><span class=cl><span class=gd>- if ! ${MODPROBE} ${MODPROBE_FLAGS} ec_master &#34;${MASTER_ARGS}&#34; \
</span></span></span><span class=line><span class=cl><span class=gd></span><span class=gi>+ if ! ${INSMOD} ${MODULE_DIR}/ec_master.ko &#34;${MASTER_ARGS}&#34; \
</span></span></span><span class=line><span class=cl><span class=gi></span>        main_devices=&#34;${DEVICES}&#34; backup_devices=&#34;${BACKUPS}&#34;; then
</span></span><span class=line><span class=cl>    exit_fail
</span></span><span class=line><span class=cl>fi
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl># check for modules to replace
</span></span><span class=line><span class=cl>for MODULE in ${DEVICE_MODULES}; do
</span></span><span class=line><span class=cl>    ECMODULE=ec_${MODULE}
</span></span><span class=line><span class=cl><span class=gd>-    if ! ${MODINFO} &#34;${ECMODULE}&#34; &gt; /dev/null; then
</span></span></span><span class=line><span class=cl><span class=gd>-        continue # ec_* module not found
</span></span></span><span class=line><span class=cl><span class=gd>-    fi
</span></span></span><span class=line><span class=cl><span class=gd></span>    if [ &#34;${MODULE}&#34; != &#34;generic&#34; ]; then
</span></span><span class=line><span class=cl>        if ${LSMOD} | grep &#34;^${MODULE} &#34; &gt; /dev/null; then
</span></span><span class=line><span class=cl>            if ! ${RMMOD} &#34;${MODULE}&#34;; then
</span></span><span class=line><span class=cl>                exit_fail
</span></span><span class=line><span class=cl>            fi
</span></span><span class=line><span class=cl>        fi
</span></span><span class=line><span class=cl>    fi
</span></span><span class=line><span class=cl><span class=gd>-    if ! ${MODPROBE} ${MODPROBE_FLAGS} &#34;${ECMODULE}&#34;; then
</span></span></span><span class=line><span class=cl><span class=gd></span><span class=gi>+    if ! ${INSMOD} &#34;${MODULE_DIR}/${ECMODULE}.ko&#34;; then
</span></span></span><span class=line><span class=cl><span class=gi></span>        if [ &#34;${MODULE}&#34; != &#34;generic&#34; ]; then
</span></span><span class=line><span class=cl>            ${MODPROBE} ${MODPROBE_FLAGS} &#34;${MODULE}&#34; # try to restore
</span></span><span class=line><span class=cl>        fi
</span></span><span class=line><span class=cl>        exit_fail
</span></span><span class=line><span class=cl>    fi
</span></span><span class=line><span class=cl>done
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>exit_success
</span></span><span class=line><span class=cl>;;
</span></span></code></pre></td></tr></table></div></div><p>ä¾‹ï¼š<code>/sbin/ethercatctl</code></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span><span class=lnt>59
</span><span class=lnt>60
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-diff data-lang=diff><span class=line><span class=cl>LSMOD=/sbin/lsmod
</span></span><span class=line><span class=cl>MODPROBE=/sbin/modprobe
</span></span><span class=line><span class=cl><span class=gi>+ INSMOD=/sbin/insmod
</span></span></span><span class=line><span class=cl><span class=gi></span>RMMOD=/sbin/rmmod
</span></span><span class=line><span class=cl>MODINFO=/sbin/modinfo
</span></span><span class=line><span class=cl>IP=/bin/ip
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=gd>- ETHERCAT=/home/loongson/__install_dir/bin/ethercat
</span></span></span><span class=line><span class=cl><span class=gd></span><span class=gi>+ ETHERCAT=/usr/bin/ethercat
</span></span></span><span class=line><span class=cl><span class=gi>+ MODULE_DIR=/root/modules
</span></span></span><span class=line><span class=cl><span class=gi></span>
</span></span><span class=line><span class=cl>#------------------------------------------------------------------------------
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=gd>- ETHERCAT_CONFIG=/home/loongson/__install_dir/etc/ethercat.conf
</span></span></span><span class=line><span class=cl><span class=gd></span><span class=gi>+ ETHERCAT_CONFIG=/etc/ethercat.conf
</span></span></span><span class=line><span class=cl><span class=gi></span>
</span></span><span class=line><span class=cl>start)
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>...
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl># load master module
</span></span><span class=line><span class=cl><span class=gd>- if ! ${MODPROBE} ${MODPROBE_FLAGS} ec_master \
</span></span></span><span class=line><span class=cl><span class=gd></span><span class=gi>+ if ! ${INSMOD} ${MODULE_DIR}/ec_master.ko \
</span></span></span><span class=line><span class=cl><span class=gi></span>        main_devices=&#34;${DEVICES}&#34; backup_devices=&#34;${BACKUPS}&#34;; then
</span></span><span class=line><span class=cl>    exit 1
</span></span><span class=line><span class=cl>fi
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>LOADED_MODULES=ec_master
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl># check for modules to replace
</span></span><span class=line><span class=cl>for MODULE in ${DEVICE_MODULES}; do
</span></span><span class=line><span class=cl>    ECMODULE=ec_${MODULE}
</span></span><span class=line><span class=cl><span class=gd>-    if ! ${MODINFO} &#34;${ECMODULE}&#34; &gt; /dev/null; then
</span></span></span><span class=line><span class=cl><span class=gd>-        continue # ec_* module not found
</span></span></span><span class=line><span class=cl><span class=gd>-    fi
</span></span></span><span class=line><span class=cl><span class=gd></span>
</span></span><span class=line><span class=cl>    if [ &#34;${MODULE}&#34; != &#34;generic&#34; ] &amp;&amp; [ &#34;${MODULE}&#34; != &#34;ccat&#34; ]; then
</span></span><span class=line><span class=cl>        # unload standard module and check if unloading was successful
</span></span><span class=line><span class=cl>        ${RMMOD} &#34;${MODULE}&#34; 2&gt; /dev/null || true
</span></span><span class=line><span class=cl>        if ${LSMOD} | grep &#34;^${MODULE} &#34; &gt; /dev/null; then
</span></span><span class=line><span class=cl>            # could not unload module
</span></span><span class=line><span class=cl>            ${RMMOD} ${LOADED_MODULES}
</span></span><span class=line><span class=cl>            exit 1
</span></span><span class=line><span class=cl>        fi
</span></span><span class=line><span class=cl>    fi
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=gd>-    if ! ${MODPROBE} ${MODPROBE_FLAGS} &#34;${ECMODULE}&#34;; then
</span></span></span><span class=line><span class=cl><span class=gd></span><span class=gi>+    if ! ${INSMOD} &#34;${MODULE_DIR}/${ECMODULE}.ko&#34;; then
</span></span></span><span class=line><span class=cl><span class=gi></span>        if [ &#34;${MODULE}&#34; != &#34;generic&#34; ] &amp;&amp; [ &#34;${MODULE}&#34; != &#34;ccat&#34; ]; then
</span></span><span class=line><span class=cl>            ${MODPROBE} ${MODPROBE_FLAGS} &#34;${MODULE}&#34; # try to restore
</span></span><span class=line><span class=cl>        fi
</span></span><span class=line><span class=cl>        ${RMMOD} ${LOADED_MODULES}
</span></span><span class=line><span class=cl>        exit 1
</span></span><span class=line><span class=cl>    fi
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    LOADED_MODULES=&#34;${ECMODULE} ${LOADED_MODULES}&#34;
</span></span><span class=line><span class=cl>done
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>exit 0
</span></span><span class=line><span class=cl>;;
</span></span></code></pre></td></tr></table></div></div><p><strong>ä¿®æ”¹ EtherCAT Master é…ç½®æ–‡ä»¶ã€‚</strong></p><p>ä¾‹ï¼š<code>/etc/sysconfig/ethercat</code>å’Œ<code>/etc/ethercat.conf</code></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl><span class=nv>MASTER0_DEVICE</span><span class=o>=</span><span class=s2>&#34;00:11:22:33:44:55&#34;</span>
</span></span><span class=line><span class=cl><span class=c1>#MASTER1_DEVICE=&#34;&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>#MASTER0_BACKUP=&#34;&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nv>DEVICE_MODULES</span><span class=o>=</span><span class=s2>&#34;generic&#34;</span>
</span></span></code></pre></td></tr></table></div></div><p><code>MASTER&lt;X>_DEVICE</code>é…ç½®ç½‘å¡çš„ç‰©ç†åœ°å€ï¼ˆMACï¼‰ï¼Œå¯é€šè¿‡<code>ifconfig</code>å‘½ä»¤æŸ¥çœ‹ã€‚<br><code>DEVICE_MODULES</code>é…ç½®ä½¿ç”¨çš„æ¨¡å—åç§°ï¼Œè¿™é‡Œä»…ä½¿ç”¨é€šç”¨ç½‘å¡é©±åŠ¨<code>generic</code>ã€‚</p><h2 id=è¿è¡Œ-ethercat-master>è¿è¡Œ EtherCAT Master<a hidden class=anchor aria-hidden=true href=#è¿è¡Œ-ethercat-master>#</a></h2><ul><li><p>å¯åŠ¨<code>EtherCAT</code>ä¸»ç«™ç¨‹åºã€‚</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>/etc/init.d/ethercat start
</span></span><span class=line><span class=cl><span class=c1># æˆ–è€…</span>
</span></span><span class=line><span class=cl>/sbin/ethercatctl start
</span></span></code></pre></td></tr></table></div></div><p>å¦‚æœä¸€åˆ‡æ­£å¸¸ï¼Œå¯ä»¥çœ‹åˆ°<code>/dev</code>ç›®å½•ä¸‹æœ‰<code>EtherCAT0</code>è®¾å¤‡æ–‡ä»¶ã€‚</p></li><li><p>æŸ¥çœ‹ä¸»ç«™ä¿¡æ¯</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl><span class=o>[</span>root@LS-GD ~<span class=o>]</span><span class=c1># ethercat master</span>
</span></span><span class=line><span class=cl>Master0
</span></span><span class=line><span class=cl>Phase: Idle
</span></span><span class=line><span class=cl>Active: no
</span></span><span class=line><span class=cl>Slaves: <span class=m>1</span>
</span></span><span class=line><span class=cl>Ethernet devices:
</span></span><span class=line><span class=cl>  Main: 00:11:22:33:44:55 <span class=o>(</span>attached<span class=o>)</span>
</span></span><span class=line><span class=cl>    Link: UP
</span></span><span class=line><span class=cl>    Tx frames:   <span class=m>370862</span>
</span></span><span class=line><span class=cl>    Tx bytes:    <span class=m>22319896</span>
</span></span><span class=line><span class=cl>    Rx frames:   <span class=m>370861</span>
</span></span><span class=line><span class=cl>    Rx bytes:    <span class=m>22319836</span>
</span></span><span class=line><span class=cl>    Tx errors:   <span class=m>0</span>
</span></span><span class=line><span class=cl>    Tx frame rate <span class=o>[</span>1/s<span class=o>]</span>:    <span class=m>125</span>    <span class=m>125</span>    <span class=m>125</span>
</span></span><span class=line><span class=cl>    Tx rate <span class=o>[</span>KByte/s<span class=o>]</span>:      7.3    7.3    7.3
</span></span><span class=line><span class=cl>    Rx frame rate <span class=o>[</span>1/s<span class=o>]</span>:    <span class=m>125</span>    <span class=m>125</span>    <span class=m>125</span>
</span></span><span class=line><span class=cl>    Rx rate <span class=o>[</span>KByte/s<span class=o>]</span>:      7.3    7.3    7.3
</span></span><span class=line><span class=cl>  Common:
</span></span><span class=line><span class=cl>    Tx frames:   <span class=m>1108336</span>
</span></span><span class=line><span class=cl>    Tx bytes:    <span class=m>66704720</span>
</span></span><span class=line><span class=cl>    Rx frames:   <span class=m>1108307</span>
</span></span><span class=line><span class=cl>    Rx bytes:    <span class=m>66702980</span>
</span></span><span class=line><span class=cl>    Lost frames: <span class=m>29</span>
</span></span><span class=line><span class=cl>    Tx frame rate <span class=o>[</span>1/s<span class=o>]</span>:    <span class=m>125</span>    <span class=m>125</span>    <span class=m>125</span>
</span></span><span class=line><span class=cl>    Tx rate <span class=o>[</span>KByte/s<span class=o>]</span>:      7.3    7.3    7.3
</span></span><span class=line><span class=cl>    Rx frame rate <span class=o>[</span>1/s<span class=o>]</span>:    <span class=m>125</span>    <span class=m>125</span>    <span class=m>125</span>
</span></span><span class=line><span class=cl>    Rx rate <span class=o>[</span>KByte/s<span class=o>]</span>:      7.3    7.3    7.3
</span></span><span class=line><span class=cl>    Loss rate <span class=o>[</span>1/s<span class=o>]</span>:          <span class=m>0</span>      <span class=m>0</span>      <span class=m>0</span>
</span></span><span class=line><span class=cl>    Frame loss <span class=o>[</span>%<span class=o>]</span>:         0.0    0.0    0.0
</span></span><span class=line><span class=cl>Distributed clocks:
</span></span><span class=line><span class=cl>  Reference clock:   Slave <span class=m>0</span>
</span></span><span class=line><span class=cl>  DC reference time: <span class=m>0</span>
</span></span><span class=line><span class=cl>  Application time:  <span class=m>0</span>
</span></span><span class=line><span class=cl>                     2000-01-01 00:00:00.000000000
</span></span></code></pre></td></tr></table></div></div></li><li><p>æŸ¥çœ‹ä»ç«™è®¾å¤‡</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl><span class=o>[</span>root@LS-GD ~<span class=o>]</span><span class=c1># ethercat slaves</span>
</span></span><span class=line><span class=cl><span class=m>0</span>  0:0  PREOP  +  XB6-EC0002<span class=o>(</span>Modules/Slots and MDP<span class=o>)</span>
</span></span></code></pre></td></tr></table></div></div></li><li><p>ç”Ÿæˆä»ç«™ä¿¡æ¯XMLæ–‡ä»¶</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl><span class=o>[</span>root@LS-GD ~<span class=o>]</span><span class=c1># ethercat xml &gt; scanner.xml</span>
</span></span></code></pre></td></tr></table></div></div></li><li><p>å…¶ä»–<code>ethercat</code>å‘½ä»¤</p><p>ä½¿ç”¨<code>ethercat -h</code>å‘½ä»¤æŸ¥çœ‹å…¶ä»–å‘½ä»¤çš„ä½¿ç”¨æ–¹æ³•ã€‚</p></li></ul><h2 id=å‚è€ƒ>å‚è€ƒ<a hidden class=anchor aria-hidden=true href=#å‚è€ƒ>#</a></h2><ul><li><a href=https://docs.etherlab.org/ethercat/1.5/doxygen/index.html>IgH EtherCAT Master</a></li><li><a href=https://gitlab.com/etherlab.org/ethercat/-/blob/master/INSTALL.md>Building and installing IgH EtherCAT Master</a></li><li><a href=https://github.com/landaurobotics/igh-ethercat-master/blob/main/README.md>IgH EtherCAT Master for Linux</a></li><li><a href=https://accelconf.web.cern.ch/pcapac2018/papers/wep01.pdf>EtherCAT DRIVER AND TOOLS FOR EPICS AND LINUX AT PSI</a></li><li><a href=https://accelconf.web.cern.ch/cyclotrons2019/papers/tup004.pdf>INTEGRATION OF EtherCAT HARDWARE INTO THE EPICS BASED DISTRIBUTED CONTROL SYSTEM AT iThemba LABS</a></li><li><a href=https://blog.csdn.net/honeymelon3/article/details/113175863>åœ¨â€œç¦ç‘2.0â€ä¸»æœºä¸Šç¼–è¯‘EPICS Ehtercaté©±åŠ¨è½¯ä»¶çš„ä½“éªŒ</a></li></ul></div><footer class=post-footer><ul class=post-tags><li><a href=https://kira-96.github.io/tags/linux/>Linux</a></li><li><a href=https://kira-96.github.io/tags/epics/>EPICS</a></li><li><a href=https://kira-96.github.io/tags/%E9%BE%99%E8%8A%AF/>é¾™èŠ¯</a></li></ul><nav class=paginav><a class=prev href=https://kira-96.github.io/posts/epics-ioc-access-security/><span class=title>Â« ä¸Šä¸€é¡µ</span><br><span>EPICS IOC è®¿é—®å®‰å…¨</span>
</a><a class=next href=https://kira-96.github.io/posts/build-epics-module-modbus/><span class=title>ä¸‹ä¸€é¡µ Â»</span><br><span>EPICSçš„MODBUSæ¨¡å—çš„ç¼–è¯‘å’Œä½¿ç”¨</span></a></nav></footer><script src=https://utteranc.es/client.js repo=kira-96/kira-96.github.io issue-term=pathname theme=github-light crossorigin=anonymous async></script></article></main><footer class=footer><span>Copyright Â© 2019-2024 <a href=/>kira&rsquo;s blog</a> Â·</span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="å¤åˆ¶";function s(){t.innerHTML="å·²å¤åˆ¶ï¼",setTimeout(()=>{t.innerHTML="å¤åˆ¶"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>