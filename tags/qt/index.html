<!doctype html><html lang=zh dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Qt | ✨kiraの博客</title>
<meta name=keywords content><meta name=description content="This is kira's blog"><meta name=author content><link rel=canonical href=https://kira-96.github.io/tags/qt/><link crossorigin=anonymous href=/assets/css/stylesheet.026333dcafeaf3c82b8515026af0a6531c530abffdaf73d32779337b0ace14c0.css integrity="sha256-AmMz3K/q88grhRUCavCmUxxTCr/9r3PTJ3kzewrOFMA=" rel="preload stylesheet" as=style><link rel=icon href=https://cdn.jsdelivr.net/gh/kira-96/kira-96.github.io@gh-pages/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://cdn.jsdelivr.net/gh/kira-96/kira-96.github.io@gh-pages/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://cdn.jsdelivr.net/gh/kira-96/kira-96.github.io@gh-pages/favicon-32x32.png><link rel=apple-touch-icon href=https://cdn.jsdelivr.net/gh/kira-96/kira-96.github.io@gh-pages/icons/apple-icon-180x180.png><link rel=mask-icon href=https://cdn.jsdelivr.net/gh/kira-96/kira-96.github.io@gh-pages/icons/apple-icon-76x76.png><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate type=application/rss+xml href=https://kira-96.github.io/tags/qt/index.xml><link rel=alternate hreflang=zh href=https://kira-96.github.io/tags/qt/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><link rel=manifest href=https://cdn.jsdelivr.net/gh/kira-96/kira-96.github.io@gh-pages/manifest.json><script src=https://fastly.jsdelivr.net/gh/stevenjoezhang/live2d-widget@latest/autoload.js></script><script type=text/javascript src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><meta property="og:url" content="https://kira-96.github.io/tags/qt/"><meta property="og:site_name" content="✨kiraの博客"><meta property="og:title" content="Qt"><meta property="og:description" content="This is kira's blog"><meta property="og:locale" content="zh"><meta property="og:type" content="website"><meta name=twitter:card content="summary"><meta name=twitter:title content="Qt"><meta name=twitter:description content="This is kira's blog"></head><body class=list id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://kira-96.github.io/ accesskey=h title="✨kiraの博客 (Alt + H)">✨kiraの博客</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)" aria-label="Toggle theme"><svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://kira-96.github.io/ title=🏠主页><span>🏠主页</span></a></li><li><a href=https://kira-96.github.io/notes/ title=📓笔记><span>📓笔记</span></a></li><li><a href=https://kira-96.github.io/search/ title=🔍️搜索><span>🔍️搜索</span></a></li><li><a href=https://kira-96.github.io/archives/ title=🗃️存档><span>🗃️存档</span></a></li></ul></nav></header><main class=main><header class=page-header><div class=breadcrumbs><a href=https://kira-96.github.io/>主页</a>&nbsp;»&nbsp;<a href=https://kira-96.github.io/tags/>Tags</a></div><h1>Qt
<a href=/tags/qt/index.xml title=RSS aria-label=RSS><svg viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" height="23"><path d="M4 11a9 9 0 019 9"/><path d="M4 4a16 16 0 0116 16"/><circle cx="5" cy="19" r="1"/></svg></a></h1></header><article class="post-entry tag-entry"><header class=entry-header><h2 class=entry-hint-parent>Qt5编写Qt Quick2插件</h2></header><div class=entry-content><p>前言 最近在试着把自定义的QML控件封装成插件供其他程序调用，由于我使用的还是Qt5，在构建的过程中遇到不少问题，这里做一下简单汇总。
新建项目 新建库→Qt Quick2 Extension Plugin，Qt 5版本仅支持使用QMake作为构建套件。Qt 6才支持使用CMake作为QML扩展插件的构建套件。
编写插件 例如，我新建了一个叫做Test的插件库，项目会自动创建一个TestPlugin的类，这个类继承自QQmlExtensionPlugin，我们需要重写它的两个虚函数。
1 2 3 4 5 6 7 8 9 10 11 12 /* testplugin.h */ #include &lt;QQmlExtensionPlugin> class TestPlugin : public QQmlExtensionPlugin { Q_OBJECT Q_PLUGIN_METADATA(IID QQmlExtensionInterface_iid) public: void registerTypes(const char *uri) Q_DECL_OVERRIDE; void initializeEngine(QQmlEngine *engine, const char *uri) Q_DECL_OVERRIDE; }; 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 /* testplugin.cpp */ #include "testplugin.h" #include "myitem.h" #include &lt;qqml.h> void TestPlugin::registerTypes(const char *uri) { // @uri com.mycompany.qmlcomponents qmlRegisterType&lt;MyItem>(uri, 1, 0, "MyItem"); } void TestPlugin::initializeEngine(QQmlEngine *engine, const char *uri) { QQmlExtensionPlugin::initializeEngine(engine, uri); } 其中，MyItem就是我们自定义的控件。简单看一下示例代码：
...</p></div><footer class=entry-footer><span title='2025-03-13 10:23:47 +0800 +0800'>三月 13, 2025</span>&nbsp;·&nbsp;4 分钟&nbsp;·&nbsp;711 字</footer><a class=entry-link aria-label="post link to Qt5编写Qt Quick2插件" href=https://kira-96.github.io/posts/qt5-quick2-extension-plugin/></a></article><article class="post-entry tag-entry"><header class=entry-header><h2 class=entry-hint-parent>QML控件访问EPICS过程变量的思路</h2></header><div class=entry-content><p>前言 写这篇文章的想法是使用自定义QML控件的方式访问EPICS过程变量，现有的Qt EPICS框架之前也介绍过了，还有配套的QEGui工具，框架的基本功能已经比较完善，但实际使用过程中还是遇到了一些问题。我总结有以下2点：
QEGui工具只能加载基于Widget的.ui界面文件，文件只能包含布局、控件和控件属性，不能嵌入代码（C++代码必须编译）。用户的操作（如：输入、点击按钮等）的相应槽函数封装在框架自定义的控件里实现，这样极大方便了用户的开发，用户只需要设计界面，填写变量名就可以实现变量访问，但相应的也失去了很大的灵活性，程序的功能变得很单一。
QEGui工具不一定符合实际开发过程中的需求，仅使用QEGui加载.ui界面，脱离了C++代码，程序很难实现用户想要的效果。而更好的选择是调用Qt EPICS框架动态库提供的控件，结合C++代码开发应用程序，但却不得不进行编译操作。
那么，有没有更好的基于Qt的EPICS框架方案呢？
刚好最近我也学习实践了QML相关的内容，这种前后端分离开发的方式给了我一些灵感。我们完全可以在Qt EPICS框架的基础上，实现自定义QML控件访问EPICS过程变量，用户使用QML编写界面，调用自定义QML控件即可，可以实现和Qt EPICS框架加载.ui界面文件类似的功能。但QML在动画、3D显示等方面明显具有优势，还有一点是基于Widget的.ui界面文件不具备的：QML本身可以嵌入javascript函数，动态控制界面的显示、切换等，甚至可以实现和底层C++接口的交互。而QML本身也不需要进行编译，完全可以只使用QML语言实现程序开发，且具有很高灵活性。
实现思路 Qt EPICS 框架提供了QCaObject类访问EPICS过程变量，但该类几乎是完全为QEWidget服务的，并没有声明属性（property），无法直接在QML中使用。
所以第1步需要对QCaObject做一层封装，将EPICS过程变量的字段声明为QPvObject类的属性，然后就可以在QML中访问EPICS过程变量了。
第2步是将QPvObject封装进自定义的QML控件QmlPvControl，实现数据的显示、输入等操作。
第3步将QmlPvControl导入（import）到QML文件，在外部QML文件中使用自定义控件。
代码示例 由于完整的代码较多，这里只放部分代码。
QPvObject类的定义
1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 /* qpvobject.h */ class QPvObject : public QObject { Q_OBJECT public: enum epicsAlarmSeverity { NO_ALARM, /**&lt; No alarm */ MINOR_ALARM, /**&lt; Minor alarm severity */ MAJOR_ALARM, /**&lt; Major alarm severity */ INVALID_ALARM, /**&lt; Invalid alarm severity */ ALARM_NSEV /**&lt; Number of alarm severities */ }; Q_ENUM(epicsAlarmSeverity) enum pvConnectionMode { NONE, WR_ONLY, /**&lt; Write only */ RD_ONCE, /**&lt; Read once */ MONITOR /**&lt; Read and Write */ }; Q_ENUM(pvConnectionMode) private: Q_PROPERTY(QString pvName READ pvName WRITE setPvName NOTIFY pvNameChanged FINAL) Q_PROPERTY(QVariant value READ value WRITE setValue NOTIFY valueChanged FINAL) Q_PROPERTY(QPvObject::pvConnectionMode mode READ mode WRITE setMode NOTIFY modeChanged FINAL) Q_PROPERTY(QString hostName READ hostName NOTIFY hostNameChanged FINAL) Q_PROPERTY(QString fieldType READ fieldType NOTIFY fieldTypeChanged FINAL) Q_PROPERTY(QString descriptor READ descriptor NOTIFY descriptorChanged FINAL) Q_PROPERTY(QString egu READ egu NOTIFY eguChanged FINAL) Q_PROPERTY(QCaDateTime dateTime READ dateTime NOTIFY dateTimeChanged FINAL) Q_PROPERTY(quint16 status READ status NOTIFY statusChanged FINAL) Q_PROPERTY(QPvObject::epicsAlarmSeverity severity READ severity NOTIFY severityChanged FINAL) Q_PROPERTY(QString statusName READ statusName NOTIFY statusNameChanged FINAL) Q_PROPERTY(QString severityName READ severityName NOTIFY severityNameChanged FINAL) Q_PROPERTY(quint32 hostElementCount READ hostElementCount NOTIFY hostElementCountChanged FINAL) Q_PROPERTY(quint32 dataElementCount READ dataElementCount NOTIFY dataElementCountChanged FINAL) Q_PROPERTY(bool readAccess READ readAccess NOTIFY readAccessChanged FINAL) Q_PROPERTY(bool writeAccess READ writeAccess NOTIFY writeAccessChanged FINAL) public: QString pvName() const; QVariant value() const; QPvObject::pvProtocol protocol() const; QPvObject::pvConnectionMode mode() const; QString hostName() const; QString fieldType() const; QString descriptor() const; QString egu() const; const QCaDateTime& dateTime() const; quint16 status() const; QPvObject::epicsAlarmSeverity severity() const; QString statusName() const; QString severityName() const; quint32 hostElementCount() const; quint32 dataElementCount() const; bool readAccess() const; bool writeAccess() const; public Q_SLOTS: virtual void setPvName(const QString &amp;pvname) = 0; virtual void setValue(const QVariant &amp;value) = 0; virtual void setMode(const QPvObject::pvConnectionMode &amp;mode); Q_SIGNALS: void pvNameChanged(const QString&); void valueChanged(const QVariant&); void protocolChanged(const QPvObject::pvProtocol&); void modeChanged(const QPvObject::pvConnectionMode&); void dateTimeChanged(const QCaDateTime&); void fieldTypeChanged(const QString&); void descriptorChanged(const QString&); void eguChanged(const QString&); void hostNameChanged(const QString&); void statusChanged(const quint16); void severityChanged(const QPvObject::epicsAlarmSeverity); void statusNameChanged(const QString); void severityNameChanged(const QString); void hostElementCountChanged(const quint32); void dataElementCountChanged(const quint32); void readAccessChanged(const bool); void writeAccessChanged(const bool); protected: QPointer&lt;qcaobject::QCaObject> m_caobject; // ... }; 注意到QPvObject类有两个虚函数setPvName和setValue，这两个函数需要子类实现。
...</p></div><footer class=entry-footer><span title='2025-02-20 16:27:36 +0800 +0800'>二月 20, 2025</span>&nbsp;·&nbsp;5 分钟&nbsp;·&nbsp;900 字</footer><a class=entry-link aria-label="post link to QML控件访问EPICS过程变量的思路" href=https://kira-96.github.io/posts/qml%E6%8E%A7%E4%BB%B6%E8%AE%BF%E9%97%AEepics%E8%BF%87%E7%A8%8B%E5%8F%98%E9%87%8F%E7%9A%84%E6%80%9D%E8%B7%AF/></a></article><article class="post-entry tag-entry"><header class=entry-header><h2 class=entry-hint-parent>EPICS Qt安装</h2></header><div class=entry-content><p>前言 本文主要记录了EPICS Qt在Linux上的安装步骤。这里以loongnix操作系统为例，Ubuntu系统上编译安装步骤类似。
EPICS Qt是一个基于Qt的分层框架，使用Channel Access （CA） and PV Access（PVA）访问EPICS数据。它是为快速开发控制系统图形界面而设计的，最初是在澳大利亚同步加速器开发的。
安装EPICS 这里不再写具体步骤了，总之就是非常简单，下载、解压、编译即可。具体步骤可以参考以前的文章。
安装Qt 直接使用终端安装Qt
1 2 3 4 5 sudo apt update sudo apt install qtbase5-dev qt5-qmake qtcreator sudo apt install qtdeclarative5-dev qttools5-dev # 安装Qt Svg库，编译QWT时需要用到 sudo apt install libqt5svg5-dev 安装QWT Qt EPICS推荐使用Qwt 6.1.4，如果在Ubuntu 20.04上直接通过终端安装也是这个版本。我使用Qwt 6.2.0编译，也是没有问题的，这里以Qwt 6.2.0为例。
最新测试：Qwt 6.3.0也可以用 ~
先下载Qwt的源码 下载Qwt-6.2.0。 下载完成后解压
1 2 3 4 # 解压tar.bz2 tar -jxvf qwt-6.2.0.tar.bz2 # 解压zip unzip qwt-6.2.0.zip 解压完成后编译Qwt，使用QtCreator或者在终端使用qmake都可以。
然后手动将编译生成的文件复制到以下位置，例：
1 2 3 4 5 6 7 # 复制编译生成的qwt sudo cp -r build-qwt-unknown-Release/lib/* /usr/lib/loongarch64-linux-gnu/ # 复制编译生成的designer插件 sudo cp build-qwt-unknown-Release/designer/plugins/designer/libqwt_designer_plugin.so /usr/lib/loongarch64-linux-gnu/qt5/plugins/designer/ # 复制qwt头文件 sudo mkdir /usr/include/qwt sudo cp qwt-6.2.0/src/*.h /usr/include/qwt 安装ACAI ACAI Channel Access Interface
...</p></div><footer class=entry-footer><span title='2023-05-04 15:06:56 +0800 +0800'>五月 4, 2023</span>&nbsp;·&nbsp;2 分钟&nbsp;·&nbsp;350 字</footer><a class=entry-link aria-label="post link to EPICS Qt安装" href=https://kira-96.github.io/posts/epics-qt%E5%AE%89%E8%A3%85/></a></article></main><footer class=footer><span>© 2019-2025 <a href=/>kira&rsquo;s blog</a></span> ·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script></body></html>